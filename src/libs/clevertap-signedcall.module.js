/* eslint-disable */
var e = { 435: e => { var t = 1e3, n = 60 * t, r = 60 * n, s = 24 * r, i = 7 * s, o = 365.25 * s; function l(e, t, n, r) { var s = t >= 1.5 * n; return Math.round(e / n) + " " + r + (s ? "s" : "") } e.exports = function (e, a) { a = a || {}; var u = typeof e; if ("string" === u && e.length > 0) return function (e) { if ((e = String(e)).length > 100) return; var l = /^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e); if (!l) return; var a = parseFloat(l[1]); switch ((l[2] || "ms").toLowerCase()) { case "years": case "year": case "yrs": case "yr": case "y": return a * o; case "weeks": case "week": case "w": return a * i; case "days": case "day": case "d": return a * s; case "hours": case "hour": case "hrs": case "hr": case "h": return a * r; case "minutes": case "minute": case "mins": case "min": case "m": return a * n; case "seconds": case "second": case "secs": case "sec": case "s": return a * t; case "milliseconds": case "millisecond": case "msecs": case "msec": case "ms": return a; default: return } }(e); if ("number" === u && isFinite(e)) return a.long ? function (e) { var i = Math.abs(e); if (i >= s) return l(e, i, s, "day"); if (i >= r) return l(e, i, r, "hour"); if (i >= n) return l(e, i, n, "minute"); if (i >= t) return l(e, i, t, "second"); return e + " ms" }(e) : function (e) { var i = Math.abs(e); if (i >= s) return Math.round(e / s) + "d"; if (i >= r) return Math.round(e / r) + "h"; if (i >= n) return Math.round(e / n) + "m"; if (i >= t) return Math.round(e / t) + "s"; return e + "ms" }(e); throw new Error("val is not a non-empty string or a valid number. val=" + JSON.stringify(e)) } }, 227: (e, t, n) => { t.formatArgs = function (t) { if (t[0] = (this.useColors ? "%c" : "") + this.namespace + (this.useColors ? " %c" : " ") + t[0] + (this.useColors ? "%c " : " ") + "+" + e.exports.humanize(this.diff), !this.useColors) return; const n = "color: " + this.color; t.splice(1, 0, n, "color: inherit"); let r = 0, s = 0; t[0].replace(/%[a-zA-Z%]/g, (e => { "%%" !== e && (r++, "%c" === e && (s = r)) })), t.splice(s, 0, n) }, t.save = function (e) { try { e ? t.storage.setItem("debug", e) : t.storage.removeItem("debug") } catch (e) { } }, t.load = function () { let e; try { e = t.storage.getItem("debug") } catch (e) { } !e && "undefined" != typeof process && "env" in process && (e = process.env.DEBUG); return e }, t.useColors = function () { if ("undefined" != typeof window && window.process && ("renderer" === window.process.type || window.process.__nwjs)) return !0; if ("undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)) return !1; return "undefined" != typeof document && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance || "undefined" != typeof window && window.console && (window.console.firebug || window.console.exception && window.console.table) || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/) }, t.storage = function () { try { return localStorage } catch (e) { } }(), t.destroy = (() => { let e = !1; return () => { e || (e = !0, console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")) } })(), t.colors = ["#0000CC", "#0000FF", "#0033CC", "#0033FF", "#0066CC", "#0066FF", "#0099CC", "#0099FF", "#00CC00", "#00CC33", "#00CC66", "#00CC99", "#00CCCC", "#00CCFF", "#3300CC", "#3300FF", "#3333CC", "#3333FF", "#3366CC", "#3366FF", "#3399CC", "#3399FF", "#33CC00", "#33CC33", "#33CC66", "#33CC99", "#33CCCC", "#33CCFF", "#6600CC", "#6600FF", "#6633CC", "#6633FF", "#66CC00", "#66CC33", "#9900CC", "#9900FF", "#9933CC", "#9933FF", "#99CC00", "#99CC33", "#CC0000", "#CC0033", "#CC0066", "#CC0099", "#CC00CC", "#CC00FF", "#CC3300", "#CC3333", "#CC3366", "#CC3399", "#CC33CC", "#CC33FF", "#CC6600", "#CC6633", "#CC9900", "#CC9933", "#CCCC00", "#CCCC33", "#FF0000", "#FF0033", "#FF0066", "#FF0099", "#FF00CC", "#FF00FF", "#FF3300", "#FF3333", "#FF3366", "#FF3399", "#FF33CC", "#FF33FF", "#FF6600", "#FF6633", "#FF9900", "#FF9933", "#FFCC00", "#FFCC33"], t.log = console.debug || console.log || (() => { }), e.exports = n(447)(t); const { formatters: r } = e.exports; r.j = function (e) { try { return JSON.stringify(e) } catch (e) { return "[UnexpectedJSONParseError]: " + e.message } } }, 447: (e, t, n) => { e.exports = function (e) { function t(e) { let n, s, i, o = null; function l(...e) { if (!l.enabled) return; const r = l, s = Number(new Date), i = s - (n || s); r.diff = i, r.prev = n, r.curr = s, n = s, e[0] = t.coerce(e[0]), "string" != typeof e[0] && e.unshift("%O"); let o = 0; e[0] = e[0].replace(/%([a-zA-Z%])/g, ((n, s) => { if ("%%" === n) return "%"; o++; const i = t.formatters[s]; if ("function" == typeof i) { const t = e[o]; n = i.call(r, t), e.splice(o, 1), o-- } return n })), t.formatArgs.call(r, e); (r.log || t.log).apply(r, e) } return l.namespace = e, l.useColors = t.useColors(), l.color = t.selectColor(e), l.extend = r, l.destroy = t.destroy, Object.defineProperty(l, "enabled", { enumerable: !0, configurable: !1, get: () => null !== o ? o : (s !== t.namespaces && (s = t.namespaces, i = t.enabled(e)), i), set: e => { o = e } }), "function" == typeof t.init && t.init(l), l } function r(e, n) { const r = t(this.namespace + (void 0 === n ? ":" : n) + e); return r.log = this.log, r } function s(e) { return e.toString().substring(2, e.toString().length - 2).replace(/\.\*\?$/, "*") } return t.debug = t, t.default = t, t.coerce = function (e) { if (e instanceof Error) return e.stack || e.message; return e }, t.disable = function () { const e = [...t.names.map(s), ...t.skips.map(s).map((e => "-" + e))].join(","); return t.enable(""), e }, t.enable = function (e) { let n; t.save(e), t.namespaces = e, t.names = [], t.skips = []; const r = ("string" == typeof e ? e : "").split(/[\s,]+/), s = r.length; for (n = 0; n < s; n++)r[n] && ("-" === (e = r[n].replace(/\*/g, ".*?"))[0] ? t.skips.push(new RegExp("^" + e.slice(1) + "$")) : t.names.push(new RegExp("^" + e + "$"))) }, t.enabled = function (e) { if ("*" === e[e.length - 1]) return !0; let n, r; for (n = 0, r = t.skips.length; n < r; n++)if (t.skips[n].test(e)) return !1; for (n = 0, r = t.names.length; n < r; n++)if (t.names[n].test(e)) return !0; return !1 }, t.humanize = n(435), t.destroy = function () { console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.") }, Object.keys(e).forEach((n => { t[n] = e[n] })), t.names = [], t.skips = [], t.formatters = {}, t.selectColor = function (e) { let n = 0; for (let t = 0; t < e.length; t++)n = (n << 5) - n + e.charCodeAt(t), n |= 0; return t.colors[Math.abs(n) % t.colors.length] }, t.enable(t.load()), t } }, 187: e => { var t, n = "object" == typeof Reflect ? Reflect : null, r = n && "function" == typeof n.apply ? n.apply : function (e, t, n) { return Function.prototype.apply.call(e, t, n) }; t = n && "function" == typeof n.ownKeys ? n.ownKeys : Object.getOwnPropertySymbols ? function (e) { return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)) } : function (e) { return Object.getOwnPropertyNames(e) }; var s = Number.isNaN || function (e) { return e != e }; function i() { i.init.call(this) } e.exports = i, e.exports.once = function (e, t) { return new Promise((function (n, r) { function s(n) { e.removeListener(t, i), r(n) } function i() { "function" == typeof e.removeListener && e.removeListener("error", s), n([].slice.call(arguments)) } _(e, t, i, { once: !0 }), "error" !== t && function (e, t, n) { "function" == typeof e.on && _(e, "error", t, n) }(e, s, { once: !0 }) })) }, i.EventEmitter = i, i.prototype._events = void 0, i.prototype._eventsCount = 0, i.prototype._maxListeners = void 0; var o = 10; function l(e) { if ("function" != typeof e) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof e) } function a(e) { return void 0 === e._maxListeners ? i.defaultMaxListeners : e._maxListeners } function u(e, t, n, r) { var s, i, o, u; if (l(n), void 0 === (i = e._events) ? (i = e._events = Object.create(null), e._eventsCount = 0) : (void 0 !== i.newListener && (e.emit("newListener", t, n.listener ? n.listener : n), i = e._events), o = i[t]), void 0 === o) o = i[t] = n, ++e._eventsCount; else if ("function" == typeof o ? o = i[t] = r ? [n, o] : [o, n] : r ? o.unshift(n) : o.push(n), (s = a(e)) > 0 && o.length > s && !o.warned) { o.warned = !0; var c = new Error("Possible EventEmitter memory leak detected. " + o.length + " " + String(t) + " listeners added. Use emitter.setMaxListeners() to increase limit"); c.name = "MaxListenersExceededWarning", c.emitter = e, c.type = t, c.count = o.length, u = c, console && console.warn && console.warn(u) } return e } function c() { if (!this.fired) return this.target.removeListener(this.type, this.wrapFn), this.fired = !0, 0 === arguments.length ? this.listener.call(this.target) : this.listener.apply(this.target, arguments) } function h(e, t, n) { var r = { fired: !1, wrapFn: void 0, target: e, type: t, listener: n }, s = c.bind(r); return s.listener = n, r.wrapFn = s, s } function d(e, t, n) { var r = e._events; if (void 0 === r) return []; var s = r[t]; return void 0 === s ? [] : "function" == typeof s ? n ? [s.listener || s] : [s] : n ? function (e) { for (var t = new Array(e.length), n = 0; n < t.length; ++n)t[n] = e[n].listener || e[n]; return t }(s) : p(s, s.length) } function f(e) { var t = this._events; if (void 0 !== t) { var n = t[e]; if ("function" == typeof n) return 1; if (void 0 !== n) return n.length } return 0 } function p(e, t) { for (var n = new Array(t), r = 0; r < t; ++r)n[r] = e[r]; return n } function _(e, t, n, r) { if ("function" == typeof e.on) r.once ? e.once(t, n) : e.on(t, n); else { if ("function" != typeof e.addEventListener) throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type ' + typeof e); e.addEventListener(t, (function s(i) { r.once && e.removeEventListener(t, s), n(i) })) } } Object.defineProperty(i, "defaultMaxListeners", { enumerable: !0, get: function () { return o }, set: function (e) { if ("number" != typeof e || e < 0 || s(e)) throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + e + "."); o = e } }), i.init = function () { void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 }, i.prototype.setMaxListeners = function (e) { if ("number" != typeof e || e < 0 || s(e)) throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + e + "."); return this._maxListeners = e, this }, i.prototype.getMaxListeners = function () { return a(this) }, i.prototype.emit = function (e) { for (var t = [], n = 1; n < arguments.length; n++)t.push(arguments[n]); var s = "error" === e, i = this._events; if (void 0 !== i) s = s && void 0 === i.error; else if (!s) return !1; if (s) { var o; if (t.length > 0 && (o = t[0]), o instanceof Error) throw o; var l = new Error("Unhandled error." + (o ? " (" + o.message + ")" : "")); throw l.context = o, l } var a = i[e]; if (void 0 === a) return !1; if ("function" == typeof a) r(a, this, t); else { var u = a.length, c = p(a, u); for (n = 0; n < u; ++n)r(c[n], this, t) } return !0 }, i.prototype.addListener = function (e, t) { return u(this, e, t, !1) }, i.prototype.on = i.prototype.addListener, i.prototype.prependListener = function (e, t) { return u(this, e, t, !0) }, i.prototype.once = function (e, t) { return l(t), this.on(e, h(this, e, t)), this }, i.prototype.prependOnceListener = function (e, t) { return l(t), this.prependListener(e, h(this, e, t)), this }, i.prototype.removeListener = function (e, t) { var n, r, s, i, o; if (l(t), void 0 === (r = this._events)) return this; if (void 0 === (n = r[e])) return this; if (n === t || n.listener === t) 0 == --this._eventsCount ? this._events = Object.create(null) : (delete r[e], r.removeListener && this.emit("removeListener", e, n.listener || t)); else if ("function" != typeof n) { for (s = -1, i = n.length - 1; i >= 0; i--)if (n[i] === t || n[i].listener === t) { o = n[i].listener, s = i; break } if (s < 0) return this; 0 === s ? n.shift() : function (e, t) { for (; t + 1 < e.length; t++)e[t] = e[t + 1]; e.pop() }(n, s), 1 === n.length && (r[e] = n[0]), void 0 !== r.removeListener && this.emit("removeListener", e, o || t) } return this }, i.prototype.off = i.prototype.removeListener, i.prototype.removeAllListeners = function (e) { var t, n, r; if (void 0 === (n = this._events)) return this; if (void 0 === n.removeListener) return 0 === arguments.length ? (this._events = Object.create(null), this._eventsCount = 0) : void 0 !== n[e] && (0 == --this._eventsCount ? this._events = Object.create(null) : delete n[e]), this; if (0 === arguments.length) { var s, i = Object.keys(n); for (r = 0; r < i.length; ++r)"removeListener" !== (s = i[r]) && this.removeAllListeners(s); return this.removeAllListeners("removeListener"), this._events = Object.create(null), this._eventsCount = 0, this } if ("function" == typeof (t = n[e])) this.removeListener(e, t); else if (void 0 !== t) for (r = t.length - 1; r >= 0; r--)this.removeListener(e, t[r]); return this }, i.prototype.listeners = function (e) { return d(this, e, !0) }, i.prototype.rawListeners = function (e) { return d(this, e, !1) }, i.listenerCount = function (e, t) { return "function" == typeof e.listenerCount ? e.listenerCount(t) : f.call(e, t) }, i.prototype.listenerCount = f, i.prototype.eventNames = function () { return this._eventsCount > 0 ? t(this._events) : [] } }, 830: (e, t, n) => { var r = n(424), s = n(965), i = n(790), o = n(987), l = n(351), a = n(63); t.settings = { authorization_user: null, password: null, realm: null, ha1: null, display_name: null, uri: null, contact_uri: null, instance_id: null, use_preloaded_route: !1, session_timers: !0, session_timers_refresh_method: s.UPDATE, no_answer_timeout: 60, register: !0, register_expires: 600, registrar_server: null, sockets: null, connection_recovery_max_interval: null, connection_recovery_min_interval: null, via_host: "".concat(r.createRandomToken(12), ".invalid") }; var u = { mandatory: { sockets: function (e) { var t = []; if (l.isSocket(e)) t.push({ socket: e }); else { if (!Array.isArray(e) || !e.length) return; var n = !0, r = !1, s = void 0; try { for (var i, o = e[Symbol.iterator](); !(n = (i = o.next()).done); n = !0){ var a = i.value; Object.prototype.hasOwnProperty.call(a, "socket") && l.isSocket(a.socket) ? t.push(a) : l.isSocket(a) && t.push({ socket: a }) } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } return t }, uri: function (e) { /^sip:/i.test(e) || (e = "".concat(s.SIP, ":").concat(e)); var t = o.parse(e); return t && t.user ? t : void 0 } }, optional: { authorization_user: function (e) { return -1 === i.parse('"'.concat(e, '"'), "quoted_string") ? void 0 : e }, user_agent: function (e) { if ("string" == typeof e) return e }, connection_recovery_max_interval: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, connection_recovery_min_interval: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, contact_uri: function (e) { if ("string" == typeof e) { var t = i.parse(e, "SIP_URI"); if (-1 !== t) return t } }, display_name: function (e) { return -1 === i.parse('"'.concat(e, '"'), "display_name") ? void 0 : e }, instance_id: function (e) { return /^uuid:/i.test(e) && (e = e.substr(5)), -1 === i.parse(e, "uuid") ? void 0 : e }, no_answer_timeout: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, session_timers: function (e) { if ("boolean" == typeof e) return e }, session_timers_refresh_method: function (e) { if ("string" == typeof e && ((e = e.toUpperCase()) === s.INVITE || e === s.UPDATE)) return e }, password: function (e) { return String(e) }, realm: function (e) { return String(e) }, ha1: function (e) { return String(e) }, register: function (e) { if ("boolean" == typeof e) return e }, register_expires: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, registrar_server: function (e) { /^sip:/i.test(e) || (e = "".concat(s.SIP, ":").concat(e)); var t = o.parse(e); return t ? t.user ? void 0 : t : void 0 }, use_preloaded_route: function (e) { if ("boolean" == typeof e) return e } } }; t.load = function (e, t) { for (var n in u.mandatory) { if (!t.hasOwnProperty(n)) throw new a.ConfigurationError(n); var s = t[n], i = u.mandatory[n](s); if (void 0 === i) throw new a.ConfigurationError(n, s); e[n] = i } for (var o in u.optional) if (t.hasOwnProperty(o)) { var l = t[o]; if (r.isEmpty(l)) continue; var c = u.optional[o](l); if (void 0 === c) throw new a.ConfigurationError(o, l); e[o] = c } } }, 965: (e, t, n) => { var r = n(403); e.exports = { USER_AGENT: "".concat(r.title, " ").concat(r.version), SIP: "sip", SIPS: "sips", causes: { CONNECTION_ERROR: "Connection Error", REQUEST_TIMEOUT: "Request Timeout", SIP_FAILURE_CODE: "SIP Failure Code", INTERNAL_ERROR: "Internal Error", BUSY: "Busy", REJECTED: "Rejected", REDIRECTED: "Redirected", UNAVAILABLE: "Unavailable", NOT_FOUND: "Not Found", ADDRESS_INCOMPLETE: "Address Incomplete", INCOMPATIBLE_SDP: "Incompatible SDP", MISSING_SDP: "Missing SDP", AUTHENTICATION_ERROR: "Authentication Error", BYE: "Terminated", WEBRTC_ERROR: "WebRTC Error", CANCELED: "Canceled", NO_ANSWER: "No Answer", EXPIRES: "Expires", NO_ACK: "No ACK", DIALOG_ERROR: "Dialog Error", USER_DENIED_MEDIA_ACCESS: "User Denied Media Access", BAD_MEDIA_DESCRIPTION: "Bad Media Description", RTP_TIMEOUT: "RTP Timeout" }, SIP_ERROR_CAUSES: { REDIRECTED: [300, 301, 302, 305, 380], BUSY: [486, 600], REJECTED: [403, 603], NOT_FOUND: [404, 604], UNAVAILABLE: [480, 410, 408, 430], ADDRESS_INCOMPLETE: [484, 424], INCOMPATIBLE_SDP: [488, 606], AUTHENTICATION_ERROR: [401, 407] }, ACK: "ACK", BYE: "BYE", CANCEL: "CANCEL", INFO: "INFO", INVITE: "INVITE", MESSAGE: "MESSAGE", NOTIFY: "NOTIFY", OPTIONS: "OPTIONS", REGISTER: "REGISTER", REFER: "REFER", UPDATE: "UPDATE", SUBSCRIBE: "SUBSCRIBE", REASON_PHRASE: { 100: "Trying", 180: "Ringing", 181: "Call Is Being Forwarded", 182: "Queued", 183: "Session Progress", 199: "Early Dialog Terminated", 200: "OK", 202: "Accepted", 204: "No Notification", 300: "Multiple Choices", 301: "Moved Permanently", 302: "Moved Temporarily", 305: "Use Proxy", 380: "Alternative Service", 400: "Bad Request", 401: "Unauthorized", 402: "Payment Required", 403: "Forbidden", 404: "Not Found", 405: "Method Not Allowed", 406: "Not Acceptable", 407: "Proxy Authentication Required", 408: "Request Timeout", 410: "Gone", 412: "Conditional Request Failed", 413: "Request Entity Too Large", 414: "Request-URI Too Long", 415: "Unsupported Media Type", 416: "Unsupported URI Scheme", 417: "Unknown Resource-Priority", 420: "Bad Extension", 421: "Extension Required", 422: "Session Interval Too Small", 423: "Interval Too Brief", 424: "Bad Location Information", 428: "Use Identity Header", 429: "Provide Referrer Identity", 430: "Flow Failed", 433: "Anonymity Disallowed", 436: "Bad Identity-Info", 437: "Unsupported Certificate", 438: "Invalid Identity Header", 439: "First Hop Lacks Outbound Support", 440: "Max-Breadth Exceeded", 469: "Bad Info Package", 470: "Consent Needed", 478: "Unresolvable Destination", 480: "Temporarily Unavailable", 481: "Call/Transaction Does Not Exist", 482: "Loop Detected", 483: "Too Many Hops", 484: "Address Incomplete", 485: "Ambiguous", 486: "Busy Here", 487: "Request Terminated", 488: "Not Acceptable Here", 489: "Bad Event", 491: "Request Pending", 493: "Undecipherable", 494: "Security Agreement Required", 500: "JsSIP Internal Error", 501: "Not Implemented", 502: "Bad Gateway", 503: "Service Unavailable", 504: "Server Time-out", 505: "Version Not Supported", 513: "Message Too Large", 580: "Precondition Failure", 600: "Busy Everywhere", 603: "Decline", 604: "Does Not Exist Anywhere", 606: "Not Acceptable" }, ALLOWED_METHODS: "INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO", ACCEPTED_BODY_TYPES: "application/sdp, application/dtmf-relay", MAX_FORWARDS: 69, SESSION_EXPIRES: 90, MIN_SESSION_EXPIRES: 60 } }, 316: (e, t, n) => { function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t, n) { return t && s(e.prototype, t), n && s(e, n), e } var o = n(497), l = n(965), a = n(754), u = n(604), c = n(424), h = n(227)("JsSIP:Dialog"), d = { STATUS_EARLY: 1, STATUS_CONFIRMED: 2 }; e.exports = function () { function e(t, n, s) { var i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : d.STATUS_CONFIRMED; if (r(this, e), this._owner = t, this._ua = t._ua, this._uac_pending_reply = !1, this._uas_pending_reply = !1, !n.hasHeader("contact")) return { error: "unable to create a Dialog without Contact header field" }; n instanceof o.IncomingResponse && (i = n.status_code < 200 ? d.STATUS_EARLY : d.STATUS_CONFIRMED); var l = n.parseHeader("contact"); "UAS" === s ? (this._id = { call_id: n.call_id, local_tag: n.to_tag, remote_tag: n.from_tag, toString: function () { return this.call_id + this.local_tag + this.remote_tag } }, this._state = i, this._remote_seqnum = n.cseq, this._local_uri = n.parseHeader("to").uri, this._remote_uri = n.parseHeader("from").uri, this._remote_target = l.uri, this._route_set = n.getHeaders("record-route"), this._ack_seqnum = this._remote_seqnum) : "UAC" === s && (this._id = { call_id: n.call_id, local_tag: n.from_tag, remote_tag: n.to_tag, toString: function () { return this.call_id + this.local_tag + this.remote_tag } }, this._state = i, this._local_seqnum = n.cseq, this._local_uri = n.parseHeader("from").uri, this._remote_uri = n.parseHeader("to").uri, this._remote_target = l.uri, this._route_set = n.getHeaders("record-route").reverse(), this._ack_seqnum = null), this._ua.newDialog(this), h("new ".concat(s, " dialog created with status ").concat(this._state === d.STATUS_EARLY ? "EARLY" : "CONFIRMED")) } return i(e, null, [{ key: "C", get: function () { return d } }]), i(e, [{ key: "update", value: function (e, t) { this._state = d.STATUS_CONFIRMED, h("dialog ".concat(this._id.toString(), "  changed to CONFIRMED state")), "UAC" === t && (this._route_set = e.getHeaders("record-route").reverse()) } }, { key: "terminate", value: function () { h("dialog ".concat(this._id.toString(), " deleted")), this._ua.destroyDialog(this) } }, { key: "sendRequest", value: function (e) { var t = this, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = c.cloneArray(n.extraHeaders), s = n.eventHandlers || {}, i = n.body || null, o = this._createRequest(e, r, i); s.onAuthenticated = function () { t._local_seqnum += 1 }; var l = new u(this, o, s); return l.send(), o } }, { key: "receiveRequest", value: function (e) { this._checkInDialogRequest(e) && (e.method === l.ACK && null !== this._ack_seqnum ? this._ack_seqnum = null : e.method === l.INVITE && (this._ack_seqnum = e.cseq), this._owner.receiveRequest(e)) } }, { key: "_createRequest", value: function (e, t, n) { t = c.cloneArray(t), this._local_seqnum || (this._local_seqnum = Math.floor(1e4 * Math.random())); var r = e === l.CANCEL || e === l.ACK ? this._local_seqnum : this._local_seqnum += 1; return new o.OutgoingRequest(e, this._remote_target, this._ua, { cseq: r, call_id: this._id.call_id, from_uri: this._local_uri, from_tag: this._id.local_tag, to_uri: this._remote_uri, to_tag: this._id.remote_tag, route_set: this._route_set }, t, n) } }, { key: "_checkInDialogRequest", value: function (e) { var t = this; if (this._remote_seqnum) if (e.cseq < this._remote_seqnum) { if (e.method !== l.ACK) return e.reply(500), !1; if (null === this._ack_seqnum || e.cseq !== this._ack_seqnum) return !1 } else e.cseq > this._remote_seqnum && (this._remote_seqnum = e.cseq); else this._remote_seqnum = e.cseq; if (e.method === l.INVITE || e.method === l.UPDATE && e.body) { if (!0 === this._uac_pending_reply) e.reply(491); else { if (!0 === this._uas_pending_reply) { var n = 1 + (10 * Math.random() | 0); return e.reply(500, null, ["Retry-After:".concat(n)]), !1 } this._uas_pending_reply = !0; e.server_transaction.on("stateChanged", (function n() { e.server_transaction.state !== a.C.STATUS_ACCEPTED && e.server_transaction.state !== a.C.STATUS_COMPLETED && e.server_transaction.state !== a.C.STATUS_TERMINATED || (e.server_transaction.removeListener("stateChanged", n), t._uas_pending_reply = !1) })) } e.hasHeader("contact") && e.server_transaction.on("stateChanged", (function () { e.server_transaction.state === a.C.STATUS_ACCEPTED && (t._remote_target = e.parseHeader("contact").uri) })) } else e.method === l.NOTIFY && e.hasHeader("contact") && e.server_transaction.on("stateChanged", (function () { e.server_transaction.state === a.C.STATUS_COMPLETED && (t._remote_target = e.parseHeader("contact").uri) })); return !0 } }, { key: "id", get: function () { return this._id } }, { key: "local_seqnum", get: function () { return this._local_seqnum }, set: function (e) { this._local_seqnum = e } }, { key: "owner", get: function () { return this._owner } }, { key: "uac_pending_reply", get: function () { return this._uac_pending_reply }, set: function (e) { this._uac_pending_reply = e } }, { key: "uas_pending_reply", get: function () { return this._uas_pending_reply } }]), e }() }, 604: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(965), i = n(754), o = n(906), l = n(66), a = { onRequestTimeout: function () { }, onTransportError: function () { }, onSuccessResponse: function () { }, onErrorResponse: function () { }, onAuthenticated: function () { }, onDialogError: function () { } }; e.exports = function () { function e(t, n, r) { for (var s in function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._dialog = t, this._ua = t._ua, this._request = n, this._eventHandlers = r, this._reattempt = !1, this._reattemptTimer = null, a) Object.prototype.hasOwnProperty.call(a, s) && (this._eventHandlers[s] || (this._eventHandlers[s] = a[s])) } var t, n, u; return t = e, (n = [{ key: "send", value: function () { var e = this, t = new l(this._ua, this._request, { onRequestTimeout: function () { e._eventHandlers.onRequestTimeout() }, onTransportError: function () { e._eventHandlers.onTransportError() }, onAuthenticated: function (t) { e._eventHandlers.onAuthenticated(t) }, onReceiveResponse: function (t) { e._receiveResponse(t) } }); t.send(), (this._request.method === s.INVITE || this._request.method === s.UPDATE && this._request.body) && t.clientTransaction.state !== i.C.STATUS_TERMINATED && (this._dialog.uac_pending_reply = !0, t.clientTransaction.on("stateChanged", (function n() { t.clientTransaction.state !== i.C.STATUS_ACCEPTED && t.clientTransaction.state !== i.C.STATUS_COMPLETED && t.clientTransaction.state !== i.C.STATUS_TERMINATED || (t.clientTransaction.removeListener("stateChanged", n), e._dialog.uac_pending_reply = !1) }))) } }, { key: "_receiveResponse", value: function (e) { var t = this; 408 === e.status_code || 481 === e.status_code ? this._eventHandlers.onDialogError(e) : e.method === s.INVITE && 491 === e.status_code ? this._reattempt ? e.status_code >= 200 && e.status_code < 300 ? this._eventHandlers.onSuccessResponse(e) : e.status_code >= 300 && this._eventHandlers.onErrorResponse(e) : (this._request.cseq.value = this._dialog.local_seqnum += 1, this._reattemptTimer = setTimeout((function () { t._dialog.owner.status !== o.C.STATUS_TERMINATED && (t._reattempt = !0, t._request_sender.send()) }), 1e3)) : e.status_code >= 200 && e.status_code < 300 ? this._eventHandlers.onSuccessResponse(e) : e.status_code >= 300 && this._eventHandlers.onErrorResponse(e) } }, { key: "request", get: function () { return this._request } }]) && r(t.prototype, n), u && r(t, u), e }() }, 999: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(424), i = n(227)("JsSIP:DigestAuthentication"), o = n(227)("JsSIP:ERROR:DigestAuthentication"); o.log = console.warn.bind(console), e.exports = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._credentials = t, this._cnonce = null, this._nc = 0, this._ncHex = "00000000", this._algorithm = null, this._realm = null, this._nonce = null, this._opaque = null, this._stale = null, this._qop = null, this._method = null, this._uri = null, this._ha1 = null, this._response = null } var t, n, l; return t = e, n = [{ key: "get", value: function (e) { switch (e) { case "realm": return this._realm; case "ha1": return this._ha1; default: return void o('get() | cannot get "%s" parameter', e) } } }, { key: "authenticate", value: function (e, t) { var n = e.method, r = e.ruri, l = e.body, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; if (this._algorithm = t.algorithm, this._realm = t.realm, this._nonce = t.nonce, this._opaque = t.opaque, this._stale = t.stale, this._algorithm) { if ("MD5" !== this._algorithm) return o('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'), !1 } else this._algorithm = "MD5"; if (!this._nonce) return o("authenticate() | challenge without Digest nonce, authentication aborted"), !1; if (!this._realm) return o("authenticate() | challenge without Digest realm, authentication aborted"), !1; if (!this._credentials.password) { if (!this._credentials.ha1) return o("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"), !1; if (this._credentials.realm !== this._realm) return o('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]', this._credentials.realm, this._realm), !1 } if (t.qop) if (t.qop.indexOf("auth-int") > -1) this._qop = "auth-int"; else { if (!(t.qop.indexOf("auth") > -1)) return o('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'), !1; this._qop = "auth" } else this._qop = null; this._method = n, this._uri = r, this._cnonce = a || s.createRandomToken(12), this._nc += 1; var u, c = Number(this._nc).toString(16); return this._ncHex = "00000000".substr(0, 8 - c.length) + c, 4294967296 === this._nc && (this._nc = 1, this._ncHex = "00000001"), this._credentials.password ? this._ha1 = s.calculateMD5("".concat(this._credentials.username, ":").concat(this._realm, ":").concat(this._credentials.password)) : this._ha1 = this._credentials.ha1, "auth" === this._qop ? (u = s.calculateMD5("".concat(this._method, ":").concat(this._uri)), this._response = s.calculateMD5("".concat(this._ha1, ":").concat(this._nonce, ":").concat(this._ncHex, ":").concat(this._cnonce, ":auth:").concat(u))) : "auth-int" === this._qop ? (u = s.calculateMD5("".concat(this._method, ":").concat(this._uri, ":").concat(s.calculateMD5(l || ""))), this._response = s.calculateMD5("".concat(this._ha1, ":").concat(this._nonce, ":").concat(this._ncHex, ":").concat(this._cnonce, ":auth-int:").concat(u))) : null === this._qop && (u = s.calculateMD5("".concat(this._method, ":").concat(this._uri)), this._response = s.calculateMD5("".concat(this._ha1, ":").concat(this._nonce, ":").concat(u))), i("authenticate() | response generated"), !0 } }, { key: "toString", value: function () { var e = []; if (!this._response) throw new Error("response field does not exist, cannot generate Authorization header"); return e.push("algorithm=".concat(this._algorithm)), e.push('username="'.concat(this._credentials.username, '"')), e.push('realm="'.concat(this._realm, '"')), e.push('nonce="'.concat(this._nonce, '"')), e.push('uri="'.concat(this._uri, '"')), e.push('response="'.concat(this._response, '"')), this._opaque && e.push('opaque="'.concat(this._opaque, '"')), this._qop && (e.push("qop=".concat(this._qop)), e.push('cnonce="'.concat(this._cnonce, '"')), e.push("nc=".concat(this._ncHex))), "Digest ".concat(e.join(", ")) } }], n && r(t.prototype, n), l && r(t, l), e }() }, 63: e => { function t(e) { return t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, t(e) } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function r(e, n) { return !n || "object" !== t(n) && "function" != typeof n ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : n } function s(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) } function i(e) { var t = "function" == typeof Map ? new Map : void 0; return i = function (e) { if (null === e || (n = e, -1 === Function.toString.call(n).indexOf("[native code]"))) return e; var n; if ("function" != typeof e) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== t) { if (t.has(e)) return t.get(e); t.set(e, r) } function r() { return l(e, arguments, u(this).constructor) } return r.prototype = Object.create(e.prototype, { constructor: { value: r, enumerable: !1, writable: !0, configurable: !0 } }), a(r, e) }, i(e) } function o() { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Date.prototype.toString.call(Reflect.construct(Date, [], (function () { }))), !0 } catch (e) { return !1 } } function l(e, t, n) { return l = o() ? Reflect.construct : function (e, t, n) { var r = [null]; r.push.apply(r, t); var s = new (Function.bind.apply(e, r)); return n && a(s, n.prototype), s }, l.apply(null, arguments) } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } function u(e) { return u = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, u(e) } var c = function (e) { function t(e, s) { var i; return n(this, t), (i = r(this, u(t).call(this))).code = 1, i.name = "CONFIGURATION_ERROR", i.parameter = e, i.value = s, i.message = i.value ? "Invalid value ".concat(JSON.stringify(i.value), ' for parameter "').concat(i.parameter, '"') : "Missing parameter: ".concat(i.parameter), i } return s(t, e), t }(i(Error)), h = function (e) { function t(e) { var s; return n(this, t), (s = r(this, u(t).call(this))).code = 2, s.name = "INVALID_STATE_ERROR", s.status = e, s.message = "Invalid status: ".concat(e), s } return s(t, e), t }(i(Error)), d = function (e) { function t(e) { var s; return n(this, t), (s = r(this, u(t).call(this))).code = 3, s.name = "NOT_SUPPORTED_ERROR", s.message = e, s } return s(t, e), t }(i(Error)), f = function (e) { function t(e) { var s; return n(this, t), (s = r(this, u(t).call(this))).code = 4, s.name = "NOT_READY_ERROR", s.message = e, s } return s(t, e), t }(i(Error)); e.exports = { ConfigurationError: c, InvalidStateError: h, NotSupportedError: d, NotReadyError: f } }, 790: (e, t, n) => { e.exports = function () { function e(e) { return '"' + e.replace(/\\/g, "\\\\").replace(/"/g, '\\"').replace(/\x08/g, "\\b").replace(/\t/g, "\\t").replace(/\n/g, "\\n").replace(/\f/g, "\\f").replace(/\r/g, "\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g, escape) + '"' } var t = { parse: function (t, r) { var s = { CRLF: u, DIGIT: c, ALPHA: h, HEXDIG: d, WSP: f, OCTET: p, DQUOTE: _, SP: m, HTAB: g, alphanum: v, reserved: y, unreserved: T, mark: C, escaped: S, LWS: E, SWS: b, HCOLON: A, TEXT_UTF8_TRIM: w, TEXT_UTF8char: R, UTF8_NONASCII: I, UTF8_CONT: k, LHEX: function () { var e; null === (e = c()) && (/^[a-f]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[a-f]"))); return e }, token: O, token_nodot: x, separators: function () { var e; 40 === t.charCodeAt(i) ? (e = "(", i++) : (e = null, a('"("')); null === e && (41 === t.charCodeAt(i) ? (e = ")", i++) : (e = null, a('")"')), null === e && (60 === t.charCodeAt(i) ? (e = "<", i++) : (e = null, a('"<"')), null === e && (62 === t.charCodeAt(i) ? (e = ">", i++) : (e = null, a('">"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, a('"@"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, a('","')), null === e && (59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, a('";"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, a('":"')), null === e && (92 === t.charCodeAt(i) ? (e = "\\", i++) : (e = null, a('"\\\\"')), null === e && null === (e = _()) && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, a('"/"')), null === e && (91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, a('"["')), null === e && (93 === t.charCodeAt(i) ? (e = "]", i++) : (e = null, a('"]"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, a('"?"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, a('"="')), null === e && (123 === t.charCodeAt(i) ? (e = "{", i++) : (e = null, a('"{"')), null === e && (125 === t.charCodeAt(i) ? (e = "}", i++) : (e = null, a('"}"')), null === e && null === (e = m()) && (e = g())))))))))))))))); return e }, word: N, STAR: D, SLASH: P, EQUAL: L, LPAREN: U, RPAREN: M, RAQUOT: q, LAQUOT: H, COMMA: F, SEMI: j, COLON: B, LDQUOT: V, RDQUOT: G, comment: function e() { var t, n, r, s; if (s = i, null !== (t = U())) { for (n = [], null === (r = W()) && null === (r = J()) && (r = e()); null !== r;)n.push(r), null === (r = W()) && null === (r = J()) && (r = e()); null !== n && null !== (r = M()) ? t = [t, n, r] : (t = null, i = s) } else t = null, i = s; return t }, ctext: W, quoted_string: K, quoted_string_clean: $, qdtext: z, quoted_pair: J, SIP_URI_noparams: Y, SIP_URI: X, uri_scheme: Q, uri_scheme_sips: Z, uri_scheme_sip: ee, userinfo: te, user: ne, user_unreserved: re, password: se, hostport: ie, host: oe, hostname: le, domainlabel: ae, toplabel: ue, IPv6reference: ce, IPv6address: he, h16: de, ls32: fe, IPv4address: pe, dec_octet: _e, port: me, uri_parameters: ge, uri_parameter: ve, transport_param: ye, user_param: Te, method_param: Ce, ttl_param: Se, maddr_param: Ee, lr_param: be, other_param: Ae, pname: we, pvalue: Re, paramchar: Ie, param_unreserved: ke, headers: Oe, header: xe, hname: Ne, hvalue: De, hnv_unreserved: Pe, Request_Response: function () { var e; null === (e = ct()) && (e = Le()); return e }, Request_Line: Le, Request_URI: Ue, absoluteURI: Me, hier_part: qe, net_path: He, abs_path: Fe, opaque_part: je, uric: Be, uric_no_slash: Ve, path_segments: Ge, segment: We, param: Ke, pchar: $e, scheme: ze, authority: Je, srvr: Ye, reg_name: Xe, query: Qe, SIP_Version: Ze, INVITEm: et, ACKm: tt, OPTIONSm: nt, BYEm: rt, CANCELm: st, REGISTERm: it, SUBSCRIBEm: ot, NOTIFYm: lt, REFERm: at, Method: ut, Status_Line: ct, Status_Code: ht, extension_code: dt, Reason_Phrase: ft, Allow_Events: function () { var e, t, n, r, s, o; if (s = i, null !== (e = Mt())) { for (t = [], o = i, null !== (n = F()) && null !== (r = Mt()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = Mt()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Call_ID: function () { var e, n, r, s, o, l; s = i, o = i, null !== (e = N()) ? (l = i, 64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, a('"@"')), null !== n && null !== (r = N()) ? n = [n, r] : (n = null, i = l), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o); null !== e && (e = function (e) { Hn = t.substring(i, e) }(s)); null === e && (i = s); return e }, Contact: function () { var e, t, n, r, s, o, l; if (s = i, null === (e = D())) if (o = i, null !== (e = pt())) { for (t = [], l = i, null !== (n = F()) && null !== (r = pt()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = F()) && null !== (r = pt()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t, n; for (n = Hn.multi_header.length, t = 0; t < n; t++)if (null === Hn.multi_header[t].parsed) { Hn = null; break } Hn = null !== Hn ? Hn.multi_header : -1 }()); null === e && (i = s); return e }, contact_param: pt, name_addr: _t, display_name: mt, contact_params: gt, c_p_q: vt, c_p_expires: yt, delta_seconds: Tt, qvalue: Ct, generic_param: St, gen_value: Et, Content_Disposition: function () { var e, t, n, r, s, o; if (s = i, null !== (e = bt())) { for (t = [], o = i, null !== (n = j()) && null !== (r = At()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = j()) && null !== (r = At()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, disp_type: bt, disp_param: At, handling_param: wt, Content_Encoding: function () { var e, t, n, r, s, o; if (s = i, null !== (e = O())) { for (t = [], o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Content_Length: function () { var e, t, n; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; null !== e && (e = void (Hn = parseInt(e.join("")))); null === e && (i = n); return e }, Content_Type: function () { var e, n; n = i, null !== (e = Rt()) && (e = function (e) { Hn = t.substring(i, e) }(n)); null === e && (i = n); return e }, media_type: Rt, m_type: It, discrete_type: kt, composite_type: Ot, extension_token: xt, x_token: Nt, m_subtype: Dt, m_parameter: Pt, m_value: Lt, CSeq: function () { var e, t, n, r; r = i, null !== (e = Ut()) && null !== (t = E()) && null !== (n = ut()) ? e = [e, t, n] : (e = null, i = r); return e }, CSeq_value: Ut, Expires: function () { var e, t; t = i, null !== (e = Tt()) && (e = void (Hn = e)); null === e && (i = t); return e }, Event: function () { var e, t, n, r, s, o, l; if (s = i, o = i, null !== (e = Mt())) { for (t = [], l = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (a = e[0], e = void (Hn.event = a.join("").toLowerCase())); var a; null === e && (i = s); return e }, event_type: Mt, From: function () { var e, t, n, r, s, o, l; s = i, o = i, null === (e = Y()) && (e = _t()); if (null !== e) { for (t = [], l = i, null !== (n = j()) && null !== (r = qt()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = j()) && null !== (r = qt()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t = Hn.tag; try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params), t && Hn.setParam("tag", t) } catch (e) { Hn = -1 } }()); null === e && (i = s); return e }, from_param: qt, tag_param: Ht, Max_Forwards: function () { var e, t, n; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; null !== e && (e = void (Hn = parseInt(e.join("")))); null === e && (i = n); return e }, Min_Expires: function () { var e, t; t = i, null !== (e = Tt()) && (e = void (Hn = e)); null === e && (i = t); return e }, Name_Addr_Header: function () { var e, t, n, r, s, o, l, a, u, c; a = i, u = i, e = [], t = mt(); for (; null !== t;)e.push(t), t = mt(); if (null !== e) if (null !== (t = H())) if (null !== (n = X())) if (null !== (r = q())) { for (s = [], c = i, null !== (o = j()) && null !== (l = St()) ? o = [o, l] : (o = null, i = c); null !== o;)s.push(o), c = i, null !== (o = j()) && null !== (l = St()) ? o = [o, l] : (o = null, i = c); null !== s ? e = [e, t, n, r, s] : (e = null, i = u) } else e = null, i = u; else e = null, i = u; else e = null, i = u; else e = null, i = u; null !== e && (e = function (e) { try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params) } catch (e) { Hn = -1 } }()); null === e && (i = a); return e }, Proxy_Authenticate: function () { return Ft() }, challenge: Ft, other_challenge: jt, auth_param: Bt, digest_cln: Vt, realm: Gt, realm_value: Wt, domain: Kt, URI: $t, nonce: zt, nonce_value: Jt, opaque: Yt, stale: Xt, algorithm: Qt, qop_options: Zt, qop_value: en, Proxy_Require: function () { var e, t, n, r, s, o; if (s = i, null !== (e = O())) { for (t = [], o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Record_Route: function () { var e, t, n, r, s, o, l; if (s = i, o = i, null !== (e = tn())) { for (t = [], l = i, null !== (n = F()) && null !== (r = tn()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = F()) && null !== (r = tn()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t, n; for (n = Hn.multi_header.length, t = 0; t < n; t++)if (null === Hn.multi_header[t].parsed) { Hn = null; break } Hn = null !== Hn ? Hn.multi_header : -1 }()); null === e && (i = s); return e }, rec_route: tn, Reason: function () { var e, n, r, s, o, l, u; o = i, l = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"SIP"')); null === e && (e = O()); if (null !== e) { for (n = [], u = i, null !== (r = j()) && null !== (s = nn()) ? r = [r, s] : (r = null, i = u); null !== r;)n.push(r), u = i, null !== (r = j()) && null !== (s = nn()) ? r = [r, s] : (r = null, i = u); null !== n ? e = [e, n] : (e = null, i = l) } else e = null, i = l; null !== e && (e = function (e, t) { if (Hn.protocol = t.toLowerCase(), Hn.params || (Hn.params = {}), Hn.params.text && '"' === Hn.params.text[0]) { var n = Hn.params.text; Hn.text = n.substring(1, n.length - 1), delete Hn.params.text } }(0, e[0])); null === e && (i = o); return e }, reason_param: nn, reason_cause: rn, Require: function () { var e, t, n, r, s, o; if (s = i, null !== (e = O())) { for (t = [], o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Route: function () { var e, t, n, r, s, o; if (s = i, null !== (e = sn())) { for (t = [], o = i, null !== (n = F()) && null !== (r = sn()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = sn()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, route_param: sn, Subscription_State: function () { var e, t, n, r, s, o; if (s = i, null !== (e = on())) { for (t = [], o = i, null !== (n = j()) && null !== (r = ln()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = j()) && null !== (r = ln()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, substate_value: on, subexp_params: ln, event_reason_value: an, Subject: function () { var e; return e = null !== (e = w()) ? e : "" }, Supported: function () { var e, t, n, r, s, o; if (s = i, null !== (e = O())) { for (t = [], o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = O()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e = null !== e ? e : "" }, To: function () { var e, t, n, r, s, o, l; s = i, o = i, null === (e = Y()) && (e = _t()); if (null !== e) { for (t = [], l = i, null !== (n = j()) && null !== (r = un()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = j()) && null !== (r = un()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t = Hn.tag; try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params), t && Hn.setParam("tag", t) } catch (e) { Hn = -1 } }()); null === e && (i = s); return e }, to_param: un, Via: function () { var e, t, n, r, s, o; if (s = i, null !== (e = cn())) { for (t = [], o = i, null !== (n = F()) && null !== (r = cn()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = cn()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, via_param: cn, via_params: hn, via_ttl: dn, via_maddr: fn, via_received: pn, via_branch: _n, response_port: mn, sent_protocol: gn, protocol_name: vn, transport: yn, sent_by: Tn, via_host: Cn, via_port: Sn, ttl: En, WWW_Authenticate: function () { return Ft() }, Session_Expires: function () { var e, t, n, r, s, o; if (s = i, null !== (e = bn())) { for (t = [], o = i, null !== (n = j()) && null !== (r = An()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = j()) && null !== (r = An()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, s_e_expires: bn, s_e_params: An, s_e_refresher: wn, extension_header: function () { var e, t, n, r; r = i, null !== (e = O()) && null !== (t = A()) && null !== (n = Rn()) ? e = [e, t, n] : (e = null, i = r); return e }, header_value: Rn, message_body: function () { var e, t; e = [], t = p(); for (; null !== t;)e.push(t), t = p(); return e }, uuid_URI: function () { var e, n, r; r = i, "uuid:" === t.substr(i, 5) ? (e = "uuid:", i += 5) : (e = null, a('"uuid:"')); null !== e && null !== (n = In()) ? e = [e, n] : (e = null, i = r); return e }, uuid: In, hex4: kn, hex8: On, hex12: xn, Refer_To: function () { var e, t, n, r, s, o, l; s = i, o = i, null === (e = Y()) && (e = _t()); if (null !== e) { for (t = [], l = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params) } catch (e) { Hn = -1 } }()); null === e && (i = s); return e }, Replaces: function () { var e, t, n, r, s, o; if (s = i, null !== (e = Nn())) { for (t = [], o = i, null !== (n = j()) && null !== (r = Dn()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = j()) && null !== (r = Dn()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, call_id: Nn, replaces_param: Dn, to_tag: Pn, from_tag: Ln, early_flag: Un }; if (void 0 !== r) { if (void 0 === s[r]) throw new Error("Invalid rule name: " + e(r) + ".") } else r = "CRLF"; var i = 0, o = 0, l = []; function a(e) { i < o || (i > o && (o = i, l = []), l.push(e)) } function u() { var e; return "\r\n" === t.substr(i, 2) ? (e = "\r\n", i += 2) : (e = null, a('"\\r\\n"')), e } function c() { var e; return /^[0-9]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[0-9]")), e } function h() { var e; return /^[a-zA-Z]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[a-zA-Z]")), e } function d() { var e; return /^[0-9a-fA-F]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[0-9a-fA-F]")), e } function f() { var e; return null === (e = m()) && (e = g()), e } function p() { var e; return /^[\0-\xFF]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[\\0-\\xFF]")), e } function _() { var e; return /^["]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a('["]')), e } function m() { var e; return 32 === t.charCodeAt(i) ? (e = " ", i++) : (e = null, a('" "')), e } function g() { var e; return 9 === t.charCodeAt(i) ? (e = "\t", i++) : (e = null, a('"\\t"')), e } function v() { var e; return /^[a-zA-Z0-9]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[a-zA-Z0-9]")), e } function y() { var e; return 59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, a('";"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, a('"/"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, a('"?"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, a('":"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, a('"@"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, a('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, a('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, a('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, a('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, a('","'))))))))))), e } function T() { var e; return null === (e = v()) && (e = C()), e } function C() { var e; return 45 === t.charCodeAt(i) ? (e = "-", i++) : (e = null, a('"-"')), null === e && (95 === t.charCodeAt(i) ? (e = "_", i++) : (e = null, a('"_"')), null === e && (46 === t.charCodeAt(i) ? (e = ".", i++) : (e = null, a('"."')), null === e && (33 === t.charCodeAt(i) ? (e = "!", i++) : (e = null, a('"!"')), null === e && (126 === t.charCodeAt(i) ? (e = "~", i++) : (e = null, a('"~"')), null === e && (42 === t.charCodeAt(i) ? (e = "*", i++) : (e = null, a('"*"')), null === e && (39 === t.charCodeAt(i) ? (e = "'", i++) : (e = null, a('"\'"')), null === e && (40 === t.charCodeAt(i) ? (e = "(", i++) : (e = null, a('"("')), null === e && (41 === t.charCodeAt(i) ? (e = ")", i++) : (e = null, a('")"')))))))))), e } function S() { var e, n, r, s, o; return s = i, o = i, 37 === t.charCodeAt(i) ? (e = "%", i++) : (e = null, a('"%"')), null !== e && null !== (n = d()) && null !== (r = d()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = e.join("")), null === e && (i = s), e } function E() { var e, t, n, r, s, o; for (r = i, s = i, o = i, e = [], t = f(); null !== t;)e.push(t), t = f(); if (null !== e && null !== (t = u()) ? e = [e, t] : (e = null, i = o), null !== (e = null !== e ? e : "")) { if (null !== (n = f())) for (t = []; null !== n;)t.push(n), n = f(); else t = null; null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return null !== e && (e = " "), null === e && (i = r), e } function b() { var e; return e = null !== (e = E()) ? e : "" } function A() { var e, n, r, s, o; for (s = i, o = i, e = [], null === (n = m()) && (n = g()); null !== n;)e.push(n), null === (n = m()) && (n = g()); return null !== e ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ":"), null === e && (i = s), e } function w() { var e, n, r, s, o, l, a; if (o = i, l = i, null !== (n = R())) for (e = []; null !== n;)e.push(n), n = R(); else e = null; if (null !== e) { for (n = [], a = i, r = [], s = E(); null !== s;)r.push(s), s = E(); for (null !== r && null !== (s = R()) ? r = [r, s] : (r = null, i = a); null !== r;){ for (n.push(r), a = i, r = [], s = E(); null !== s;)r.push(s), s = E(); null !== r && null !== (s = R()) ? r = [r, s] : (r = null, i = a) } null !== n ? e = [e, n] : (e = null, i = l) } else e = null, i = l; return null !== e && (e = function (e) { return t.substring(i, e) }(o)), null === e && (i = o), e } function R() { var e; return /^[!-~]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[!-~]")), null === e && (e = I()), e } function I() { var e; return /^[\x80-\uFFFF]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[\\x80-\\uFFFF]")), e } function k() { var e; return /^[\x80-\xBF]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[\\x80-\\xBF]")), e } function O() { var e, n, r; if (r = i, null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, a('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, a('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, a('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, a('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, a('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, a('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, a('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, a('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, a('"~"')))))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, a('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, a('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, a('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, a('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, a('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, a('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, a('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, a('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, a('"~"')))))))))))); else e = null; return null !== e && (e = function (e) { return t.substring(i, e) }(r)), null === e && (i = r), e } function x() { var e, n, r; if (r = i, null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, a('"-"')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, a('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, a('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, a('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, a('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, a('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, a('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, a('"~"'))))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, a('"-"')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, a('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, a('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, a('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, a('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, a('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, a('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, a('"~"'))))))))))); else e = null; return null !== e && (e = function (e) { return t.substring(i, e) }(r)), null === e && (i = r), e } function N() { var e, n, r; if (r = i, null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, a('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, a('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, a('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, a('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, a('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, a('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, a('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, a('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, a('"~"')), null === n && (40 === t.charCodeAt(i) ? (n = "(", i++) : (n = null, a('"("')), null === n && (41 === t.charCodeAt(i) ? (n = ")", i++) : (n = null, a('")"')), null === n && (60 === t.charCodeAt(i) ? (n = "<", i++) : (n = null, a('"<"')), null === n && (62 === t.charCodeAt(i) ? (n = ">", i++) : (n = null, a('">"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null === n && (92 === t.charCodeAt(i) ? (n = "\\", i++) : (n = null, a('"\\\\"')), null === n && null === (n = _()) && (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, a('"/"')), null === n && (91 === t.charCodeAt(i) ? (n = "[", i++) : (n = null, a('"["')), null === n && (93 === t.charCodeAt(i) ? (n = "]", i++) : (n = null, a('"]"')), null === n && (63 === t.charCodeAt(i) ? (n = "?", i++) : (n = null, a('"?"')), null === n && (123 === t.charCodeAt(i) ? (n = "{", i++) : (n = null, a('"{"')), null === n && (125 === t.charCodeAt(i) ? (n = "}", i++) : (n = null, a('"}"')))))))))))))))))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, a('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, a('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, a('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, a('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, a('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, a('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, a('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, a('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, a('"~"')), null === n && (40 === t.charCodeAt(i) ? (n = "(", i++) : (n = null, a('"("')), null === n && (41 === t.charCodeAt(i) ? (n = ")", i++) : (n = null, a('")"')), null === n && (60 === t.charCodeAt(i) ? (n = "<", i++) : (n = null, a('"<"')), null === n && (62 === t.charCodeAt(i) ? (n = ">", i++) : (n = null, a('">"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null === n && (92 === t.charCodeAt(i) ? (n = "\\", i++) : (n = null, a('"\\\\"')), null === n && null === (n = _()) && (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, a('"/"')), null === n && (91 === t.charCodeAt(i) ? (n = "[", i++) : (n = null, a('"["')), null === n && (93 === t.charCodeAt(i) ? (n = "]", i++) : (n = null, a('"]"')), null === n && (63 === t.charCodeAt(i) ? (n = "?", i++) : (n = null, a('"?"')), null === n && (123 === t.charCodeAt(i) ? (n = "{", i++) : (n = null, a('"{"')), null === n && (125 === t.charCodeAt(i) ? (n = "}", i++) : (n = null, a('"}"')))))))))))))))))))))))); else e = null; return null !== e && (e = function (e) { return t.substring(i, e) }(r)), null === e && (i = r), e } function D() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, a('"*"')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "*"), null === e && (i = s), e } function P() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, a('"/"')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "/"), null === e && (i = s), e } function L() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "="), null === e && (i = s), e } function U() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (40 === t.charCodeAt(i) ? (n = "(", i++) : (n = null, a('"("')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "("), null === e && (i = s), e } function M() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (41 === t.charCodeAt(i) ? (n = ")", i++) : (n = null, a('")"')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ")"), null === e && (i = s), e } function q() { var e, n, r, s; return r = i, s = i, 62 === t.charCodeAt(i) ? (e = ">", i++) : (e = null, a('">"')), null !== e && null !== (n = b()) ? e = [e, n] : (e = null, i = s), null !== e && (e = ">"), null === e && (i = r), e } function H() { var e, n, r, s; return r = i, s = i, null !== (e = b()) ? (60 === t.charCodeAt(i) ? (n = "<", i++) : (n = null, a('"<"')), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== e && (e = "<"), null === e && (i = r), e } function F() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, a('","')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ","), null === e && (i = s), e } function j() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, a('";"')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ";"), null === e && (i = s), e } function B() { var e, n, r, s, o; return s = i, o = i, null !== (e = b()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = b()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ":"), null === e && (i = s), e } function V() { var e, t, n, r; return n = i, r = i, null !== (e = b()) && null !== (t = _()) ? e = [e, t] : (e = null, i = r), null !== e && (e = '"'), null === e && (i = n), e } function G() { var e, t, n, r; return n = i, r = i, null !== (e = _()) && null !== (t = b()) ? e = [e, t] : (e = null, i = r), null !== e && (e = '"'), null === e && (i = n), e } function W() { var e; return /^[!-']/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[!-']")), null === e && (/^[*-[]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[*-[]")), null === e && (/^[\]-~]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[\\]-~]")), null === e && null === (e = I()) && (e = E()))), e } function K() { var e, n, r, s, o, l; if (o = i, l = i, null !== (e = b())) if (null !== (n = _())) { for (r = [], null === (s = z()) && (s = J()); null !== s;)r.push(s), null === (s = z()) && (s = J()); null !== r && null !== (s = _()) ? e = [e, n, r, s] : (e = null, i = l) } else e = null, i = l; else e = null, i = l; return null !== e && (e = function (e) { return t.substring(i, e) }(o)), null === e && (i = o), e } function $() { var e, n, r, s, o, l; if (o = i, l = i, null !== (e = b())) if (null !== (n = _())) { for (r = [], null === (s = z()) && (s = J()); null !== s;)r.push(s), null === (s = z()) && (s = J()); null !== r && null !== (s = _()) ? e = [e, n, r, s] : (e = null, i = l) } else e = null, i = l; else e = null, i = l; return null !== e && (e = function (e) { return t.substring(i - 1, e + 1) }(o)), null === e && (i = o), e } function z() { var e; return null === (e = E()) && (33 === t.charCodeAt(i) ? (e = "!", i++) : (e = null, a('"!"')), null === e && (/^[#-[]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[#-[]")), null === e && (/^[\]-~]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[\\]-~]")), null === e && (e = I())))), e } function J() { var e, n, r; return r = i, 92 === t.charCodeAt(i) ? (e = "\\", i++) : (e = null, a('"\\\\"')), null !== e ? (/^[\0-\t]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, a("[\\0-\\t]")), null === n && (/^[\x0B-\f]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, a("[\\x0B-\\f]")), null === n && (/^[\x0E-]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, a("[\\x0E-]")))), null !== n ? e = [e, n] : (e = null, i = r)) : (e = null, i = r), e } function Y() { var e, n, r, s, o, l; return o = i, l = i, null !== (e = Q()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = null !== (r = te()) ? r : "") && null !== (s = ie()) ? e = [e, n, r, s] : (e = null, i = l)) : (e = null, i = l), null !== e && (e = function (e) { try { Hn.uri = new Mn(Hn.scheme, Hn.user, Hn.host, Hn.port), delete Hn.scheme, delete Hn.user, delete Hn.host, delete Hn.host_type, delete Hn.port } catch (e) { Hn = -1 } }()), null === e && (i = o), e } function X() { var e, n, s, o, l, u, c, h; return c = i, h = i, null !== (e = Q()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (s = null !== (s = te()) ? s : "") && null !== (o = ie()) && null !== (l = ge()) && null !== (u = null !== (u = Oe()) ? u : "") ? e = [e, n, s, o, l, u] : (e = null, i = h)) : (e = null, i = h), null !== e && (e = function (e) { try { Hn.uri = new Mn(Hn.scheme, Hn.user, Hn.host, Hn.port, Hn.uri_params, Hn.uri_headers), delete Hn.scheme, delete Hn.user, delete Hn.host, delete Hn.host_type, delete Hn.port, delete Hn.uri_params, "SIP_URI" === r && (Hn = Hn.uri) } catch (e) { Hn = -1 } }()), null === e && (i = c), e } function Q() { var e; return null === (e = Z()) && (e = ee()), e } function Z() { var e, n, r; return n = i, "sips" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, a('"sips"')), null !== e && (r = e, e = void (Hn.scheme = r.toLowerCase())), null === e && (i = n), e } function ee() { var e, n, r; return n = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"sip"')), null !== e && (r = e, e = void (Hn.scheme = r.toLowerCase())), null === e && (i = n), e } function te() { var e, n, r, s, o, l; return s = i, o = i, null !== (e = ne()) ? (l = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = se()) ? n = [n, r] : (n = null, i = l), null !== (n = null !== n ? n : "") ? (64 === t.charCodeAt(i) ? (r = "@", i++) : (r = null, a('"@"')), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { Hn.user = decodeURIComponent(t.substring(i - 1, e)) }(s)), null === e && (i = s), e } function ne() { var e, t; if (null === (t = T()) && null === (t = S()) && (t = re()), null !== t) for (e = []; null !== t;)e.push(t), null === (t = T()) && null === (t = S()) && (t = re()); else e = null; return e } function re() { var e; return 38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, a('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, a('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, a('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, a('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, a('","')), null === e && (59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, a('";"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, a('"?"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, a('"/"'))))))))), e } function se() { var e, n, r; for (r = i, e = [], null === (n = T()) && null === (n = S()) && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, a('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, a('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, a('","'))))))); null !== n;)e.push(n), null === (n = T()) && null === (n = S()) && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, a('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')), null === n && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, a('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, a('","'))))))); return null !== e && (e = function (e) { Hn.password = t.substring(i, e) }(r)), null === e && (i = r), e } function ie() { var e, n, r, s, o; return s = i, null !== (e = oe()) ? (o = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = me()) ? n = [n, r] : (n = null, i = o), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), e } function oe() { var e, n; return n = i, null === (e = le()) && null === (e = pe()) && (e = ce()), null !== e && (e = function (e) { return Hn.host = t.substring(i, e).toLowerCase(), Hn.host }(n)), null === e && (i = n), e } function le() { var e, n, r, s, o, l; for (s = i, o = i, e = [], l = i, null !== (n = ae()) ? (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, a('"."')), null !== r ? n = [n, r] : (n = null, i = l)) : (n = null, i = l); null !== n;)e.push(n), l = i, null !== (n = ae()) ? (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, a('"."')), null !== r ? n = [n, r] : (n = null, i = l)) : (n = null, i = l); return null !== e && null !== (n = ue()) ? (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, a('"."')), null !== (r = null !== r ? r : "") ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { return Hn.host_type = "domain", t.substring(i, e) }(s)), null === e && (i = s), e } function ae() { var e, n, r, s; if (s = i, null !== (e = v())) { for (n = [], null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, a('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, a('"_"')))); null !== r;)n.push(r), null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, a('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, a('"_"')))); null !== n ? e = [e, n] : (e = null, i = s) } else e = null, i = s; return e } function ue() { var e, n, r, s; if (s = i, null !== (e = h())) { for (n = [], null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, a('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, a('"_"')))); null !== r;)n.push(r), null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, a('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, a('"_"')))); null !== n ? e = [e, n] : (e = null, i = s) } else e = null, i = s; return e } function ce() { var e, n, r, s, o; return s = i, o = i, 91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, a('"["')), null !== e && null !== (n = he()) ? (93 === t.charCodeAt(i) ? (r = "]", i++) : (r = null, a('"]"')), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { return Hn.host_type = "IPv6", t.substring(i, e) }(s)), null === e && (i = s), e } function he() { var e, n, r, s, o, l, u, c, h, d, f, p, _, m, g, v; return m = i, g = i, null !== (e = de()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? (58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, a('":"')), null !== s && null !== (o = de()) ? (58 === t.charCodeAt(i) ? (l = ":", i++) : (l = null, a('":"')), null !== l && null !== (u = de()) ? (58 === t.charCodeAt(i) ? (c = ":", i++) : (c = null, a('":"')), null !== c && null !== (h = de()) ? (58 === t.charCodeAt(i) ? (d = ":", i++) : (d = null, a('":"')), null !== d && null !== (f = de()) ? (58 === t.charCodeAt(i) ? (p = ":", i++) : (p = null, a('":"')), null !== p && null !== (_ = fe()) ? e = [e, n, r, s, o, l, u, c, h, d, f, p, _] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, a('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, a('":"')), null !== u && null !== (c = de()) ? (58 === t.charCodeAt(i) ? (h = ":", i++) : (h = null, a('":"')), null !== h && null !== (d = de()) ? (58 === t.charCodeAt(i) ? (f = ":", i++) : (f = null, a('":"')), null !== f && null !== (p = fe()) ? e = [e, n, r, s, o, l, u, c, h, d, f, p] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, a('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, a('":"')), null !== u && null !== (c = de()) ? (58 === t.charCodeAt(i) ? (h = ":", i++) : (h = null, a('":"')), null !== h && null !== (d = fe()) ? e = [e, n, r, s, o, l, u, c, h, d] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, a('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, a('":"')), null !== u && null !== (c = fe()) ? e = [e, n, r, s, o, l, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, a('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = fe()) ? e = [e, n, r, s, o, l] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, a('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = fe()) ? e = [e, n, r, s] : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, a('"::"')), null !== e && null !== (n = fe()) ? e = [e, n] : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, a('"::"')), null !== e && null !== (n = de()) ? e = [e, n] : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? ("::" === t.substr(i, 2) ? (n = "::", i += 2) : (n = null, a('"::"')), null !== n && null !== (r = de()) ? (58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, a('":"')), null !== s && null !== (o = de()) ? (58 === t.charCodeAt(i) ? (l = ":", i++) : (l = null, a('":"')), null !== l && null !== (u = de()) ? (58 === t.charCodeAt(i) ? (c = ":", i++) : (c = null, a('":"')), null !== c && null !== (h = de()) ? (58 === t.charCodeAt(i) ? (d = ":", i++) : (d = null, a('":"')), null !== d && null !== (f = fe()) ? e = [e, n, r, s, o, l, u, c, h, d, f] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? ("::" === t.substr(i, 2) ? (r = "::", i += 2) : (r = null, a('"::"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, a('":"')), null !== u && null !== (c = de()) ? (58 === t.charCodeAt(i) ? (h = ":", i++) : (h = null, a('":"')), null !== h && null !== (d = fe()) ? e = [e, n, r, s, o, l, u, c, h, d] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? ("::" === t.substr(i, 2) ? (s = "::", i += 2) : (s = null, a('"::"')), null !== s && null !== (o = de()) ? (58 === t.charCodeAt(i) ? (l = ":", i++) : (l = null, a('":"')), null !== l && null !== (u = de()) ? (58 === t.charCodeAt(i) ? (c = ":", i++) : (c = null, a('":"')), null !== c && null !== (h = fe()) ? e = [e, n, r, s, o, l, u, c, h] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, a('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? ("::" === t.substr(i, 2) ? (o = "::", i += 2) : (o = null, a('"::"')), null !== o && null !== (l = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, a('":"')), null !== u && null !== (c = fe()) ? e = [e, n, r, s, o, l, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, a('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? (v = i, 58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = de()) ? o = [o, l] : (o = null, i = v), null !== (o = null !== o ? o : "") ? ("::" === t.substr(i, 2) ? (l = "::", i += 2) : (l = null, a('"::"')), null !== l && null !== (u = fe()) ? e = [e, n, r, s, o, l, u] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, a('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? (v = i, 58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = de()) ? o = [o, l] : (o = null, i = v), null !== (o = null !== o ? o : "") ? (v = i, 58 === t.charCodeAt(i) ? (l = ":", i++) : (l = null, a('":"')), null !== l && null !== (u = de()) ? l = [l, u] : (l = null, i = v), null !== (l = null !== l ? l : "") ? ("::" === t.substr(i, 2) ? (u = "::", i += 2) : (u = null, a('"::"')), null !== u && null !== (c = de()) ? e = [e, n, r, s, o, l, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, a('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, a('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? (v = i, 58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, a('":"')), null !== o && null !== (l = de()) ? o = [o, l] : (o = null, i = v), null !== (o = null !== o ? o : "") ? (v = i, 58 === t.charCodeAt(i) ? (l = ":", i++) : (l = null, a('":"')), null !== l && null !== (u = de()) ? l = [l, u] : (l = null, i = v), null !== (l = null !== l ? l : "") ? (v = i, 58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, a('":"')), null !== u && null !== (c = de()) ? u = [u, c] : (u = null, i = v), null !== (u = null !== u ? u : "") ? ("::" === t.substr(i, 2) ? (c = "::", i += 2) : (c = null, a('"::"')), null !== c ? e = [e, n, r, s, o, l, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g))))))))))))))), null !== e && (e = function (e) { return Hn.host_type = "IPv6", t.substring(i, e) }(m)), null === e && (i = m), e } function de() { var e, t, n, r, s; return s = i, null !== (e = d()) && null !== (t = null !== (t = d()) ? t : "") && null !== (n = null !== (n = d()) ? n : "") && null !== (r = null !== (r = d()) ? r : "") ? e = [e, t, n, r] : (e = null, i = s), e } function fe() { var e, n, r, s; return s = i, null !== (e = de()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n && null !== (r = de()) ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), null === e && (e = pe()), e } function pe() { var e, n, r, s, o, l, u, c, h; return c = i, h = i, null !== (e = _e()) ? (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, a('"."')), null !== n && null !== (r = _e()) ? (46 === t.charCodeAt(i) ? (s = ".", i++) : (s = null, a('"."')), null !== s && null !== (o = _e()) ? (46 === t.charCodeAt(i) ? (l = ".", i++) : (l = null, a('"."')), null !== l && null !== (u = _e()) ? e = [e, n, r, s, o, l, u] : (e = null, i = h)) : (e = null, i = h)) : (e = null, i = h)) : (e = null, i = h), null !== e && (e = function (e) { return Hn.host_type = "IPv4", t.substring(i, e) }(c)), null === e && (i = c), e } function _e() { var e, n, r, s; return s = i, "25" === t.substr(i, 2) ? (e = "25", i += 2) : (e = null, a('"25"')), null !== e ? (/^[0-5]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, a("[0-5]")), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null === e && (s = i, 50 === t.charCodeAt(i) ? (e = "2", i++) : (e = null, a('"2"')), null !== e ? (/^[0-4]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, a("[0-4]")), null !== n && null !== (r = c()) ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), null === e && (s = i, 49 === t.charCodeAt(i) ? (e = "1", i++) : (e = null, a('"1"')), null !== e && null !== (n = c()) && null !== (r = c()) ? e = [e, n, r] : (e = null, i = s), null === e && (s = i, /^[1-9]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, a("[1-9]")), null !== e && null !== (n = c()) ? e = [e, n] : (e = null, i = s), null === e && (e = c())))), e } function me() { var e, t, n, r, s, o, l, a; return o = i, l = i, null !== (e = null !== (e = c()) ? e : "") && null !== (t = null !== (t = c()) ? t : "") && null !== (n = null !== (n = c()) ? n : "") && null !== (r = null !== (r = c()) ? r : "") && null !== (s = null !== (s = c()) ? s : "") ? e = [e, t, n, r, s] : (e = null, i = l), null !== e && (a = e, a = parseInt(a.join("")), Hn.port = a, e = a), null === e && (i = o), e } function ge() { var e, n, r, s; for (e = [], s = i, 59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, a('";"')), null !== n && null !== (r = ve()) ? n = [n, r] : (n = null, i = s); null !== n;)e.push(n), s = i, 59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, a('";"')), null !== n && null !== (r = ve()) ? n = [n, r] : (n = null, i = s); return e } function ve() { var e; return null === (e = ye()) && null === (e = Te()) && null === (e = Ce()) && null === (e = Se()) && null === (e = Ee()) && null === (e = be()) && (e = Ae()), e } function ye() { var e, n, r, s, o; return r = i, s = i, "transport=" === t.substr(i, 10).toLowerCase() ? (e = t.substr(i, 10), i += 10) : (e = null, a('"transport="')), null !== e ? ("udp" === t.substr(i, 3).toLowerCase() ? (n = t.substr(i, 3), i += 3) : (n = null, a('"udp"')), null === n && ("tcp" === t.substr(i, 3).toLowerCase() ? (n = t.substr(i, 3), i += 3) : (n = null, a('"tcp"')), null === n && ("sctp" === t.substr(i, 4).toLowerCase() ? (n = t.substr(i, 4), i += 4) : (n = null, a('"sctp"')), null === n && ("tls" === t.substr(i, 3).toLowerCase() ? (n = t.substr(i, 3), i += 3) : (n = null, a('"tls"')), null === n && (n = O())))), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.transport = o.toLowerCase())), null === e && (i = r), e } function Te() { var e, n, r, s, o; return r = i, s = i, "user=" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"user="')), null !== e ? ("phone" === t.substr(i, 5).toLowerCase() ? (n = t.substr(i, 5), i += 5) : (n = null, a('"phone"')), null === n && ("ip" === t.substr(i, 2).toLowerCase() ? (n = t.substr(i, 2), i += 2) : (n = null, a('"ip"')), null === n && (n = O())), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.user = o.toLowerCase())), null === e && (i = r), e } function Ce() { var e, n, r, s, o; return r = i, s = i, "method=" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, a('"method="')), null !== e && null !== (n = ut()) ? e = [e, n] : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.method = o)), null === e && (i = r), e } function Se() { var e, n, r, s, o; return r = i, s = i, "ttl=" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, a('"ttl="')), null !== e && null !== (n = En()) ? e = [e, n] : (e = null, i = s), null !== e && (o = e[1], Hn.params || (Hn.params = {}), e = void (Hn.params.ttl = o)), null === e && (i = r), e } function Ee() { var e, n, r, s, o; return r = i, s = i, "maddr=" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"maddr="')), null !== e && null !== (n = oe()) ? e = [e, n] : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.maddr = o)), null === e && (i = r), e } function be() { var e, n, r, s, o, l; return s = i, o = i, "lr" === t.substr(i, 2).toLowerCase() ? (e = t.substr(i, 2), i += 2) : (e = null, a('"lr"')), null !== e ? (l = i, 61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null !== n && null !== (r = O()) ? n = [n, r] : (n = null, i = l), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o), null !== e && (Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.lr = void 0)), null === e && (i = s), e } function Ae() { var e, n, r, s, o, l, u, c; return s = i, o = i, null !== (e = we()) ? (l = i, 61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null !== n && null !== (r = Re()) ? n = [n, r] : (n = null, i = l), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o), null !== e && (u = e[0], c = e[1], Hn.uri_params || (Hn.uri_params = {}), c = void 0 === c ? void 0 : c[1], e = void (Hn.uri_params[u.toLowerCase()] = c)), null === e && (i = s), e } function we() { var e, t, n; if (n = i, null !== (t = Ie())) for (e = []; null !== t;)e.push(t), t = Ie(); else e = null; return null !== e && (e = e.join("")), null === e && (i = n), e } function Re() { var e, t, n; if (n = i, null !== (t = Ie())) for (e = []; null !== t;)e.push(t), t = Ie(); else e = null; return null !== e && (e = e.join("")), null === e && (i = n), e } function Ie() { var e; return null === (e = ke()) && null === (e = T()) && (e = S()), e } function ke() { var e; return 91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, a('"["')), null === e && (93 === t.charCodeAt(i) ? (e = "]", i++) : (e = null, a('"]"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, a('"/"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, a('":"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, a('"&"')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, a('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, a('"$"')))))))), e } function Oe() { var e, n, r, s, o, l, u; if (l = i, 63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, a('"?"')), null !== e) if (null !== (n = xe())) { for (r = [], u = i, 38 === t.charCodeAt(i) ? (s = "&", i++) : (s = null, a('"&"')), null !== s && null !== (o = xe()) ? s = [s, o] : (s = null, i = u); null !== s;)r.push(s), u = i, 38 === t.charCodeAt(i) ? (s = "&", i++) : (s = null, a('"&"')), null !== s && null !== (o = xe()) ? s = [s, o] : (s = null, i = u); null !== r ? e = [e, n, r] : (e = null, i = l) } else e = null, i = l; else e = null, i = l; return e } function xe() { var e, n, r, s, o, l, u; return s = i, o = i, null !== (e = Ne()) ? (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null !== n && null !== (r = De()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (l = e[0], u = e[2], l = l.join("").toLowerCase(), u = u.join(""), Hn.uri_headers || (Hn.uri_headers = {}), e = void (Hn.uri_headers[l] ? Hn.uri_headers[l].push(u) : Hn.uri_headers[l] = [u])), null === e && (i = s), e } function Ne() { var e, t; if (null === (t = Pe()) && null === (t = T()) && (t = S()), null !== t) for (e = []; null !== t;)e.push(t), null === (t = Pe()) && null === (t = T()) && (t = S()); else e = null; return e } function De() { var e, t; for (e = [], null === (t = Pe()) && null === (t = T()) && (t = S()); null !== t;)e.push(t), null === (t = Pe()) && null === (t = T()) && (t = S()); return e } function Pe() { var e; return 91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, a('"["')), null === e && (93 === t.charCodeAt(i) ? (e = "]", i++) : (e = null, a('"]"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, a('"/"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, a('"?"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, a('":"')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, a('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, a('"$"')))))))), e } function Le() { var e, t, n, r, s, o; return o = i, null !== (e = ut()) && null !== (t = m()) && null !== (n = Ue()) && null !== (r = m()) && null !== (s = Ze()) ? e = [e, t, n, r, s] : (e = null, i = o), e } function Ue() { var e; return null === (e = X()) && (e = Me()), e } function Me() { var e, n, r, s; return s = i, null !== (e = ze()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null !== n ? (null === (r = qe()) && (r = je()), null !== r ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s)) : (e = null, i = s), e } function qe() { var e, n, r, s, o; return s = i, null === (e = He()) && (e = Fe()), null !== e ? (o = i, 63 === t.charCodeAt(i) ? (n = "?", i++) : (n = null, a('"?"')), null !== n && null !== (r = Qe()) ? n = [n, r] : (n = null, i = o), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), e } function He() { var e, n, r, s; return s = i, "//" === t.substr(i, 2) ? (e = "//", i += 2) : (e = null, a('"//"')), null !== e && null !== (n = Je()) && null !== (r = null !== (r = Fe()) ? r : "") ? e = [e, n, r] : (e = null, i = s), e } function Fe() { var e, n, r; return r = i, 47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, a('"/"')), null !== e && null !== (n = Ge()) ? e = [e, n] : (e = null, i = r), e } function je() { var e, t, n, r; if (r = i, null !== (e = Ve())) { for (t = [], n = Be(); null !== n;)t.push(n), n = Be(); null !== t ? e = [e, t] : (e = null, i = r) } else e = null, i = r; return e } function Be() { var e; return null === (e = y()) && null === (e = T()) && (e = S()), e } function Ve() { var e; return null === (e = T()) && null === (e = S()) && (59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, a('";"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, a('"?"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, a('":"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, a('"@"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, a('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, a('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, a('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, a('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, a('","'))))))))))), e } function Ge() { var e, n, r, s, o, l; if (o = i, null !== (e = We())) { for (n = [], l = i, 47 === t.charCodeAt(i) ? (r = "/", i++) : (r = null, a('"/"')), null !== r && null !== (s = We()) ? r = [r, s] : (r = null, i = l); null !== r;)n.push(r), l = i, 47 === t.charCodeAt(i) ? (r = "/", i++) : (r = null, a('"/"')), null !== r && null !== (s = We()) ? r = [r, s] : (r = null, i = l); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return e } function We() { var e, n, r, s, o, l; for (o = i, e = [], n = $e(); null !== n;)e.push(n), n = $e(); if (null !== e) { for (n = [], l = i, 59 === t.charCodeAt(i) ? (r = ";", i++) : (r = null, a('";"')), null !== r && null !== (s = Ke()) ? r = [r, s] : (r = null, i = l); null !== r;)n.push(r), l = i, 59 === t.charCodeAt(i) ? (r = ";", i++) : (r = null, a('";"')), null !== r && null !== (s = Ke()) ? r = [r, s] : (r = null, i = l); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return e } function Ke() { var e, t; for (e = [], t = $e(); null !== t;)e.push(t), t = $e(); return e } function $e() { var e; return null === (e = T()) && null === (e = S()) && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, a('":"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, a('"@"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, a('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, a('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, a('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, a('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, a('","'))))))))), e } function ze() { var e, n, r, s, o; if (s = i, o = i, null !== (e = h())) { for (n = [], null === (r = h()) && null === (r = c()) && (43 === t.charCodeAt(i) ? (r = "+", i++) : (r = null, a('"+"')), null === r && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, a('"-"')), null === r && (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, a('"."'))))); null !== r;)n.push(r), null === (r = h()) && null === (r = c()) && (43 === t.charCodeAt(i) ? (r = "+", i++) : (r = null, a('"+"')), null === r && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, a('"-"')), null === r && (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, a('"."'))))); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return null !== e && (e = function (e) { Hn.scheme = t.substring(i, e) }(s)), null === e && (i = s), e } function Je() { var e; return null === (e = Ye()) && (e = Xe()), e } function Ye() { var e, n, r, s; return r = i, s = i, null !== (e = te()) ? (64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, a('"@"')), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== (e = null !== e ? e : "") && null !== (n = ie()) ? e = [e, n] : (e = null, i = r), e = null !== e ? e : "" } function Xe() { var e, n; if (null === (n = T()) && null === (n = S()) && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, a('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, a('","')), null === n && (59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, a('";"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null === n && (64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, a('"@"')), null === n && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, a('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = T()) && null === (n = S()) && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, a('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, a('","')), null === n && (59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, a('";"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, a('":"')), null === n && (64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, a('"@"')), null === n && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, a('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, a('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, a('"+"')))))))))); else e = null; return e } function Qe() { var e, t; for (e = [], t = Be(); null !== t;)e.push(t), t = Be(); return e } function Ze() { var e, n, r, s, o, l, u, h; if (u = i, h = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"SIP"')), null !== e) if (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, a('"/"')), null !== n) { if (null !== (s = c())) for (r = []; null !== s;)r.push(s), s = c(); else r = null; if (null !== r) if (46 === t.charCodeAt(i) ? (s = ".", i++) : (s = null, a('"."')), null !== s) { if (null !== (l = c())) for (o = []; null !== l;)o.push(l), l = c(); else o = null; null !== o ? e = [e, n, r, s, o] : (e = null, i = h) } else e = null, i = h; else e = null, i = h } else e = null, i = h; else e = null, i = h; return null !== e && (e = function (e) { Hn.sip_version = t.substring(i, e) }(u)), null === e && (i = u), e } function et() { var e; return "INVITE" === t.substr(i, 6) ? (e = "INVITE", i += 6) : (e = null, a('"INVITE"')), e } function tt() { var e; return "ACK" === t.substr(i, 3) ? (e = "ACK", i += 3) : (e = null, a('"ACK"')), e } function nt() { var e; return "OPTIONS" === t.substr(i, 7) ? (e = "OPTIONS", i += 7) : (e = null, a('"OPTIONS"')), e } function rt() { var e; return "BYE" === t.substr(i, 3) ? (e = "BYE", i += 3) : (e = null, a('"BYE"')), e } function st() { var e; return "CANCEL" === t.substr(i, 6) ? (e = "CANCEL", i += 6) : (e = null, a('"CANCEL"')), e } function it() { var e; return "REGISTER" === t.substr(i, 8) ? (e = "REGISTER", i += 8) : (e = null, a('"REGISTER"')), e } function ot() { var e; return "SUBSCRIBE" === t.substr(i, 9) ? (e = "SUBSCRIBE", i += 9) : (e = null, a('"SUBSCRIBE"')), e } function lt() { var e; return "NOTIFY" === t.substr(i, 6) ? (e = "NOTIFY", i += 6) : (e = null, a('"NOTIFY"')), e } function at() { var e; return "REFER" === t.substr(i, 5) ? (e = "REFER", i += 5) : (e = null, a('"REFER"')), e } function ut() { var e, n; return n = i, null === (e = et()) && null === (e = tt()) && null === (e = nt()) && null === (e = rt()) && null === (e = st()) && null === (e = it()) && null === (e = ot()) && null === (e = lt()) && null === (e = at()) && (e = O()), null !== e && (e = function (e) { return Hn.method = t.substring(i, e), Hn.method }(n)), null === e && (i = n), e } function ct() { var e, t, n, r, s, o; return o = i, null !== (e = Ze()) && null !== (t = m()) && null !== (n = ht()) && null !== (r = m()) && null !== (s = ft()) ? e = [e, t, n, r, s] : (e = null, i = o), e } function ht() { var e, t, n; return t = i, null !== (e = dt()) && (n = e, e = void (Hn.status_code = parseInt(n.join("")))), null === e && (i = t), e } function dt() { var e, t, n, r; return r = i, null !== (e = c()) && null !== (t = c()) && null !== (n = c()) ? e = [e, t, n] : (e = null, i = r), e } function ft() { var e, n, r; for (r = i, e = [], null === (n = y()) && null === (n = T()) && null === (n = S()) && null === (n = I()) && null === (n = k()) && null === (n = m()) && (n = g()); null !== n;)e.push(n), null === (n = y()) && null === (n = T()) && null === (n = S()) && null === (n = I()) && null === (n = k()) && null === (n = m()) && (n = g()); return null !== e && (e = function (e) { Hn.reason_phrase = t.substring(i, e) }(r)), null === e && (i = r), e } function pt() { var e, t, n, r, s, o, l; if (s = i, o = i, null === (e = Y()) && (e = _t()), null !== e) { for (t = [], l = i, null !== (n = j()) && null !== (r = gt()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = j()) && null !== (r = gt()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; return null !== e && (e = function (e) { var t; Hn.multi_header || (Hn.multi_header = []); try { t = new qn(Hn.uri, Hn.display_name, Hn.params), delete Hn.uri, delete Hn.display_name, delete Hn.params } catch (e) { t = null } Hn.multi_header.push({ possition: i, offset: e, parsed: t }) }(s)), null === e && (i = s), e } function _t() { var e, t, n, r, s; return s = i, null !== (e = null !== (e = mt()) ? e : "") && null !== (t = H()) && null !== (n = X()) && null !== (r = q()) ? e = [e, t, n, r] : (e = null, i = s), e } function mt() { var e, n, r, s, o, l, a; if (o = i, l = i, null !== (e = O())) { for (n = [], a = i, null !== (r = E()) && null !== (s = O()) ? r = [r, s] : (r = null, i = a); null !== r;)n.push(r), a = i, null !== (r = E()) && null !== (s = O()) ? r = [r, s] : (r = null, i = a); null !== n ? e = [e, n] : (e = null, i = l) } else e = null, i = l; return null === e && (e = K()), null !== e && (e = function (e, n) { '"' === (n = t.substring(i, e).trim())[0] && (n = n.substring(1, n.length - 1)), Hn.display_name = n }(o, e)), null === e && (i = o), e } function gt() { var e; return null === (e = vt()) && null === (e = yt()) && (e = St()), e } function vt() { var e, n, r, s, o, l; return s = i, o = i, "q" === t.substr(i, 1).toLowerCase() ? (e = t.substr(i, 1), i++) : (e = null, a('"q"')), null !== e && null !== (n = L()) && null !== (r = Ct()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], Hn.params || (Hn.params = {}), e = void (Hn.params.q = l)), null === e && (i = s), e } function yt() { var e, n, r, s, o, l; return s = i, o = i, "expires" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, a('"expires"')), null !== e && null !== (n = L()) && null !== (r = Tt()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], Hn.params || (Hn.params = {}), e = void (Hn.params.expires = l)), null === e && (i = s), e } function Tt() { var e, t, n; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; return null !== e && (e = parseInt(e.join(""))), null === e && (i = n), e } function Ct() { var e, n, r, s, o, l, u, h; return l = i, u = i, 48 === t.charCodeAt(i) ? (e = "0", i++) : (e = null, a('"0"')), null !== e ? (h = i, 46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, a('"."')), null !== n && null !== (r = null !== (r = c()) ? r : "") && null !== (s = null !== (s = c()) ? s : "") && null !== (o = null !== (o = c()) ? o : "") ? n = [n, r, s, o] : (n = null, i = h), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = u)) : (e = null, i = u), null !== e && (e = function (e) { return parseFloat(t.substring(i, e)) }(l)), null === e && (i = l), e } function St() { var e, t, n, r, s, o, l, a; return r = i, s = i, null !== (e = O()) ? (o = i, null !== (t = L()) && null !== (n = Et()) ? t = [t, n] : (t = null, i = o), null !== (t = null !== t ? t : "") ? e = [e, t] : (e = null, i = s)) : (e = null, i = s), null !== e && (l = e[0], a = e[1], Hn.params || (Hn.params = {}), a = void 0 === a ? void 0 : a[1], e = void (Hn.params[l.toLowerCase()] = a)), null === e && (i = r), e } function Et() { var e; return null === (e = O()) && null === (e = oe()) && (e = K()), e } function bt() { var e; return "render" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"render"')), null === e && ("session" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, a('"session"')), null === e && ("icon" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, a('"icon"')), null === e && ("alert" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"alert"')), null === e && (e = O())))), e } function At() { var e; return null === (e = wt()) && (e = St()), e } function wt() { var e, n, r, s; return s = i, "handling" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, a('"handling"')), null !== e && null !== (n = L()) ? ("optional" === t.substr(i, 8).toLowerCase() ? (r = t.substr(i, 8), i += 8) : (r = null, a('"optional"')), null === r && ("required" === t.substr(i, 8).toLowerCase() ? (r = t.substr(i, 8), i += 8) : (r = null, a('"required"')), null === r && (r = O())), null !== r ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), e } function Rt() { var e, t, n, r, s, o, l, a; if (l = i, null !== (e = It())) if (null !== (t = P())) if (null !== (n = Dt())) { for (r = [], a = i, null !== (s = j()) && null !== (o = Pt()) ? s = [s, o] : (s = null, i = a); null !== s;)r.push(s), a = i, null !== (s = j()) && null !== (o = Pt()) ? s = [s, o] : (s = null, i = a); null !== r ? e = [e, t, n, r] : (e = null, i = l) } else e = null, i = l; else e = null, i = l; else e = null, i = l; return e } function It() { var e; return null === (e = kt()) && (e = Ot()), e } function kt() { var e; return "text" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, a('"text"')), null === e && ("image" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"image"')), null === e && ("audio" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"audio"')), null === e && ("video" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"video"')), null === e && ("application" === t.substr(i, 11).toLowerCase() ? (e = t.substr(i, 11), i += 11) : (e = null, a('"application"')), null === e && (e = xt()))))), e } function Ot() { var e; return "message" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, a('"message"')), null === e && ("multipart" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, a('"multipart"')), null === e && (e = xt())), e } function xt() { var e; return null === (e = O()) && (e = Nt()), e } function Nt() { var e, n, r; return r = i, "x-" === t.substr(i, 2).toLowerCase() ? (e = t.substr(i, 2), i += 2) : (e = null, a('"x-"')), null !== e && null !== (n = O()) ? e = [e, n] : (e = null, i = r), e } function Dt() { var e; return null === (e = xt()) && (e = O()), e } function Pt() { var e, t, n, r; return r = i, null !== (e = O()) && null !== (t = L()) && null !== (n = Lt()) ? e = [e, t, n] : (e = null, i = r), e } function Lt() { var e; return null === (e = O()) && (e = K()), e } function Ut() { var e, t, n, r; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; return null !== e && (r = e, e = void (Hn.value = parseInt(r.join("")))), null === e && (i = n), e } function Mt() { var e, n, r, s, o, l; if (o = i, null !== (e = x())) { for (n = [], l = i, 46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, a('"."')), null !== r && null !== (s = x()) ? r = [r, s] : (r = null, i = l); null !== r;)n.push(r), l = i, 46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, a('"."')), null !== r && null !== (s = x()) ? r = [r, s] : (r = null, i = l); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return e } function qt() { var e; return null === (e = Ht()) && (e = St()), e } function Ht() { var e, n, r, s, o, l; return s = i, o = i, "tag" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"tag"')), null !== e && null !== (n = L()) && null !== (r = O()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.tag = l)), null === e && (i = s), e } function Ft() { var e, n, r, s, o, l, u, c; if (u = i, "digest" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"Digest"')), null !== e) if (null !== (n = E())) if (null !== (r = Vt())) { for (s = [], c = i, null !== (o = F()) && null !== (l = Vt()) ? o = [o, l] : (o = null, i = c); null !== o;)s.push(o), c = i, null !== (o = F()) && null !== (l = Vt()) ? o = [o, l] : (o = null, i = c); null !== s ? e = [e, n, r, s] : (e = null, i = u) } else e = null, i = u; else e = null, i = u; else e = null, i = u; return null === e && (e = jt()), e } function jt() { var e, t, n, r, s, o, l, a; if (l = i, null !== (e = O())) if (null !== (t = E())) if (null !== (n = Bt())) { for (r = [], a = i, null !== (s = F()) && null !== (o = Bt()) ? s = [s, o] : (s = null, i = a); null !== s;)r.push(s), a = i, null !== (s = F()) && null !== (o = Bt()) ? s = [s, o] : (s = null, i = a); null !== r ? e = [e, t, n, r] : (e = null, i = l) } else e = null, i = l; else e = null, i = l; else e = null, i = l; return e } function Bt() { var e, t, n, r; return r = i, null !== (e = O()) && null !== (t = L()) ? (null === (n = O()) && (n = K()), null !== n ? e = [e, t, n] : (e = null, i = r)) : (e = null, i = r), e } function Vt() { var e; return null === (e = Gt()) && null === (e = Kt()) && null === (e = zt()) && null === (e = Yt()) && null === (e = Xt()) && null === (e = Qt()) && null === (e = Zt()) && (e = Bt()), e } function Gt() { var e, n, r, s; return s = i, "realm" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"realm"')), null !== e && null !== (n = L()) && null !== (r = Wt()) ? e = [e, n, r] : (e = null, i = s), e } function Wt() { var e, t, n; return t = i, null !== (e = $()) && (n = e, e = void (Hn.realm = n)), null === e && (i = t), e } function Kt() { var e, n, r, s, o, l, u, c, h; if (c = i, "domain" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"domain"')), null !== e) if (null !== (n = L())) if (null !== (r = V())) if (null !== (s = $t())) { if (o = [], h = i, null !== (u = m())) for (l = []; null !== u;)l.push(u), u = m(); else l = null; for (null !== l && null !== (u = $t()) ? l = [l, u] : (l = null, i = h); null !== l;){ if (o.push(l), h = i, null !== (u = m())) for (l = []; null !== u;)l.push(u), u = m(); else l = null; null !== l && null !== (u = $t()) ? l = [l, u] : (l = null, i = h) } null !== o && null !== (l = G()) ? e = [e, n, r, s, o, l] : (e = null, i = c) } else e = null, i = c; else e = null, i = c; else e = null, i = c; else e = null, i = c; return e } function $t() { var e; return null === (e = Me()) && (e = Fe()), e } function zt() { var e, n, r, s; return s = i, "nonce" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"nonce"')), null !== e && null !== (n = L()) && null !== (r = Jt()) ? e = [e, n, r] : (e = null, i = s), e } function Jt() { var e, t, n; return t = i, null !== (e = $()) && (n = e, e = void (Hn.nonce = n)), null === e && (i = t), e } function Yt() { var e, n, r, s, o, l; return s = i, o = i, "opaque" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"opaque"')), null !== e && null !== (n = L()) && null !== (r = $()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.opaque = l)), null === e && (i = s), e } function Xt() { var e, n, r, s, o; return s = i, "stale" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"stale"')), null !== e && null !== (n = L()) ? (o = i, "true" === t.substr(i, 4).toLowerCase() ? (r = t.substr(i, 4), i += 4) : (r = null, a('"true"')), null !== r && (r = void (Hn.stale = !0)), null === r && (i = o), null === r && (o = i, "false" === t.substr(i, 5).toLowerCase() ? (r = t.substr(i, 5), i += 5) : (r = null, a('"false"')), null !== r && (r = void (Hn.stale = !1)), null === r && (i = o)), null !== r ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), e } function Qt() { var e, n, r, s, o, l; return s = i, o = i, "algorithm" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, a('"algorithm"')), null !== e && null !== (n = L()) ? ("md5" === t.substr(i, 3).toLowerCase() ? (r = t.substr(i, 3), i += 3) : (r = null, a('"MD5"')), null === r && ("md5-sess" === t.substr(i, 8).toLowerCase() ? (r = t.substr(i, 8), i += 8) : (r = null, a('"MD5-sess"')), null === r && (r = O())), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.algorithm = l.toUpperCase())), null === e && (i = s), e } function Zt() { var e, n, r, s, o, l, u, c, h, d; if (c = i, "qop" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"qop"')), null !== e) if (null !== (n = L())) if (null !== (r = V())) { if (h = i, null !== (s = en())) { for (o = [], d = i, 44 === t.charCodeAt(i) ? (l = ",", i++) : (l = null, a('","')), null !== l && null !== (u = en()) ? l = [l, u] : (l = null, i = d); null !== l;)o.push(l), d = i, 44 === t.charCodeAt(i) ? (l = ",", i++) : (l = null, a('","')), null !== l && null !== (u = en()) ? l = [l, u] : (l = null, i = d); null !== o ? s = [s, o] : (s = null, i = h) } else s = null, i = h; null !== s && null !== (o = G()) ? e = [e, n, r, s, o] : (e = null, i = c) } else e = null, i = c; else e = null, i = c; else e = null, i = c; return e } function en() { var e, n, r; return n = i, "auth-int" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, a('"auth-int"')), null === e && ("auth" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, a('"auth"')), null === e && (e = O())), null !== e && (r = e, Hn.qop || (Hn.qop = []), e = void Hn.qop.push(r.toLowerCase())), null === e && (i = n), e } function tn() { var e, t, n, r, s, o, l; if (s = i, o = i, null !== (e = _t())) { for (t = [], l = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = l); null !== n;)t.push(n), l = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = l); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; return null !== e && (e = function (e) { var t; Hn.multi_header || (Hn.multi_header = []); try { t = new qn(Hn.uri, Hn.display_name, Hn.params), delete Hn.uri, delete Hn.display_name, delete Hn.params } catch (e) { t = null } Hn.multi_header.push({ possition: i, offset: e, parsed: t }) }(s)), null === e && (i = s), e } function nn() { var e; return null === (e = rn()) && (e = St()), e } function rn() { var e, n, r, s, o, l, u; if (o = i, l = i, "cause" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"cause"')), null !== e) if (null !== (n = L())) { if (null !== (s = c())) for (r = []; null !== s;)r.push(s), s = c(); else r = null; null !== r ? e = [e, n, r] : (e = null, i = l) } else e = null, i = l; else e = null, i = l; return null !== e && (u = e[2], e = void (Hn.cause = parseInt(u.join("")))), null === e && (i = o), e } function sn() { var e, t, n, r, s, o; if (s = i, null !== (e = _t())) { for (t = [], o = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = j()) && null !== (r = St()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e } function on() { var e, n; return n = i, "active" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"active"')), null === e && ("pending" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, a('"pending"')), null === e && ("terminated" === t.substr(i, 10).toLowerCase() ? (e = t.substr(i, 10), i += 10) : (e = null, a('"terminated"')), null === e && (e = O()))), null !== e && (e = function (e) { Hn.state = t.substring(i, e) }(n)), null === e && (i = n), e } function ln() { var e, n, r, s, o, l, u, c; return s = i, o = i, "reason" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"reason"')), null !== e && null !== (n = L()) && null !== (r = an()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = void (void 0 !== (l = e[2]) && (Hn.reason = l))), null === e && (i = s), null === e && (s = i, o = i, "expires" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, a('"expires"')), null !== e && null !== (n = L()) && null !== (r = Tt()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = void (void 0 !== (c = e[2]) && (Hn.expires = c))), null === e && (i = s), null === e && (s = i, o = i, "retry_after" === t.substr(i, 11).toLowerCase() ? (e = t.substr(i, 11), i += 11) : (e = null, a('"retry_after"')), null !== e && null !== (n = L()) && null !== (r = Tt()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = void (void 0 !== (u = e[2]) && (Hn.retry_after = u))), null === e && (i = s), null === e && (e = St()))), e } function an() { var e; return "deactivated" === t.substr(i, 11).toLowerCase() ? (e = t.substr(i, 11), i += 11) : (e = null, a('"deactivated"')), null === e && ("probation" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, a('"probation"')), null === e && ("rejected" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, a('"rejected"')), null === e && ("timeout" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, a('"timeout"')), null === e && ("giveup" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"giveup"')), null === e && ("noresource" === t.substr(i, 10).toLowerCase() ? (e = t.substr(i, 10), i += 10) : (e = null, a('"noresource"')), null === e && ("invariant" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, a('"invariant"')), null === e && (e = O()))))))), e } function un() { var e; return null === (e = Ht()) && (e = St()), e } function cn() { var e, t, n, r, s, o, l, a; if (l = i, null !== (e = gn())) if (null !== (t = E())) if (null !== (n = Tn())) { for (r = [], a = i, null !== (s = j()) && null !== (o = hn()) ? s = [s, o] : (s = null, i = a); null !== s;)r.push(s), a = i, null !== (s = j()) && null !== (o = hn()) ? s = [s, o] : (s = null, i = a); null !== r ? e = [e, t, n, r] : (e = null, i = l) } else e = null, i = l; else e = null, i = l; else e = null, i = l; return e } function hn() { var e; return null === (e = dn()) && null === (e = fn()) && null === (e = pn()) && null === (e = _n()) && null === (e = mn()) && (e = St()), e } function dn() { var e, n, r, s, o, l; return s = i, o = i, "ttl" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"ttl"')), null !== e && null !== (n = L()) && null !== (r = En()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.ttl = l)), null === e && (i = s), e } function fn() { var e, n, r, s, o, l; return s = i, o = i, "maddr" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"maddr"')), null !== e && null !== (n = L()) && null !== (r = oe()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.maddr = l)), null === e && (i = s), e } function pn() { var e, n, r, s, o, l; return s = i, o = i, "received" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, a('"received"')), null !== e && null !== (n = L()) ? (null === (r = pe()) && (r = he()), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.received = l)), null === e && (i = s), e } function _n() { var e, n, r, s, o, l; return s = i, o = i, "branch" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, a('"branch"')), null !== e && null !== (n = L()) && null !== (r = O()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.branch = l)), null === e && (i = s), e } function mn() { var e, n, r, s, o, l, u; if (o = i, l = i, "rport" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, a('"rport"')), null !== e) { if (u = i, null !== (n = L())) { for (r = [], s = c(); null !== s;)r.push(s), s = c(); null !== r ? n = [n, r] : (n = null, i = u) } else n = null, i = u; null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = l) } else e = null, i = l; return null !== e && (e = void ("undefined" != typeof response_port && (Hn.rport = response_port.join("")))), null === e && (i = o), e } function gn() { var e, t, n, r, s, o; return o = i, null !== (e = vn()) && null !== (t = P()) && null !== (n = O()) && null !== (r = P()) && null !== (s = yn()) ? e = [e, t, n, r, s] : (e = null, i = o), e } function vn() { var e, n, r; return n = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"SIP"')), null === e && (e = O()), null !== e && (r = e, e = void (Hn.protocol = r)), null === e && (i = n), e } function yn() { var e, n, r; return n = i, "udp" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"UDP"')), null === e && ("tcp" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"TCP"')), null === e && ("tls" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, a('"TLS"')), null === e && ("sctp" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, a('"SCTP"')), null === e && (e = O())))), null !== e && (r = e, e = void (Hn.transport = r)), null === e && (i = n), e } function Tn() { var e, t, n, r, s; return r = i, null !== (e = Cn()) ? (s = i, null !== (t = B()) && null !== (n = Sn()) ? t = [t, n] : (t = null, i = s), null !== (t = null !== t ? t : "") ? e = [e, t] : (e = null, i = r)) : (e = null, i = r), e } function Cn() { var e, n; return n = i, null === (e = pe()) && null === (e = ce()) && (e = le()), null !== e && (e = function (e) { Hn.host = t.substring(i, e) }(n)), null === e && (i = n), e } function Sn() { var e, t, n, r, s, o, l, a; return o = i, l = i, null !== (e = null !== (e = c()) ? e : "") && null !== (t = null !== (t = c()) ? t : "") && null !== (n = null !== (n = c()) ? n : "") && null !== (r = null !== (r = c()) ? r : "") && null !== (s = null !== (s = c()) ? s : "") ? e = [e, t, n, r, s] : (e = null, i = l), null !== e && (a = e, e = void (Hn.port = parseInt(a.join("")))), null === e && (i = o), e } function En() { var e, t, n, r, s; return r = i, s = i, null !== (e = c()) && null !== (t = null !== (t = c()) ? t : "") && null !== (n = null !== (n = c()) ? n : "") ? e = [e, t, n] : (e = null, i = s), null !== e && (e = parseInt(e.join(""))), null === e && (i = r), e } function bn() { var e, t, n; return t = i, null !== (e = Tt()) && (n = e, e = void (Hn.expires = n)), null === e && (i = t), e } function An() { var e; return null === (e = wn()) && (e = St()), e } function wn() { var e, n, r, s, o, l; return s = i, o = i, "refresher" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, a('"refresher"')), null !== e && null !== (n = L()) ? ("uac" === t.substr(i, 3).toLowerCase() ? (r = t.substr(i, 3), i += 3) : (r = null, a('"uac"')), null === r && ("uas" === t.substr(i, 3).toLowerCase() ? (r = t.substr(i, 3), i += 3) : (r = null, a('"uas"'))), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.refresher = l.toLowerCase())), null === e && (i = s), e } function Rn() { var e, t; for (e = [], null === (t = R()) && null === (t = k()) && (t = E()); null !== t;)e.push(t), null === (t = R()) && null === (t = k()) && (t = E()); return e } function In() { var e, n, r, s, o, l, u, c, h, d, f; return d = i, f = i, null !== (e = On()) ? (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, a('"-"')), null !== n && null !== (r = kn()) ? (45 === t.charCodeAt(i) ? (s = "-", i++) : (s = null, a('"-"')), null !== s && null !== (o = kn()) ? (45 === t.charCodeAt(i) ? (l = "-", i++) : (l = null, a('"-"')), null !== l && null !== (u = kn()) ? (45 === t.charCodeAt(i) ? (c = "-", i++) : (c = null, a('"-"')), null !== c && null !== (h = xn()) ? e = [e, n, r, s, o, l, u, c, h] : (e = null, i = f)) : (e = null, i = f)) : (e = null, i = f)) : (e = null, i = f)) : (e = null, i = f), null !== e && (e = function (e, n) { Hn = t.substring(i + 5, e) }(d, e[0])), null === e && (i = d), e } function kn() { var e, t, n, r, s; return s = i, null !== (e = d()) && null !== (t = d()) && null !== (n = d()) && null !== (r = d()) ? e = [e, t, n, r] : (e = null, i = s), e } function On() { var e, t, n; return n = i, null !== (e = kn()) && null !== (t = kn()) ? e = [e, t] : (e = null, i = n), e } function xn() { var e, t, n, r; return r = i, null !== (e = kn()) && null !== (t = kn()) && null !== (n = kn()) ? e = [e, t, n] : (e = null, i = r), e } function Nn() { var e, n, r, s, o, l; return s = i, o = i, null !== (e = N()) ? (l = i, 64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, a('"@"')), null !== n && null !== (r = N()) ? n = [n, r] : (n = null, i = l), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { Hn.call_id = t.substring(i, e) }(s)), null === e && (i = s), e } function Dn() { var e; return null === (e = Pn()) && null === (e = Ln()) && null === (e = Un()) && (e = St()), e } function Pn() { var e, n, r, s, o, l; return s = i, o = i, "to-tag" === t.substr(i, 6) ? (e = "to-tag", i += 6) : (e = null, a('"to-tag"')), null !== e && null !== (n = L()) && null !== (r = O()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.to_tag = l)), null === e && (i = s), e } function Ln() { var e, n, r, s, o, l; return s = i, o = i, "from-tag" === t.substr(i, 8) ? (e = "from-tag", i += 8) : (e = null, a('"from-tag"')), null !== e && null !== (n = L()) && null !== (r = O()) ? e = [e, n, r] : (e = null, i = o), null !== e && (l = e[2], e = void (Hn.from_tag = l)), null === e && (i = s), e } function Un() { var e, n; return n = i, "early-only" === t.substr(i, 10) ? (e = "early-only", i += 10) : (e = null, a('"early-only"')), null !== e && (e = void (Hn.early_only = !0)), null === e && (i = n), e } var Mn = n(987), qn = n(437), Hn = {}; if (null === s[r]() || i !== t.length) { var Fn = Math.max(i, o), jn = Fn < t.length ? t.charAt(Fn) : null, Bn = function () { for (var e = 1, n = 1, r = !1, s = 0; s < Math.max(i, o); s++){ var l = t.charAt(s); "\n" === l ? (r || e++, n = 1, r = !1) : "\r" === l || "\u2028" === l || "\u2029" === l ? (e++, n = 1, r = !0) : (n++, r = !1) } return { line: e, column: n } }(); return new this.SyntaxError(function (e) { e.sort(); for (var t = null, n = [], r = 0; r < e.length; r++)e[r] !== t && (n.push(e[r]), t = e[r]); return n }(l), jn, Fn, Bn.line, Bn.column), -1 } return Hn }, toSource: function () { return this._source }, SyntaxError: function (t, n, r, s, i) { this.name = "SyntaxError", this.expected = t, this.found = n, this.message = function (t, n) { var r; switch (t.length) { case 0: r = "end of input"; break; case 1: r = t[0]; break; default: r = t.slice(0, t.length - 1).join(", ") + " or " + t[t.length - 1] }return "Expected " + r + " but " + (n ? e(n) : "end of input") + " found." }(t, n), this.offset = r, this.line = s, this.column = i } }; return t.SyntaxError.prototype = Error.prototype, t }() }, 979: (e, t, n) => { var r = n(403), s = n(965), i = n(63), o = n(424), l = n(387), a = n(987), u = n(437), c = n(790), h = n(288); n(227)("JsSIP")("version %s", r.version), e.exports = { C: s, Exceptions: i, Utils: o, UA: l, URI: a, NameAddrHeader: u, WebSocketInterface: h, Grammar: c, debug: n(227), get name() { return r.title }, get version() { return r.version } } }, 193: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } var a = n(187).EventEmitter, u = n(965), c = n(497), h = n(424), d = n(66), f = n(63), p = n(227)("JsSIP:Message"); e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._ua = e, n._request = null, n._closed = !1, n._direction = null, n._local_identity = null, n._remote_identity = null, n._is_replied = !1, n._data = {}, n } var n, r, a; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) }(t, e), n = t, r = [{ key: "send", value: function (e, t) { var n = this, r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, s = e; if (void 0 === e || void 0 === t) throw new TypeError("Not enough arguments"); if (!(e = this._ua.normalizeTarget(e))) throw new TypeError("Invalid target: ".concat(s)); var i = h.cloneArray(r.extraHeaders), o = r.eventHandlers || {}, l = r.contentType || "text/plain"; for (var a in o) Object.prototype.hasOwnProperty.call(o, a) && this.on(a, o[a]); i.push("Content-Type: ".concat(l)), this._request = new c.OutgoingRequest(u.MESSAGE, e, this._ua, null, i), t && (this._request.body = t); var f = new d(this._ua, this._request, { onRequestTimeout: function () { n._onRequestTimeout() }, onTransportError: function () { n._onTransportError() }, onReceiveResponse: function (e) { n._receiveResponse(e) } }); this._newMessage("local", this._request), f.send() } }, { key: "init_incoming", value: function (e) { this._request = e, this._newMessage("remote", e), this._is_replied || (this._is_replied = !0, e.reply(200)), this._close() } }, { key: "accept", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = h.cloneArray(e.extraHeaders), n = e.body; if ("incoming" !== this._direction) throw new f.NotSupportedError('"accept" not supported for outgoing Message'); if (this._is_replied) throw new Error("incoming Message already replied"); this._is_replied = !0, this._request.reply(200, null, t, n) } }, { key: "reject", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.status_code || 480, n = e.reason_phrase, r = h.cloneArray(e.extraHeaders), s = e.body; if ("incoming" !== this._direction) throw new f.NotSupportedError('"reject" not supported for outgoing Message'); if (this._is_replied) throw new Error("incoming Message already replied"); if (t < 300 || t >= 700) throw new TypeError("Invalid status_code: ".concat(t)); this._is_replied = !0, this._request.reply(t, n, r, s) } }, { key: "_receiveResponse", value: function (e) { if (!this._closed) switch (!0) { case /^1[0-9]{2}$/.test(e.status_code): break; case /^2[0-9]{2}$/.test(e.status_code): this._succeeded("remote", e); break; default: var t = h.sipErrorCause(e.status_code); this._failed("remote", e, t) } } }, { key: "_onRequestTimeout", value: function () { this._closed || this._failed("system", null, u.causes.REQUEST_TIMEOUT) } }, { key: "_onTransportError", value: function () { this._closed || this._failed("system", null, u.causes.CONNECTION_ERROR) } }, { key: "_close", value: function () { this._closed = !0, this._ua.destroyMessage(this) } }, { key: "_newMessage", value: function (e, t) { "remote" === e ? (this._direction = "incoming", this._local_identity = t.to, this._remote_identity = t.from) : "local" === e && (this._direction = "outgoing", this._local_identity = t.from, this._remote_identity = t.to), this._ua.newMessage(this, { originator: e, message: this, request: t }) } }, { key: "_failed", value: function (e, t, n) { p("MESSAGE failed"), this._close(), p('emit "failed"'), this.emit("failed", { originator: e, response: t || null, cause: n }) } }, { key: "_succeeded", value: function (e, t) { p("MESSAGE succeeded"), this._close(), p('emit "succeeded"'), this.emit("succeeded", { originator: e, response: t }) } }, { key: "direction", get: function () { return this._direction } }, { key: "local_identity", get: function () { return this._local_identity } }, { key: "remote_identity", get: function () { return this._remote_identity } }], r && s(n.prototype, r), a && s(n, a), t }(a) }, 437: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function s(e, t, n) { return t && r(e.prototype, t), n && r(e, n), e } var i = n(987), o = n(790); e.exports = function () { function e(t, n, r) { if (function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), !(t && t instanceof i)) throw new TypeError('missing or invalid "uri" parameter'); for (var s in this._uri = t, this._parameters = {}, this._display_name = n, r) Object.prototype.hasOwnProperty.call(r, s) && this.setParam(s, r[s]) } return s(e, null, [{ key: "parse", value: function (e) { return -1 !== (e = o.parse(e, "Name_Addr_Header")) ? e : void 0 } }]), s(e, [{ key: "setParam", value: function (e, t) { e && (this._parameters[e.toLowerCase()] = null == t ? null : t.toString()) } }, { key: "getParam", value: function (e) { if (e) return this._parameters[e.toLowerCase()] } }, { key: "hasParam", value: function (e) { if (e) return !!this._parameters.hasOwnProperty(e.toLowerCase()) } }, { key: "deleteParam", value: function (e) { if (e = e.toLowerCase(), this._parameters.hasOwnProperty(e)) { var t = this._parameters[e]; return delete this._parameters[e], t } } }, { key: "clearParams", value: function () { this._parameters = {} } }, { key: "clone", value: function () { return new e(this._uri.clone(), this._display_name, JSON.parse(JSON.stringify(this._parameters))) } }, { key: "toString", value: function () { var e = this._display_name || 0 === this._display_name ? '"'.concat(this._display_name, '" ') : ""; for (var t in e += "<".concat(this._uri.toString(), ">"), this._parameters) Object.prototype.hasOwnProperty.call(this._parameters, t) && (e += ";".concat(t), null !== this._parameters[t] && (e += "=".concat(this._parameters[t]))); return e } }, { key: "uri", get: function () { return this._uri } }, { key: "display_name", get: function () { return this._display_name }, set: function (e) { this._display_name = 0 === e ? "0" : e } }]), e }() }, 407: (e, t, n) => { var r = n(790), s = n(497), i = n(227)("JsSIP:ERROR:Parser"); function o(e, t) { var n = t, r = 0, s = 0; if (e.substring(n, n + 2).match(/(^\r\n)/)) return -2; for (; 0 === r;){ if (-1 === (s = e.indexOf("\r\n", n))) return s; !e.substring(s + 2, s + 4).match(/(^\r\n)/) && e.charAt(s + 2).match(/(^\s+)/) ? n = s + 2 : r = s } return r } function l(e, t, n, i) { var o, l = t.indexOf(":", n), a = t.substring(n, l).trim(), u = t.substring(l + 1, i).trim(); switch (a.toLowerCase()) { case "via": case "v": e.addHeader("via", u), 1 === e.getHeaders("via").length ? (o = e.parseHeader("Via")) && (e.via = o, e.via_branch = o.branch) : o = 0; break; case "from": case "f": e.setHeader("from", u), (o = e.parseHeader("from")) && (e.from = o, e.from_tag = o.getParam("tag")); break; case "to": case "t": e.setHeader("to", u), (o = e.parseHeader("to")) && (e.to = o, e.to_tag = o.getParam("tag")); break; case "record-route": if (-1 === (o = r.parse(u, "Record_Route"))) o = void 0; else { var c = !0, h = !1, d = void 0; try { for (var f, p = o[Symbol.iterator](); !(c = (f = p.next()).done); c = !0){ var _ = f.value; e.addHeader("record-route", u.substring(_.possition, _.offset)), e.headers["Record-Route"][e.getHeaders("record-route").length - 1].parsed = _.parsed } } catch (e) { h = !0, d = e } finally { try { c || null == p.return || p.return() } finally { if (h) throw d } } } break; case "call-id": case "i": e.setHeader("call-id", u), (o = e.parseHeader("call-id")) && (e.call_id = u); break; case "contact": case "m": if (-1 === (o = r.parse(u, "Contact"))) o = void 0; else { var m = !0, g = !1, v = void 0; try { for (var y, T = o[Symbol.iterator](); !(m = (y = T.next()).done); m = !0){ var C = y.value; e.addHeader("contact", u.substring(C.possition, C.offset)), e.headers.Contact[e.getHeaders("contact").length - 1].parsed = C.parsed } } catch (e) { g = !0, v = e } finally { try { m || null == T.return || T.return() } finally { if (g) throw v } } } break; case "content-length": case "l": e.setHeader("content-length", u), o = e.parseHeader("content-length"); break; case "content-type": case "c": e.setHeader("content-type", u), o = e.parseHeader("content-type"); break; case "cseq": e.setHeader("cseq", u), (o = e.parseHeader("cseq")) && (e.cseq = o.value), e instanceof s.IncomingResponse && (e.method = o.method); break; case "max-forwards": e.setHeader("max-forwards", u), o = e.parseHeader("max-forwards"); break; case "www-authenticate": e.setHeader("www-authenticate", u), o = e.parseHeader("www-authenticate"); break; case "proxy-authenticate": e.setHeader("proxy-authenticate", u), o = e.parseHeader("proxy-authenticate"); break; case "session-expires": case "x": e.setHeader("session-expires", u), (o = e.parseHeader("session-expires")) && (e.session_expires = o.expires, e.session_expires_refresher = o.refresher); break; case "refer-to": case "r": e.setHeader("refer-to", u), (o = e.parseHeader("refer-to")) && (e.refer_to = o); break; case "replaces": e.setHeader("replaces", u), (o = e.parseHeader("replaces")) && (e.replaces = o); break; case "event": case "o": e.setHeader("event", u), (o = e.parseHeader("event")) && (e.event = o); break; default: e.addHeader(a, u), o = 0 }return void 0 !== o || { error: 'error parsing header "'.concat(a, '"') } } i.log = console.warn.bind(console), t.parseMessage = function (e, t) { var n, a, u = e.indexOf("\r\n"); if (-1 !== u) { var c = e.substring(0, u), h = r.parse(c, "Request_Response"); if (-1 !== h) { h.status_code ? ((n = new s.IncomingResponse).status_code = h.status_code, n.reason_phrase = h.reason_phrase) : ((n = new s.IncomingRequest(t)).method = h.method, n.ruri = h.uri), n.data = e; for (var d = u + 2; ;){ if (-2 === (u = o(e, d))) { a = d + 2; break } if (-1 === u) return void i("parseMessage() | malformed message"); if (!0 !== (h = l(n, e, d, u))) return void i("parseMessage() |", h.error); d = u + 2 } if (n.hasHeader("content-length")) { var f = n.getHeader("content-length"); n.body = e.substr(a, f) } else n.body = e.substring(a); return n } i('parseMessage() | error parsing first line of SIP message: "'.concat(c, '"')) } else i("parseMessage() | no CRLF found, not a SIP message") } }, 906: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function i(e) { return i = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, i(e) } function o(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function l(e, t, n) { return t && o(e.prototype, t), n && o(e, n), e } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } var u = n(187).EventEmitter, c = n(766), h = n(965), d = n(63), f = n(754), p = n(424), _ = n(306), m = n(497), g = n(316), v = n(66), y = n(481), T = n(126), C = n(774), S = n(603), E = n(227)("JsSIP:RTCSession"), b = n(227)("JsSIP:ERROR:RTCSession"); b.log = console.warn.bind(console); var A = { STATUS_NULL: 0, STATUS_INVITE_SENT: 1, STATUS_1XX_RECEIVED: 2, STATUS_INVITE_RECEIVED: 3, STATUS_WAITING_FOR_ANSWER: 4, STATUS_ANSWERED: 5, STATUS_WAITING_FOR_ACK: 6, STATUS_CANCELED: 7, STATUS_TERMINATED: 8, STATUS_CONFIRMED: 9 }, w = ["audio", "video"]; e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), E("new"), (n = s(this, i(t).call(this)))._id = null, n._ua = e, n._status = A.STATUS_NULL, n._dialog = null, n._earlyDialogs = {}, n._contact = null, n._from_tag = null, n._to_tag = null, n._connection = null, n._connectionPromiseQueue = Promise.resolve(), n._request = null, n._is_canceled = !1, n._cancel_reason = "", n._is_confirmed = !1, n._late_sdp = !1, n._rtcOfferConstraints = null, n._rtcAnswerConstraints = null, n._localMediaStream = null, n._localMediaStreamLocallyGenerated = !1, n._rtcReady = !0, n._timers = { ackTimer: null, expiresTimer: null, invite2xxTimer: null, userNoAnswerTimer: null }, n._direction = null, n._local_identity = null, n._remote_identity = null, n._start_time = null, n._end_time = null, n._tones = null, n._audioMuted = !1, n._videoMuted = !1, n._localHold = !1, n._remoteHold = !1, n._sessionTimers = { enabled: n._ua.configuration.session_timers, refreshMethod: n._ua.configuration.session_timers_refresh_method, defaultExpires: h.SESSION_EXPIRES, currentExpires: null, running: !1, refresher: !1, timer: null }, n._referSubscribers = {}, n._data = {}, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) }(t, e), l(t, null, [{ key: "C", get: function () { return A } }]), l(t, [{ key: "isInProgress", value: function () { switch (this._status) { case A.STATUS_NULL: case A.STATUS_INVITE_SENT: case A.STATUS_1XX_RECEIVED: case A.STATUS_INVITE_RECEIVED: case A.STATUS_WAITING_FOR_ANSWER: return !0; default: return !1 } } }, { key: "isEstablished", value: function () { switch (this._status) { case A.STATUS_ANSWERED: case A.STATUS_WAITING_FOR_ACK: case A.STATUS_CONFIRMED: return !0; default: return !1 } } }, { key: "isEnded", value: function () { switch (this._status) { case A.STATUS_CANCELED: case A.STATUS_TERMINATED: return !0; default: return !1 } } }, { key: "isMuted", value: function () { return { audio: this._audioMuted, video: this._videoMuted } } }, { key: "isOnHold", value: function () { return { local: this._localHold, remote: this._remoteHold } } }, { key: "connect", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = arguments.length > 2 ? arguments[2] : void 0; E("connect()"); var r = e, s = t.eventHandlers || {}, i = p.cloneArray(t.extraHeaders), o = t.mediaConstraints || { audio: !0, video: !0 }, l = t.mediaStream || null, a = t.pcConfig || { iceServers: [] }, u = t.rtcConstraints || null, c = t.rtcOfferConstraints || null; if (this._rtcOfferConstraints = c, this._rtcAnswerConstraints = t.rtcAnswerConstraints || null, this._data = t.data || this._data, void 0 === e) throw new TypeError("Not enough arguments"); if (this._status !== A.STATUS_NULL) throw new d.InvalidStateError(this._status); if (!window.RTCPeerConnection) throw new d.NotSupportedError("WebRTC not supported"); if (!(e = this._ua.normalizeTarget(e))) throw new TypeError("Invalid target: ".concat(r)); for (var f in this._sessionTimers.enabled && p.isDecimal(t.sessionTimersExpires) && (t.sessionTimersExpires >= h.MIN_SESSION_EXPIRES ? this._sessionTimers.defaultExpires = t.sessionTimersExpires : this._sessionTimers.defaultExpires = h.SESSION_EXPIRES), s) Object.prototype.hasOwnProperty.call(s, f) && this.on(f, s[f]); this._from_tag = p.newTag(); var _ = t.anonymous || !1, g = { from_tag: this._from_tag }; this._contact = this._ua.contact.toString({ anonymous: _, outbound: !0 }), _ && (g.from_display_name = "Anonymous", g.from_uri = "sip:anonymous@anonymous.invalid", i.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())), i.push("Privacy: id")), i.push("Contact: ".concat(this._contact)), i.push("Content-Type: application/sdp"), this._sessionTimers.enabled && i.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires)), this._request = new m.InitialOutgoingInviteRequest(e, this._ua, g, i), this._id = this._request.call_id + this._from_tag, this._createRTCConnection(a, u), this._direction = "outgoing", this._local_identity = this._request.from, this._remote_identity = this._request.to, n && n(this), this._newRTCSession("local", this._request), this._sendInitialRequest(o, c, l) } }, { key: "init_incoming", value: function (e, t) { var n, r = this; E("init_incoming()"); var s = e.getHeader("Content-Type"); e.body && "application/sdp" !== s ? e.reply(415) : (this._status = A.STATUS_INVITE_RECEIVED, this._from_tag = e.from_tag, this._id = e.call_id + this._from_tag, this._request = e, this._contact = this._ua.contact.toString(), e.hasHeader("expires") && (n = 1e3 * e.getHeader("expires")), e.to_tag = p.newTag(), this._createDialog(e, "UAS", !0) ? (e.body ? this._late_sdp = !1 : this._late_sdp = !0, this._status = A.STATUS_WAITING_FOR_ANSWER, this._timers.userNoAnswerTimer = setTimeout((function () { e.reply(408), r._failed("local", null, h.causes.NO_ANSWER) }), this._ua.configuration.no_answer_timeout), n && (this._timers.expiresTimer = setTimeout((function () { r._status === A.STATUS_WAITING_FOR_ANSWER && (e.reply(487), r._failed("system", null, h.causes.EXPIRES)) }), n)), this._direction = "incoming", this._local_identity = e.to, this._remote_identity = e.from, t && t(this), this._newRTCSession("remote", e), this._status !== A.STATUS_TERMINATED && (e.reply(180, null, ["Contact: ".concat(this._contact)]), this._progress("local", null))) : e.reply(500, "Missing Contact header field")) } }, { key: "answer", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; E("answer()"); var n, r = this._request, s = p.cloneArray(t.extraHeaders), i = t.mediaConstraints || {}, o = t.mediaStream || null, l = t.pcConfig || { iceServers: [] }, a = t.rtcConstraints || null, u = t.rtcAnswerConstraints || null, c = !1, f = !1, _ = !1, m = !1; if (this._rtcAnswerConstraints = u, this._rtcOfferConstraints = t.rtcOfferConstraints || null, this._data = t.data || this._data, "incoming" !== this._direction) throw new d.NotSupportedError('"answer" not supported for outgoing RTCSession'); if (this._status !== A.STATUS_WAITING_FOR_ANSWER) throw new d.InvalidStateError(this._status); if (this._sessionTimers.enabled && p.isDecimal(t.sessionTimersExpires) && (t.sessionTimersExpires >= h.MIN_SESSION_EXPIRES ? this._sessionTimers.defaultExpires = t.sessionTimersExpires : this._sessionTimers.defaultExpires = h.SESSION_EXPIRES), this._status = A.STATUS_ANSWERED, this._createDialog(r, "UAS")) { clearTimeout(this._timers.userNoAnswerTimer), s.unshift("Contact: ".concat(this._contact)); var g = r.parseSDP(); Array.isArray(g.media) || (g.media = [g.media]); var v = !0, y = !1, T = void 0; try { for (var C, S = g.media[Symbol.iterator](); !(v = (C = S.next()).done); v = !0){ var w = C.value; "audio" === w.type && (c = !0, w.direction && "sendrecv" !== w.direction || (_ = !0)), "video" === w.type && (f = !0, w.direction && "sendrecv" !== w.direction || (m = !0)) } } catch (e) { y = !0, T = e } finally { try { v || null == S.return || S.return() } finally { if (y) throw T } } if (o && !1 === i.audio) { n = o.getAudioTracks(); var R = !0, I = !1, k = void 0; try { for (var O, x = n[Symbol.iterator](); !(R = (O = x.next()).done); R = !0){ var N = O.value; o.removeTrack(N) } } catch (e) { I = !0, k = e } finally { try { R || null == x.return || x.return() } finally { if (I) throw k } } } if (o && !1 === i.video) { n = o.getVideoTracks(); var D = !0, P = !1, L = void 0; try { for (var U, M = n[Symbol.iterator](); !(D = (U = M.next()).done); D = !0){ var q = U.value; o.removeTrack(q) } } catch (e) { P = !0, L = e } finally { try { D || null == M.return || M.return() } finally { if (P) throw L } } } o || void 0 !== i.audio || (i.audio = _), o || void 0 !== i.video || (i.video = m), o || c || (i.audio = !1), o || f || (i.video = !1), this._createRTCConnection(l, a), Promise.resolve().then((function () { return o || (i.audio || i.video ? (e._localMediaStreamLocallyGenerated = !0, navigator.mediaDevices.getUserMedia(i).catch((function (t) { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); throw r.reply(480), e._failed("local", null, h.causes.USER_DENIED_MEDIA_ACCESS), b('emit "getusermediafailed" [error:%o]', t), e.emit("getusermediafailed", t), new Error("getUserMedia() failed") }))) : void 0) })).then((function (t) { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); e._localMediaStream = t, t && e._connection.addStream(t) })).then((function () { if (!e._late_sdp) { var t = { originator: "remote", type: "offer", sdp: r.body }; E('emit "sdp"'), e.emit("sdp", t); var n = new RTCSessionDescription({ type: "offer", sdp: t.sdp }); return e._connectionPromiseQueue = e._connectionPromiseQueue.then((function () { return e._connection.setRemoteDescription(n) })).catch((function (t) { throw r.reply(488), e._failed("system", null, h.causes.WEBRTC_ERROR), b('emit "peerconnection:setremotedescriptionfailed" [error:%o]', t), e.emit("peerconnection:setremotedescriptionfailed", t), new Error("peerconnection.setRemoteDescription() failed") })), e._connectionPromiseQueue } })).then((function () { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); return e._connecting(r), e._late_sdp ? e._createLocalDescription("offer", e._rtcOfferConstraints).catch((function () { throw r.reply(500), new Error("_createLocalDescription() failed") })) : e._createLocalDescription("answer", u).catch((function () { throw r.reply(500), new Error("_createLocalDescription() failed") })) })).then((function (t) { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); e._handleSessionTimersInIncomingRequest(r, s), r.reply(200, null, s, t, (function () { e._status = A.STATUS_WAITING_FOR_ACK, e._setInvite2xxTimer(r, t), e._setACKTimer(), e._accepted("local") }), (function () { e._failed("system", null, h.causes.CONNECTION_ERROR) })) })).catch((function (t) { e._status !== A.STATUS_TERMINATED && b(t) })) } else r.reply(500, "Error creating dialog") } }, { key: "terminate", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; E("terminate()"); var n, r = t.cause || h.causes.BYE, s = p.cloneArray(t.extraHeaders), i = t.body, o = t.status_code, l = t.reason_phrase; if (this._status === A.STATUS_TERMINATED) throw new d.InvalidStateError(this._status); switch (this._status) { case A.STATUS_NULL: case A.STATUS_INVITE_SENT: case A.STATUS_1XX_RECEIVED: if (E("canceling session"), o && (o < 200 || o >= 700)) throw new TypeError("Invalid status_code: ".concat(o)); o && (l = l || h.REASON_PHRASE[o] || "", n = "SIP ;cause=".concat(o, ' ;text="').concat(l, '"')), this._status === A.STATUS_NULL || this._status === A.STATUS_INVITE_SENT ? (this._is_canceled = !0, this._cancel_reason = n) : this._status === A.STATUS_1XX_RECEIVED && this._request.cancel(n), this._status = A.STATUS_CANCELED, this._failed("local", null, h.causes.CANCELED); break; case A.STATUS_WAITING_FOR_ANSWER: case A.STATUS_ANSWERED: if (E("rejecting session"), (o = o || 480) < 300 || o >= 700) throw new TypeError("Invalid status_code: ".concat(o)); this._request.reply(o, l, s, i), this._failed("local", null, h.causes.REJECTED); break; case A.STATUS_WAITING_FOR_ACK: case A.STATUS_CONFIRMED: if (E("terminating session"), l = t.reason_phrase || h.REASON_PHRASE[o] || "", o && (o < 200 || o >= 700)) throw new TypeError("Invalid status_code: ".concat(o)); if (o && s.push("Reason: SIP ;cause=".concat(o, '; text="').concat(l, '"')), this._status === A.STATUS_WAITING_FOR_ACK && "incoming" === this._direction && this._request.server_transaction.state !== f.C.STATUS_TERMINATED) { var a = this._dialog; this.receiveRequest = function (t) { t.method === h.ACK && (e.sendRequest(h.BYE, { extraHeaders: s, body: i }), a.terminate()) }, this._request.server_transaction.on("stateChanged", (function () { e._request.server_transaction.state === f.C.STATUS_TERMINATED && (e.sendRequest(h.BYE, { extraHeaders: s, body: i }), a.terminate()) })), this._ended("local", null, r), this._dialog = a, this._ua.newDialog(a) } else this.sendRequest(h.BYE, { extraHeaders: s, body: i }), this._ended("local", null, r) } } }, { key: "sendDTMF", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; E("sendDTMF() | tones: %s", e); var n = 0, r = t.duration || null, s = t.interToneGap || null; if (void 0 === e) throw new TypeError("Not enough arguments"); if (this._status !== A.STATUS_CONFIRMED && this._status !== A.STATUS_WAITING_FOR_ACK) throw new d.InvalidStateError(this._status); if ("number" == typeof e && (e = e.toString()), !e || "string" != typeof e || !e.match(/^[0-9A-DR#*,]+$/i)) throw new TypeError("Invalid tones: ".concat(e)); if (r && !p.isDecimal(r)) throw new TypeError("Invalid tone duration: ".concat(r)); if (r ? r < y.C.MIN_DURATION ? (E('"duration" value is lower than the minimum allowed, setting it to '.concat(y.C.MIN_DURATION, " milliseconds")), r = y.C.MIN_DURATION) : r > y.C.MAX_DURATION ? (E('"duration" value is greater than the maximum allowed, setting it to '.concat(y.C.MAX_DURATION, " milliseconds")), r = y.C.MAX_DURATION) : r = Math.abs(r) : r = y.C.DEFAULT_DURATION, t.duration = r, s && !p.isDecimal(s)) throw new TypeError("Invalid interToneGap: ".concat(s)); function i() { var e, o = this; if (this._status === A.STATUS_TERMINATED || !this._tones || n >= this._tones.length) this._tones = null; else { var l = this._tones[n]; if (n += 1, "," === l) e = 2e3; else { var a = new y(this); t.eventHandlers = { onFailed: function () { o._tones = null } }, a.send(l, t), e = r + s } setTimeout(i.bind(this), e) } } s ? s < y.C.MIN_INTER_TONE_GAP ? (E('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(y.C.MIN_INTER_TONE_GAP, " milliseconds")), s = y.C.MIN_INTER_TONE_GAP) : s = Math.abs(s) : s = y.C.DEFAULT_INTER_TONE_GAP, this._tones ? this._tones += e : (this._tones = e, i.call(this)) } }, { key: "sendInfo", value: function (e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; if (E("sendInfo()"), this._status !== A.STATUS_CONFIRMED && this._status !== A.STATUS_WAITING_FOR_ACK) throw new d.InvalidStateError(this._status); var r = new T(this); r.send(e, t, n) } }, { key: "mute", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : { audio: !0, video: !1 }; E("mute()"); var t = !1, n = !1; !1 === this._audioMuted && e.audio && (t = !0, this._audioMuted = !0, this._toogleMuteAudio(!0)), !1 === this._videoMuted && e.video && (n = !0, this._videoMuted = !0, this._toogleMuteVideo(!0)), !0 !== t && !0 !== n || this._onmute({ audio: t, video: n }) } }, { key: "unmute", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : { audio: !0, video: !0 }; E("unmute()"); var t = !1, n = !1; !0 === this._audioMuted && e.audio && (t = !0, this._audioMuted = !1, !1 === this._localHold && this._toogleMuteAudio(!1)), !0 === this._videoMuted && e.video && (n = !0, this._videoMuted = !1, !1 === this._localHold && this._toogleMuteVideo(!1)), !0 !== t && !0 !== n || this._onunmute({ audio: t, video: n }) } }, { key: "hold", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = arguments.length > 1 ? arguments[1] : void 0; if (E("hold()"), this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!0 === this._localHold) return !1; if (!this._isReadyToReOffer()) return !1; this._localHold = !0, this._onhold("local"); var r = { succeeded: function () { n && n() }, failed: function () { e.terminate({ cause: h.causes.WEBRTC_ERROR, status_code: 500, reason_phrase: "Hold Failed" }) } }; return t.useUpdate ? this._sendUpdate({ sdpOffer: !0, eventHandlers: r, extraHeaders: t.extraHeaders }) : this._sendReinvite({ eventHandlers: r, extraHeaders: t.extraHeaders }), !0 } }, { key: "unhold", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = arguments.length > 1 ? arguments[1] : void 0; if (E("unhold()"), this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!1 === this._localHold) return !1; if (!this._isReadyToReOffer()) return !1; this._localHold = !1, this._onunhold("local"); var r = { succeeded: function () { n && n() }, failed: function () { e.terminate({ cause: h.causes.WEBRTC_ERROR, status_code: 500, reason_phrase: "Unhold Failed" }) } }; return t.useUpdate ? this._sendUpdate({ sdpOffer: !0, eventHandlers: r, extraHeaders: t.extraHeaders }) : this._sendReinvite({ eventHandlers: r, extraHeaders: t.extraHeaders }), !0 } }, { key: "renegotiate", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = arguments.length > 1 ? arguments[1] : void 0; E("renegotiate()"); var r = t.rtcOfferConstraints || null; if (this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!this._isReadyToReOffer()) return !1; var s = { succeeded: function () { n && n() }, failed: function () { e.terminate({ cause: h.causes.WEBRTC_ERROR, status_code: 500, reason_phrase: "Media Renegotiation Failed" }) } }; return this._setLocalMediaStatus(), t.useUpdate ? this._sendUpdate({ sdpOffer: !0, eventHandlers: s, rtcOfferConstraints: r, extraHeaders: t.extraHeaders }) : this._sendReinvite({ eventHandlers: s, rtcOfferConstraints: r, extraHeaders: t.extraHeaders }), !0 } }, { key: "refer", value: function (e, t) { var n = this; E("refer()"); var r = e; if (this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!(e = this._ua.normalizeTarget(e))) throw new TypeError("Invalid target: ".concat(r)); var s = new S(this); s.sendRefer(e, t); var i = s.id; return this._referSubscribers[i] = s, s.on("requestFailed", (function () { delete n._referSubscribers[i] })), s.on("accepted", (function () { delete n._referSubscribers[i] })), s.on("failed", (function () { delete n._referSubscribers[i] })), s } }, { key: "sendRequest", value: function (e, t) { return E("sendRequest()"), this._dialog.sendRequest(e, t) } }, { key: "receiveRequest", value: function (e) { var t = this; if (E("receiveRequest()"), e.method === h.CANCEL) this._status !== A.STATUS_WAITING_FOR_ANSWER && this._status !== A.STATUS_ANSWERED || (this._status = A.STATUS_CANCELED, this._request.reply(487), this._failed("remote", e, h.causes.CANCELED)); else switch (e.method) { case h.ACK: if (this._status !== A.STATUS_WAITING_FOR_ACK) return; if (this._status = A.STATUS_CONFIRMED, clearTimeout(this._timers.ackTimer), clearTimeout(this._timers.invite2xxTimer), this._late_sdp) { if (!e.body) { this.terminate({ cause: h.causes.MISSING_SDP, status_code: 400 }); break } var n = { originator: "remote", type: "answer", sdp: e.body }; E('emit "sdp"'), this.emit("sdp", n); var r = new RTCSessionDescription({ type: "answer", sdp: n.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(r) })).then((function () { t._is_confirmed || t._confirmed("remote", e) })).catch((function (e) { t.terminate({ cause: h.causes.BAD_MEDIA_DESCRIPTION, status_code: 488 }), b('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })) } else this._is_confirmed || this._confirmed("remote", e); break; case h.BYE: this._status === A.STATUS_CONFIRMED ? (e.reply(200), this._ended("remote", e, h.causes.BYE)) : this._status === A.STATUS_INVITE_RECEIVED ? (e.reply(200), this._request.reply(487, "BYE Received"), this._ended("remote", e, h.causes.BYE)) : e.reply(403, "Wrong Status"); break; case h.INVITE: this._status === A.STATUS_CONFIRMED ? e.hasHeader("replaces") ? this._receiveReplaces(e) : this._receiveReinvite(e) : e.reply(403, "Wrong Status"); break; case h.INFO: if (this._status === A.STATUS_1XX_RECEIVED || this._status === A.STATUS_WAITING_FOR_ANSWER || this._status === A.STATUS_ANSWERED || this._status === A.STATUS_WAITING_FOR_ACK || this._status === A.STATUS_CONFIRMED) { var s = e.getHeader("content-type"); s && s.match(/^application\/dtmf-relay/i) ? new y(this).init_incoming(e) : void 0 !== s ? new T(this).init_incoming(e) : e.reply(415) } else e.reply(403, "Wrong Status"); break; case h.UPDATE: this._status === A.STATUS_CONFIRMED ? this._receiveUpdate(e) : e.reply(403, "Wrong Status"); break; case h.REFER: this._status === A.STATUS_CONFIRMED ? this._receiveRefer(e) : e.reply(403, "Wrong Status"); break; case h.NOTIFY: this._status === A.STATUS_CONFIRMED ? this._receiveNotify(e) : e.reply(403, "Wrong Status"); break; default: e.reply(501) } } }, { key: "onTransportError", value: function () { b("onTransportError()"), this._status !== A.STATUS_TERMINATED && this.terminate({ status_code: 500, reason_phrase: h.causes.CONNECTION_ERROR, cause: h.causes.CONNECTION_ERROR }) } }, { key: "onRequestTimeout", value: function () { b("onRequestTimeout()"), this._status !== A.STATUS_TERMINATED && this.terminate({ status_code: 408, reason_phrase: h.causes.REQUEST_TIMEOUT, cause: h.causes.REQUEST_TIMEOUT }) } }, { key: "onDialogError", value: function () { b("onDialogError()"), this._status !== A.STATUS_TERMINATED && this.terminate({ status_code: 500, reason_phrase: h.causes.DIALOG_ERROR, cause: h.causes.DIALOG_ERROR }) } }, { key: "newDTMF", value: function (e) { E("newDTMF()"), this.emit("newDTMF", e) } }, { key: "newInfo", value: function (e) { E("newInfo()"), this.emit("newInfo", e) } }, { key: "_isReadyToReOffer", value: function () { return this._rtcReady ? this._dialog ? !0 !== this._dialog.uac_pending_reply && !0 !== this._dialog.uas_pending_reply || (E("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"), !1) : (E("_isReadyToReOffer() | session not established yet"), !1) : (E("_isReadyToReOffer() | internal WebRTC status not ready"), !1) } }, { key: "_close", value: function () { if (E("close()"), this._status !== A.STATUS_TERMINATED) { if (this._status = A.STATUS_TERMINATED, this._connection) try { this._connection.close() } catch (e) { b("close() | error closing the RTCPeerConnection: %o", e) } for (var e in this._localMediaStream && this._localMediaStreamLocallyGenerated && (E("close() | closing local MediaStream"), p.closeMediaStream(this._localMediaStream)), this._timers) Object.prototype.hasOwnProperty.call(this._timers, e) && clearTimeout(this._timers[e]); for (var t in clearTimeout(this._sessionTimers.timer), this._dialog && (this._dialog.terminate(), delete this._dialog), this._earlyDialogs) Object.prototype.hasOwnProperty.call(this._earlyDialogs, t) && (this._earlyDialogs[t].terminate(), delete this._earlyDialogs[t]); for (var n in this._referSubscribers) Object.prototype.hasOwnProperty.call(this._referSubscribers, n) && delete this._referSubscribers[n]; this._ua.destroyRTCSession(this) } } }, { key: "_setInvite2xxTimer", value: function (e, t) { var n = _.T1; this._timers.invite2xxTimer = setTimeout(function r() { this._status === A.STATUS_WAITING_FOR_ACK && (e.reply(200, null, ["Contact: ".concat(this._contact)], t), n < _.T2 && (n *= 2) > _.T2 && (n = _.T2), this._timers.invite2xxTimer = setTimeout(r.bind(this), n)) }.bind(this), n) } }, { key: "_setACKTimer", value: function () { var e = this; this._timers.ackTimer = setTimeout((function () { e._status === A.STATUS_WAITING_FOR_ACK && (E("no ACK received, terminating the session"), clearTimeout(e._timers.invite2xxTimer), e.sendRequest(h.BYE), e._ended("remote", null, h.causes.NO_ACK)) }), _.TIMER_H) } }, { key: "_createRTCConnection", value: function (e, t) { var n = this; this._connection = new RTCPeerConnection(e, t), this._connection.addEventListener("iceconnectionstatechange", (function () { "failed" === n._connection.iceConnectionState && n.terminate({ cause: h.causes.RTP_TIMEOUT, status_code: 408, reason_phrase: h.causes.RTP_TIMEOUT }) })), E('emit "peerconnection"'), this.emit("peerconnection", { peerconnection: this._connection }) } }, { key: "_createLocalDescription", value: function (e, t) { var n = this; if (E("createLocalDescription()"), "offer" !== e && "answer" !== e) throw new Error('createLocalDescription() | invalid type "'.concat(e, '"')); var r = this._connection; return this._rtcReady = !1, Promise.resolve().then((function () { return "offer" === e ? r.createOffer(t).catch((function (e) { return b('emit "peerconnection:createofferfailed" [error:%o]', e), n.emit("peerconnection:createofferfailed", e), Promise.reject(e) })) : r.createAnswer(t).catch((function (e) { return b('emit "peerconnection:createanswerfailed" [error:%o]', e), n.emit("peerconnection:createanswerfailed", e), Promise.reject(e) })) })).then((function (e) { return r.setLocalDescription(e).catch((function (e) { return n._rtcReady = !0, b('emit "peerconnection:setlocaldescriptionfailed" [error:%o]', e), n.emit("peerconnection:setlocaldescriptionfailed", e), Promise.reject(e) })) })).then((function () { if ("complete" === r.iceGatheringState) { n._rtcReady = !0; var t = { originator: "local", type: e, sdp: r.localDescription.sdp }; return E('emit "sdp"'), n.emit("sdp", t), Promise.resolve(t.sdp) } return new Promise((function (t) { var s, i = !1, o = function () { r.removeEventListener("icecandidate", s), i = !0, n._rtcReady = !0; var o = { originator: "local", type: e, sdp: r.localDescription.sdp }; E('emit "sdp"'), n.emit("sdp", o), t(o.sdp) }; r.addEventListener("icecandidate", s = function (e) { var t = e.candidate; t ? n.emit("icecandidate", { candidate: t, ready: o }) : i || o() }) })) })) } }, { key: "_createDialog", value: function (e, t, n) { var r = "UAS" === t ? e.to_tag : e.from_tag, s = "UAS" === t ? e.from_tag : e.to_tag, i = e.call_id + r + s, o = this._earlyDialogs[i]; if (n) return !!o || ((o = new g(this, e, t, g.C.STATUS_EARLY)).error ? (E(o.error), this._failed("remote", e, h.causes.INTERNAL_ERROR), !1) : (this._earlyDialogs[i] = o, !0)); if (this._from_tag = e.from_tag, this._to_tag = e.to_tag, o) return o.update(e, t), this._dialog = o, delete this._earlyDialogs[i], !0; var l = new g(this, e, t); return l.error ? (E(l.error), this._failed("remote", e, h.causes.INTERNAL_ERROR), !1) : (this._dialog = l, !0) } }, { key: "_receiveReinvite", value: function (e) { var t = this; E("receiveReinvite()"); var n = e.getHeader("Content-Type"), r = { request: e, callback: void 0, reject: function () { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; s = !0; var n = t.status_code || 403, r = t.reason_phrase || "", i = p.cloneArray(t.extraHeaders); if (this._status !== A.STATUS_CONFIRMED) return !1; if (n < 300 || n >= 700) throw new TypeError("Invalid status_code: ".concat(n)); e.reply(n, r, i) }.bind(this) }, s = !1; if (this.emit("reinvite", r), !s) { if (this._late_sdp = !1, !e.body) return this._late_sdp = !0, void (this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._createLocalDescription("offer", t._rtcOfferConstraints) })).then((function (e) { i.call(t, e) })).catch((function () { e.reply(500) }))); if ("application/sdp" !== n) return E("invalid Content-Type"), void e.reply(415); this._processInDialogSdpOffer(e).then((function (e) { t._status !== A.STATUS_TERMINATED && i.call(t, e) })).catch((function (e) { b(e) })) } function i(t) { var n = this, s = ["Contact: ".concat(this._contact)]; this._handleSessionTimersInIncomingRequest(e, s), this._late_sdp && (t = this._mangleOffer(t)), e.reply(200, null, s, t, (function () { n._status = A.STATUS_WAITING_FOR_ACK, n._setInvite2xxTimer(e, t), n._setACKTimer() })), "function" == typeof r.callback && r.callback() } } }, { key: "_receiveUpdate", value: function (e) { var t = this; E("receiveUpdate()"); var n = e.getHeader("Content-Type"), r = { request: e, callback: void 0, reject: function () { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; s = !0; var n = t.status_code || 403, r = t.reason_phrase || "", i = p.cloneArray(t.extraHeaders); if (this._status !== A.STATUS_CONFIRMED) return !1; if (n < 300 || n >= 700) throw new TypeError("Invalid status_code: ".concat(n)); e.reply(n, r, i) }.bind(this) }, s = !1; if (this.emit("update", r), !s) if (e.body) { if ("application/sdp" !== n) return E("invalid Content-Type"), void e.reply(415); this._processInDialogSdpOffer(e).then((function (e) { t._status !== A.STATUS_TERMINATED && i.call(t, e) })).catch((function (e) { b(e) })) } else i.call(this, null); function i(t) { var n = ["Contact: ".concat(this._contact)]; this._handleSessionTimersInIncomingRequest(e, n), e.reply(200, null, n, t), "function" == typeof r.callback && r.callback() } } }, { key: "_processInDialogSdpOffer", value: function (e) { var t = this; E("_processInDialogSdpOffer()"); var n = e.parseSDP(), r = !1, s = !0, i = !1, o = void 0; try { for (var l, a = n.media[Symbol.iterator](); !(s = (l = a.next()).done); s = !0){ var u = l.value; if (-1 !== w.indexOf(u.type)) { var c = u.direction || n.direction || "sendrecv"; if ("sendonly" !== c && "inactive" !== c) { r = !1; break } r = !0 } } } catch (e) { i = !0, o = e } finally { try { s || null == a.return || a.return() } finally { if (i) throw o } } var h = { originator: "remote", type: "offer", sdp: e.body }; E('emit "sdp"'), this.emit("sdp", h); var d = new RTCSessionDescription({ type: "offer", sdp: h.sdp }); return this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { if (t._status === A.STATUS_TERMINATED) throw new Error("terminated"); return t._connection.setRemoteDescription(d).catch((function (n) { throw e.reply(488), b('emit "peerconnection:setremotedescriptionfailed" [error:%o]', n), t.emit("peerconnection:setremotedescriptionfailed", n), new Error("peerconnection.setRemoteDescription() failed") })) })).then((function () { if (t._status === A.STATUS_TERMINATED) throw new Error("terminated"); !0 === t._remoteHold && !1 === r ? (t._remoteHold = !1, t._onunhold("remote")) : !1 === t._remoteHold && !0 === r && (t._remoteHold = !0, t._onhold("remote")) })).then((function () { if (t._status === A.STATUS_TERMINATED) throw new Error("terminated"); return t._createLocalDescription("answer", t._rtcAnswerConstraints).catch((function () { throw e.reply(500), new Error("_createLocalDescription() failed") })) })), this._connectionPromiseQueue } }, { key: "_receiveRefer", value: function (e) { var n = this; if (E("receiveRefer()"), void 0 === r(e.refer_to)) return E("no Refer-To header field present in REFER"), void e.reply(400); if (e.refer_to.uri.scheme !== h.SIP) return E("Refer-To header field points to a non-SIP URI scheme"), void e.reply(416); e.reply(202); var s = new C(this, e.cseq); function i(n) { var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; if (n = "function" == typeof n ? n : null, this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; var i = new t(this._ua); if (i.on("progress", (function (e) { var t = e.response; s.notify(t.status_code, t.reason_phrase) })), i.on("accepted", (function (e) { var t = e.response; s.notify(t.status_code, t.reason_phrase) })), i.on("failed", (function (e) { var t = e.message, n = e.cause; t ? s.notify(t.status_code, t.reason_phrase) : s.notify(487, n) })), e.refer_to.uri.hasHeader("replaces")) { var o = decodeURIComponent(e.refer_to.uri.getHeader("replaces")); r.extraHeaders = p.cloneArray(r.extraHeaders), r.extraHeaders.push("Replaces: ".concat(o)) } i.connect(e.refer_to.uri.toAor(), r, n) } function o() { s.notify(603) } E('emit "refer"'), this.emit("refer", { request: e, accept: function (e, t) { i.call(n, e, t) }, reject: function () { o.call(n) } }) } }, { key: "_receiveNotify", value: function (e) { if (E("receiveNotify()"), void 0 === r(e.event) && e.reply(400), "refer" === e.event.event) { var t, n; if (e.event.params && e.event.params.id) t = e.event.params.id, n = this._referSubscribers[t]; else { if (1 !== Object.keys(this._referSubscribers).length) return void e.reply(400, "Missing event id parameter"); n = this._referSubscribers[Object.keys(this._referSubscribers)[0]] } if (!n) return void e.reply(481, "Subscription does not exist"); n.receiveNotify(e), e.reply(200) } else e.reply(489) } }, { key: "_receiveReplaces", value: function (e) { var n = this; function r(n) { var r = this; if (this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; var s = new t(this._ua); s.on("confirmed", (function () { r.terminate() })), s.init_incoming(e, n) } function s() { E("Replaced INVITE rejected by the user"), e.reply(486) } E("receiveReplaces()"), this.emit("replaces", { request: e, accept: function (e) { r.call(n, e) }, reject: function () { s.call(n) } }) } }, { key: "_sendInitialRequest", value: function (e, t, n) { var r = this, s = new v(this._ua, this._request, { onRequestTimeout: function () { r.onRequestTimeout() }, onTransportError: function () { r.onTransportError() }, onAuthenticated: function (e) { r._request = e }, onReceiveResponse: function (e) { r._receiveInviteResponse(e) } }); Promise.resolve().then((function () { return n || (e.audio || e.video ? (r._localMediaStreamLocallyGenerated = !0, navigator.mediaDevices.getUserMedia(e).catch((function (e) { if (r._status === A.STATUS_TERMINATED) throw new Error("terminated"); throw r._failed("local", null, h.causes.USER_DENIED_MEDIA_ACCESS), b('emit "getusermediafailed" [error:%o]', e), r.emit("getusermediafailed", e), e }))) : void 0) })).then((function (e) { if (r._status === A.STATUS_TERMINATED) throw new Error("terminated"); return r._localMediaStream = e, e && r._connection.addStream(e), r._connecting(r._request), r._createLocalDescription("offer", t).catch((function (e) { throw r._failed("local", null, h.causes.WEBRTC_ERROR), e })) })).then((function (e) { if (r._is_canceled || r._status === A.STATUS_TERMINATED) throw new Error("terminated"); r._request.body = e, r._status = A.STATUS_INVITE_SENT, E('emit "sending" [request:%o]', r._request), r.emit("sending", { request: r._request }), s.send() })).catch((function (e) { r._status !== A.STATUS_TERMINATED && b(e) })) } }, { key: "_receiveInviteResponse", value: function (e) { var t = this; if (E("receiveInviteResponse()"), this._dialog && e.status_code >= 200 && e.status_code <= 299) { if (this._dialog.id.call_id === e.call_id && this._dialog.id.local_tag === e.from_tag && this._dialog.id.remote_tag === e.to_tag) return void this.sendRequest(h.ACK); var n = new g(this, e, "UAC"); return void 0 !== n.error ? void E(n.error) : (this.sendRequest(h.ACK), void this.sendRequest(h.BYE)) } if (this._is_canceled) e.status_code >= 100 && e.status_code < 200 ? this._request.cancel(this._cancel_reason) : e.status_code >= 200 && e.status_code < 299 && this._acceptAndTerminate(e); else if (this._status === A.STATUS_INVITE_SENT || this._status === A.STATUS_1XX_RECEIVED) switch (!0) { case /^100$/.test(e.status_code): this._status = A.STATUS_1XX_RECEIVED; break; case /^1[0-9]{2}$/.test(e.status_code): if (!e.to_tag) { E("1xx response received without to tag"); break } if (e.hasHeader("contact") && !this._createDialog(e, "UAC", !0)) break; if (this._status = A.STATUS_1XX_RECEIVED, this._progress("remote", e), !e.body) break; var r = { originator: "remote", type: "answer", sdp: e.body }; E('emit "sdp"'), this.emit("sdp", r); var s = new RTCSessionDescription({ type: "answer", sdp: r.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(s) })).catch((function (e) { b('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })); break; case /^2[0-9]{2}$/.test(e.status_code): if (this._status = A.STATUS_CONFIRMED, !e.body) { this._acceptAndTerminate(e, 400, h.causes.MISSING_SDP), this._failed("remote", e, h.causes.BAD_MEDIA_DESCRIPTION); break } if (!this._createDialog(e, "UAC")) break; var i = { originator: "remote", type: "answer", sdp: e.body }; E('emit "sdp"'), this.emit("sdp", i); var o = new RTCSessionDescription({ type: "answer", sdp: i.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { if ("stable" === t._connection.signalingState) return t._connection.createOffer().then((function (e) { return t._connection.setLocalDescription(e) })).catch((function (n) { t._acceptAndTerminate(e, 500, n.toString()), t._failed("local", e, h.causes.WEBRTC_ERROR) })) })).then((function () { t._connection.setRemoteDescription(o).then((function () { t._handleSessionTimersInIncomingResponse(e), t._accepted("remote", e), t.sendRequest(h.ACK), t._confirmed("local", null) })).catch((function (n) { t._acceptAndTerminate(e, 488, "Not Acceptable Here"), t._failed("remote", e, h.causes.BAD_MEDIA_DESCRIPTION), b('emit "peerconnection:setremotedescriptionfailed" [error:%o]', n), t.emit("peerconnection:setremotedescriptionfailed", n) })) })); break; default: var l = p.sipErrorCause(e.status_code); this._failed("remote", e, l) } } }, { key: "_sendReinvite", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; E("sendReinvite()"); var n = p.cloneArray(t.extraHeaders), r = t.eventHandlers || {}, s = t.rtcOfferConstraints || this._rtcOfferConstraints || null, i = !1; function o(e) { var t = this; if (this._status !== A.STATUS_TERMINATED && (this.sendRequest(h.ACK), !i)) if (this._handleSessionTimersInIncomingResponse(e), e.body) if ("application/sdp" === e.getHeader("Content-Type")) { var n = { originator: "remote", type: "answer", sdp: e.body }; E('emit "sdp"'), this.emit("sdp", n); var s = new RTCSessionDescription({ type: "answer", sdp: n.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(s) })).then((function () { r.succeeded && r.succeeded(e) })).catch((function (e) { l.call(t), b('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })) } else l.call(this); else l.call(this) } function l(e) { r.failed && r.failed(e) } n.push("Contact: ".concat(this._contact)), n.push("Content-Type: application/sdp"), this._sessionTimers.running && n.push("Session-Expires: ".concat(this._sessionTimers.currentExpires, ";refresher=").concat(this._sessionTimers.refresher ? "uac" : "uas")), this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return e._createLocalDescription("offer", s) })).then((function (t) { t = e._mangleOffer(t), e.sendRequest(h.INVITE, { extraHeaders: n, body: t, eventHandlers: { onSuccessResponse: function (t) { o.call(e, t), i = !0 }, onErrorResponse: function (t) { l.call(e, t) }, onTransportError: function () { e.onTransportError() }, onRequestTimeout: function () { e.onRequestTimeout() }, onDialogError: function () { e.onDialogError() } } }) })).catch((function () { l() })) } }, { key: "_sendUpdate", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; E("sendUpdate()"); var n = p.cloneArray(t.extraHeaders), r = t.eventHandlers || {}, s = t.rtcOfferConstraints || this._rtcOfferConstraints || null, i = t.sdpOffer || !1, o = !1; function l(e) { var t = this; if (this._status !== A.STATUS_TERMINATED && !o) if (this._handleSessionTimersInIncomingResponse(e), i) { if (!e.body) return void a.call(this); if ("application/sdp" !== e.getHeader("Content-Type")) return void a.call(this); var n = { originator: "remote", type: "answer", sdp: e.body }; E('emit "sdp"'), this.emit("sdp", n); var s = new RTCSessionDescription({ type: "answer", sdp: n.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(s) })).then((function () { r.succeeded && r.succeeded(e) })).catch((function (e) { a.call(t), b('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })) } else r.succeeded && r.succeeded(e) } function a(e) { r.failed && r.failed(e) } n.push("Contact: ".concat(this._contact)), this._sessionTimers.running && n.push("Session-Expires: ".concat(this._sessionTimers.currentExpires, ";refresher=").concat(this._sessionTimers.refresher ? "uac" : "uas")), i ? (n.push("Content-Type: application/sdp"), this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return e._createLocalDescription("offer", s) })).then((function (t) { t = e._mangleOffer(t), e.sendRequest(h.UPDATE, { extraHeaders: n, body: t, eventHandlers: { onSuccessResponse: function (t) { l.call(e, t), o = !0 }, onErrorResponse: function (t) { a.call(e, t) }, onTransportError: function () { e.onTransportError() }, onRequestTimeout: function () { e.onRequestTimeout() }, onDialogError: function () { e.onDialogError() } } }) })).catch((function () { a.call(e) }))) : this.sendRequest(h.UPDATE, { extraHeaders: n, eventHandlers: { onSuccessResponse: function (t) { l.call(e, t) }, onErrorResponse: function (t) { a.call(e, t) }, onTransportError: function () { e.onTransportError() }, onRequestTimeout: function () { e.onRequestTimeout() }, onDialogError: function () { e.onDialogError() } } }) } }, { key: "_acceptAndTerminate", value: function (e, t, n) { E("acceptAndTerminate()"); var r = []; t && (n = n || h.REASON_PHRASE[t] || "", r.push("Reason: SIP ;cause=".concat(t, '; text="').concat(n, '"'))), (this._dialog || this._createDialog(e, "UAC")) && (this.sendRequest(h.ACK), this.sendRequest(h.BYE, { extraHeaders: r })), this._status = A.STATUS_TERMINATED } }, { key: "_mangleOffer", value: function (e) { if (!this._localHold && !this._remoteHold) return e; if (e = c.parse(e), this._localHold && !this._remoteHold) { E("mangleOffer() | me on hold, mangling offer"); var t = !0, n = !1, r = void 0; try { for (var s, i = e.media[Symbol.iterator](); !(t = (s = i.next()).done); t = !0){ var o = s.value; -1 !== w.indexOf(o.type) && (o.direction ? "sendrecv" === o.direction ? o.direction = "sendonly" : "recvonly" === o.direction && (o.direction = "inactive") : o.direction = "sendonly") } } catch (e) { n = !0, r = e } finally { try { t || null == i.return || i.return() } finally { if (n) throw r } } } else if (this._localHold && this._remoteHold) { E("mangleOffer() | both on hold, mangling offer"); var l = !0, a = !1, u = void 0; try { for (var h, d = e.media[Symbol.iterator](); !(l = (h = d.next()).done); l = !0){ var f = h.value; -1 !== w.indexOf(f.type) && (f.direction = "inactive") } } catch (e) { a = !0, u = e } finally { try { l || null == d.return || d.return() } finally { if (a) throw u } } } else if (this._remoteHold) { E("mangleOffer() | remote on hold, mangling offer"); var p = !0, _ = !1, m = void 0; try { for (var g, v = e.media[Symbol.iterator](); !(p = (g = v.next()).done); p = !0){ var y = g.value; -1 !== w.indexOf(y.type) && (y.direction ? "sendrecv" === y.direction ? y.direction = "recvonly" : "recvonly" === y.direction && (y.direction = "inactive") : y.direction = "recvonly") } } catch (e) { _ = !0, m = e } finally { try { p || null == v.return || v.return() } finally { if (_) throw m } } } return c.write(e) } }, { key: "_setLocalMediaStatus", value: function () { var e = !0, t = !0; (this._localHold || this._remoteHold) && (e = !1, t = !1), this._audioMuted && (e = !1), this._videoMuted && (t = !1), this._toogleMuteAudio(!e), this._toogleMuteVideo(!t) } }, { key: "_handleSessionTimersInIncomingRequest", value: function (e, t) { var n; this._sessionTimers.enabled && (e.session_expires && e.session_expires >= h.MIN_SESSION_EXPIRES ? (this._sessionTimers.currentExpires = e.session_expires, n = e.session_expires_refresher || "uas") : (this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires, n = "uas"), t.push("Session-Expires: ".concat(this._sessionTimers.currentExpires, ";refresher=").concat(n)), this._sessionTimers.refresher = "uas" === n, this._runSessionTimer()) } }, { key: "_handleSessionTimersInIncomingResponse", value: function (e) { var t; this._sessionTimers.enabled && (e.session_expires && e.session_expires >= h.MIN_SESSION_EXPIRES ? (this._sessionTimers.currentExpires = e.session_expires, t = e.session_expires_refresher || "uac") : (this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires, t = "uac"), this._sessionTimers.refresher = "uac" === t, this._runSessionTimer()) } }, { key: "_runSessionTimer", value: function () { var e = this, t = this._sessionTimers.currentExpires; this._sessionTimers.running = !0, clearTimeout(this._sessionTimers.timer), this._sessionTimers.refresher ? this._sessionTimers.timer = setTimeout((function () { e._status !== A.STATUS_TERMINATED && (E("runSessionTimer() | sending session refresh request"), e._sessionTimers.refreshMethod === h.UPDATE ? e._sendUpdate() : e._sendReinvite()) }), 500 * t) : this._sessionTimers.timer = setTimeout((function () { e._status !== A.STATUS_TERMINATED && (b("runSessionTimer() | timer expired, terminating the session"), e.terminate({ cause: h.causes.REQUEST_TIMEOUT, status_code: 408, reason_phrase: "Session Timer Expired" })) }), 1100 * t) } }, { key: "_toogleMuteAudio", value: function (e) { var t = this._connection.getLocalStreams(), n = !0, r = !1, s = void 0; try { for (var i, o = t[Symbol.iterator](); !(n = (i = o.next()).done); n = !0){ var l = i.value.getAudioTracks(), a = !0, u = !1, c = void 0; try { for (var h, d = l[Symbol.iterator](); !(a = (h = d.next()).done); a = !0){ h.value.enabled = !e } } catch (e) { u = !0, c = e } finally { try { a || null == d.return || d.return() } finally { if (u) throw c } } } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } }, { key: "_toogleMuteVideo", value: function (e) { var t = this._connection.getLocalStreams(), n = !0, r = !1, s = void 0; try { for (var i, o = t[Symbol.iterator](); !(n = (i = o.next()).done); n = !0){ var l = i.value.getVideoTracks(), a = !0, u = !1, c = void 0; try { for (var h, d = l[Symbol.iterator](); !(a = (h = d.next()).done); a = !0){ h.value.enabled = !e } } catch (e) { u = !0, c = e } finally { try { a || null == d.return || d.return() } finally { if (u) throw c } } } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } }, { key: "_newRTCSession", value: function (e, t) { E("newRTCSession()"), this._ua.newRTCSession(this, { originator: e, session: this, request: t }) } }, { key: "_connecting", value: function (e) { E("session connecting"), E('emit "connecting"'), this.emit("connecting", { request: e }) } }, { key: "_progress", value: function (e, t) { E("session progress"), E('emit "progress"'), this.emit("progress", { originator: e, response: t || null }) } }, { key: "_accepted", value: function (e, t) { E("session accepted"), this._start_time = new Date, E('emit "accepted"'), this.emit("accepted", { originator: e, response: t || null }) } }, { key: "_confirmed", value: function (e, t) { E("session confirmed"), this._is_confirmed = !0, E('emit "confirmed"'), this.emit("confirmed", { originator: e, ack: t || null }) } }, { key: "_ended", value: function (e, t, n) { E("session ended"), this._end_time = new Date, this._close(), E('emit "ended"'), this.emit("ended", { originator: e, message: t || null, cause: n }) } }, { key: "_failed", value: function (e, t, n) { E("session failed"), this._close(), E('emit "failed"'), this.emit("failed", { originator: e, message: t || null, cause: n }) } }, { key: "_onhold", value: function (e) { E("session onhold"), this._setLocalMediaStatus(), E('emit "hold"'), this.emit("hold", { originator: e }) } }, { key: "_onunhold", value: function (e) { E("session onunhold"), this._setLocalMediaStatus(), E('emit "unhold"'), this.emit("unhold", { originator: e }) } }, { key: "_onmute", value: function (e) { var t = e.audio, n = e.video; E("session onmute"), this._setLocalMediaStatus(), E('emit "muted"'), this.emit("muted", { audio: t, video: n }) } }, { key: "_onunmute", value: function (e) { var t = e.audio, n = e.video; E("session onunmute"), this._setLocalMediaStatus(), E('emit "unmuted"'), this.emit("unmuted", { audio: t, video: n }) } }, { key: "C", get: function () { return A } }, { key: "causes", get: function () { return h.causes } }, { key: "id", get: function () { return this._id } }, { key: "connection", get: function () { return this._connection } }, { key: "contact", get: function () { return this._contact } }, { key: "direction", get: function () { return this._direction } }, { key: "local_identity", get: function () { return this._local_identity } }, { key: "remote_identity", get: function () { return this._remote_identity } }, { key: "start_time", get: function () { return this._start_time } }, { key: "end_time", get: function () { return this._end_time } }, { key: "data", get: function () { return this._data }, set: function (e) { this._data = e } }, { key: "status", get: function () { return this._status } }]), t }(u) }, 481: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } var a = n(187).EventEmitter, u = n(965), c = n(63), h = n(424), d = n(227)("JsSIP:RTCSession:DTMF"); n(227)("JsSIP:ERROR:RTCSession:DTMF").log = console.warn.bind(console); var f = { MIN_DURATION: 70, MAX_DURATION: 6e3, DEFAULT_DURATION: 100, MIN_INTER_TONE_GAP: 50, DEFAULT_INTER_TONE_GAP: 500 }; e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._session = e, n._direction = null, n._tone = null, n._duration = null, n._request = null, n } var n, r, a; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) }(t, e), n = t, r = [{ key: "send", value: function (e) { var t = this, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; if (void 0 === e) throw new TypeError("Not enough arguments"); if (this._direction = "outgoing", this._session.status !== this._session.C.STATUS_CONFIRMED && this._session.status !== this._session.C.STATUS_WAITING_FOR_ACK) throw new c.InvalidStateError(this._session.status); var r = h.cloneArray(n.extraHeaders); if (this.eventHandlers = n.eventHandlers || {}, "string" == typeof e) e = e.toUpperCase(); else { if ("number" != typeof e) throw new TypeError("Invalid tone: ".concat(e)); e = e.toString() } if (!e.match(/^[0-9A-DR#*]$/)) throw new TypeError("Invalid tone: ".concat(e)); this._tone = e, this._duration = n.duration, r.push("Content-Type: application/dtmf-relay"); var s = "Signal=".concat(this._tone, "\r\n"); s += "Duration=".concat(this._duration), this._session.newDTMF({ originator: "local", dtmf: this, request: this._request }), this._session.sendRequest(u.INFO, { extraHeaders: r, eventHandlers: { onSuccessResponse: function (e) { t.emit("succeeded", { originator: "remote", response: e }) }, onErrorResponse: function (e) { t.eventHandlers.onFailed && t.eventHandlers.onFailed(), t.emit("failed", { originator: "remote", response: e }) }, onRequestTimeout: function () { t._session.onRequestTimeout() }, onTransportError: function () { t._session.onTransportError() }, onDialogError: function () { t._session.onDialogError() } }, body: s }) } }, { key: "init_incoming", value: function (e) { var t = /^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/, n = /^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/; if (this._direction = "incoming", this._request = e, e.reply(200), e.body) { var r = e.body.split("\n"); r.length >= 1 && t.test(r[0]) && (this._tone = r[0].replace(t, "$2")), r.length >= 2 && n.test(r[1]) && (this._duration = parseInt(r[1].replace(n, "$2"), 10)) } this._duration || (this._duration = f.DEFAULT_DURATION), this._tone ? this._session.newDTMF({ originator: "remote", dtmf: this, request: e }) : d("invalid INFO DTMF received, discarded") } }, { key: "tone", get: function () { return this._tone } }, { key: "duration", get: function () { return this._duration } }], r && s(n.prototype, r), a && s(n, a), t }(a), e.exports.C = f }, 126: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } var a = n(187).EventEmitter; n(227)("JsSIP:ERROR:RTCSession:Info").log = console.warn.bind(console); var u = n(965), c = n(63), h = n(424); e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._session = e, n._direction = null, n._contentType = null, n._body = null, n } var n, r, a; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) }(t, e), n = t, r = [{ key: "send", value: function (e, t) { var n = this, r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; if (this._direction = "outgoing", void 0 === e) throw new TypeError("Not enough arguments"); if (this._session.status !== this._session.C.STATUS_CONFIRMED && this._session.status !== this._session.C.STATUS_WAITING_FOR_ACK) throw new c.InvalidStateError(this._session.status); this._contentType = e, this._body = t; var s = h.cloneArray(r.extraHeaders); s.push("Content-Type: ".concat(e)), this._session.newInfo({ originator: "local", info: this, request: this.request }), this._session.sendRequest(u.INFO, { extraHeaders: s, eventHandlers: { onSuccessResponse: function (e) { n.emit("succeeded", { originator: "remote", response: e }) }, onErrorResponse: function (e) { n.emit("failed", { originator: "remote", response: e }) }, onTransportError: function () { n._session.onTransportError() }, onRequestTimeout: function () { n._session.onRequestTimeout() }, onDialogError: function () { n._session.onDialogError() } }, body: t }) } }, { key: "init_incoming", value: function (e) { this._direction = "incoming", this.request = e, e.reply(200), this._contentType = e.getHeader("content-type"), this._body = e.body, this._session.newInfo({ originator: "remote", info: this, request: e }) } }, { key: "contentType", get: function () { return this._contentType } }, { key: "body", get: function () { return this._body } }], r && s(n.prototype, r), a && s(n, a), t }(a) }, 774: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(965), i = n(227)("JsSIP:RTCSession:ReferNotifier"), o = "refer", l = "message/sipfrag;version=2.0", a = 300; e.exports = function () { function e(t, n, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._session = t, this._id = n, this._expires = r || a, this._active = !0, this.notify(100) } var t, n, u; return t = e, (n = [{ key: "notify", value: function (e, t) { var n; i("notify()"), !1 !== this._active && (t = t || s.REASON_PHRASE[e] || "", n = e >= 200 ? "terminated;reason=noresource" : "active;expires=".concat(this._expires), this._session.sendRequest(s.NOTIFY, { extraHeaders: ["Event: ".concat(o, ";id=").concat(this._id), "Subscription-State: ".concat(n), "Content-Type: ".concat(l)], body: "SIP/2.0 ".concat(e, " ").concat(t), eventHandlers: { onErrorResponse: function () { this._active = !1 } } })) } }]) && r(t.prototype, n), u && r(t, u), e }() }, 603: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } var a = n(187).EventEmitter, u = n(965), c = n(790), h = n(424), d = n(227)("JsSIP:RTCSession:ReferSubscriber"); e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._id = null, n._session = e, n } var n, r, a; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) }(t, e), n = t, r = [{ key: "sendRefer", value: function (e) { var t = this, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; d("sendRefer()"); var r = h.cloneArray(n.extraHeaders), s = n.eventHandlers || {}; for (var i in s) Object.prototype.hasOwnProperty.call(s, i) && this.on(i, s[i]); var o = null; n.replaces && (o = n.replaces._request.call_id, o += ";to-tag=".concat(n.replaces._to_tag), o += ";from-tag=".concat(n.replaces._from_tag), o = encodeURIComponent(o)); var l = "Refer-To: <".concat(e).concat(o ? "?Replaces=".concat(o) : "", ">"); r.push(l), r.push("Contact: ".concat(this._session.contact)); var a = this._session.sendRequest(u.REFER, { extraHeaders: r, eventHandlers: { onSuccessResponse: function (e) { t._requestSucceeded(e) }, onErrorResponse: function (e) { t._requestFailed(e, u.causes.REJECTED) }, onTransportError: function () { t._requestFailed(null, u.causes.CONNECTION_ERROR) }, onRequestTimeout: function () { t._requestFailed(null, u.causes.REQUEST_TIMEOUT) }, onDialogError: function () { t._requestFailed(null, u.causes.DIALOG_ERROR) } } }); this._id = a.cseq } }, { key: "receiveNotify", value: function (e) { if (d("receiveNotify()"), e.body) { var t = c.parse(e.body.trim(), "Status_Line"); if (-1 !== t) switch (!0) { case /^100$/.test(t.status_code): this.emit("trying", { request: e, status_line: t }); break; case /^1[0-9]{2}$/.test(t.status_code): this.emit("progress", { request: e, status_line: t }); break; case /^2[0-9]{2}$/.test(t.status_code): this.emit("accepted", { request: e, status_line: t }); break; default: this.emit("failed", { request: e, status_line: t }) } else d('receiveNotify() | error parsing NOTIFY body: "'.concat(e.body, '"')) } } }, { key: "_requestSucceeded", value: function (e) { d("REFER succeeded"), d('emit "requestSucceeded"'), this.emit("requestSucceeded", { response: e }) } }, { key: "_requestFailed", value: function (e, t) { d("REFER failed"), d('emit "requestFailed"'), this.emit("requestFailed", { response: e || null, cause: t }) } }, { key: "id", get: function () { return this._id } }], r && s(n.prototype, r), a && s(n, a), t }(a) }, 116: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(424), i = n(965), o = n(497), l = n(66), a = n(227)("JsSIP:Registrator"); e.exports = function () { function e(t, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e); this._ua = t, this._transport = n, this._registrar = t.configuration.registrar_server, this._expires = t.configuration.register_expires, this._call_id = s.createRandomToken(22), this._cseq = 0, this._to_uri = t.configuration.uri, this._registrationTimer = null, this._registering = !1, this._registered = !1, this._contact = this._ua.contact.toString(), this._contact += ";+sip.ice", this._extraHeaders = [], this._extraContactParams = "", this._contact += ";reg-id=".concat(1), this._contact += ';+sip.instance="<urn:uuid:'.concat(this._ua.configuration.instance_id, '>"') } var t, n, u; return t = e, n = [{ key: "setExtraHeaders", value: function (e) { Array.isArray(e) || (e = []), this._extraHeaders = e.slice() } }, { key: "setExtraContactParams", value: function (e) { for (var t in e instanceof Object || (e = {}), this._extraContactParams = "", e) if (Object.prototype.hasOwnProperty.call(e, t)) { var n = e[t]; this._extraContactParams += ";".concat(t), n && (this._extraContactParams += "=".concat(n)) } } }, { key: "register", value: function () { var e = this; if (this._registering) a("Register request in progress..."); else { var t = this._extraHeaders.slice(); t.push("Contact: ".concat(this._contact, ";expires=").concat(this._expires).concat(this._extraContactParams)), t.push("Expires: ".concat(this._expires)); var n = new o.OutgoingRequest(i.REGISTER, this._registrar, this._ua, { to_uri: this._to_uri, call_id: this._call_id, cseq: this._cseq += 1 }, t), r = new l(this._ua, n, { onRequestTimeout: function () { e._registrationFailure(null, i.causes.REQUEST_TIMEOUT) }, onTransportError: function () { e._registrationFailure(null, i.causes.CONNECTION_ERROR) }, onAuthenticated: function () { e._cseq += 1 }, onReceiveResponse: function (t) { var n, r, o = t.getHeaders("contact").length; if (t.cseq === e._cseq) switch (null !== e._registrationTimer && (clearTimeout(e._registrationTimer), e._registrationTimer = null), !0) { case /^1[0-9]{2}$/.test(t.status_code): break; case /^2[0-9]{2}$/.test(t.status_code): if (e._registering = !1, !o) { a("no Contact header in response to REGISTER, response ignored"); break } for (; o--;){ if ((n = t.parseHeader("contact", o)).uri.user === e._ua.contact.uri.user) { r = n.getParam("expires"); break } n = null } if (!n) { a("no Contact header pointing to us, response ignored"); break } !r && t.hasHeader("expires") && (r = t.getHeader("expires")), r || (r = e._expires), (r = Number(r)) < 10 && (r = 10), e._registrationTimer = setTimeout((function () { e._registrationTimer = null, 0 === e._ua.listeners("registrationExpiring").length ? e.register() : e._ua.emit("registrationExpiring") }), 1e3 * r - 5e3), n.hasParam("temp-gruu") && (e._ua.contact.temp_gruu = n.getParam("temp-gruu").replace(/"/g, "")), n.hasParam("pub-gruu") && (e._ua.contact.pub_gruu = n.getParam("pub-gruu").replace(/"/g, "")), e._registered || (e._registered = !0, e._ua.registered({ response: t })); break; case /^423$/.test(t.status_code): t.hasHeader("min-expires") ? (e._expires = Number(t.getHeader("min-expires")), e._expires < 10 && (e._expires = 10), e.register()) : (a("423 response received for REGISTER without Min-Expires"), e._registrationFailure(t, i.causes.SIP_FAILURE_CODE)); break; default: var l = s.sipErrorCause(t.status_code); e._registrationFailure(t, l) } } }); this._registering = !0, r.send() } } }, { key: "unregister", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; if (this._registered) { this._registered = !1, null !== this._registrationTimer && (clearTimeout(this._registrationTimer), this._registrationTimer = null); var n = this._extraHeaders.slice(); t.all ? n.push("Contact: *".concat(this._extraContactParams)) : n.push("Contact: ".concat(this._contact, ";expires=0").concat(this._extraContactParams)), n.push("Expires: 0"); var r = new o.OutgoingRequest(i.REGISTER, this._registrar, this._ua, { to_uri: this._to_uri, call_id: this._call_id, cseq: this._cseq += 1 }, n), u = new l(this._ua, r, { onRequestTimeout: function () { e._unregistered(null, i.causes.REQUEST_TIMEOUT) }, onTransportError: function () { e._unregistered(null, i.causes.CONNECTION_ERROR) }, onAuthenticated: function () { e._cseq += 1 }, onReceiveResponse: function (t) { switch (!0) { case /^1[0-9]{2}$/.test(t.status_code): break; case /^2[0-9]{2}$/.test(t.status_code): e._unregistered(t); break; default: var n = s.sipErrorCause(t.status_code); e._unregistered(t, n) } } }); u.send() } else a("already unregistered") } }, { key: "close", value: function () { this._registered && this.unregister() } }, { key: "onTransportClosed", value: function () { this._registering = !1, null !== this._registrationTimer && (clearTimeout(this._registrationTimer), this._registrationTimer = null), this._registered && (this._registered = !1, this._ua.unregistered({})) } }, { key: "_registrationFailure", value: function (e, t) { this._registering = !1, this._ua.registrationFailed({ response: e || null, cause: t }), this._registered && (this._registered = !1, this._ua.unregistered({ response: e || null, cause: t })) } }, { key: "_unregistered", value: function (e, t) { this._registering = !1, this._registered = !1, this._ua.unregistered({ response: e || null, cause: t || null }) } }, { key: "registered", get: function () { return this._registered } }], n && r(t.prototype, n), u && r(t, u), e }() }, 66: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(965), i = n(999), o = n(754), l = n(227)("JsSIP:RequestSender"), a = { onRequestTimeout: function () { }, onTransportError: function () { }, onReceiveResponse: function () { }, onAuthenticated: function () { } }; e.exports = function () { function e(t, n, r) { for (var i in function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._ua = t, this._eventHandlers = r, this._method = n.method, this._request = n, this._auth = null, this._challenged = !1, this._staled = !1, a) Object.prototype.hasOwnProperty.call(a, i) && (this._eventHandlers[i] || (this._eventHandlers[i] = a[i])); t.status !== t.C.STATUS_USER_CLOSED || this._method === s.BYE && this._method === s.ACK || this._eventHandlers.onTransportError() } var t, n, u; return t = e, (n = [{ key: "send", value: function () { var e = this, t = { onRequestTimeout: function () { e._eventHandlers.onRequestTimeout() }, onTransportError: function () { e._eventHandlers.onTransportError() }, onReceiveResponse: function (t) { e._receiveResponse(t) } }; switch (this._method) { case "INVITE": this.clientTransaction = new o.InviteClientTransaction(this._ua, this._ua.transport, this._request, t); break; case "ACK": this.clientTransaction = new o.AckClientTransaction(this._ua, this._ua.transport, this._request, t); break; default: this.clientTransaction = new o.NonInviteClientTransaction(this._ua, this._ua.transport, this._request, t) }this.clientTransaction.send() } }, { key: "_receiveResponse", value: function (e) { var t, n, r = e.status_code; if (401 !== r && 407 !== r || null === this._ua.configuration.password && null === this._ua.configuration.ha1) this._eventHandlers.onReceiveResponse(e); else { if (401 === e.status_code ? (t = e.parseHeader("www-authenticate"), n = "authorization") : (t = e.parseHeader("proxy-authenticate"), n = "proxy-authorization"), !t) return l("".concat(e.status_code, " with wrong or missing challenge, cannot authenticate")), void this._eventHandlers.onReceiveResponse(e); if (!this._challenged || !this._staled && !0 === t.stale) { if (this._auth || (this._auth = new i({ username: this._ua.configuration.authorization_user, password: this._ua.configuration.password, realm: this._ua.configuration.realm, ha1: this._ua.configuration.ha1 })), !this._auth.authenticate(this._request, t)) return void this._eventHandlers.onReceiveResponse(e); this._challenged = !0, this._ua.set("realm", this._auth.get("realm")), this._ua.set("ha1", this._auth.get("ha1")), t.stale && (this._staled = !0), this._request = this._request.clone(), this._request.cseq += 1, this._request.setHeader("cseq", "".concat(this._request.cseq, " ").concat(this._method)), this._request.setHeader(n, this._auth.toString()), this._eventHandlers.onAuthenticated(this._request), this.send() } else this._eventHandlers.onReceiveResponse(e) } } }]) && r(t.prototype, n), u && r(t, u), e }() }, 497: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function i(e) { return i = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, i(e) } function o(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } function a(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function u(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function c(e, t, n) { return t && u(e.prototype, t), n && u(e, n), e } var h = n(766), d = n(965), f = n(424), p = n(437), _ = n(790), m = n(227)("JsSIP:SIPMessage"), g = function () { function e(t, n, r, s, i, o) { if (a(this, e), !t || !n || !r) return null; s = s || {}, this.ua = r, this.headers = {}, this.method = t, this.ruri = n, this.body = o, this.extraHeaders = f.cloneArray(i), s.route_set ? this.setHeader("route", s.route_set) : r.configuration.use_preloaded_route && this.setHeader("route", "<".concat(r.transport.sip_uri, ";lr>")), this.setHeader("via", ""), this.setHeader("max-forwards", d.MAX_FORWARDS); var l, u = s.to_display_name || 0 === s.to_display_name ? '"'.concat(s.to_display_name, '" ') : ""; u += "<".concat(s.to_uri || n, ">"), u += s.to_tag ? ";tag=".concat(s.to_tag) : "", this.to = p.parse(u), this.setHeader("to", u), l = s.from_display_name || 0 === s.from_display_name ? '"'.concat(s.from_display_name, '" ') : r.configuration.display_name ? '"'.concat(r.configuration.display_name, '" ') : "", l += "<".concat(s.from_uri || r.configuration.uri, ">;tag="), l += s.from_tag || f.newTag(), this.from = p.parse(l), this.setHeader("from", l); var c = s.call_id || r.configuration.jssip_id + f.createRandomToken(15); this.call_id = c, this.setHeader("call-id", c); var h = s.cseq || Math.floor(1e4 * Math.random()); this.cseq = h, this.setHeader("cseq", "".concat(h, " ").concat(t)) } return c(e, [{ key: "setHeader", value: function (e, t) { for (var n = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), r = 0; r < this.extraHeaders.length; r++)n.test(this.extraHeaders[r]) && this.extraHeaders.splice(r, 1); this.headers[f.headerize(e)] = Array.isArray(t) ? t : [t] } }, { key: "getHeader", value: function (e) { var t = this.headers[f.headerize(e)]; if (t) { if (t[0]) return t[0] } else { var n = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), r = !0, s = !1, i = void 0; try { for (var o, l = this.extraHeaders[Symbol.iterator](); !(r = (o = l.next()).done); r = !0){ var a = o.value; if (n.test(a)) return a.substring(a.indexOf(":") + 1).trim() } } catch (e) { s = !0, i = e } finally { try { r || null == l.return || l.return() } finally { if (s) throw i } } } } }, { key: "getHeaders", value: function (e) { var t = this.headers[f.headerize(e)], n = []; if (t) { var r = !0, s = !1, i = void 0; try { for (var o, l = t[Symbol.iterator](); !(r = (o = l.next()).done); r = !0){ var a = o.value; n.push(a) } } catch (e) { s = !0, i = e } finally { try { r || null == l.return || l.return() } finally { if (s) throw i } } return n } var u = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), c = !0, h = !1, d = void 0; try { for (var p, _ = this.extraHeaders[Symbol.iterator](); !(c = (p = _.next()).done); c = !0){ var m = p.value; u.test(m) && n.push(m.substring(m.indexOf(":") + 1).trim()) } } catch (e) { h = !0, d = e } finally { try { c || null == _.return || _.return() } finally { if (h) throw d } } return n } }, { key: "hasHeader", value: function (e) { if (this.headers[f.headerize(e)]) return !0; var t = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), n = !0, r = !1, s = void 0; try { for (var i, o = this.extraHeaders[Symbol.iterator](); !(n = (i = o.next()).done); n = !0){ var l = i.value; if (t.test(l)) return !0 } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } return !1 } }, { key: "parseSDP", value: function (e) { return !e && this.sdp || (this.sdp = h.parse(this.body || "")), this.sdp } }, { key: "toString", value: function () { var e = "".concat(this.method, " ").concat(this.ruri, " SIP/2.0\r\n"); for (var t in this.headers) if (Object.prototype.hasOwnProperty.call(this.headers, t)) { var n = !0, r = !1, s = void 0; try { for (var i, o = this.headers[t][Symbol.iterator](); !(n = (i = o.next()).done); n = !0){ var l = i.value; e += "".concat(t, ": ").concat(l, "\r\n") } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } var a = !0, u = !1, c = void 0; try { for (var h, p = this.extraHeaders[Symbol.iterator](); !(a = (h = p.next()).done); a = !0){ var _ = h.value; e += "".concat(_.trim(), "\r\n") } } catch (e) { u = !0, c = e } finally { try { a || null == p.return || p.return() } finally { if (u) throw c } } var m = []; switch (this.method) { case d.REGISTER: m.push("path", "gruu"); break; case d.INVITE: this.ua.configuration.session_timers && m.push("timer"), (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) && m.push("gruu"), m.push("ice", "replaces"); break; case d.UPDATE: this.ua.configuration.session_timers && m.push("timer"), m.push("ice") }m.push("outbound"); var g = this.ua.configuration.user_agent || d.USER_AGENT; if (e += "Allow: ".concat(d.ALLOWED_METHODS, "\r\n"), e += "Supported: ".concat(m, "\r\n"), e += "User-Agent: ".concat(g, "\r\n"), this.body) { var v = f.str_utf8_length(this.body); e += "Content-Length: ".concat(v, "\r\n\r\n"), e += this.body } else e += "Content-Length: 0\r\n\r\n"; return e } }, { key: "clone", value: function () { var t = new e(this.method, this.ruri, this.ua); return Object.keys(this.headers).forEach((function (e) { t.headers[e] = this.headers[e].slice() }), this), t.body = this.body, t.extraHeaders = f.cloneArray(this.extraHeaders), t.to = this.to, t.from = this.from, t.call_id = this.call_id, t.cseq = this.cseq, t } }]), e }(), v = function (e) { function t(e, n, r, o, l) { var u; return a(this, t), (u = s(this, i(t).call(this, d.INVITE, e, n, r, o, l))).transaction = null, u } return o(t, e), c(t, [{ key: "cancel", value: function (e) { this.transaction.cancel(e) } }, { key: "clone", value: function () { var e = new t(this.ruri, this.ua); return Object.keys(this.headers).forEach((function (t) { e.headers[t] = this.headers[t].slice() }), this), e.body = this.body, e.extraHeaders = f.cloneArray(this.extraHeaders), e.to = this.to, e.from = this.from, e.call_id = this.call_id, e.cseq = this.cseq, e.transaction = this.transaction, e } }]), t }(g), y = function () { function e() { a(this, e), this.data = null, this.headers = null, this.method = null, this.via = null, this.via_branch = null, this.call_id = null, this.cseq = null, this.from = null, this.from_tag = null, this.to = null, this.to_tag = null, this.body = null, this.sdp = null } return c(e, [{ key: "addHeader", value: function (e, t) { var n = { raw: t }; e = f.headerize(e), this.headers[e] ? this.headers[e].push(n) : this.headers[e] = [n] } }, { key: "getHeader", value: function (e) { var t = this.headers[f.headerize(e)]; if (t) return t[0] ? t[0].raw : void 0 } }, { key: "getHeaders", value: function (e) { var t = this.headers[f.headerize(e)], n = []; if (!t) return []; var r = !0, s = !1, i = void 0; try { for (var o, l = t[Symbol.iterator](); !(r = (o = l.next()).done); r = !0){ var a = o.value; n.push(a.raw) } } catch (e) { s = !0, i = e } finally { try { r || null == l.return || l.return() } finally { if (s) throw i } } return n } }, { key: "hasHeader", value: function (e) { return !!this.headers[f.headerize(e)] } }, { key: "parseHeader", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0; if (e = f.headerize(e), this.headers[e]) { if (!(t >= this.headers[e].length)) { var n = this.headers[e][t], r = n.raw; if (n.parsed) return n.parsed; var s = _.parse(r, e.replace(/-/g, "_")); return -1 === s ? (this.headers[e].splice(t, 1), void m('error parsing "'.concat(e, '" header field with value "').concat(r, '"'))) : (n.parsed = s, s) } m('not so many "'.concat(e, '" headers present')) } else m('header "'.concat(e, '" not present')) } }, { key: "s", value: function (e, t) { return this.parseHeader(e, t) } }, { key: "setHeader", value: function (e, t) { var n = { raw: t }; this.headers[f.headerize(e)] = [n] } }, { key: "parseSDP", value: function (e) { return !e && this.sdp || (this.sdp = h.parse(this.body || "")), this.sdp } }, { key: "toString", value: function () { return this.data } }]), e }(), T = function (e) { function t(e) { var n; return a(this, t), (n = s(this, i(t).call(this))).ua = e, n.headers = {}, n.ruri = null, n.transport = null, n.server_transaction = null, n } return o(t, e), c(t, [{ key: "reply", value: function (e, t, n, r, s, i) { var o = [], l = this.getHeader("To"); if (t = t || null, !(e = e || null) || e < 100 || e > 699) throw new TypeError("Invalid status_code: ".concat(e)); if (t && "string" != typeof t && !(t instanceof String)) throw new TypeError("Invalid reason_phrase: ".concat(t)); t = t || d.REASON_PHRASE[e] || "", n = f.cloneArray(n); var a = "SIP/2.0 ".concat(e, " ").concat(t, "\r\n"); if (this.method === d.INVITE && e > 100 && e <= 200) { var u = this.getHeaders("record-route"), c = !0, h = !1, p = void 0; try { for (var _, m = u[Symbol.iterator](); !(c = (_ = m.next()).done); c = !0){ var g = _.value; a += "Record-Route: ".concat(g, "\r\n") } } catch (e) { h = !0, p = e } finally { try { c || null == m.return || m.return() } finally { if (h) throw p } } } var v = this.getHeaders("via"), y = !0, T = !1, C = void 0; try { for (var S, E = v[Symbol.iterator](); !(y = (S = E.next()).done); y = !0){ var b = S.value; a += "Via: ".concat(b, "\r\n") } } catch (e) { T = !0, C = e } finally { try { y || null == E.return || E.return() } finally { if (T) throw C } } !this.to_tag && e > 100 ? l += ";tag=".concat(f.newTag()) : this.to_tag && !this.s("to").hasParam("tag") && (l += ";tag=".concat(this.to_tag)), a += "To: ".concat(l, "\r\n"), a += "From: ".concat(this.getHeader("From"), "\r\n"), a += "Call-ID: ".concat(this.call_id, "\r\n"), a += "CSeq: ".concat(this.cseq, " ").concat(this.method, "\r\n"); var A = !0, w = !1, R = void 0; try { for (var I, k = n[Symbol.iterator](); !(A = (I = k.next()).done); A = !0){ var O = I.value; a += "".concat(O.trim(), "\r\n") } } catch (e) { w = !0, R = e } finally { try { A || null == k.return || k.return() } finally { if (w) throw R } } switch (this.method) { case d.INVITE: this.ua.configuration.session_timers && o.push("timer"), (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) && o.push("gruu"), o.push("ice", "replaces"); break; case d.UPDATE: this.ua.configuration.session_timers && o.push("timer"), r && o.push("ice"), o.push("replaces") }if (o.push("outbound"), this.method === d.OPTIONS ? (a += "Allow: ".concat(d.ALLOWED_METHODS, "\r\n"), a += "Accept: ".concat(d.ACCEPTED_BODY_TYPES, "\r\n")) : 405 === e ? a += "Allow: ".concat(d.ALLOWED_METHODS, "\r\n") : 415 === e && (a += "Accept: ".concat(d.ACCEPTED_BODY_TYPES, "\r\n")), a += "Supported: ".concat(o, "\r\n"), r) { var x = f.str_utf8_length(r); a += "Content-Type: application/sdp\r\n", a += "Content-Length: ".concat(x, "\r\n\r\n"), a += r } else a += "Content-Length: ".concat(0, "\r\n\r\n"); this.server_transaction.receiveResponse(e, a, s, i) } }, { key: "reply_sl", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null, t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, n = this.getHeaders("via"); if (!e || e < 100 || e > 699) throw new TypeError("Invalid status_code: ".concat(e)); if (t && "string" != typeof t && !(t instanceof String)) throw new TypeError("Invalid reason_phrase: ".concat(t)); t = t || d.REASON_PHRASE[e] || ""; var r = "SIP/2.0 ".concat(e, " ").concat(t, "\r\n"), s = !0, i = !1, o = void 0; try { for (var l, a = n[Symbol.iterator](); !(s = (l = a.next()).done); s = !0){ var u = l.value; r += "Via: ".concat(u, "\r\n") } } catch (e) { i = !0, o = e } finally { try { s || null == a.return || a.return() } finally { if (i) throw o } } var c = this.getHeader("To"); !this.to_tag && e > 100 ? c += ";tag=".concat(f.newTag()) : this.to_tag && !this.s("to").hasParam("tag") && (c += ";tag=".concat(this.to_tag)), r += "To: ".concat(c, "\r\n"), r += "From: ".concat(this.getHeader("From"), "\r\n"), r += "Call-ID: ".concat(this.call_id, "\r\n"), r += "CSeq: ".concat(this.cseq, " ").concat(this.method, "\r\n"), r += "Content-Length: ".concat(0, "\r\n\r\n"), this.transport.send(r) } }]), t }(y), C = function (e) { function t() { var e; return a(this, t), (e = s(this, i(t).call(this))).headers = {}, e.status_code = null, e.reason_phrase = null, e } return o(t, e), t }(y); e.exports = { OutgoingRequest: g, InitialOutgoingInviteRequest: v, IncomingRequest: T, IncomingResponse: C } }, 351: (e, t, n) => { var r = n(424), s = n(790), i = n(227)("JsSIP:ERROR:Socket"); i.log = console.warn.bind(console), t.isSocket = function (e) { if (Array.isArray(e)) return !1; if (void 0 === e) return i("undefined JsSIP.Socket instance"), !1; try { if (!r.isString(e.url)) throw i("missing or invalid JsSIP.Socket url property"), new Error; if (!r.isString(e.via_transport)) throw i("missing or invalid JsSIP.Socket via_transport property"), new Error; if (-1 === s.parse(e.sip_uri, "SIP_URI")) throw i("missing or invalid JsSIP.Socket sip_uri property"), new Error } catch (e) { return !1 } try { ["connect", "disconnect", "send"].forEach((function (t) { if (!r.isFunction(e[t])) throw i("missing or invalid JsSIP.Socket method: ".concat(t)), new Error })) } catch (e) { return !1 } return !0 } }, 306: e => { var t = 500; e.exports = { T1: t, T2: 4e3, T4: 5e3, TIMER_B: 32e3, TIMER_D: 0, TIMER_F: 32e3, TIMER_H: 32e3, TIMER_I: 0, TIMER_J: 0, TIMER_K: 0, TIMER_L: 32e3, TIMER_M: 32e3, PROVISIONAL_RESPONSE_INTERVAL: 6e4 } }, 754: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function o(e, t, n) { return t && i(e.prototype, t), n && i(e, n), e } function l(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? h(e) : t } function a(e) { return a = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, a(e) } function u(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && c(e, t) } function c(e, t) { return c = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, c(e, t) } function h(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } var d = n(187).EventEmitter, f = n(965), p = n(497), _ = n(306), m = n(227)("JsSIP:NonInviteClientTransaction"), g = n(227)("JsSIP:InviteClientTransaction"), v = n(227)("JsSIP:AckClientTransaction"), y = n(227)("JsSIP:NonInviteServerTransaction"), T = n(227)("JsSIP:InviteServerTransaction"), C = { STATUS_TRYING: 1, STATUS_PROCEEDING: 2, STATUS_CALLING: 3, STATUS_ACCEPTED: 4, STATUS_COMPLETED: 5, STATUS_TERMINATED: 6, STATUS_CONFIRMED: 7, NON_INVITE_CLIENT: "nict", NON_INVITE_SERVER: "nist", INVITE_CLIENT: "ict", INVITE_SERVER: "ist" }, S = function (e) { function t(e, n, r, i) { var o; s(this, t), (o = l(this, a(t).call(this))).type = C.NON_INVITE_CLIENT, o.id = "z9hG4bK".concat(Math.floor(1e7 * Math.random())), o.ua = e, o.transport = n, o.request = r, o.eventHandlers = i; var u = "SIP/2.0/".concat(n.via_transport); return u += " ".concat(e.configuration.via_host, ";branch=").concat(o.id), o.request.setHeader("via", u), o.ua.newTransaction(h(h(o))), o } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "send", value: function () { var e = this; this.stateChanged(C.STATUS_TRYING), this.F = setTimeout((function () { e.timer_F() }), _.TIMER_F), this.transport.send(this.request) || this.onTransportError() } }, { key: "onTransportError", value: function () { m("transport error occurred, deleting transaction ".concat(this.id)), clearTimeout(this.F), clearTimeout(this.K), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this), this.eventHandlers.onTransportError() } }, { key: "timer_F", value: function () { m("Timer F expired for transaction ".concat(this.id)), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this), this.eventHandlers.onRequestTimeout() } }, { key: "timer_K", value: function () { this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "receiveResponse", value: function (e) { var t = this, n = e.status_code; if (n < 200) switch (this.state) { case C.STATUS_TRYING: case C.STATUS_PROCEEDING: this.stateChanged(C.STATUS_PROCEEDING), this.eventHandlers.onReceiveResponse(e) } else switch (this.state) { case C.STATUS_TRYING: case C.STATUS_PROCEEDING: this.stateChanged(C.STATUS_COMPLETED), clearTimeout(this.F), 408 === n ? this.eventHandlers.onRequestTimeout() : this.eventHandlers.onReceiveResponse(e), this.K = setTimeout((function () { t.timer_K() }), _.TIMER_K) } } }, { key: "C", get: function () { return C } }]), t }(d), E = function (e) { function t(e, n, r, i) { var o; s(this, t), (o = l(this, a(t).call(this))).type = C.INVITE_CLIENT, o.id = "z9hG4bK".concat(Math.floor(1e7 * Math.random())), o.ua = e, o.transport = n, o.request = r, o.eventHandlers = i, r.transaction = h(h(o)); var u = "SIP/2.0/".concat(n.via_transport); return u += " ".concat(e.configuration.via_host, ";branch=").concat(o.id), o.request.setHeader("via", u), o.ua.newTransaction(h(h(o))), o } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "send", value: function () { var e = this; this.stateChanged(C.STATUS_CALLING), this.B = setTimeout((function () { e.timer_B() }), _.TIMER_B), this.transport.send(this.request) || this.onTransportError() } }, { key: "onTransportError", value: function () { clearTimeout(this.B), clearTimeout(this.D), clearTimeout(this.M), this.state !== C.STATUS_ACCEPTED && (g("transport error occurred, deleting transaction ".concat(this.id)), this.eventHandlers.onTransportError()), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "timer_M", value: function () { g("Timer M expired for transaction ".concat(this.id)), this.state === C.STATUS_ACCEPTED && (clearTimeout(this.B), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "timer_B", value: function () { g("Timer B expired for transaction ".concat(this.id)), this.state === C.STATUS_CALLING && (this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this), this.eventHandlers.onRequestTimeout()) } }, { key: "timer_D", value: function () { g("Timer D expired for transaction ".concat(this.id)), clearTimeout(this.B), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "sendACK", value: function (e) { var t = this, n = new p.OutgoingRequest(f.ACK, this.request.ruri, this.ua, { route_set: this.request.getHeader("route"), call_id: this.request.getHeader("call-id"), cseq: this.request.cseq }); n.setHeader("from", this.request.getHeader("from")), n.setHeader("via", this.request.getHeader("via")), n.setHeader("to", e.getHeader("to")), this.D = setTimeout((function () { t.timer_D() }), _.TIMER_D), this.transport.send(n) } }, { key: "cancel", value: function (e) { if (this.state === C.STATUS_PROCEEDING) { var t = new p.OutgoingRequest(f.CANCEL, this.request.ruri, this.ua, { route_set: this.request.getHeader("route"), call_id: this.request.getHeader("call-id"), cseq: this.request.cseq }); t.setHeader("from", this.request.getHeader("from")), t.setHeader("via", this.request.getHeader("via")), t.setHeader("to", this.request.getHeader("to")), e && t.setHeader("reason", e), this.transport.send(t) } } }, { key: "receiveResponse", value: function (e) { var t = this, n = e.status_code; if (n >= 100 && n <= 199) switch (this.state) { case C.STATUS_CALLING: this.stateChanged(C.STATUS_PROCEEDING), this.eventHandlers.onReceiveResponse(e); break; case C.STATUS_PROCEEDING: this.eventHandlers.onReceiveResponse(e) } else if (n >= 200 && n <= 299) switch (this.state) { case C.STATUS_CALLING: case C.STATUS_PROCEEDING: this.stateChanged(C.STATUS_ACCEPTED), this.M = setTimeout((function () { t.timer_M() }), _.TIMER_M), this.eventHandlers.onReceiveResponse(e); break; case C.STATUS_ACCEPTED: this.eventHandlers.onReceiveResponse(e) } else if (n >= 300 && n <= 699) switch (this.state) { case C.STATUS_CALLING: case C.STATUS_PROCEEDING: this.stateChanged(C.STATUS_COMPLETED), this.sendACK(e), this.eventHandlers.onReceiveResponse(e); break; case C.STATUS_COMPLETED: this.sendACK(e) } } }, { key: "C", get: function () { return C } }]), t }(d), b = function (e) { function t(e, n, r, i) { var o; s(this, t), (o = l(this, a(t).call(this))).id = "z9hG4bK".concat(Math.floor(1e7 * Math.random())), o.transport = n, o.request = r, o.eventHandlers = i; var u = "SIP/2.0/".concat(n.via_transport); return u += " ".concat(e.configuration.via_host, ";branch=").concat(o.id), o.request.setHeader("via", u), o } return u(t, e), o(t, [{ key: "send", value: function () { this.transport.send(this.request) || this.onTransportError() } }, { key: "onTransportError", value: function () { v("transport error occurred for transaction ".concat(this.id)), this.eventHandlers.onTransportError() } }, { key: "C", get: function () { return C } }]), t }(d), A = function (e) { function t(e, n, r) { var i; return s(this, t), (i = l(this, a(t).call(this))).type = C.NON_INVITE_SERVER, i.id = r.via_branch, i.ua = e, i.transport = n, i.request = r, i.last_response = "", r.server_transaction = h(h(i)), i.state = C.STATUS_TRYING, e.newTransaction(h(h(i))), i } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "timer_J", value: function () { y("Timer J expired for transaction ".concat(this.id)), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "onTransportError", value: function () { this.transportError || (this.transportError = !0, y("transport error occurred, deleting transaction ".concat(this.id)), clearTimeout(this.J), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "receiveResponse", value: function (e, t, n, r) { var s = this; if (100 === e) switch (this.state) { case C.STATUS_TRYING: this.stateChanged(C.STATUS_PROCEEDING), this.transport.send(t) || this.onTransportError(); break; case C.STATUS_PROCEEDING: this.last_response = t, this.transport.send(t) ? n && n() : (this.onTransportError(), r && r()) } else if (e >= 200 && e <= 699) switch (this.state) { case C.STATUS_TRYING: case C.STATUS_PROCEEDING: this.stateChanged(C.STATUS_COMPLETED), this.last_response = t, this.J = setTimeout((function () { s.timer_J() }), _.TIMER_J), this.transport.send(t) ? n && n() : (this.onTransportError(), r && r()) } } }, { key: "C", get: function () { return C } }]), t }(d), w = function (e) { function t(e, n, r) { var i; return s(this, t), (i = l(this, a(t).call(this))).type = C.INVITE_SERVER, i.id = r.via_branch, i.ua = e, i.transport = n, i.request = r, i.last_response = "", r.server_transaction = h(h(i)), i.state = C.STATUS_PROCEEDING, e.newTransaction(h(h(i))), i.resendProvisionalTimer = null, r.reply(100), i } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "timer_H", value: function () { T("Timer H expired for transaction ".concat(this.id)), this.state === C.STATUS_COMPLETED && T("ACK not received, dialog will be terminated"), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "timer_I", value: function () { this.stateChanged(C.STATUS_TERMINATED) } }, { key: "timer_L", value: function () { T("Timer L expired for transaction ".concat(this.id)), this.state === C.STATUS_ACCEPTED && (this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "onTransportError", value: function () { this.transportError || (this.transportError = !0, T("transport error occurred, deleting transaction ".concat(this.id)), null !== this.resendProvisionalTimer && (clearInterval(this.resendProvisionalTimer), this.resendProvisionalTimer = null), clearTimeout(this.L), clearTimeout(this.H), clearTimeout(this.I), this.stateChanged(C.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "resend_provisional", value: function () { this.transport.send(this.last_response) || this.onTransportError() } }, { key: "receiveResponse", value: function (e, t, n, r) { var s = this; if (e >= 100 && e <= 199 && this.state === C.STATUS_PROCEEDING) this.transport.send(t) || this.onTransportError(), this.last_response = t; if (e > 100 && e <= 199 && this.state === C.STATUS_PROCEEDING) null === this.resendProvisionalTimer && (this.resendProvisionalTimer = setInterval((function () { s.resend_provisional() }), _.PROVISIONAL_RESPONSE_INTERVAL)); else if (e >= 200 && e <= 299) switch (this.state) { case C.STATUS_PROCEEDING: this.stateChanged(C.STATUS_ACCEPTED), this.last_response = t, this.L = setTimeout((function () { s.timer_L() }), _.TIMER_L), null !== this.resendProvisionalTimer && (clearInterval(this.resendProvisionalTimer), this.resendProvisionalTimer = null); case C.STATUS_ACCEPTED: this.transport.send(t) ? n && n() : (this.onTransportError(), r && r()) } else if (e >= 300 && e <= 699 && this.state === C.STATUS_PROCEEDING) null !== this.resendProvisionalTimer && (clearInterval(this.resendProvisionalTimer), this.resendProvisionalTimer = null), this.transport.send(t) ? (this.stateChanged(C.STATUS_COMPLETED), this.H = setTimeout((function () { s.timer_H() }), _.TIMER_H), n && n()) : (this.onTransportError(), r && r()) } }, { key: "C", get: function () { return C } }]), t }(d); e.exports = { C, NonInviteClientTransaction: S, InviteClientTransaction: E, AckClientTransaction: b, NonInviteServerTransaction: A, InviteServerTransaction: w, checkTransaction: function (e, t) { var n, r = e._transactions; switch (t.method) { case f.INVITE: if (n = r.ist[t.via_branch]) { if (n.state === C.STATUS_PROCEEDING) n.transport.send(n.last_response); return !0 } break; case f.ACK: if (!(n = r.ist[t.via_branch])) return !1; if (n.state === C.STATUS_ACCEPTED) return !1; if (n.state === C.STATUS_COMPLETED) return n.state = C.STATUS_CONFIRMED, n.I = setTimeout((function () { n.timer_I() }), _.TIMER_I), !0; break; case f.CANCEL: return (n = r.ist[t.via_branch]) ? (t.reply_sl(200), n.state !== C.STATUS_PROCEEDING) : (t.reply_sl(481), !0); default: if (n = r.nist[t.via_branch]) { switch (n.state) { case C.STATUS_TRYING: break; case C.STATUS_PROCEEDING: case C.STATUS_COMPLETED: n.transport.send(n.last_response) }return !0 } } } } }, 103: (e, t, n) => { function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var i = n(351), o = n(227)("JsSIP:Transport"), l = n(227)("JsSIP:ERROR:Transport"); l.log = console.warn.bind(console); var a = { STATUS_CONNECTED: 0, STATUS_CONNECTING: 1, STATUS_DISCONNECTED: 2, SOCKET_STATUS_READY: 0, SOCKET_STATUS_ERROR: 1, recovery_options: { min_interval: 2, max_interval: 30 } }; e.exports = function () { function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : a.recovery_options; if (r(this, e), o("new()"), this.status = a.STATUS_DISCONNECTED, this.socket = null, this.sockets = [], this.recovery_options = n, this.recover_attempts = 0, this.recovery_timer = null, this.close_requested = !1, void 0 === t) throw new TypeError("Invalid argument. undefined 'sockets' argument"); t instanceof Array || (t = [t]), t.forEach((function (e) { if (!i.isSocket(e.socket)) throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance"); if (e.weight && !Number(e.weight)) throw new TypeError("Invalid argument. 'weight' attribute is not a number"); this.sockets.push({ socket: e.socket, weight: e.weight || 0, status: a.SOCKET_STATUS_READY }) }), this), this._getSocket() } var t, n, u; return t = e, (n = [{ key: "connect", value: function () { o("connect()"), this.isConnected() ? o("Transport is already connected") : this.isConnecting() ? o("Transport is connecting") : (this.close_requested = !1, this.status = a.STATUS_CONNECTING, this.onconnecting({ socket: this.socket, attempts: this.recover_attempts }), this.close_requested || (this.socket.onconnect = this._onConnect.bind(this), this.socket.ondisconnect = this._onDisconnect.bind(this), this.socket.ondata = this._onData.bind(this), this.socket.connect())) } }, { key: "disconnect", value: function () { o("close()"), this.close_requested = !0, this.recover_attempts = 0, this.status = a.STATUS_DISCONNECTED, null !== this.recovery_timer && (clearTimeout(this.recovery_timer), this.recovery_timer = null), this.socket.onconnect = function () { }, this.socket.ondisconnect = function () { }, this.socket.ondata = function () { }, this.socket.disconnect(), this.ondisconnect({ socket: this.socket, error: !1 }) } }, { key: "send", value: function (e) { if (o("send()"), !this.isConnected()) return l("unable to send message, transport is not connected"), !1; var t = e.toString(); return o("sending message:\n\n".concat(t, "\n")), this.socket.send(t) } }, { key: "isConnected", value: function () { return this.status === a.STATUS_CONNECTED } }, { key: "isConnecting", value: function () { return this.status === a.STATUS_CONNECTING } }, { key: "_reconnect", value: function () { var e = this; this.recover_attempts += 1; var t = Math.floor(Math.random() * Math.pow(2, this.recover_attempts) + 1); t < this.recovery_options.min_interval ? t = this.recovery_options.min_interval : t > this.recovery_options.max_interval && (t = this.recovery_options.max_interval), o("reconnection attempt: ".concat(this.recover_attempts, ". next connection attempt in ").concat(t, " seconds")), this.recovery_timer = setTimeout((function () { e.close_requested || e.isConnected() || e.isConnecting() || (e._getSocket(), e.connect()) }), 1e3 * t) } }, { key: "_getSocket", value: function () { var e = []; if (this.sockets.forEach((function (t) { t.status !== a.SOCKET_STATUS_ERROR && (0 === e.length ? e.push(t) : t.weight > e[0].weight ? e = [t] : t.weight === e[0].weight && e.push(t)) })), 0 === e.length) return this.sockets.forEach((function (e) { e.status = a.SOCKET_STATUS_READY })), void this._getSocket(); var t = Math.floor(Math.random() * e.length); this.socket = e[t].socket } }, { key: "_onConnect", value: function () { this.recover_attempts = 0, this.status = a.STATUS_CONNECTED, null !== this.recovery_timer && (clearTimeout(this.recovery_timer), this.recovery_timer = null), this.onconnect({ socket: this }) } }, { key: "_onDisconnect", value: function (e, t, n) { this.status = a.STATUS_DISCONNECTED, this.ondisconnect({ socket: this.socket, error: e, code: t, reason: n }), this.close_requested || (this.sockets.forEach((function (e) { this.socket === e.socket && (e.status = a.SOCKET_STATUS_ERROR) }), this), this._reconnect(e)) } }, { key: "_onData", value: function (e) { if ("\r\n" !== e) { if ("string" != typeof e) { try { e = String.fromCharCode.apply(null, new Uint8Array(e)) } catch (e) { return void o("received binary message failed to be converted into string, message discarded") } o("received binary message:\n\n".concat(e, "\n")) } else o("received text message:\n\n".concat(e, "\n")); this.ondata({ transport: this, message: e }) } else o("received message with CRLF Keep Alive response") } }, { key: "via_transport", get: function () { return this.socket.via_transport } }, { key: "url", get: function () { return this.socket.url } }, { key: "sip_uri", get: function () { return this.socket.sip_uri } }]) && s(t.prototype, n), u && s(t, u), e }() }, 387: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e) { return s = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, s(e) } function i(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function o(e, t, n) { return t && i(e.prototype, t), n && i(e, n), e } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } function a(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } var u = n(187).EventEmitter, c = n(965), h = n(116), d = n(906), f = n(193), p = n(754), _ = n(103), m = n(424), g = n(63), v = n(987), y = n(790), T = n(407), C = n(497), S = n(710), E = n(830), b = n(227)("JsSIP:UA"), A = n(227)("JsSIP:ERROR:UA"); A.log = console.warn.bind(console); var w = { STATUS_INIT: 0, STATUS_READY: 1, STATUS_USER_CLOSED: 2, STATUS_NOT_READY: 3, CONFIGURATION_ERROR: 1, NETWORK_ERROR: 2 }; function R(e) { this.emit("connecting", e) } function I(e) { this._status !== w.STATUS_USER_CLOSED && (this._status = w.STATUS_READY, this._error = null, this.emit("connected", e), this._dynConfiguration.register && this._registrator.register()) } function k(e) { for (var t = ["nict", "ict", "nist", "ist"], n = 0; n < t.length; n++){ var r = t[n]; for (var s in this._transactions[r]) Object.prototype.hasOwnProperty.call(this._transactions[r], s) && this._transactions[r][s].onTransportError() } this.emit("disconnected", e), this._registrator.onTransportClosed(), this._status !== w.STATUS_USER_CLOSED && (this._status = w.STATUS_NOT_READY, this._error = w.NETWORK_ERROR) } function O(e) { var t = e.transport, n = e.message; if ((n = T.parseMessage(n, this)) && !(this._status === w.STATUS_USER_CLOSED && n instanceof C.IncomingRequest) && S(n, this, t)) if (n instanceof C.IncomingRequest) n.transport = t, this.receiveRequest(n); else if (n instanceof C.IncomingResponse) { var r; switch (n.method) { case c.INVITE: (r = this._transactions.ict[n.via_branch]) && r.receiveResponse(n); break; case c.ACK: break; default: (r = this._transactions.nict[n.via_branch]) && r.receiveResponse(n) } } } e.exports = function (e) { function t(e) { var n; if (function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), b("new() [configuration:%o]", e), (n = function (e, t) { return !t || "object" !== r(t) && "function" != typeof t ? a(e) : t }(this, s(t).call(this)))._cache = { credentials: {} }, n._configuration = Object.assign({}, E.settings), n._dynConfiguration = {}, n._dialogs = {}, n._applicants = {}, n._sessions = {}, n._transport = null, n._contact = null, n._status = w.STATUS_INIT, n._error = null, n._transactions = { nist: {}, nict: {}, ist: {}, ict: {} }, n._data = {}, n._closeTimer = null, void 0 === e) throw new TypeError("Not enough arguments"); try { n._loadConfig(e) } catch (e) { throw n._status = w.STATUS_NOT_READY, n._error = w.CONFIGURATION_ERROR, e } return n._registrator = new h(a(a(n))), n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) }(t, e), o(t, null, [{ key: "C", get: function () { return w } }]), o(t, [{ key: "start", value: function () { b("start()"), this._status === w.STATUS_INIT ? this._transport.connect() : this._status === w.STATUS_USER_CLOSED ? (b("restarting UA"), null !== this._closeTimer && (clearTimeout(this._closeTimer), this._closeTimer = null, this._transport.disconnect()), this._status = w.STATUS_INIT, this._transport.connect()) : this._status === w.STATUS_READY ? b("UA is in READY status, not restarted") : b("ERROR: connection is down, Auto-Recovery system is trying to reconnect"), this._dynConfiguration.register = this._configuration.register } }, { key: "register", value: function () { b("register()"), this._dynConfiguration.register = !0, this._registrator.register() } }, { key: "unregister", value: function (e) { b("unregister()"), this._dynConfiguration.register = !1, this._registrator.unregister(e) } }, { key: "registrator", value: function () { return this._registrator } }, { key: "isRegistered", value: function () { return this._registrator.registered } }, { key: "isConnected", value: function () { return this._transport.isConnected() } }, { key: "call", value: function (e, t) { b("call()"); var n = new d(this); return n.connect(e, t), n } }, { key: "sendMessage", value: function (e, t, n) { b("sendMessage()"); var r = new f(this); return r.send(e, t, n), r } }, { key: "terminateSessions", value: function (e) { for (var t in b("terminateSessions()"), this._sessions) this._sessions[t].isEnded() || this._sessions[t].terminate(e) } }, { key: "stop", value: function () { var e = this; if (b("stop()"), this._dynConfiguration = {}, this._status !== w.STATUS_USER_CLOSED) { this._registrator.close(); var t = Object.keys(this._sessions).length; for (var n in this._sessions) if (Object.prototype.hasOwnProperty.call(this._sessions, n)) { b("closing session ".concat(n)); try { this._sessions[n].terminate() } catch (e) { } } for (var r in this._applicants) if (Object.prototype.hasOwnProperty.call(this._applicants, r)) try { this._applicants[r].close() } catch (e) { } this._status = w.STATUS_USER_CLOSED, 0 === Object.keys(this._transactions.nict).length + Object.keys(this._transactions.nist).length + Object.keys(this._transactions.ict).length + Object.keys(this._transactions.ist).length && 0 === t ? this._transport.disconnect() : this._closeTimer = setTimeout((function () { e._closeTimer = null, e._transport.disconnect() }), 2e3) } else b("UA already closed") } }, { key: "normalizeTarget", value: function (e) { return m.normalizeTarget(e, this._configuration.hostport_params) } }, { key: "get", value: function (e) { switch (e) { case "realm": return this._configuration.realm; case "ha1": return this._configuration.ha1; default: return void A('get() | cannot get "%s" parameter in runtime', e) } } }, { key: "set", value: function (e, t) { switch (e) { case "password": this._configuration.password = String(t); break; case "realm": this._configuration.realm = String(t); break; case "ha1": this._configuration.ha1 = String(t), this._configuration.password = null; break; case "display_name": if (-1 === y.parse('"'.concat(t, '"'), "display_name")) return A('set() | wrong "display_name"'), !1; this._configuration.display_name = t; break; default: return A('set() | cannot set "%s" parameter in runtime', e), !1 }return !0 } }, { key: "newTransaction", value: function (e) { this._transactions[e.type][e.id] = e, this.emit("newTransaction", { transaction: e }) } }, { key: "destroyTransaction", value: function (e) { delete this._transactions[e.type][e.id], this.emit("transactionDestroyed", { transaction: e }) } }, { key: "newDialog", value: function (e) { this._dialogs[e.id] = e } }, { key: "destroyDialog", value: function (e) { delete this._dialogs[e.id] } }, { key: "newMessage", value: function (e, t) { this._applicants[e] = e, this.emit("newMessage", t) } }, { key: "destroyMessage", value: function (e) { delete this._applicants[e] } }, { key: "newRTCSession", value: function (e, t) { this._sessions[e.id] = e, this.emit("newRTCSession", t) } }, { key: "destroyRTCSession", value: function (e) { delete this._sessions[e.id] } }, { key: "registered", value: function (e) { this.emit("registered", e) } }, { key: "unregistered", value: function (e) { this.emit("unregistered", e) } }, { key: "registrationFailed", value: function (e) { this.emit("registrationFailed", e) } }, { key: "receiveRequest", value: function (e) { var t = e.method; if (e.ruri.user !== this._configuration.uri.user && e.ruri.user !== this._contact.uri.user) return b("Request-URI does not point to us"), void (e.method !== c.ACK && e.reply_sl(404)); if (e.ruri.scheme !== c.SIPS) { if (!p.checkTransaction(this, e)) { if (t === c.INVITE ? new p.InviteServerTransaction(this, this._transport, e) : t !== c.ACK && t !== c.CANCEL && new p.NonInviteServerTransaction(this, this._transport, e), t === c.OPTIONS) e.reply(200); else if (t === c.MESSAGE) { if (0 === this.listeners("newMessage").length) return void e.reply(405); new f(this).init_incoming(e) } else if (t === c.INVITE && !e.to_tag && 0 === this.listeners("newRTCSession").length) return void e.reply(405); var n, r; if (e.to_tag) (n = this._findDialog(e.call_id, e.from_tag, e.to_tag)) ? n.receiveRequest(e) : t === c.NOTIFY ? (r = this._findSession(e)) ? r.receiveRequest(e) : (b("received NOTIFY request for a non existent subscription"), e.reply(481, "Subscription does not exist")) : t !== c.ACK && e.reply(481); else switch (t) { case c.INVITE: if (window.RTCPeerConnection) if (e.hasHeader("replaces")) { var s = e.replaces; (n = this._findDialog(s.call_id, s.from_tag, s.to_tag)) ? (r = n.owner).isEnded() ? e.reply(603) : r.receiveRequest(e) : e.reply(481) } else (r = new d(this)).init_incoming(e); else A("INVITE received but WebRTC is not supported"), e.reply(488); break; case c.BYE: e.reply(481); break; case c.CANCEL: (r = this._findSession(e)) ? r.receiveRequest(e) : b("received CANCEL request for a non existent session"); break; case c.ACK: break; default: e.reply(405) } } } else e.reply_sl(416) } }, { key: "_findSession", value: function (e) { var t = e.call_id, n = e.from_tag, r = e.to_tag, s = t + n, i = this._sessions[s], o = t + r, l = this._sessions[o]; return i || (l || null) } }, { key: "_findDialog", value: function (e, t, n) { var r = e + t + n, s = this._dialogs[r]; return s || (r = e + n + t, (s = this._dialogs[r]) || null) } }, { key: "_loadConfig", value: function (e) { try { E.load(this._configuration, e) } catch (e) { throw e } 0 === this._configuration.display_name && (this._configuration.display_name = "0"), this._configuration.instance_id || (this._configuration.instance_id = m.newUUID()), this._configuration.jssip_id = m.createRandomToken(5); var t = this._configuration.uri.clone(); t.user = null, this._configuration.hostport_params = t.toString().replace(/^sip:/i, ""); try { this._transport = new _(this._configuration.sockets, { max_interval: this._configuration.connection_recovery_max_interval, min_interval: this._configuration.connection_recovery_min_interval }), this._transport.onconnecting = R.bind(this), this._transport.onconnect = I.bind(this), this._transport.ondisconnect = k.bind(this), this._transport.ondata = O.bind(this) } catch (e) { throw A(e), new g.ConfigurationError("sockets", this._configuration.sockets) } if (delete this._configuration.sockets, this._configuration.authorization_user || (this._configuration.authorization_user = this._configuration.uri.user), !this._configuration.registrar_server) { var n = this._configuration.uri.clone(); n.user = null, n.clearParams(), n.clearHeaders(), this._configuration.registrar_server = n } this._configuration.no_answer_timeout *= 1e3, this._configuration.contact_uri ? this._configuration.via_host = this._configuration.contact_uri.host : this._configuration.contact_uri = new v("sip", m.createRandomToken(8), this._configuration.via_host, null, { transport: "ws" }), this._contact = { pub_gruu: null, temp_gruu: null, uri: this._configuration.contact_uri, toString: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.anonymous || null, n = e.outbound || null, r = "<"; return r += t ? this.temp_gruu || "sip:anonymous@anonymous.invalid;transport=ws" : this.pub_gruu || this.uri.toString(), !n || (t ? this.temp_gruu : this.pub_gruu) || (r += ";ob"), r += ">" } }; var r = ["password", "realm", "ha1", "display_name", "register"]; for (var s in this._configuration) Object.prototype.hasOwnProperty.call(this._configuration, s) && (-1 !== r.indexOf(s) ? Object.defineProperty(this._configuration, s, { writable: !0, configurable: !1 }) : Object.defineProperty(this._configuration, s, { writable: !1, configurable: !1 })); for (var i in b("configuration parameters after validation:"), this._configuration) if (Object.prototype.hasOwnProperty.call(E.settings, i)) switch (i) { case "uri": case "registrar_server": b("- ".concat(i, ": ").concat(this._configuration[i])); break; case "password": case "ha1": b("- ".concat(i, ": NOT SHOWN")); break; default: b("- ".concat(i, ": ").concat(JSON.stringify(this._configuration[i]))) } } }, { key: "C", get: function () { return w } }, { key: "status", get: function () { return this._status } }, { key: "contact", get: function () { return this._contact } }, { key: "configuration", get: function () { return this._configuration } }, { key: "transport", get: function () { return this._transport } }]), t }(u) }, 987: (e, t, n) => { function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t, n) { return t && s(e.prototype, t), n && s(e, n), e } var o = n(965), l = n(424), a = n(790); e.exports = function () { function e(t, n, s, i) { var l = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}, a = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : {}; if (r(this, e), !s) throw new TypeError('missing or invalid "host" parameter'); for (var u in this._parameters = {}, this._headers = {}, this._scheme = t || o.SIP, this._user = n, this._host = s, this._port = i, l) Object.prototype.hasOwnProperty.call(l, u) && this.setParam(u, l[u]); for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && this.setHeader(c, a[c]) } return i(e, null, [{ key: "parse", value: function (e) { return -1 !== (e = a.parse(e, "SIP_URI")) ? e : void 0 } }]), i(e, [{ key: "setParam", value: function (e, t) { e && (this._parameters[e.toLowerCase()] = null == t ? null : t.toString()) } }, { key: "getParam", value: function (e) { if (e) return this._parameters[e.toLowerCase()] } }, { key: "hasParam", value: function (e) { if (e) return !!this._parameters.hasOwnProperty(e.toLowerCase()) } }, { key: "deleteParam", value: function (e) { if (e = e.toLowerCase(), this._parameters.hasOwnProperty(e)) { var t = this._parameters[e]; return delete this._parameters[e], t } } }, { key: "clearParams", value: function () { this._parameters = {} } }, { key: "setHeader", value: function (e, t) { this._headers[l.headerize(e)] = Array.isArray(t) ? t : [t] } }, { key: "getHeader", value: function (e) { if (e) return this._headers[l.headerize(e)] } }, { key: "hasHeader", value: function (e) { if (e) return !!this._headers.hasOwnProperty(l.headerize(e)) } }, { key: "deleteHeader", value: function (e) { if (e = l.headerize(e), this._headers.hasOwnProperty(e)) { var t = this._headers[e]; return delete this._headers[e], t } } }, { key: "clearHeaders", value: function () { this._headers = {} } }, { key: "clone", value: function () { return new e(this._scheme, this._user, this._host, this._port, JSON.parse(JSON.stringify(this._parameters)), JSON.parse(JSON.stringify(this._headers))) } }, { key: "toString", value: function () { var e = [], t = "".concat(this._scheme, ":"); for (var n in this._user && (t += "".concat(l.escapeUser(this._user), "@")), t += this._host, (this._port || 0 === this._port) && (t += ":".concat(this._port)), this._parameters) Object.prototype.hasOwnProperty.call(this._parameters, n) && (t += ";".concat(n), null !== this._parameters[n] && (t += "=".concat(this._parameters[n]))); for (var r in this._headers) if (Object.prototype.hasOwnProperty.call(this._headers, r)) { var s = !0, i = !1, o = void 0; try { for (var a, u = this._headers[r][Symbol.iterator](); !(s = (a = u.next()).done); s = !0){ var c = a.value; e.push("".concat(r, "=").concat(c)) } } catch (e) { i = !0, o = e } finally { try { s || null == u.return || u.return() } finally { if (i) throw o } } } return e.length > 0 && (t += "?".concat(e.join("&"))), t } }, { key: "toAor", value: function (e) { var t = "".concat(this._scheme, ":"); return this._user && (t += "".concat(l.escapeUser(this._user), "@")), t += this._host, e && (this._port || 0 === this._port) && (t += ":".concat(this._port)), t } }, { key: "scheme", get: function () { return this._scheme }, set: function (e) { this._scheme = e.toLowerCase() } }, { key: "user", get: function () { return this._user }, set: function (e) { this._user = e } }, { key: "host", get: function () { return this._host }, set: function (e) { this._host = e.toLowerCase() } }, { key: "port", get: function () { return this._port }, set: function (e) { this._port = 0 === e ? e : parseInt(e, 10) || null } }]), e }() }, 424: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } var s = n(965), i = n(987), o = n(790); t.str_utf8_length = function (e) { return unescape(encodeURIComponent(e)).length }; var l = t.isFunction = function (e) { return void 0 !== e && "[object Function]" === Object.prototype.toString.call(e) }; t.isString = function (e) { return void 0 !== e && "[object String]" === Object.prototype.toString.call(e) }, t.isDecimal = function (e) { return !isNaN(e) && parseFloat(e) === parseInt(e, 10) }, t.isEmpty = function (e) { return null === e || "" === e || void 0 === e || Array.isArray(e) && 0 === e.length || "number" == typeof e && isNaN(e) }, t.hasMethods = function (e) { for (var t = arguments.length, n = new Array(t > 1 ? t - 1 : 0), r = 1; r < t; r++)n[r - 1] = arguments[r]; for (var s = 0; s < n.length; s++){ var i = n[s]; if (l(e[i])) return !1 } return !0 }; var a = t.createRandomToken = function (e) { var t, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 32, r = ""; for (t = 0; t < e; t++)r += (Math.random() * n | 0).toString(n); return r }; t.newTag = function () { return a(10) }, t.newUUID = function () { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (function (e) { var t = 16 * Math.random() | 0; return ("x" === e ? t : 3 & t | 8).toString(16) })) }, t.hostType = function (e) { if (e) return -1 !== (e = o.parse(e, "host")) ? e.host_type : void 0 }; var u = t.escapeUser = function (e) { return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi, ":").replace(/%2B/gi, "+").replace(/%3F/gi, "?").replace(/%2F/gi, "/") }; t.normalizeTarget = function (e, t) { if (e) { if (e instanceof i) return e; if ("string" == typeof e) { var n, r, o, l = e.split("@"); switch (l.length) { case 1: if (!t) return; n = e, r = t; break; case 2: n = l[0], r = l[1]; break; default: n = l.slice(0, l.length - 1).join("@"), r = l[l.length - 1] }return n = n.replace(/^(sips?|tel):/i, ""), /^[-.()]*\+?[0-9\-.()]+$/.test(n) && (n = n.replace(/[-.()]/g, "")), e = "".concat(s.SIP, ":").concat(u(n), "@").concat(r), (o = i.parse(e)) ? o : void 0 } } else; }, t.headerize = function (e) { var t, n = { "Call-Id": "Call-ID", Cseq: "CSeq", "Www-Authenticate": "WWW-Authenticate" }, r = e.toLowerCase().replace(/_/g, "-").split("-"), s = "", i = r.length; for (t = 0; t < i; t++)0 !== t && (s += "-"), s += r[t].charAt(0).toUpperCase() + r[t].substring(1); return n[s] && (s = n[s]), s }, t.sipErrorCause = function (e) { for (var t in s.SIP_ERROR_CAUSES) if (-1 !== s.SIP_ERROR_CAUSES[t].indexOf(e)) return s.causes[t]; return s.causes.SIP_FAILURE_CODE }, t.getRandomTestNetIP = function () { return "192.0.2.".concat((e = 1, t = 254, Math.floor(Math.random() * (t - e + 1) + e))); var e, t }, t.calculateMD5 = function (e) { function t(e, t) { return e << t | e >>> 32 - t } function n(e, t) { var n = 2147483648 & e, r = 2147483648 & t, s = 1073741824 & e, i = 1073741824 & t, o = (1073741823 & e) + (1073741823 & t); return s & i ? 2147483648 ^ o ^ n ^ r : s | i ? 1073741824 & o ? 3221225472 ^ o ^ n ^ r : 1073741824 ^ o ^ n ^ r : o ^ n ^ r } function r(e, r, s, i, o, l, a) { return e = n(e, n(n(function (e, t, n) { return e & t | ~e & n }(r, s, i), o), a)), n(t(e, l), r) } function s(e, r, s, i, o, l, a) { return e = n(e, n(n(function (e, t, n) { return e & n | t & ~n }(r, s, i), o), a)), n(t(e, l), r) } function i(e, r, s, i, o, l, a) { return e = n(e, n(n(function (e, t, n) { return e ^ t ^ n }(r, s, i), o), a)), n(t(e, l), r) } function o(e, r, s, i, o, l, a) { return e = n(e, n(n(function (e, t, n) { return t ^ (e | ~n) }(r, s, i), o), a)), n(t(e, l), r) } function l(e) { var t, n = "", r = ""; for (t = 0; t <= 3; t++)n += (r = "0".concat((e >>> 8 * t & 255).toString(16))).substr(r.length - 2, 2); return n } var a, u, c, h, d, f, p, _, m, g; for (a = function (e) { for (var t, n = e.length, r = n + 8, s = 16 * ((r - r % 64) / 64 + 1), i = new Array(s - 1), o = 0, l = 0; l < n;)o = l % 4 * 8, i[t = (l - l % 4) / 4] = i[t] | e.charCodeAt(l) << o, l++; return o = l % 4 * 8, i[t = (l - l % 4) / 4] = i[t] | 128 << o, i[s - 2] = n << 3, i[s - 1] = n >>> 29, i }(e = function (e) { e = e.replace(/\r\n/g, "\n"); for (var t = "", n = 0; n < e.length; n++){ var r = e.charCodeAt(n); r < 128 ? t += String.fromCharCode(r) : r > 127 && r < 2048 ? (t += String.fromCharCode(r >> 6 | 192), t += String.fromCharCode(63 & r | 128)) : (t += String.fromCharCode(r >> 12 | 224), t += String.fromCharCode(r >> 6 & 63 | 128), t += String.fromCharCode(63 & r | 128)) } return t }(e)), p = 1732584193, _ = 4023233417, m = 2562383102, g = 271733878, u = 0; u < a.length; u += 16)c = p, h = _, d = m, f = g, p = r(p, _, m, g, a[u + 0], 7, 3614090360), g = r(g, p, _, m, a[u + 1], 12, 3905402710), m = r(m, g, p, _, a[u + 2], 17, 606105819), _ = r(_, m, g, p, a[u + 3], 22, 3250441966), p = r(p, _, m, g, a[u + 4], 7, 4118548399), g = r(g, p, _, m, a[u + 5], 12, 1200080426), m = r(m, g, p, _, a[u + 6], 17, 2821735955), _ = r(_, m, g, p, a[u + 7], 22, 4249261313), p = r(p, _, m, g, a[u + 8], 7, 1770035416), g = r(g, p, _, m, a[u + 9], 12, 2336552879), m = r(m, g, p, _, a[u + 10], 17, 4294925233), _ = r(_, m, g, p, a[u + 11], 22, 2304563134), p = r(p, _, m, g, a[u + 12], 7, 1804603682), g = r(g, p, _, m, a[u + 13], 12, 4254626195), m = r(m, g, p, _, a[u + 14], 17, 2792965006), p = s(p, _ = r(_, m, g, p, a[u + 15], 22, 1236535329), m, g, a[u + 1], 5, 4129170786), g = s(g, p, _, m, a[u + 6], 9, 3225465664), m = s(m, g, p, _, a[u + 11], 14, 643717713), _ = s(_, m, g, p, a[u + 0], 20, 3921069994), p = s(p, _, m, g, a[u + 5], 5, 3593408605), g = s(g, p, _, m, a[u + 10], 9, 38016083), m = s(m, g, p, _, a[u + 15], 14, 3634488961), _ = s(_, m, g, p, a[u + 4], 20, 3889429448), p = s(p, _, m, g, a[u + 9], 5, 568446438), g = s(g, p, _, m, a[u + 14], 9, 3275163606), m = s(m, g, p, _, a[u + 3], 14, 4107603335), _ = s(_, m, g, p, a[u + 8], 20, 1163531501), p = s(p, _, m, g, a[u + 13], 5, 2850285829), g = s(g, p, _, m, a[u + 2], 9, 4243563512), m = s(m, g, p, _, a[u + 7], 14, 1735328473), p = i(p, _ = s(_, m, g, p, a[u + 12], 20, 2368359562), m, g, a[u + 5], 4, 4294588738), g = i(g, p, _, m, a[u + 8], 11, 2272392833), m = i(m, g, p, _, a[u + 11], 16, 1839030562), _ = i(_, m, g, p, a[u + 14], 23, 4259657740), p = i(p, _, m, g, a[u + 1], 4, 2763975236), g = i(g, p, _, m, a[u + 4], 11, 1272893353), m = i(m, g, p, _, a[u + 7], 16, 4139469664), _ = i(_, m, g, p, a[u + 10], 23, 3200236656), p = i(p, _, m, g, a[u + 13], 4, 681279174), g = i(g, p, _, m, a[u + 0], 11, 3936430074), m = i(m, g, p, _, a[u + 3], 16, 3572445317), _ = i(_, m, g, p, a[u + 6], 23, 76029189), p = i(p, _, m, g, a[u + 9], 4, 3654602809), g = i(g, p, _, m, a[u + 12], 11, 3873151461), m = i(m, g, p, _, a[u + 15], 16, 530742520), p = o(p, _ = i(_, m, g, p, a[u + 2], 23, 3299628645), m, g, a[u + 0], 6, 4096336452), g = o(g, p, _, m, a[u + 7], 10, 1126891415), m = o(m, g, p, _, a[u + 14], 15, 2878612391), _ = o(_, m, g, p, a[u + 5], 21, 4237533241), p = o(p, _, m, g, a[u + 12], 6, 1700485571), g = o(g, p, _, m, a[u + 3], 10, 2399980690), m = o(m, g, p, _, a[u + 10], 15, 4293915773), _ = o(_, m, g, p, a[u + 1], 21, 2240044497), p = o(p, _, m, g, a[u + 8], 6, 1873313359), g = o(g, p, _, m, a[u + 15], 10, 4264355552), m = o(m, g, p, _, a[u + 6], 15, 2734768916), _ = o(_, m, g, p, a[u + 13], 21, 1309151649), p = o(p, _, m, g, a[u + 4], 6, 4149444226), g = o(g, p, _, m, a[u + 11], 10, 3174756917), m = o(m, g, p, _, a[u + 2], 15, 718787259), _ = o(_, m, g, p, a[u + 9], 21, 3951481745), p = n(p, c), _ = n(_, h), m = n(m, d), g = n(g, f); return (l(p) + l(_) + l(m) + l(g)).toLowerCase() }, t.closeMediaStream = function (e) { if (e) try { var t; if (e.getTracks) { t = e.getTracks(); var n = !0, s = !1, i = void 0; try { for (var o, l = t[Symbol.iterator](); !(n = (o = l.next()).done); n = !0){ o.value.stop() } } catch (e) { s = !0, i = e } finally { try { n || null == l.return || l.return() } finally { if (s) throw i } } } else { t = e.getAudioTracks(); var a = !0, u = !1, c = void 0; try { for (var h, d = t[Symbol.iterator](); !(a = (h = d.next()).done); a = !0){ h.value.stop() } } catch (e) { u = !0, c = e } finally { try { a || null == d.return || d.return() } finally { if (u) throw c } } t = e.getVideoTracks(); var f = !0, p = !1, _ = void 0; try { for (var m, g = t[Symbol.iterator](); !(f = (m = g.next()).done); f = !0){ m.value.stop() } } catch (e) { p = !0, _ = e } finally { try { f || null == g.return || g.return() } finally { if (p) throw _ } } } } catch (t) { "function" != typeof e.stop && "object" !== r(e.stop) || e.stop() } }, t.cloneArray = function (e) { return e && e.slice() || [] } }, 288: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++){ var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(790), i = n(227)("JsSIP:WebSocketInterface"), o = n(227)("JsSIP:ERROR:WebSocketInterface"); o.log = console.warn.bind(console), e.exports = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), i('new() [url:"%s"]', t), this._url = t, this._sip_uri = null, this._via_transport = null, this._ws = null; var n = s.parse(t, "absoluteURI"); if (-1 === n) throw o("invalid WebSocket URI: ".concat(t)), new TypeError("Invalid argument: ".concat(t)); if ("wss" !== n.scheme && "ws" !== n.scheme) throw o("invalid WebSocket URI scheme: ".concat(n.scheme)), new TypeError("Invalid argument: ".concat(t)); this._sip_uri = "sip:".concat(n.host).concat(n.port ? ":".concat(n.port) : "", ";transport=ws"), this._via_transport = n.scheme.toUpperCase() } var t, n, l; return t = e, (n = [{ key: "connect", value: function () { if (i("connect()"), this.isConnected()) i("WebSocket ".concat(this._url, " is already connected")); else if (this.isConnecting()) i("WebSocket ".concat(this._url, " is connecting")); else { this._ws && this.disconnect(), i("connecting to WebSocket ".concat(this._url)); try { this._ws = new WebSocket(this._url, "sip"), this._ws.binaryType = "arraybuffer", this._ws.onopen = this._onOpen.bind(this), this._ws.onclose = this._onClose.bind(this), this._ws.onmessage = this._onMessage.bind(this), this._ws.onerror = this._onError.bind(this) } catch (e) { this._onError(e) } } } }, { key: "disconnect", value: function () { i("disconnect()"), this._ws && (this._ws.onopen = function () { }, this._ws.onclose = function () { }, this._ws.onmessage = function () { }, this._ws.onerror = function () { }, this._ws.close(), this._ws = null) } }, { key: "send", value: function (e) { return i("send()"), this.isConnected() ? (this._ws.send(e), !0) : (o("unable to send message, WebSocket is not open"), !1) } }, { key: "isConnected", value: function () { return this._ws && this._ws.readyState === this._ws.OPEN } }, { key: "isConnecting", value: function () { return this._ws && this._ws.readyState === this._ws.CONNECTING } }, { key: "_onOpen", value: function () { i("WebSocket ".concat(this._url, " connected")), this.onconnect() } }, { key: "_onClose", value: function (e) { var t = e.wasClean, n = e.code, r = e.reason; i("WebSocket ".concat(this._url, " closed")), !1 === t && i("WebSocket abrupt disconnection"); var s = { socket: this, error: !t, code: n, reason: r }; this.ondisconnect(s) } }, { key: "_onMessage", value: function (e) { var t = e.data; i("received WebSocket message"), this.ondata(t) } }, { key: "_onError", value: function (e) { o("WebSocket ".concat(this._url, " error: ").concat(e)) } }, { key: "via_transport", get: function () { return this._via_transport }, set: function (e) { this._via_transport = e.toUpperCase() } }, { key: "sip_uri", get: function () { return this._sip_uri } }, { key: "url", get: function () { return this._url } }]) && r(t.prototype, n), l && r(t, l), e }() }, 710: (e, t, n) => { var r, s, i, o = n(965), l = n(497), a = n(424), u = n(227)("JsSIP:sanityCheck"), c = [function () { for (var e = ["from", "to", "call_id", "cseq", "via"], t = 0; t < e.length; t++){ var n = e[t]; if (!r.hasHeader(n)) return u("missing mandatory header field : ".concat(n, ", dropping the response")), !1 } }], h = [function () { if ("sip" !== r.s("to").uri.scheme) return f(416), !1 }, function () { if (!r.to_tag && r.call_id.substr(0, 5) === s.configuration.jssip_id) return f(482), !1 }, function () { var e = a.str_utf8_length(r.body), t = r.getHeader("content-length"); if (e < t) return f(400), !1 }, function () { var e, t = r.from_tag, n = r.call_id, i = r.cseq; if (r.to_tag) return; if (r.method === o.INVITE) { if (s._transactions.ist[r.via_branch]) return !1; for (var l in s._transactions.ist) if (Object.prototype.hasOwnProperty.call(s._transactions.ist, l) && (e = s._transactions.ist[l]).request.from_tag === t && e.request.call_id === n && e.request.cseq === i) return f(482), !1 } else { if (s._transactions.nist[r.via_branch]) return !1; for (var a in s._transactions.nist) if (Object.prototype.hasOwnProperty.call(s._transactions.nist, a) && (e = s._transactions.nist[a]).request.from_tag === t && e.request.call_id === n && e.request.cseq === i) return f(482), !1 } }], d = [function () { if (r.getHeaders("via").length > 1) return u("more than one Via header field present in the response, dropping the response"), !1 }, function () { var e = a.str_utf8_length(r.body), t = r.getHeader("content-length"); if (e < t) return u("message body length is lower than the value in Content-Length header field, dropping the response"), !1 }]; function f(e) { var t, n = r.getHeaders("via"), s = "SIP/2.0 ".concat(e, " ").concat(o.REASON_PHRASE[e], "\r\n"), l = !0, u = !1, c = void 0; try { for (var h, d = n[Symbol.iterator](); !(l = (h = d.next()).done); l = !0){ var f = h.value; s += "Via: ".concat(f, "\r\n") } } catch (e) { u = !0, c = e } finally { try { l || null == d.return || d.return() } finally { if (u) throw c } } t = r.getHeader("To"), r.to_tag || (t += ";tag=".concat(a.newTag())), s += "To: ".concat(t, "\r\n"), s += "From: ".concat(r.getHeader("From"), "\r\n"), s += "Call-ID: ".concat(r.call_id, "\r\n"), s += "CSeq: ".concat(r.cseq, " ").concat(r.method, "\r\n"), s += "\r\n", i.send(s) } e.exports = function (e, t, n) { r = e, s = t, i = n; for (var o = 0; o < c.length; o++){ if (!1 === (0, c[o])()) return !1 } if (r instanceof l.IncomingRequest) for (var a = 0; a < h.length; a++){ if (!1 === (0, h[a])()) return !1 } else if (r instanceof l.IncomingResponse) for (var u = 0; u < d.length; u++){ if (!1 === (0, d[u])()) return !1 } return !0 } }, 692: e => { var t = e.exports = { v: [{ name: "version", reg: /^(\d*)$/ }], o: [{ name: "origin", reg: /^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/, names: ["username", "sessionId", "sessionVersion", "netType", "ipVer", "address"], format: "%s %s %d %s IP%d %s" }], s: [{ name: "name" }], i: [{ name: "description" }], u: [{ name: "uri" }], e: [{ name: "email" }], p: [{ name: "phone" }], z: [{ name: "timezones" }], r: [{ name: "repeats" }], t: [{ name: "timing", reg: /^(\d*) (\d*)/, names: ["start", "stop"], format: "%d %d" }], c: [{ name: "connection", reg: /^IN IP(\d) (\S*)/, names: ["version", "ip"], format: "IN IP%d %s" }], b: [{ push: "bandwidth", reg: /^(TIAS|AS|CT|RR|RS):(\d*)/, names: ["type", "limit"], format: "%s:%s" }], m: [{ reg: /^(\w*) (\d*) ([\w\/]*)(?: (.*))?/, names: ["type", "port", "protocol", "payloads"], format: "%s %d %s %s" }], a: [{ push: "rtp", reg: /^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/, names: ["payload", "codec", "rate", "encoding"], format: function (e) { return e.encoding ? "rtpmap:%d %s/%s/%s" : e.rate ? "rtpmap:%d %s/%s" : "rtpmap:%d %s" } }, { push: "fmtp", reg: /^fmtp:(\d*) ([\S| ]*)/, names: ["payload", "config"], format: "fmtp:%d %s" }, { name: "control", reg: /^control:(.*)/, format: "control:%s" }, { name: "rtcp", reg: /^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/, names: ["port", "netType", "ipVer", "address"], format: function (e) { return null != e.address ? "rtcp:%d %s IP%d %s" : "rtcp:%d" } }, { push: "rtcpFbTrrInt", reg: /^rtcp-fb:(\*|\d*) trr-int (\d*)/, names: ["payload", "value"], format: "rtcp-fb:%d trr-int %d" }, { push: "rtcpFb", reg: /^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/, names: ["payload", "type", "subtype"], format: function (e) { return null != e.subtype ? "rtcp-fb:%s %s %s" : "rtcp-fb:%s %s" } }, { push: "ext", reg: /^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/, names: ["value", "direction", "uri", "config"], format: function (e) { return "extmap:%d" + (e.direction ? "/%s" : "%v") + " %s" + (e.config ? " %s" : "") } }, { push: "crypto", reg: /^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/, names: ["id", "suite", "config", "sessionConfig"], format: function (e) { return null != e.sessionConfig ? "crypto:%d %s %s %s" : "crypto:%d %s %s" } }, { name: "setup", reg: /^setup:(\w*)/, format: "setup:%s" }, { name: "mid", reg: /^mid:([^\s]*)/, format: "mid:%s" }, { name: "msid", reg: /^msid:(.*)/, format: "msid:%s" }, { name: "ptime", reg: /^ptime:(\d*)/, format: "ptime:%d" }, { name: "maxptime", reg: /^maxptime:(\d*)/, format: "maxptime:%d" }, { name: "direction", reg: /^(sendrecv|recvonly|sendonly|inactive)/ }, { name: "icelite", reg: /^(ice-lite)/ }, { name: "iceUfrag", reg: /^ice-ufrag:(\S*)/, format: "ice-ufrag:%s" }, { name: "icePwd", reg: /^ice-pwd:(\S*)/, format: "ice-pwd:%s" }, { name: "fingerprint", reg: /^fingerprint:(\S*) (\S*)/, names: ["type", "hash"], format: "fingerprint:%s %s" }, { push: "candidates", reg: /^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/, names: ["foundation", "component", "transport", "priority", "ip", "port", "type", "raddr", "rport", "tcptype", "generation", "network-id", "network-cost"], format: function (e) { var t = "candidate:%s %d %s %d %s %d typ %s"; return t += null != e.raddr ? " raddr %s rport %d" : "%v%v", t += null != e.tcptype ? " tcptype %s" : "%v", null != e.generation && (t += " generation %d"), t += null != e["network-id"] ? " network-id %d" : "%v", t += null != e["network-cost"] ? " network-cost %d" : "%v" } }, { name: "endOfCandidates", reg: /^(end-of-candidates)/ }, { name: "remoteCandidates", reg: /^remote-candidates:(.*)/, format: "remote-candidates:%s" }, { name: "iceOptions", reg: /^ice-options:(\S*)/, format: "ice-options:%s" }, { push: "ssrcs", reg: /^ssrc:(\d*) ([\w_-]*)(?::(.*))?/, names: ["id", "attribute", "value"], format: function (e) { var t = "ssrc:%d"; return null != e.attribute && (t += " %s", null != e.value && (t += ":%s")), t } }, { push: "ssrcGroups", reg: /^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/, names: ["semantics", "ssrcs"], format: "ssrc-group:%s %s" }, { name: "msidSemantic", reg: /^msid-semantic:\s?(\w*) (\S*)/, names: ["semantic", "token"], format: "msid-semantic: %s %s" }, { push: "groups", reg: /^group:(\w*) (.*)/, names: ["type", "mids"], format: "group:%s %s" }, { name: "rtcpMux", reg: /^(rtcp-mux)/ }, { name: "rtcpRsize", reg: /^(rtcp-rsize)/ }, { name: "sctpmap", reg: /^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/, names: ["sctpmapNumber", "app", "maxMessageSize"], format: function (e) { return null != e.maxMessageSize ? "sctpmap:%s %s %s" : "sctpmap:%s %s" } }, { name: "xGoogleFlag", reg: /^x-google-flag:([^\s]*)/, format: "x-google-flag:%s" }, { push: "rids", reg: /^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/, names: ["id", "direction", "params"], format: function (e) { return e.params ? "rid:%s %s %s" : "rid:%s %s" } }, { push: "imageattrs", reg: new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"), names: ["pt", "dir1", "attrs1", "dir2", "attrs2"], format: function (e) { return "imageattr:%s %s %s" + (e.dir2 ? " %s %s" : "") } }, { name: "simulcast", reg: new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"), names: ["dir1", "list1", "dir2", "list2"], format: function (e) { return "simulcast:%s %s" + (e.dir2 ? " %s %s" : "") } }, { name: "simulcast_03", reg: /^simulcast:[\s\t]+([\S+\s\t]+)$/, names: ["value"], format: "simulcast: %s" }, { name: "framerate", reg: /^framerate:(\d+(?:$|\.\d+))/, format: "framerate:%s" }, { name: "sourceFilter", reg: /^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/, names: ["filterMode", "netType", "addressTypes", "destAddress", "srcList"], format: "source-filter: %s %s %s %s %s" }, { push: "invalid", names: ["value"] }] }; Object.keys(t).forEach((function (e) { t[e].forEach((function (e) { e.reg || (e.reg = /(.*)/), e.format || (e.format = "%s") })) })) }, 766: (e, t, n) => { var r = n(962), s = n(776); t.write = s, t.parse = r.parse, t.parseFmtpConfig = r.parseFmtpConfig, t.parseParams = r.parseParams, t.parsePayloads = r.parsePayloads, t.parseRemoteCandidates = r.parseRemoteCandidates, t.parseImageAttributes = r.parseImageAttributes, t.parseSimulcastStreamList = r.parseSimulcastStreamList }, 962: (e, t, n) => { var r = function (e) { return String(Number(e)) === e ? Number(e) : e }, s = function (e, t, n) { var s = e.name && e.names; e.push && !t[e.push] ? t[e.push] = [] : s && !t[e.name] && (t[e.name] = {}); var i = e.push ? {} : s ? t[e.name] : t; !function (e, t, n, s) { if (s && !n) t[s] = r(e[1]); else for (var i = 0; i < n.length; i += 1)null != e[i + 1] && (t[n[i]] = r(e[i + 1])) }(n.match(e.reg), i, e.names, e.name), e.push && t[e.push].push(i) }, i = n(692), o = RegExp.prototype.test.bind(/^([a-z])=(.*)/); t.parse = function (e) { var t = {}, n = [], r = t; return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function (e) { var t = e[0], o = e.slice(2); "m" === t && (n.push({ rtp: [], fmtp: [] }), r = n[n.length - 1]); for (var l = 0; l < (i[t] || []).length; l += 1){ var a = i[t][l]; if (a.reg.test(o)) return s(a, r, o) } })), t.media = n, t }; var l = function (e, t) { var n = t.split(/=(.+)/, 2); return 2 === n.length ? e[n[0]] = r(n[1]) : 1 === n.length && t.length > 1 && (e[n[0]] = void 0), e }; t.parseParams = function (e) { return e.split(/\;\s?/).reduce(l, {}) }, t.parseFmtpConfig = t.parseParams, t.parsePayloads = function (e) { return e.split(" ").map(Number) }, t.parseRemoteCandidates = function (e) { for (var t = [], n = e.split(" ").map(r), s = 0; s < n.length; s += 3)t.push({ component: n[s], ip: n[s + 1], port: n[s + 2] }); return t }, t.parseImageAttributes = function (e) { return e.split(" ").map((function (e) { return e.substring(1, e.length - 1).split(",").reduce(l, {}) })) }, t.parseSimulcastStreamList = function (e) { return e.split(";").map((function (e) { return e.split(",").map((function (e) { var t, n = !1; return "~" !== e[0] ? t = r(e) : (t = r(e.substring(1, e.length)), n = !0), { scid: t, paused: n } })) })) } }, 776: (e, t, n) => { var r = n(692), s = /%[sdv%]/g, i = function (e) { var t = 1, n = arguments, r = n.length; return e.replace(s, (function (e) { if (t >= r) return e; var s = n[t]; switch (t += 1, e) { case "%%": return "%"; case "%s": return String(s); case "%d": return Number(s); case "%v": return "" } })) }, o = function (e, t, n) { var r = [e + "=" + (t.format instanceof Function ? t.format(t.push ? n : n[t.name]) : t.format)]; if (t.names) for (var s = 0; s < t.names.length; s += 1){ var o = t.names[s]; t.name ? r.push(n[t.name][o]) : r.push(n[t.names[s]]) } else r.push(n[t.name]); return i.apply(null, r) }, l = ["v", "o", "s", "i", "u", "e", "p", "c", "b", "t", "r", "z", "a"], a = ["i", "c", "b", "a"]; e.exports = function (e, t) { t = t || {}, null == e.version && (e.version = 0), null == e.name && (e.name = " "), e.media.forEach((function (e) { null == e.payloads && (e.payloads = "") })); var n = t.outerOrder || l, s = t.innerOrder || a, i = []; return n.forEach((function (t) { r[t].forEach((function (n) { n.name in e && null != e[n.name] ? i.push(o(t, n, e)) : n.push in e && null != e[n.push] && e[n.push].forEach((function (e) { i.push(o(t, n, e)) })) })) })), e.media.forEach((function (e) { i.push(o("m", r.m[0], e)), s.forEach((function (t) { r[t].forEach((function (n) { n.name in e && null != e[n.name] ? i.push(o(t, n, e)) : n.push in e && null != e[n.push] && e[n.push].forEach((function (e) { i.push(o(t, n, e)) })) })) })) })), i.join("\r\n") + "\r\n" } }, 403: e => { e.exports = JSON.parse('{"name":"jssip","title":"JsSIP","description":"the Javascript SIP library","version":"3.2.15","homepage":"http://jssip.net","author":"José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)","contributors":["Iñaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Saúl Ibarra Corretgé <saghul@gmail.com> (https://github.com/saghul)"],"main":"lib-es5/JsSIP.js","keywords":["sip","websocket","webrtc","node","browser","library"],"license":"MIT","repository":{"type":"git","url":"https://github.com/versatica/JsSIP.git"},"bugs":{"url":"https://github.com/versatica/JsSIP/issues"},"dependencies":{"debug":"^4.1.0","events":"^3.0.0","sdp-transform":"^2.4.1"},"devDependencies":{"ansi-colors":"^3.1.0","@babel/core":"^7.1.2","@babel/preset-env":"^7.1.0","browserify":"^16.2.3","eslint":"^5.6.1","fancy-log":"^1.3.2","gulp":"^4.0.0","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.0","gulp-header":"^2.0.5","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.0","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4","pegjs":"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},"scripts":{"test":"gulp test","prepublishOnly":"gulp babel"}}') } }, t = {}; function n(r) { var s = t[r]; if (void 0 !== s) return s.exports; var i = t[r] = { exports: {} }; return e[r](i, i.exports, n), i.exports } n.n = e => { var t = e && e.__esModule ? () => e.default : () => e; return n.d(t, { a: t }), t }, n.d = (e, t) => { for (var r in t) n.o(t, r) && !n.o(e, r) && Object.defineProperty(e, r, { enumerable: !0, get: t[r] }) }, n.o = (e, t) => Object.prototype.hasOwnProperty.call(e, t), n.r = e => { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }; var r = {}; (() => { n.d(r, { Z: () => Ye, C: () => Xe }); var e = {}; n.r(e), n.d(e, { Decoder: () => ve, Encoder: () => ge, PacketType: () => me, protocol: () => _e }); const t = "0.0.4", s = "SCOutgoing", i = "SCIncoming", o = "SCEnd", l = 1, a = 1, u = 2, c = { baseUrl: "https://sk1.auth.clevertap-prod.com/api/v2/", defaultBaseUrl: "https://sk1.auth.clevertap-prod.com/api/v2/", jwt: void 0, user: void 0, cc: void 0, phone: void 0, cuid: void 0, accountId: void 0, apikey: void 0, platform: void 0, name: void 0, callId: void 0, incomingcall: void 0, sna: void 0, branding: void 0, isBusy: !1, playRinger: !1, ringTime: 35e3, callsockPassword: void 0, callsockHost: void 0, hangup: !1, disconnectSip: !1, participantCount: 0, mute: !1, ringtone: void 0, recording: !1, isAnswered: !1, disconnectCallsock: !1, retries: 5, retryDelay: 5e3, record: !1, canDeclineCall: !0, disconnectSigsock: !1, isInitiator: !1, setOngoingCallEvents: !1, callVoip: !1, sipRegistered: !1, callsockReconnectAttempt: 0, isMuted: a, sigsockToken: void 0, callsockToken: void 0, sipTimer: null, reconnectionDelay: 1500, reconnectionDelayMax: 5e3, randomizationFactor: .5, notifPermission: void 0 }; class h{ constructor() { this.events = {} } subscribe(e, t) { return this.events.hasOwnProperty(e) || (this.events[e.toString()] = []), this.events[e.toString()].push(t) } publish(e, t) { return this.events.hasOwnProperty(e) ? this.events[e.toString()].map((n => n(t, e))) : [] } unsubscribe(e) { return this.events.hasOwnProperty(e) ? (this.events[e.toString()] = [], this.events) : [] } debug(e) { return this.events.hasOwnProperty(e) ? this.events[e.toString()].length : "no such event" } } const d = new class { constructor({ mutations: e, state: t }) { this.mutations = e || {}, this.events = new h; let n = this; this.state = new Proxy(t || {}, { set: function (e, t, r, s) { return r === s[t] || (e[t] = r, n.events.publish(t, r)), !0 }, get: function (e, t) { return e.hasOwnProperty(t) ? e[t] : `the ${t} does not exists` } }) } commit(e, t) { if (!this.mutations[e]) return console.log(`mutation ${e} does not exist`), !1; let n = this.mutations[e](this.state, t); return this.state = Object.assign(this.state, n), !0 } stateLogger(e) { return this.state[e] } }({ mutations: { setBaseUrl: function (e, t) { return { ...e, baseUrl: t } }, setAccountDetails: function (e, { accountId: t, apikey: n, platform: r, phone: s, cc: i, cuid: o, name: l }) { return { ...e, accountId: t, apikey: n, platform: r, phone: s, cc: i, cuid: o, name: l } }, setAuthResponse: function (e, { branding: t, jwt: n, sna: r }) { return { ...e, branding: t, jwt: n, sna: r } }, setSigSockConfiguration: function (e, { randomizationFactor: t, reconnectionDelay: n, reconnectionDelayMax: r }) { return { ...e, randomizationFactor: t, reconnectionDelay: n, reconnectionDelayMax: r } }, setIsBusy: function (e, t) { return { ...e, isBusy: t } }, setCallId: function (e, t) { return { ...e, callId: t } }, setContext: function (e, t) { return { ...e, context: t } }, setCallsockHost: function (e, t) { return { ...e, callsockHost: t } }, setIncomingCallData: function (e, t) { return { ...e, incomingcall: t } }, playRinger: function (e, t) { return { ...e, playRinger: t } }, setCallsockPassword: function (e, t) { return { ...e, callsockPassword: t } }, hangup: function (e, t) { return { ...e, hangup: t } }, disconnectSip: function (e, t) { return { ...e, disconnectSip: t } }, mute: function (e, t) { return { state: e, mute: t } }, setParticipantCount: function (e, t) { return { ...e, participantCount: t } }, setRingtone: function (e, t) { return { ...e, ringtone: t } }, setIsAnswered: function (e, t) { return { ...e, isAnswered: t } }, disconnectCallsock: function (e, t) { return { ...e, disconnectCallsock: t } }, setRetryDelay: function (e, t) { return { ...e, retryDelay: t } }, setRecord: function (e, t) { return { ...e, record: t } }, setCanDeclineCall: function (e, t) { return { ...e, canDeclineCall: t } }, disconnectSigsock: function (e, t) { return { ...e, disconnectSigsock: t } }, setIsInitiator: function (e, t) { return { ...e, isInitiator: t } }, setOngoingCallEvents: function (e, t) { return { ...e, setOngoingCallEvents: t } }, callVoip: function (e, t) { return { ...e, callVoip: t } }, setSipRegistered: function (e, t) { return { ...e, sipRegistered: t } }, setReconnectionAttempt: function (e, t) { return { ...e, callsockReconnectAttempt: t } }, setIsMuted: function (e, t) { return { ...e, isMuted: t } }, setSigsockToken: function (e, t) { return { ...e, sigsockToken: t } }, setCallsockToken: function (e, t) { return { ...e, callsockToken: t } }, setSipTimer: function (e, t) { return { ...e, sipTimer: t } }, setNotificationPermission: function (e, t) { return { ...e, notifPermission: t } } }, state: c }), f = d, p = Object.create(null); p.open = "0", p.close = "1", p.ping = "2", p.pong = "3", p.message = "4", p.upgrade = "5", p.noop = "6"; const _ = Object.create(null); Object.keys(p).forEach((e => { _[p[e]] = e })); const m = { type: "error", data: "parser error" }, g = "function" == typeof Blob || "undefined" != typeof Blob && "[object BlobConstructor]" === Object.prototype.toString.call(Blob), v = "function" == typeof ArrayBuffer, y = (e, t) => { const n = new FileReader; return n.onload = function () { const e = n.result.split(",")[1]; t("b" + e) }, n.readAsDataURL(e) }, T = ({ type: e, data: t }, n, r) => { return g && t instanceof Blob ? n ? r(t) : y(t, r) : v && (t instanceof ArrayBuffer || (s = t, "function" == typeof ArrayBuffer.isView ? ArrayBuffer.isView(s) : s && s.buffer instanceof ArrayBuffer)) ? n ? r(t) : y(new Blob([t]), r) : r(p[e] + (t || "")); var s }, C = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", S = "undefined" == typeof Uint8Array ? [] : new Uint8Array(256); for (let e = 0; e < C.length; e++)S[C.charCodeAt(e)] = e; const E = "function" == typeof ArrayBuffer, b = (e, t) => { if (E) { const n = (e => { let t, n, r, s, i, o = .75 * e.length, l = e.length, a = 0; "=" === e[e.length - 1] && (o--, "=" === e[e.length - 2] && o--); const u = new ArrayBuffer(o), c = new Uint8Array(u); for (t = 0; t < l; t += 4)n = S[e.charCodeAt(t)], r = S[e.charCodeAt(t + 1)], s = S[e.charCodeAt(t + 2)], i = S[e.charCodeAt(t + 3)], c[a++] = n << 2 | r >> 4, c[a++] = (15 & r) << 4 | s >> 2, c[a++] = (3 & s) << 6 | 63 & i; return u })(e); return A(n, t) } return { base64: !0, data: e } }, A = (e, t) => "blob" === t && e instanceof ArrayBuffer ? new Blob([e]) : e, w = (e, t) => { if ("string" != typeof e) return { type: "message", data: A(e, t) }; const n = e.charAt(0); if ("b" === n) return { type: "message", data: b(e.substring(1), t) }; return _[n] ? e.length > 1 ? { type: _[n], data: e.substring(1) } : { type: _[n] } : m }, R = String.fromCharCode(30); function I(e) { if (e) return function (e) { for (var t in I.prototype) e[t] = I.prototype[t]; return e }(e) } I.prototype.on = I.prototype.addEventListener = function (e, t) { return this._callbacks = this._callbacks || {}, (this._callbacks["$" + e] = this._callbacks["$" + e] || []).push(t), this }, I.prototype.once = function (e, t) { function n() { this.off(e, n), t.apply(this, arguments) } return n.fn = t, this.on(e, n), this }, I.prototype.off = I.prototype.removeListener = I.prototype.removeAllListeners = I.prototype.removeEventListener = function (e, t) { if (this._callbacks = this._callbacks || {}, 0 == arguments.length) return this._callbacks = {}, this; var n, r = this._callbacks["$" + e]; if (!r) return this; if (1 == arguments.length) return delete this._callbacks["$" + e], this; for (var s = 0; s < r.length; s++)if ((n = r[s]) === t || n.fn === t) { r.splice(s, 1); break } return 0 === r.length && delete this._callbacks["$" + e], this }, I.prototype.emit = function (e) { this._callbacks = this._callbacks || {}; for (var t = new Array(arguments.length - 1), n = this._callbacks["$" + e], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; if (n) { r = 0; for (var s = (n = n.slice(0)).length; r < s; ++r)n[r].apply(this, t) } return this }, I.prototype.emitReserved = I.prototype.emit, I.prototype.listeners = function (e) { return this._callbacks = this._callbacks || {}, this._callbacks["$" + e] || [] }, I.prototype.hasListeners = function (e) { return !!this.listeners(e).length }; const k = "undefined" != typeof self ? self : "undefined" != typeof window ? window : Function("return this")(); function O(e, ...t) { return t.reduce(((t, n) => (e.hasOwnProperty(n) && (t[n] = e[n]), t)), {}) } const x = setTimeout, N = clearTimeout; function D(e, t) { t.useNativeTimers ? (e.setTimeoutFn = x.bind(k), e.clearTimeoutFn = N.bind(k)) : (e.setTimeoutFn = setTimeout.bind(k), e.clearTimeoutFn = clearTimeout.bind(k)) } class P extends Error{ constructor(e, t, n) { super(e), this.description = t, this.context = n, this.type = "TransportError" } } class L extends I{ constructor(e) { super(), this.writable = !1, D(this, e), this.opts = e, this.query = e.query, this.readyState = "", this.socket = e.socket } onError(e, t, n) { return super.emitReserved("error", new P(e, t, n)), this } open() { return "closed" !== this.readyState && "" !== this.readyState || (this.readyState = "opening", this.doOpen()), this } close() { return "opening" !== this.readyState && "open" !== this.readyState || (this.doClose(), this.onClose()), this } send(e) { "open" === this.readyState && this.write(e) } onOpen() { this.readyState = "open", this.writable = !0, super.emitReserved("open") } onData(e) { const t = w(e, this.socket.binaryType); this.onPacket(t) } onPacket(e) { super.emitReserved("packet", e) } onClose(e) { this.readyState = "closed", super.emitReserved("close", e) } } const U = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""), M = {}; let q, H = 0, F = 0; function j(e) { let t = ""; do { t = U[e % 64] + t, e = Math.floor(e / 64) } while (e > 0); return t } function B() { const e = j(+new Date); return e !== q ? (H = 0, q = e) : e + "." + j(H++) } for (; F < 64; F++)M[U[F]] = F; function V(e) { let t = ""; for (let n in e) e.hasOwnProperty(n) && (t.length && (t += "&"), t += encodeURIComponent(n) + "=" + encodeURIComponent(e[n])); return t } let G = !1; try { G = "undefined" != typeof XMLHttpRequest && "withCredentials" in new XMLHttpRequest } catch (e) { } const W = G; function K(e) { const t = e.xdomain; try { if ("undefined" != typeof XMLHttpRequest && (!t || W)) return new XMLHttpRequest } catch (e) { } if (!t) try { return new (k[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP") } catch (e) { } } function $() { } const z = null != new K({ xdomain: !1 }).responseType; class J extends I{ constructor(e, t) { super(), D(this, t), this.opts = t, this.method = t.method || "GET", this.uri = e, this.async = !1 !== t.async, this.data = void 0 !== t.data ? t.data : null, this.create() } create() { const e = O(this.opts, "agent", "pfx", "key", "passphrase", "cert", "ca", "ciphers", "rejectUnauthorized", "autoUnref"); e.xdomain = !!this.opts.xd, e.xscheme = !!this.opts.xs; const t = this.xhr = new K(e); try { t.open(this.method, this.uri, this.async); try { if (this.opts.extraHeaders) { t.setDisableHeaderCheck && t.setDisableHeaderCheck(!0); for (let e in this.opts.extraHeaders) this.opts.extraHeaders.hasOwnProperty(e) && t.setRequestHeader(e, this.opts.extraHeaders[e]) } } catch (e) { } if ("POST" === this.method) try { t.setRequestHeader("Content-type", "text/plain;charset=UTF-8") } catch (e) { } try { t.setRequestHeader("Accept", "*/*") } catch (e) { } "withCredentials" in t && (t.withCredentials = this.opts.withCredentials), this.opts.requestTimeout && (t.timeout = this.opts.requestTimeout), t.onreadystatechange = () => { 4 === t.readyState && (200 === t.status || 1223 === t.status ? this.onLoad() : this.setTimeoutFn((() => { this.onError("number" == typeof t.status ? t.status : 0) }), 0)) }, t.send(this.data) } catch (e) { return void this.setTimeoutFn((() => { this.onError(e) }), 0) } "undefined" != typeof document && (this.index = J.requestsCount++, J.requests[this.index] = this) } onError(e) { this.emitReserved("error", e, this.xhr), this.cleanup(!0) } cleanup(e) { if (void 0 !== this.xhr && null !== this.xhr) { if (this.xhr.onreadystatechange = $, e) try { this.xhr.abort() } catch (e) { } "undefined" != typeof document && delete J.requests[this.index], this.xhr = null } } onLoad() { const e = this.xhr.responseText; null !== e && (this.emitReserved("data", e), this.emitReserved("success"), this.cleanup()) } abort() { this.cleanup() } } if (J.requestsCount = 0, J.requests = {}, "undefined" != typeof document) if ("function" == typeof attachEvent) attachEvent("onunload", Y); else if ("function" == typeof addEventListener) { addEventListener("onpagehide" in k ? "pagehide" : "unload", Y, !1) } function Y() { for (let e in J.requests) J.requests.hasOwnProperty(e) && J.requests[e].abort() } const X = "function" == typeof Promise && "function" == typeof Promise.resolve ? e => Promise.resolve().then(e) : (e, t) => t(e, 0), Q = k.WebSocket || k.MozWebSocket, Z = "undefined" != typeof navigator && "string" == typeof navigator.product && "reactnative" === navigator.product.toLowerCase(); const ee = { websocket: class extends L{ constructor(e) { super(e), this.supportsBinary = !e.forceBase64 } get name() { return "websocket" } doOpen() { if (!this.check()) return; const e = this.uri(), t = this.opts.protocols, n = Z ? {} : O(this.opts, "agent", "perMessageDeflate", "pfx", "key", "passphrase", "cert", "ca", "ciphers", "rejectUnauthorized", "localAddress", "protocolVersion", "origin", "maxPayload", "family", "checkServerIdentity"); this.opts.extraHeaders && (n.headers = this.opts.extraHeaders); try { this.ws = Z ? new Q(e, t, n) : t ? new Q(e, t) : new Q(e) } catch (e) { return this.emitReserved("error", e) } this.ws.binaryType = this.socket.binaryType || "arraybuffer", this.addEventListeners() } addEventListeners() { this.ws.onopen = () => { this.opts.autoUnref && this.ws._socket.unref(), this.onOpen() }, this.ws.onclose = e => this.onClose({ description: "websocket connection closed", context: e }), this.ws.onmessage = e => this.onData(e.data), this.ws.onerror = e => this.onError("websocket error", e) } write(e) { this.writable = !1; for (let t = 0; t < e.length; t++){ const n = e[t], r = t === e.length - 1; T(n, this.supportsBinary, (e => { try { this.ws.send(e) } catch (e) { } r && X((() => { this.writable = !0, this.emitReserved("drain") }), this.setTimeoutFn) })) } } doClose() { void 0 !== this.ws && (this.ws.close(), this.ws = null) } uri() { let e = this.query || {}; const t = this.opts.secure ? "wss" : "ws"; let n = ""; this.opts.port && ("wss" === t && 443 !== Number(this.opts.port) || "ws" === t && 80 !== Number(this.opts.port)) && (n = ":" + this.opts.port), this.opts.timestampRequests && (e[this.opts.timestampParam] = B()), this.supportsBinary || (e.b64 = 1); const r = V(e); return t + "://" + (-1 !== this.opts.hostname.indexOf(":") ? "[" + this.opts.hostname + "]" : this.opts.hostname) + n + this.opts.path + (r.length ? "?" + r : "") } check() { return !!Q } }, polling: class extends L{ constructor(e) { if (super(e), this.polling = !1, "undefined" != typeof location) { const t = "https:" === location.protocol; let n = location.port; n || (n = t ? "443" : "80"), this.xd = "undefined" != typeof location && e.hostname !== location.hostname || n !== e.port, this.xs = e.secure !== t } const t = e && e.forceBase64; this.supportsBinary = z && !t } get name() { return "polling" } doOpen() { this.poll() } pause(e) { this.readyState = "pausing"; const t = () => { this.readyState = "paused", e() }; if (this.polling || !this.writable) { let e = 0; this.polling && (e++, this.once("pollComplete", (function () { --e || t() }))), this.writable || (e++, this.once("drain", (function () { --e || t() }))) } else t() } poll() { this.polling = !0, this.doPoll(), this.emitReserved("poll") } onData(e) { ((e, t) => { const n = e.split(R), r = []; for (let e = 0; e < n.length; e++){ const s = w(n[e], t); if (r.push(s), "error" === s.type) break } return r })(e, this.socket.binaryType).forEach((e => { if ("opening" === this.readyState && "open" === e.type && this.onOpen(), "close" === e.type) return this.onClose({ description: "transport closed by the server" }), !1; this.onPacket(e) })), "closed" !== this.readyState && (this.polling = !1, this.emitReserved("pollComplete"), "open" === this.readyState && this.poll()) } doClose() { const e = () => { this.write([{ type: "close" }]) }; "open" === this.readyState ? e() : this.once("open", e) } write(e) { this.writable = !1, ((e, t) => { const n = e.length, r = new Array(n); let s = 0; e.forEach(((e, i) => { T(e, !1, (e => { r[i] = e, ++s === n && t(r.join(R)) })) })) })(e, (e => { this.doWrite(e, (() => { this.writable = !0, this.emitReserved("drain") })) })) } uri() { let e = this.query || {}; const t = this.opts.secure ? "https" : "http"; let n = ""; !1 !== this.opts.timestampRequests && (e[this.opts.timestampParam] = B()), this.supportsBinary || e.sid || (e.b64 = 1), this.opts.port && ("https" === t && 443 !== Number(this.opts.port) || "http" === t && 80 !== Number(this.opts.port)) && (n = ":" + this.opts.port); const r = V(e); return t + "://" + (-1 !== this.opts.hostname.indexOf(":") ? "[" + this.opts.hostname + "]" : this.opts.hostname) + n + this.opts.path + (r.length ? "?" + r : "") } request(e = {}) { return Object.assign(e, { xd: this.xd, xs: this.xs }, this.opts), new J(this.uri(), e) } doWrite(e, t) { const n = this.request({ method: "POST", data: e }); n.on("success", t), n.on("error", ((e, t) => { this.onError("xhr post error", e, t) })) } doPoll() { const e = this.request(); e.on("data", this.onData.bind(this)), e.on("error", ((e, t) => { this.onError("xhr poll error", e, t) })), this.pollXhr = e } } }, te = /^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/, ne = ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"]; function re(e) { const t = e, n = e.indexOf("["), r = e.indexOf("]"); -1 != n && -1 != r && (e = e.substring(0, n) + e.substring(n, r).replace(/:/g, ";") + e.substring(r, e.length)); let s = te.exec(e || ""), i = {}, o = 14; for (; o--;)i[ne[o]] = s[o] || ""; return -1 != n && -1 != r && (i.source = t, i.host = i.host.substring(1, i.host.length - 1).replace(/;/g, ":"), i.authority = i.authority.replace("[", "").replace("]", "").replace(/;/g, ":"), i.ipv6uri = !0), i.pathNames = function (e, t) { const n = /\/{2,9}/g, r = t.replace(n, "/").split("/"); "/" != t.substr(0, 1) && 0 !== t.length || r.splice(0, 1); "/" == t.substr(t.length - 1, 1) && r.splice(r.length - 1, 1); return r }(0, i.path), i.queryKey = function (e, t) { const n = {}; return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, (function (e, t, r) { t && (n[t] = r) })), n }(0, i.query), i } class se extends I{ constructor(e, t = {}) { super(), e && "object" == typeof e && (t = e, e = null), e ? (e = re(e), t.hostname = e.host, t.secure = "https" === e.protocol || "wss" === e.protocol, t.port = e.port, e.query && (t.query = e.query)) : t.host && (t.hostname = re(t.host).host), D(this, t), this.secure = null != t.secure ? t.secure : "undefined" != typeof location && "https:" === location.protocol, t.hostname && !t.port && (t.port = this.secure ? "443" : "80"), this.hostname = t.hostname || ("undefined" != typeof location ? location.hostname : "localhost"), this.port = t.port || ("undefined" != typeof location && location.port ? location.port : this.secure ? "443" : "80"), this.transports = t.transports || ["polling", "websocket"], this.readyState = "", this.writeBuffer = [], this.prevBufferLen = 0, this.opts = Object.assign({ path: "/engine.io", agent: !1, withCredentials: !1, upgrade: !0, timestampParam: "t", rememberUpgrade: !1, rejectUnauthorized: !0, perMessageDeflate: { threshold: 1024 }, transportOptions: {}, closeOnBeforeunload: !0 }, t), this.opts.path = this.opts.path.replace(/\/$/, "") + "/", "string" == typeof this.opts.query && (this.opts.query = function (e) { let t = {}, n = e.split("&"); for (let e = 0, r = n.length; e < r; e++){ let r = n[e].split("="); t[decodeURIComponent(r[0])] = decodeURIComponent(r[1]) } return t }(this.opts.query)), this.id = null, this.upgrades = null, this.pingInterval = null, this.pingTimeout = null, this.pingTimeoutTimer = null, "function" == typeof addEventListener && (this.opts.closeOnBeforeunload && addEventListener("beforeunload", (() => { this.transport && (this.transport.removeAllListeners(), this.transport.close()) }), !1), "localhost" !== this.hostname && (this.offlineEventListener = () => { this.onClose("transport close", { description: "network connection lost" }) }, addEventListener("offline", this.offlineEventListener, !1))), this.open() } createTransport(e) { const t = Object.assign({}, this.opts.query); t.EIO = 4, t.transport = e, this.id && (t.sid = this.id); const n = Object.assign({}, this.opts.transportOptions[e], this.opts, { query: t, socket: this, hostname: this.hostname, secure: this.secure, port: this.port }); return new ee[e](n) } open() { let e; if (this.opts.rememberUpgrade && se.priorWebsocketSuccess && -1 !== this.transports.indexOf("websocket")) e = "websocket"; else { if (0 === this.transports.length) return void this.setTimeoutFn((() => { this.emitReserved("error", "No transports available") }), 0); e = this.transports[0] } this.readyState = "opening"; try { e = this.createTransport(e) } catch (e) { return this.transports.shift(), void this.open() } e.open(), this.setTransport(e) } setTransport(e) { this.transport && this.transport.removeAllListeners(), this.transport = e, e.on("drain", this.onDrain.bind(this)).on("packet", this.onPacket.bind(this)).on("error", this.onError.bind(this)).on("close", (e => this.onClose("transport close", e))) } probe(e) { let t = this.createTransport(e), n = !1; se.priorWebsocketSuccess = !1; const r = () => { n || (t.send([{ type: "ping", data: "probe" }]), t.once("packet", (e => { if (!n) if ("pong" === e.type && "probe" === e.data) { if (this.upgrading = !0, this.emitReserved("upgrading", t), !t) return; se.priorWebsocketSuccess = "websocket" === t.name, this.transport.pause((() => { n || "closed" !== this.readyState && (u(), this.setTransport(t), t.send([{ type: "upgrade" }]), this.emitReserved("upgrade", t), t = null, this.upgrading = !1, this.flush()) })) } else { const e = new Error("probe error"); e.transport = t.name, this.emitReserved("upgradeError", e) } }))) }; function s() { n || (n = !0, u(), t.close(), t = null) } const i = e => { const n = new Error("probe error: " + e); n.transport = t.name, s(), this.emitReserved("upgradeError", n) }; function o() { i("transport closed") } function l() { i("socket closed") } function a(e) { t && e.name !== t.name && s() } const u = () => { t.removeListener("open", r), t.removeListener("error", i), t.removeListener("close", o), this.off("close", l), this.off("upgrading", a) }; t.once("open", r), t.once("error", i), t.once("close", o), this.once("close", l), this.once("upgrading", a), t.open() } onOpen() { if (this.readyState = "open", se.priorWebsocketSuccess = "websocket" === this.transport.name, this.emitReserved("open"), this.flush(), "open" === this.readyState && this.opts.upgrade && this.transport.pause) { let e = 0; const t = this.upgrades.length; for (; e < t; e++)this.probe(this.upgrades[e]) } } onPacket(e) { if ("opening" === this.readyState || "open" === this.readyState || "closing" === this.readyState) switch (this.emitReserved("packet", e), this.emitReserved("heartbeat"), e.type) { case "open": this.onHandshake(JSON.parse(e.data)); break; case "ping": this.resetPingTimeout(), this.sendPacket("pong"), this.emitReserved("ping"), this.emitReserved("pong"); break; case "error": const t = new Error("server error"); t.code = e.data, this.onError(t); break; case "message": this.emitReserved("data", e.data), this.emitReserved("message", e.data) } } onHandshake(e) { this.emitReserved("handshake", e), this.id = e.sid, this.transport.query.sid = e.sid, this.upgrades = this.filterUpgrades(e.upgrades), this.pingInterval = e.pingInterval, this.pingTimeout = e.pingTimeout, this.maxPayload = e.maxPayload, this.onOpen(), "closed" !== this.readyState && this.resetPingTimeout() } resetPingTimeout() { this.clearTimeoutFn(this.pingTimeoutTimer), this.pingTimeoutTimer = this.setTimeoutFn((() => { this.onClose("ping timeout") }), this.pingInterval + this.pingTimeout), this.opts.autoUnref && this.pingTimeoutTimer.unref() } onDrain() { this.writeBuffer.splice(0, this.prevBufferLen), this.prevBufferLen = 0, 0 === this.writeBuffer.length ? this.emitReserved("drain") : this.flush() } flush() { if ("closed" !== this.readyState && this.transport.writable && !this.upgrading && this.writeBuffer.length) { const e = this.getWritablePackets(); this.transport.send(e), this.prevBufferLen = e.length, this.emitReserved("flush") } } getWritablePackets() { if (!(this.maxPayload && "polling" === this.transport.name && this.writeBuffer.length > 1)) return this.writeBuffer; let e = 1; for (let n = 0; n < this.writeBuffer.length; n++){ const r = this.writeBuffer[n].data; if (r && (e += "string" == typeof (t = r) ? function (e) { let t = 0, n = 0; for (let r = 0, s = e.length; r < s; r++)t = e.charCodeAt(r), t < 128 ? n += 1 : t < 2048 ? n += 2 : t < 55296 || t >= 57344 ? n += 3 : (r++, n += 4); return n }(t) : Math.ceil(1.33 * (t.byteLength || t.size))), n > 0 && e > this.maxPayload) return this.writeBuffer.slice(0, n); e += 2 } var t; return this.writeBuffer } write(e, t, n) { return this.sendPacket("message", e, t, n), this } send(e, t, n) { return this.sendPacket("message", e, t, n), this } sendPacket(e, t, n, r) { if ("function" == typeof t && (r = t, t = void 0), "function" == typeof n && (r = n, n = null), "closing" === this.readyState || "closed" === this.readyState) return; (n = n || {}).compress = !1 !== n.compress; const s = { type: e, data: t, options: n }; this.emitReserved("packetCreate", s), this.writeBuffer.push(s), r && this.once("flush", r), this.flush() } close() { const e = () => { this.onClose("forced close"), this.transport.close() }, t = () => { this.off("upgrade", t), this.off("upgradeError", t), e() }, n = () => { this.once("upgrade", t), this.once("upgradeError", t) }; return "opening" !== this.readyState && "open" !== this.readyState || (this.readyState = "closing", this.writeBuffer.length ? this.once("drain", (() => { this.upgrading ? n() : e() })) : this.upgrading ? n() : e()), this } onError(e) { se.priorWebsocketSuccess = !1, this.emitReserved("error", e), this.onClose("transport error", e) } onClose(e, t) { "opening" !== this.readyState && "open" !== this.readyState && "closing" !== this.readyState || (this.clearTimeoutFn(this.pingTimeoutTimer), this.transport.removeAllListeners("close"), this.transport.close(), this.transport.removeAllListeners(), "function" == typeof removeEventListener && removeEventListener("offline", this.offlineEventListener, !1), this.readyState = "closed", this.id = null, this.emitReserved("close", e, t), this.writeBuffer = [], this.prevBufferLen = 0) } filterUpgrades(e) { const t = []; let n = 0; const r = e.length; for (; n < r; n++)~this.transports.indexOf(e[n]) && t.push(e[n]); return t } } se.protocol = 4; se.protocol; const ie = "function" == typeof ArrayBuffer, oe = Object.prototype.toString, le = "function" == typeof Blob || "undefined" != typeof Blob && "[object BlobConstructor]" === oe.call(Blob), ae = "function" == typeof File || "undefined" != typeof File && "[object FileConstructor]" === oe.call(File); function ue(e) { return ie && (e instanceof ArrayBuffer || (e => "function" == typeof ArrayBuffer.isView ? ArrayBuffer.isView(e) : e.buffer instanceof ArrayBuffer)(e)) || le && e instanceof Blob || ae && e instanceof File } function ce(e, t) { if (!e || "object" != typeof e) return !1; if (Array.isArray(e)) { for (let t = 0, n = e.length; t < n; t++)if (ce(e[t])) return !0; return !1 } if (ue(e)) return !0; if (e.toJSON && "function" == typeof e.toJSON && 1 === arguments.length) return ce(e.toJSON(), !0); for (const t in e) if (Object.prototype.hasOwnProperty.call(e, t) && ce(e[t])) return !0; return !1 } function he(e) { const t = [], n = e.data, r = e; return r.data = de(n, t), r.attachments = t.length, { packet: r, buffers: t } } function de(e, t) { if (!e) return e; if (ue(e)) { const n = { _placeholder: !0, num: t.length }; return t.push(e), n } if (Array.isArray(e)) { const n = new Array(e.length); for (let r = 0; r < e.length; r++)n[r] = de(e[r], t); return n } if ("object" == typeof e && !(e instanceof Date)) { const n = {}; for (const r in e) Object.prototype.hasOwnProperty.call(e, r) && (n[r] = de(e[r], t)); return n } return e } function fe(e, t) { return e.data = pe(e.data, t), e.attachments = void 0, e } function pe(e, t) { if (!e) return e; if (e && e._placeholder) return t[e.num]; if (Array.isArray(e)) for (let n = 0; n < e.length; n++)e[n] = pe(e[n], t); else if ("object" == typeof e) for (const n in e) Object.prototype.hasOwnProperty.call(e, n) && (e[n] = pe(e[n], t)); return e } const _e = 5; var me; !function (e) { e[e.CONNECT = 0] = "CONNECT", e[e.DISCONNECT = 1] = "DISCONNECT", e[e.EVENT = 2] = "EVENT", e[e.ACK = 3] = "ACK", e[e.CONNECT_ERROR = 4] = "CONNECT_ERROR", e[e.BINARY_EVENT = 5] = "BINARY_EVENT", e[e.BINARY_ACK = 6] = "BINARY_ACK" }(me || (me = {})); class ge{ constructor(e) { this.replacer = e } encode(e) { return e.type !== me.EVENT && e.type !== me.ACK || !ce(e) ? [this.encodeAsString(e)] : (e.type = e.type === me.EVENT ? me.BINARY_EVENT : me.BINARY_ACK, this.encodeAsBinary(e)) } encodeAsString(e) { let t = "" + e.type; return e.type !== me.BINARY_EVENT && e.type !== me.BINARY_ACK || (t += e.attachments + "-"), e.nsp && "/" !== e.nsp && (t += e.nsp + ","), null != e.id && (t += e.id), null != e.data && (t += JSON.stringify(e.data, this.replacer)), t } encodeAsBinary(e) { const t = he(e), n = this.encodeAsString(t.packet), r = t.buffers; return r.unshift(n), r } } class ve extends I{ constructor(e) { super(), this.reviver = e } add(e) { let t; if ("string" == typeof e) t = this.decodeString(e), t.type === me.BINARY_EVENT || t.type === me.BINARY_ACK ? (this.reconstructor = new ye(t), 0 === t.attachments && super.emitReserved("decoded", t)) : super.emitReserved("decoded", t); else { if (!ue(e) && !e.base64) throw new Error("Unknown type: " + e); if (!this.reconstructor) throw new Error("got binary data when not reconstructing a packet"); t = this.reconstructor.takeBinaryData(e), t && (this.reconstructor = null, super.emitReserved("decoded", t)) } } decodeString(e) { let t = 0; const n = { type: Number(e.charAt(0)) }; if (void 0 === me[n.type]) throw new Error("unknown packet type " + n.type); if (n.type === me.BINARY_EVENT || n.type === me.BINARY_ACK) { const r = t + 1; for (; "-" !== e.charAt(++t) && t != e.length;); const s = e.substring(r, t); if (s != Number(s) || "-" !== e.charAt(t)) throw new Error("Illegal attachments"); n.attachments = Number(s) } if ("/" === e.charAt(t + 1)) { const r = t + 1; for (; ++t;){ if ("," === e.charAt(t)) break; if (t === e.length) break } n.nsp = e.substring(r, t) } else n.nsp = "/"; const r = e.charAt(t + 1); if ("" !== r && Number(r) == r) { const r = t + 1; for (; ++t;){ const n = e.charAt(t); if (null == n || Number(n) != n) { --t; break } if (t === e.length) break } n.id = Number(e.substring(r, t + 1)) } if (e.charAt(++t)) { const r = this.tryParse(e.substr(t)); if (!ve.isPayloadValid(n.type, r)) throw new Error("invalid payload"); n.data = r } return n } tryParse(e) { try { return JSON.parse(e, this.reviver) } catch (e) { return !1 } } static isPayloadValid(e, t) { switch (e) { case me.CONNECT: return "object" == typeof t; case me.DISCONNECT: return void 0 === t; case me.CONNECT_ERROR: return "string" == typeof t || "object" == typeof t; case me.EVENT: case me.BINARY_EVENT: return Array.isArray(t) && t.length > 0; case me.ACK: case me.BINARY_ACK: return Array.isArray(t) } } destroy() { this.reconstructor && this.reconstructor.finishedReconstruction() } } class ye{ constructor(e) { this.packet = e, this.buffers = [], this.reconPack = e } takeBinaryData(e) { if (this.buffers.push(e), this.buffers.length === this.reconPack.attachments) { const e = fe(this.reconPack, this.buffers); return this.finishedReconstruction(), e } return null } finishedReconstruction() { this.reconPack = null, this.buffers = [] } } function Te(e, t, n) { return e.on(t, n), function () { e.off(t, n) } } const Ce = Object.freeze({ connect: 1, connect_error: 1, disconnect: 1, disconnecting: 1, newListener: 1, removeListener: 1 }); class Se extends I{ constructor(e, t, n) { super(), this.connected = !1, this.receiveBuffer = [], this.sendBuffer = [], this.ids = 0, this.acks = {}, this.flags = {}, this.io = e, this.nsp = t, n && n.auth && (this.auth = n.auth), this.io._autoConnect && this.open() } get disconnected() { return !this.connected } subEvents() { if (this.subs) return; const e = this.io; this.subs = [Te(e, "open", this.onopen.bind(this)), Te(e, "packet", this.onpacket.bind(this)), Te(e, "error", this.onerror.bind(this)), Te(e, "close", this.onclose.bind(this))] } get active() { return !!this.subs } connect() { return this.connected || (this.subEvents(), this.io._reconnecting || this.io.open(), "open" === this.io._readyState && this.onopen()), this } open() { return this.connect() } send(...e) { return e.unshift("message"), this.emit.apply(this, e), this } emit(e, ...t) { if (Ce.hasOwnProperty(e)) throw new Error('"' + e + '" is a reserved event name'); t.unshift(e); const n = { type: me.EVENT, data: t, options: {} }; if (n.options.compress = !1 !== this.flags.compress, "function" == typeof t[t.length - 1]) { const e = this.ids++, r = t.pop(); this._registerAckCallback(e, r), n.id = e } const r = this.io.engine && this.io.engine.transport && this.io.engine.transport.writable; return this.flags.volatile && (!r || !this.connected) || (this.connected ? (this.notifyOutgoingListeners(n), this.packet(n)) : this.sendBuffer.push(n)), this.flags = {}, this } _registerAckCallback(e, t) { const n = this.flags.timeout; if (void 0 === n) return void (this.acks[e] = t); const r = this.io.setTimeoutFn((() => { delete this.acks[e]; for (let t = 0; t < this.sendBuffer.length; t++)this.sendBuffer[t].id === e && this.sendBuffer.splice(t, 1); t.call(this, new Error("operation has timed out")) }), n); this.acks[e] = (...e) => { this.io.clearTimeoutFn(r), t.apply(this, [null, ...e]) } } packet(e) { e.nsp = this.nsp, this.io._packet(e) } onopen() { "function" == typeof this.auth ? this.auth((e => { this.packet({ type: me.CONNECT, data: e }) })) : this.packet({ type: me.CONNECT, data: this.auth }) } onerror(e) { this.connected || this.emitReserved("connect_error", e) } onclose(e, t) { this.connected = !1, delete this.id, this.emitReserved("disconnect", e, t) } onpacket(e) { if (e.nsp === this.nsp) switch (e.type) { case me.CONNECT: if (e.data && e.data.sid) { const t = e.data.sid; this.onconnect(t) } else this.emitReserved("connect_error", new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)")); break; case me.EVENT: case me.BINARY_EVENT: this.onevent(e); break; case me.ACK: case me.BINARY_ACK: this.onack(e); break; case me.DISCONNECT: this.ondisconnect(); break; case me.CONNECT_ERROR: this.destroy(); const t = new Error(e.data.message); t.data = e.data.data, this.emitReserved("connect_error", t) } } onevent(e) { const t = e.data || []; null != e.id && t.push(this.ack(e.id)), this.connected ? this.emitEvent(t) : this.receiveBuffer.push(Object.freeze(t)) } emitEvent(e) { if (this._anyListeners && this._anyListeners.length) { const t = this._anyListeners.slice(); for (const n of t) n.apply(this, e) } super.emit.apply(this, e) } ack(e) { const t = this; let n = !1; return function (...r) { n || (n = !0, t.packet({ type: me.ACK, id: e, data: r })) } } onack(e) { const t = this.acks[e.id]; "function" == typeof t && (t.apply(this, e.data), delete this.acks[e.id]) } onconnect(e) { this.id = e, this.connected = !0, this.emitBuffered(), this.emitReserved("connect") } emitBuffered() { this.receiveBuffer.forEach((e => this.emitEvent(e))), this.receiveBuffer = [], this.sendBuffer.forEach((e => { this.notifyOutgoingListeners(e), this.packet(e) })), this.sendBuffer = [] } ondisconnect() { this.destroy(), this.onclose("io server disconnect") } destroy() { this.subs && (this.subs.forEach((e => e())), this.subs = void 0), this.io._destroy(this) } disconnect() { return this.connected && this.packet({ type: me.DISCONNECT }), this.destroy(), this.connected && this.onclose("io client disconnect"), this } close() { return this.disconnect() } compress(e) { return this.flags.compress = e, this } get volatile() { return this.flags.volatile = !0, this } timeout(e) { return this.flags.timeout = e, this } onAny(e) { return this._anyListeners = this._anyListeners || [], this._anyListeners.push(e), this } prependAny(e) { return this._anyListeners = this._anyListeners || [], this._anyListeners.unshift(e), this } offAny(e) { if (!this._anyListeners) return this; if (e) { const t = this._anyListeners; for (let n = 0; n < t.length; n++)if (e === t[n]) return t.splice(n, 1), this } else this._anyListeners = []; return this } listenersAny() { return this._anyListeners || [] } onAnyOutgoing(e) { return this._anyOutgoingListeners = this._anyOutgoingListeners || [], this._anyOutgoingListeners.push(e), this } prependAnyOutgoing(e) { return this._anyOutgoingListeners = this._anyOutgoingListeners || [], this._anyOutgoingListeners.unshift(e), this } offAnyOutgoing(e) { if (!this._anyOutgoingListeners) return this; if (e) { const t = this._anyOutgoingListeners; for (let n = 0; n < t.length; n++)if (e === t[n]) return t.splice(n, 1), this } else this._anyOutgoingListeners = []; return this } listenersAnyOutgoing() { return this._anyOutgoingListeners || [] } notifyOutgoingListeners(e) { if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) { const t = this._anyOutgoingListeners.slice(); for (const n of t) n.apply(this, e.data) } } } function Ee(e) { e = e || {}, this.ms = e.min || 100, this.max = e.max || 1e4, this.factor = e.factor || 2, this.jitter = e.jitter > 0 && e.jitter <= 1 ? e.jitter : 0, this.attempts = 0 } Ee.prototype.duration = function () { var e = this.ms * Math.pow(this.factor, this.attempts++); if (this.jitter) { var t = Math.random(), n = Math.floor(t * this.jitter * e); e = 0 == (1 & Math.floor(10 * t)) ? e - n : e + n } return 0 | Math.min(e, this.max) }, Ee.prototype.reset = function () { this.attempts = 0 }, Ee.prototype.setMin = function (e) { this.ms = e }, Ee.prototype.setMax = function (e) { this.max = e }, Ee.prototype.setJitter = function (e) { this.jitter = e }; class be extends I{ constructor(t, n) { var r; super(), this.nsps = {}, this.subs = [], t && "object" == typeof t && (n = t, t = void 0), (n = n || {}).path = n.path || "/socket.io", this.opts = n, D(this, n), this.reconnection(!1 !== n.reconnection), this.reconnectionAttempts(n.reconnectionAttempts || 1 / 0), this.reconnectionDelay(n.reconnectionDelay || 1e3), this.reconnectionDelayMax(n.reconnectionDelayMax || 5e3), this.randomizationFactor(null !== (r = n.randomizationFactor) && void 0 !== r ? r : .5), this.backoff = new Ee({ min: this.reconnectionDelay(), max: this.reconnectionDelayMax(), jitter: this.randomizationFactor() }), this.timeout(null == n.timeout ? 2e4 : n.timeout), this._readyState = "closed", this.uri = t; const s = n.parser || e; this.encoder = new s.Encoder, this.decoder = new s.Decoder, this._autoConnect = !1 !== n.autoConnect, this._autoConnect && this.open() } reconnection(e) { return arguments.length ? (this._reconnection = !!e, this) : this._reconnection } reconnectionAttempts(e) { return void 0 === e ? this._reconnectionAttempts : (this._reconnectionAttempts = e, this) } reconnectionDelay(e) { var t; return void 0 === e ? this._reconnectionDelay : (this._reconnectionDelay = e, null === (t = this.backoff) || void 0 === t || t.setMin(e), this) } randomizationFactor(e) { var t; return void 0 === e ? this._randomizationFactor : (this._randomizationFactor = e, null === (t = this.backoff) || void 0 === t || t.setJitter(e), this) } reconnectionDelayMax(e) { var t; return void 0 === e ? this._reconnectionDelayMax : (this._reconnectionDelayMax = e, null === (t = this.backoff) || void 0 === t || t.setMax(e), this) } timeout(e) { return arguments.length ? (this._timeout = e, this) : this._timeout } maybeReconnectOnOpen() { !this._reconnecting && this._reconnection && 0 === this.backoff.attempts && this.reconnect() } open(e) { if (~this._readyState.indexOf("open")) return this; this.engine = new se(this.uri, this.opts); const t = this.engine, n = this; this._readyState = "opening", this.skipReconnect = !1; const r = Te(t, "open", (function () { n.onopen(), e && e() })), s = Te(t, "error", (t => { n.cleanup(), n._readyState = "closed", this.emitReserved("error", t), e ? e(t) : n.maybeReconnectOnOpen() })); if (!1 !== this._timeout) { const e = this._timeout; 0 === e && r(); const n = this.setTimeoutFn((() => { r(), t.close(), t.emit("error", new Error("timeout")) }), e); this.opts.autoUnref && n.unref(), this.subs.push((function () { clearTimeout(n) })) } return this.subs.push(r), this.subs.push(s), this } connect(e) { return this.open(e) } onopen() { this.cleanup(), this._readyState = "open", this.emitReserved("open"); const e = this.engine; this.subs.push(Te(e, "ping", this.onping.bind(this)), Te(e, "data", this.ondata.bind(this)), Te(e, "error", this.onerror.bind(this)), Te(e, "close", this.onclose.bind(this)), Te(this.decoder, "decoded", this.ondecoded.bind(this))) } onping() { this.emitReserved("ping") } ondata(e) { this.decoder.add(e) } ondecoded(e) { this.emitReserved("packet", e) } onerror(e) { this.emitReserved("error", e) } socket(e, t) { let n = this.nsps[e]; return n || (n = new Se(this, e, t), this.nsps[e] = n), n } _destroy(e) { const t = Object.keys(this.nsps); for (const e of t) { if (this.nsps[e].active) return } this._close() } _packet(e) { const t = this.encoder.encode(e); for (let n = 0; n < t.length; n++)this.engine.write(t[n], e.options) } cleanup() { this.subs.forEach((e => e())), this.subs.length = 0, this.decoder.destroy() } _close() { this.skipReconnect = !0, this._reconnecting = !1, this.onclose("forced close"), this.engine && this.engine.close() } disconnect() { return this._close() } onclose(e, t) { this.cleanup(), this.backoff.reset(), this._readyState = "closed", this.emitReserved("close", e, t), this._reconnection && !this.skipReconnect && this.reconnect() } reconnect() { if (this._reconnecting || this.skipReconnect) return this; const e = this; if (this.backoff.attempts >= this._reconnectionAttempts) this.backoff.reset(), this.emitReserved("reconnect_failed"), this._reconnecting = !1; else { const t = this.backoff.duration(); this._reconnecting = !0; const n = this.setTimeoutFn((() => { e.skipReconnect || (this.emitReserved("reconnect_attempt", e.backoff.attempts), e.skipReconnect || e.open((t => { t ? (e._reconnecting = !1, e.reconnect(), this.emitReserved("reconnect_error", t)) : e.onreconnect() }))) }), t); this.opts.autoUnref && n.unref(), this.subs.push((function () { clearTimeout(n) })) } } onreconnect() { const e = this.backoff.attempts; this._reconnecting = !1, this.backoff.reset(), this.emitReserved("reconnect", e) } } const Ae = {}; function we(e, t) { "object" == typeof e && (t = e, e = void 0); const n = function (e, t = "", n) { let r = e; n = n || "undefined" != typeof location && location, null == e && (e = n.protocol + "//" + n.host), "string" == typeof e && ("/" === e.charAt(0) && (e = "/" === e.charAt(1) ? n.protocol + e : n.host + e), /^(https?|wss?):\/\//.test(e) || (e = void 0 !== n ? n.protocol + "//" + e : "https://" + e), r = re(e)), r.port || (/^(http|ws)$/.test(r.protocol) ? r.port = "80" : /^(http|ws)s$/.test(r.protocol) && (r.port = "443")), r.path = r.path || "/"; const s = -1 !== r.host.indexOf(":") ? "[" + r.host + "]" : r.host; return r.id = r.protocol + "://" + s + ":" + r.port + t, r.href = r.protocol + "://" + s + (n && n.port === r.port ? "" : ":" + r.port), r }(e, (t = t || {}).path || "/socket.io"), r = n.source, s = n.id, i = n.path, o = Ae[s] && i in Ae[s].nsps; let l; return t.forceNew || t["force new connection"] || !1 === t.multiplex || o ? l = new be(r, t) : (Ae[s] || (Ae[s] = new be(r, t)), l = Ae[s]), n.query && !t.query && (t.query = n.queryKey), l.socket(n.path, t) } Object.assign(we, { Manager: be, Socket: Se, io: we, connect: we }); const Re = (e, { logo: t, bgColor: n, color: r }, s) => { let i = `<div id="sc__sdk">\n      <p id="sc__sdk--header">${e}</p>\n        <div class="sc__sdk--brand">\n          <img src="${s || (t || "")}" class="${s ? "sc__sdk--participantImage" : "sc__sdk--logo"}">\n        </div>\n      <p id="sc__sdk--timer" class="sc__hide">00:00:00</p>\n      <div id="sc__callactions"></div>\n      <audio id="audioSink" class="sc__ong--hide"></audio>\n      </div>\n      `, o = `\n  @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');\n  #sc__sdk{\n      width: 134px;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      flex-direction: column;\n      height: 308px;\n      position: fixed;\n      right: 0;\n      top: 36.38%;\n      bottom: 28.38%;\n      background: ${n};\n      color: ${r};\n      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.04), 0px 4px 8px rgba(0, 0, 0, 0.06);\n      border-radius: 4px 0px 0px 4px;\n      z-index: 999999;\n      font-family: 'Roboto', sans-serif;\n    }\n    .sc__hide {\n      display: none;\n    }\n\n    #sc__sdk--header {\n      margin: 20px 0 5px 0;\n      font-style: normal;\n      font-weight: 600;\n      font-size: 18px;\n      line-height: 24px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      color: ${r};\n    }\n\n    .sc__sdk--brand {\n      width: 88px;\n      height: 66px;\n      margin: 0 0 4px 0;\n    }\n\n    .sc__sdk--participantImage {\n      width: 60px;\n      height: 60px;\n      border-radius: 50%;\n      display: block;\n      margin: 0 auto;\n    }\n\n    .sc__sdk--logo {\n      width: 60px;\n      height: 60px;\n      display: block;\n      margin: 0 auto;\n    }\n\n    #sc__sdk--timer {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 0px 38px 12px 38px;\n      color: ${r};\n\n    }\n    \n    #sc__callactions {\n      display: inherit;\n      justify-content: inherit;\n      align-items: inherit;\n      flex-direction: inherit;\n    }\n    \n    `, l = document.getElementById("sc-sdk"); if (!l) throw new Error("Container block for calling views is missing."); let a = "callmodal_css"; if (!document.getElementById(a)) { let e = document.getElementsByTagName("head")[0], t = document.createElement("style"); t.setAttribute("id", a), t.innerHTML = o, e.appendChild(t) } l.innerHTML = i }, Ie = e => { let t = document.getElementById("sc__sdk--header"); t && (t.innerText = e) }, ke = () => { let e = document.getElementById("sc__sdk"); e && e.remove() }; var Oe = n(979), xe = n.n(Oe); class Ne{ constructor(e) { if (this.seconds = 0, this.minutes = 0, this.hours = 0, !e || "" === e) throw new Error("Please provide a valid element id"); if (this.timeElement = document.getElementById(e), !this.timeElement) throw new Error("Cannot find a valid dom node with provided element id") } startTimer() { let e = this; this.timer = window.setInterval((function () { e.timeElement.innerText = e.add() }), 1e3) } clearTimer() { try { this.timer && (window.clearInterval(this.timer), this.timer = 0), this.timeElement.innerHTML = "00:00:00" } catch (e) { throw console.error(e), e } } add() { return this.seconds++, 60 === this.seconds && (this.seconds = 0, this.minutes++, 60 === this.minutes && (this.minutes = 0, this.hours++)), `${this.formatTime(this.hours)}:${this.formatTime(this.minutes)}:${this.formatTime(this.seconds)}` } resetTimer() { this.hours = 0, this.minutes = 0, this.seconds = 0, this.clearTimer() } formatTime(e) { return e < 10 ? `0${e}` : e } } const De = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M1.79619 8.10012L1.93876 7.95771C1.94636 7.95012 1.95393 7.94255 1.96199 7.9345C2.66848 7.29757 3.55866 6.80807 4.76361 6.39382C6.84725 5.66603 9.06196 5.39375 11.258 5.59545C12.9029 5.70768 14.5144 6.10987 16.0181 6.78346C16.8443 7.12814 17.5862 7.64706 18.1932 8.3048C18.6466 8.83434 18.922 9.32035 18.8988 10.1108C18.8945 10.3517 18.8405 10.5892 18.7399 10.8083C18.6393 11.0275 18.4945 11.2235 18.3145 11.3841C18.1345 11.5446 17.9233 11.6661 17.6942 11.7411C17.4651 11.816 17.223 11.8427 16.9833 11.8195L14.1415 11.4749C13.718 11.4299 13.3266 11.2293 13.043 10.9121C12.7593 10.5949 12.6036 10.1836 12.606 9.75759L12.6075 9.0709C11.5559 8.94682 9.18117 8.73603 7.25235 9.07006C7.25411 9.30436 7.25646 9.56777 7.25916 9.78235C7.26372 10.2204 7.10207 10.6442 6.80682 10.9684C6.51157 11.2927 6.10462 11.4932 5.66799 11.5297L2.75636 11.8066C2.52292 11.8256 2.28817 11.7961 2.06692 11.7198C1.84566 11.6435 1.64273 11.5222 1.47085 11.3635C1.28972 11.2005 1.14358 11.0024 1.04115 10.7812C0.93872 10.56 0.88212 10.3204 0.874838 10.0765C0.837628 9.13161 1.21483 8.68084 1.79619 8.10012Z" fill="white"/>\n</svg>\n', Pe = ({ color: e, buttonTheme: t }) => { f.events.subscribe("sipRegistered", (e => { e ? Le() : Ue() })); let n = `\n    #sc__ong--mute {\n      cursor: pointer;\n    }\n    #sc__ong--unmute {\n      cursor: pointer;\n    }\n\n    .sc__inactive {\n      opacity: 50%;\n      cursor: wait\n    }\n    #sc__ong--mute>svg, #sc__ong--unmute>svg {\n      display: block;\n      margin: 0 auto;\n      width: 40px;\n      height: 40px;\n    }\n\n    .sc__ong--mutetext {\n      ffont-family: 'Roboto', sans-serif;\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      color: ${e = e || "#ffffff"};\n      margin: 4px auto 12px auto\n    }\n\n    .sc__ong--hangup {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      background-color: #FF453A;\n      position: relative;\n      cursor: pointer;\n      margin: 12px auto auto auto;\n    }\n\n    .sc__ong--hangup>svg {\n      position: absolute;\n      top: 11px;\n      left: 10px;\n    }\n\n    .sc__ong--hanguptext {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 4px auto 20px auto;\n      color: ${e};\n    }\n\n    .hold__text {\n      text-align: center;\n      color: ${e}\n    }\n\n    .sc__hide {\n      display: none;\n    }\n  `, r = `\n      <div id="sc__ong">\n      <p class="hold__text sc__hide">The user has put you on hold</p>\n      <div id="sc__mute_container" class="sc__inactive">\n        <div id="sc__ong--unmute" class="sc__hide">\n        ${"dark" === t ? '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M15 29.5C23.0081 29.5 29.5 23.0081 29.5 15C29.5 6.99187 23.0081 0.5 15 0.5C6.99187 0.5 0.5 6.99187 0.5 15C0.5 23.0081 6.99187 29.5 15 29.5Z" stroke="black"/>\n<path d="M10.664 15.0019C10.664 14.8502 10.6037 14.7046 10.4964 14.5973C10.3891 14.49 10.2435 14.4297 10.0918 14.4297C9.94001 14.4297 9.79445 14.49 9.68714 14.5973C9.57982 14.7046 9.51954 14.8502 9.51954 15.0019C9.51818 15.932 9.7774 16.8439 10.2678 17.6342L11.1071 16.7949C10.8157 16.2422 10.6636 15.6267 10.664 15.0019Z" fill="black"/>\n<path d="M13.9599 19.9802V21.8548H11.3999C11.2481 21.8548 11.1026 21.9151 10.9952 22.0224C10.8879 22.1298 10.8276 22.2753 10.8276 22.4271C10.8276 22.5788 10.8879 22.7244 10.9952 22.8317C11.1026 22.939 11.2481 22.9993 11.3999 22.9993H17.6645C17.8163 22.9993 17.9618 22.939 18.0692 22.8317C18.1765 22.7244 18.2368 22.5788 18.2368 22.4271C18.2368 22.2753 18.1765 22.1298 18.0692 22.0224C17.9618 21.9151 17.8163 21.8548 17.6645 21.8548H15.1043V19.9804C16.3259 19.8388 17.453 19.2536 18.2715 18.3358C19.0901 17.4181 19.5432 16.2317 19.5447 15.0019C19.5447 14.8502 19.4844 14.7046 19.3771 14.5973C19.2698 14.49 19.1242 14.4297 18.9725 14.4297C18.8207 14.4297 18.6752 14.49 18.5678 14.5973C18.4605 14.7046 18.4002 14.8502 18.4002 15.0019C18.4005 15.669 18.228 16.3248 17.8997 16.9054C17.5714 17.4861 17.0984 17.972 16.5267 18.3157C15.955 18.6594 15.3041 18.8493 14.6373 18.8669C13.9705 18.8846 13.3104 18.7293 12.7214 18.4163L11.8847 19.2529C12.5137 19.6468 13.2226 19.8953 13.9599 19.9802Z" fill="black"/>\n<path d="M12.9028 14.7977V9.75081C12.9074 9.32176 13.0811 8.91186 13.3861 8.6101C13.6912 8.30835 14.103 8.13909 14.532 8.13909C14.9611 8.13909 15.3729 8.30835 15.6779 8.6101C15.9829 8.91186 16.1566 9.32176 16.1613 9.75081V11.7409L17.3058 10.5964V9.75081C17.2997 9.01916 17.0048 8.31954 16.4853 7.80431C15.9657 7.28909 15.2637 7 14.532 7C13.8003 7 13.0983 7.28909 12.5788 7.80431C12.0593 8.31954 11.7644 9.01916 11.7583 9.75081V14.7977C11.7583 15.1806 11.8381 15.5593 11.9925 15.9096L12.9148 14.9874C12.9071 14.9244 12.9031 14.8611 12.9028 14.7977Z" fill="black"/>\n<path d="M14.7247 16.4169L13.6968 17.4448C13.9668 17.5303 14.2484 17.5737 14.5317 17.5736C15.267 17.5728 15.972 17.2803 16.4919 16.7604C17.0118 16.2404 17.3043 15.5355 17.3051 14.8002V13.8359L16.1482 14.9928C16.1046 15.3553 15.9406 15.6926 15.6825 15.9508C15.4244 16.209 15.0871 16.3731 14.7247 16.4169Z" fill="black"/>\n<path d="M20.0632 9.46094L9 20.5242" stroke="black" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>\n' : '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="15" cy="15" r="14.5" stroke="white"/>\n<path d="M10.664 15.0019C10.664 14.8502 10.6037 14.7046 10.4964 14.5973C10.3891 14.49 10.2435 14.4297 10.0918 14.4297C9.94001 14.4297 9.79445 14.49 9.68714 14.5973C9.57982 14.7046 9.51954 14.8502 9.51954 15.0019C9.51818 15.932 9.7774 16.8439 10.2678 17.6342L11.1071 16.7949C10.8157 16.2422 10.6636 15.6267 10.664 15.0019Z" fill="white"/>\n<path d="M13.9599 19.9802V21.8548H11.3999C11.2481 21.8548 11.1026 21.9151 10.9952 22.0224C10.8879 22.1298 10.8276 22.2753 10.8276 22.4271C10.8276 22.5788 10.8879 22.7244 10.9952 22.8317C11.1026 22.939 11.2481 22.9993 11.3999 22.9993H17.6645C17.8163 22.9993 17.9618 22.939 18.0692 22.8317C18.1765 22.7244 18.2368 22.5788 18.2368 22.4271C18.2368 22.2753 18.1765 22.1298 18.0692 22.0224C17.9618 21.9151 17.8163 21.8548 17.6645 21.8548H15.1043V19.9804C16.3259 19.8388 17.453 19.2536 18.2715 18.3358C19.0901 17.4181 19.5432 16.2317 19.5447 15.0019C19.5447 14.8502 19.4844 14.7046 19.3771 14.5973C19.2698 14.49 19.1242 14.4297 18.9725 14.4297C18.8207 14.4297 18.6752 14.49 18.5678 14.5973C18.4605 14.7046 18.4002 14.8502 18.4002 15.0019C18.4005 15.669 18.228 16.3248 17.8997 16.9054C17.5714 17.4861 17.0984 17.972 16.5267 18.3157C15.955 18.6594 15.3041 18.8493 14.6373 18.8669C13.9705 18.8846 13.3104 18.7293 12.7214 18.4163L11.8847 19.2529C12.5137 19.6468 13.2226 19.8953 13.9599 19.9802V19.9802Z" fill="white"/>\n<path d="M12.9028 14.7977V9.75081C12.9074 9.32176 13.0811 8.91186 13.3861 8.6101C13.6912 8.30835 14.103 8.13909 14.532 8.13909C14.9611 8.13909 15.3729 8.30835 15.6779 8.6101C15.9829 8.91186 16.1566 9.32176 16.1613 9.75081V11.7409L17.3058 10.5964V9.75081C17.2997 9.01916 17.0048 8.31954 16.4853 7.80431C15.9657 7.28909 15.2637 7 14.532 7C13.8003 7 13.0983 7.28909 12.5788 7.80431C12.0593 8.31954 11.7644 9.01916 11.7583 9.75081V14.7977C11.7583 15.1806 11.8381 15.5593 11.9925 15.9096L12.9148 14.9874C12.9071 14.9244 12.9031 14.8611 12.9028 14.7977V14.7977Z" fill="white"/>\n<path d="M14.7247 16.4169L13.6968 17.4448C13.9668 17.5303 14.2484 17.5737 14.5317 17.5736V17.5736C15.267 17.5728 15.972 17.2803 16.4919 16.7604C17.0118 16.2404 17.3043 15.5355 17.3051 14.8002V13.8359L16.1482 14.9928C16.1046 15.3553 15.9406 15.6926 15.6825 15.9508C15.4244 16.209 15.0871 16.3731 14.7247 16.4169V16.4169Z" fill="white"/>\n<path d="M20.0632 9.46094L9 20.5242" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>\n'}\n          <p class="sc__ong--mutetext">Unmute</p>\n        </div>\n        <div id="sc__ong--mute">\n          ${"dark" === t ? '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="15" cy="15" r="14.5" stroke="#121212"/>\n<path d="M11.4077 23H18.1447" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7759 23.0013V19.9531" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7765 7H14.7759C13.4685 7 12.4087 8.05982 12.4087 9.36718V14.7947C12.4087 16.102 13.4685 17.1618 14.7759 17.1618H14.7765C16.0838 17.1618 17.1437 16.102 17.1437 14.7947V9.36718C17.1437 8.05982 16.0838 7 14.7765 7Z" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M19.5512 15.0156C19.5474 16.2808 19.0431 17.4931 18.1484 18.3876C17.2538 19.2822 16.0414 19.7863 14.7762 19.7898H14.7742C13.5091 19.786 12.297 19.2819 11.4024 18.3873C10.5079 17.4928 10.0037 16.2807 10 15.0156" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>\n' : '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="15" cy="15" r="14.5" stroke="white"/>\n<path d="M11.4077 23H18.1447" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7759 23.0013V19.9531" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7765 7H14.7759C13.4685 7 12.4087 8.05982 12.4087 9.36718V14.7947C12.4087 16.102 13.4685 17.1618 14.7759 17.1618H14.7765C16.0838 17.1618 17.1437 16.102 17.1437 14.7947V9.36718C17.1437 8.05982 16.0838 7 14.7765 7Z" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M19.5512 15.0156C19.5474 16.2808 19.0431 17.4931 18.1484 18.3876C17.2538 19.2822 16.0414 19.7863 14.7762 19.7898H14.7742C13.5091 19.786 12.297 19.2819 11.4024 18.3873C10.5079 17.4928 10.0037 16.2807 10 15.0156" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>\n'}\n          <p class="sc__ong--mutetext">Mute</p>\n        </div>\n      </div>\n      <div id="sc__ong--hangup--container" class="sc__inactive">\n      <div class="sc__ong--hangup">\n        ${De}\n      </div>\n      <p class="sc__ong--hanguptext">Hang up</p>\n      \n    </div>\n    </div>\n    `, s = document.getElementById("sc__callactions"); if (!s) throw new Error("Call element is not present. Call modal cannot render."); let i = "ongoing_css"; if (!document.getElementById(i)) { let e = document.getElementsByTagName("head")[0], t = document.createElement("style"); t.setAttribute("id", i), t.innerHTML = n, e.appendChild(t) } s.innerHTML = r }, Le = () => { let e = document.getElementById("sc__mute_container"), t = document.getElementById("sc__ong--hangup--container"); e && e.classList.remove("sc__inactive"), t && t.classList.remove("sc__inactive") }, Ue = () => { let e = document.getElementById("sc__mute_container"); e && e.classList.add("sc__inactive") }, Me = function (e, t) { if (window.localStorage.getItem("ll") && window.localStorage.getItem("ll") === l + "") return "log" === t ? console.log(e) : console.count(e) }; class qe{ constructor() { this.sipSession = void 0, this.ua = void 0, this.sipSocket = void 0 } init() { if (Me("hit on jssip init", "count"), this.sipSocket) throw new Error("Instance available"); this.sipSocket = new (xe().WebSocketInterface)("wss://" + f.state.callsockHost + ":8089/ws"), xe().debug.disable("JsSIP:*"), f.events.subscribe("disconnectSip", (() => { this.disconnect() })), f.events.subscribe("mute", (e => { this.mute(e) })) } initUa() { let e; Me("hit on ua", "count"), f.state.cuid.length > 0 ? e = f.state.cuid : f.state.cc.length > 0 && f.state.phone.length > 0 && (e = f.state.cc + f.state.phone); let t = new (xe().URI)("sip", f.state.accountId + "_" + e, f.state.callsockHost); t = t.toAor(), Me(`this is ua ${this.ua}, this is callsock pwd: ${f.state.callsockPassword}`, "count"), void 0 !== this.ua ? this.ua.set("password", f.state.callsockPassword) : this.ua = new (xe().UA)({ sockets: [this.sipSocket], uri: t, password: f.state.callsockPassword, realm: f.state.callsockHost, register: !0, no_answer_timeout: 30, connection_recovery_min_interval: 3, connection_recovery_max_interval: 45 }), this.ua.start() } setupUaListners(e) { Me("hit on ua listeners", "count"), this.ua.on("registered", (() => { f.commit("setSipRegistered", !0), Me({ sipRegistered: f.state.sipRegistered }, "log") })), this.ua.on("unregistered", (e => { Me("hit on unregistered event", "count"), Me("unregistered data", { data: e }), f.commit("setSipRegistered", !1), this.sipSocket = void 0, Me({ sipRegistered: f.state.sipRegistered }, "log") })), this.ua.on("registrationFailed", (() => { this.disconnect(), f.commit("hangup", !f.state.hangup) })), this.ua.on("confirmed", (() => { })), this.ua.on("disconnected", (e => { Me("sip false on disconnected event", "count"), Me({ e }, "log"), f.commit("setSipRegistered", !1) })), this.ua.on("newRTCSession", (t => { if ("incoming" === t.session.direction) { this.sipSession = t.session, this.setupRTCSession(e); try { this.sipSession.answer({ mediaConstraints: { audio: !0, video: !1 } }) } catch (e) { console.log(e) } } })) } setupRTCSession(e) { let t; this.sipSession.on("ended", (() => { this.sipSession = void 0, f.commit("setSipRegistered", !1) })), this.sipSession.on("progress", (e => { })), this.sipSession.on("accepted", (e => { })), this.sipSession.on("failed", (e => { })), this.sipSession.on("sdp", (e => { })), this.sipSession.on("getusermediafailed", (e => { })), this.sipSession.on("createofferfailed", (e => { })), this.sipSession.on("createanswerfailed", (e => { })), this.sipSession.on("setlocaldescriptionfailed", (e => { })), this.sipSession.on("setremotedescriptionfailed", (e => { })), this.sipSession.on("confirmed", (n => { if (t = document.getElementById("audioSink"), t) try { t.pause() } catch (e) { console.log("try again") } else t = document.createElement("audio"), t.id = "audioSink", t.classList.add("sc__ong--hide"), document.getElementById("sc__sdk").appendChild(t); let r = this.sipSession.connection.getRemoteStreams()[0]; r && (t.srcObject = r), f.state.record && e.recordCall(f.state.callId).catch((e => console.error(e))), Ie("Ongoing Call"), Pe(f.state.branding), f.commit("setOngoingCallEvents", !f.state.setOngoingCallEvents), new Ne("sc__sdk--timer").startTimer(), t.play(), Le() })) } mute() { this.sipSession && (f.state.isMuted === a ? (this.sipSession.mute({ audio: !0 }), f.commit("setIsMuted", u)) : (this.sipSession.unmute({ audio: !0 }), f.commit("setIsMuted", a))) } clearSubscriptions() { f.events.unsubscribe("disconnectSip"), f.events.unsubscribe("mute") } disconnect() { void 0 !== this.sipSession && (this.sipSession.isEnded() || this.sipSession.terminate()), void 0 !== this.ua && (this.ua.unregister(), this.ua.stop()), void 0 !== this.sipSocket && this.sipSocket.disconnect(), Me(`in sip disconnect ${{ sipSocket: this.sipSocket }}`, "log"), this.clearSubscriptions() } } class He{ constructor() { this.socket = void 0, this.ready = !1, this.reconnectAttempts = 0, this.addSubscriptions() } init(e, t, n) { return new Promise(((r, s) => { try { this.socket = we(`https://${e}:3001`, t), Me("this is callsock options", "count"), Me(t, "log"), this.socket ? (Me("callsock is connected", "count"), Me(this.socket, "log"), this.initHandlers(n, r, s)) : s(new Error("failed to initialise call connection")) } catch (e) { console.log(e), s(e) } })) } addSubscriptions() { f.events.subscribe("disconnectCallsock", this.disconnect.bind(this)), f.events.subscribe("callVoip", (() => { this.callVoip() })) } disconnect() { this.clearSubscriptions(), this.socket.disconnect() } initHandlers(e, t, n) { let r = this; this.socket.on("connect", (() => { Me("hit inside callsock connect emit", "count"), r.socket.emit("authentication", e); r.socket.once("authenticated", (() => { r.connected = !0, this.reconnectAttempts > 0 && (f.state.sipRegistered ? f.commit("callVoip", !f.state.callVoip) : f.events.subscribe("sipRegistered", (e => { e && f.commit("callVoip", !f.state.callVoip), f.events.unsubscribe("sipRegistered") }))), t() })), r.socket.once("unauthorized", (e => { r.connected = !1, r.disconnect(), console.log("some error occured", e), f.commit("hangup", !f.state.hangup) })) })), this.socket.io.on("reconnect", (e => { this.reconnectAttempts = e, this.addSubscriptions(), f.commit("setReconnectionAttempt", e) })), this.socket.io.on("reconnect_attempt", (e => { })), this.socket.io.on("reconnect_error", (e => { console.log(e) })), this.socket.io.on("reconnect_failed", (e => { r.connected = !1 })), this.socket.on("disconnect", (e => { Me("on callsock disconnect", "count"), f.commit("disconnectSip", !f.state.disconnectSip), r.connected = !1, Ie("Reconnecting") })), this.socket.on("connect_error", (e => { this.clearSubscriptions() })), this.socket.on("connect_timeout", (e => { r.connected = !1 })), this.socket.on("failure", (e => { if ("call_voip" === e.type) r.voipConnected = !1 })), this.socket.on("callsockError", (e => { console.log("try again") })), this.socket.on("participant-disconnected", (e => { })), this.socket.on("endpoint_ready", (e => { r.callsockPwd = e.secret, f.commit("setCallsockPassword", e.secret), this.sip = new qe, this.sip.init(), this.sip.initUa(), this.sip.setupUaListners(this) })), this.socket.on("call_status", (e => { if (e && e.status) { let t = Object.keys(e.status); f.commit("setParticipantCount", t.length) } e.alone ? (f.commit("hangup", !f.state.hangup), f.commit("setReconnectionAttempt", 0)) : e.networkError ? Ie("Reconnecting") : e.networkRestored && Ie("Ongoing Call") })), this.socket.on("connect_timeout", (e => { f.commit("hangup", !f.state.hangup) })), this.socket.on("participant-disconnected", (e => { })) } callVoip(e) { let t; return t = e ? { confCall: e } : null, new Promise(((e, n) => { this.socket.emit("call_voip", t, (t => { t.status ? e(t) : (n(t.error), f.commit("setIsBusy", !1)) })) })) } recordCall(e) { return new Promise(((t, n) => { this.socket.emit("record_call", e, (e => { e.error && n(e.error), t(e) })) })) } clearSubscriptions() { f.events.unsubscribe("disconnectCallsock"), f.events.unsubscribe("callVoip") } } function Fe() { return new Promise(((e, t) => { let n = new He, r = { platform: "web", accountId: f.state.accountId, cuid: f.state.cuid, callId: f.state.callId, callJwt: f.state.callsockToken }; n.init(f.state.callsockHost, { reconnectionAttempts: 20, reconnectionDelay: 2e3, reconnectionDelayMax: 5e3, timeout: 3e4, autoReconnect: !0, autoConnect: !0, transports: ["websocket"] }, r).then((() => { e(n) })).catch((e => { console.log(e), t(e) })) })) } class je{ constructor({ url: e, loop: t }) { if (this.url = e, this.loop = t, this.audioElement = void 0, !e) throw new Error("Please provide a valid url") } play() { this.audioElement = document.createElement("audio"), this.audioElement.src = this.url, this.loop && (this.audioElement.loop = !0), document.body.append(this.audioElement), this.audioElement.play() } stop() { this.audioElement.pause(), this.audioElement.remove() } } const Be = function () { let e; class t{ constructor(e, t) { this.instance = void 0, this.cancelRinger = void 0, this.ring = new je({ url: e, loop: t }), f.events.subscribe("playRinger", (e => e ? this.play(f.state.ringTime) : this.stop())) } play(e) { this.ring.play(), this.cancelRinger = setTimeout((() => { this.ring.stop() }), e) } stop() { this.ring.stop(), clearTimeout(this.cancelRinger) } } return { getInstance: (n = "https://d35fo82fjcw0y8.cloudfront.net/2022/12/08223736/ringback1.mp3", r = !0) => (e || (e = new t(n, r)), e) } }(); class Ve{ constructor() { this.socket = void 0, this.incomingcall = void 0 } init(e, t, n) { return new Promise(((r, s) => { this.socket = we(`https://${e}`, t), this.socket ? this.initHandlers(n, r, s) : s(new Error("failed to initialise Signalling connection")), f.events.subscribe("disconnectSigsock", (() => this.disconnect())) })) } initHandlers(e, t, n) { let r = this; this.socket.on("connect", (() => { r.socket.emit("authentication", e, (e => { })); let s = e => { r.socket.removeListener("authenticated", s), r.connected = !1, n(e) }; r.socket.once("authenticated", ((e, n) => { r.socket.removeListener("unauthorized", s), n && n({ status: !0 }), t() })), r.socket.once("unauthorized", s) })), this.socket.on("disconnect", (() => { r.connected = !1 })), this.socket.on("connect_error", (e => { r.connected = !1, n(e) })), this.socket.on("connect_timeout", (e => { r.connected = !1, n(e) })), this.socket.on("reconnect_failed", (e => { r.connected = !1 })) } disconnect() { this.socket.connected && this.socket.disconnect() } makeCall(e) { let t = !1; return new Promise(((n, r) => { let s = setTimeout((() => { if (t) clearTimeout(s); else { r({ code: "ERR_INTERNET_LOST", message: "Internet lost at receiver's end. Please try again later" }) } }), 1e4); this.socket.emit("makecall", e, (e => { if (e) if (t = !0, clearTimeout(s), e.status) n(e.data); else if (e.error) r(e.error); else { r({ code: "ERR_USER_BUSY", message: "User busy on another call" }) } })) })) } answer(e) { return new Promise(((t, n) => { f.commit("setCanDeclineCall", !1); let r = { responseSid: f.state.incomingcall.from.id + "_" + e, callId: f.state.incomingcall.call, sid: f.state.incomingcall.sid }; f.state.callsockToken && (r.callJwt = f.state.callsockToken), this.socket.emit("answer", r, (e => { f.commit("setCanDeclineCall", !0), e.status || n(e.error), f.state.isAnswered && (Me("this is sipRegistered inside answer", "count"), Me({ sipRegistered: f.state.sipRegistered }, "log"), f.state.sipRegistered ? f.commit("callVoip", !f.state.callVoip) : f.events.subscribe("sipRegistered", (e => { e && f.commit("callVoip", !f.state.callVoip), f.events.unsubscribe("sipRegistered") }))), t() })) })) } decline(e, t, n) { let r = this, s = { callId: e }; return n || f.state.isBusy && (s.reason = "User Busy", s.reasonCode = 1001), f.state.callsockToken && (s.callJwt = t), new Promise(((e, t) => { this.socket.emit("decline", s, (n => { s = void 0, n && n.error && t(n.error), f.state.isBusy || (r.incomingcall = void 0), e(n) })) })) } miss(e) { let t = this, n = { responseSid: f.state.incomingcall.from.id + "_" + e, callId: f.state.incomingcall.call }; return f.state.callsockToken && (n.callJwt = f.state.callsockToken), new Promise(((e, r) => { this.socket.emit("miss", n, (n => { n && n.error ? r(n.error) : r(n), t.incomingcall = void 0, e(n) })) })) } cancel(e) { let t = { callId: e }; return f.state.callsockToken && (t.callJwt = f.state.callsockToken), new Promise(((e, n) => { this.socket.emit("cancel", t, (t => { t ? t.error ? n(t.error) : e(t) : n("no_response") })) })) } } function Ge() { this.sigsock.socket.on("incoming_call", ((e, t) => { if (Me("inside incoming_call", "count"), this.ctSdk.event.push(i, { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: e.call, cuid: f.state.cuid, epoch: Date.now(), context: e.context }), f.state.isBusy) { t({ status: !0 }); let n = { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: f.state.callId, cuid: f.state.cuid, epoch: Date.now(), context: f.state.context, call_status: "declined", reason: "user busy", reason_code: 1001 }; this.ctSdk.event.push(o, n), this.sigsock.decline(e.call, e.callJwt).then((() => { console.log("user busy, call decline") })).catch((e => { console.error(e) })) } else { if ("granted" === f.state.notifPermission && "visible" !== document.visibilityState) { const t = "Incoming Call", n = f.state.branding.logo || null; let r = { body: e.context }; n && (r.icon = n); let s = new Notification(t, r); s.onclick = () => { s.close(), window.parent.focus() } } let s; f.commit("setIncomingCallData", e), f.commit("mute", !1), f.commit("setIsMuted", a), this.sigsock.incomingcall = e, f.commit("setCallsockToken", e.callJwt), f.commit("setCallId", e.call), f.commit("setContext", e.context), f.commit("setCallsockHost", e.host), f.commit("playRinger", !0), f.commit("setIsBusy", !0), Fe(f.state.record).catch((e => console.log("error from callsock", e))), e.customMetadata && e.customMetadata.initiator_image && (s = e.customMetadata.initiator_image), Re("Incoming Call", f.state.branding, s || null), (({ color: e }, t) => { let n = `\n\n    #sc--call_context{\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 5px auto 10px auto;\n      color: ${e = e || "#ffffff"};\n    }\n\n    .sc__inc--decline, .sc__inc--answer {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      position: relative;\n      cursor: pointer;\n      color: ${e};\n      margin-left: 8px;\n    }\n    .sc__inc--decline {\n      background-color: #FF453A\n    }\n\n    .sc__inc--answer  {\n      background-color: #25D366\n    }\n\n\n    .sc__inc--decline>svg {\n      position: absolute;\n      top: 11px;\n      left: 10px;\n    }\n\n    .sc__inc--answer>svg {\n      position: absolute;\n      top: 13px;\n      left: 12px;\n      transform: rotate(372deg);\n    }\n\n    .sc__inc--actiontext {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 4px auto 20px auto;\n      color: ${e};\n      margin-left: 5px;\n    }\n\n    #sc__incoming--answer {\n      margin: 5px auto 10px 5px;\n    }\n    `, r = `\n  <p id="sc--call_context">${t}</p>\n  <div id="sc__inc--answer--container">\n    <div class="sc__inc--answer">\n        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M11.461 14H11.2594C11.2487 14 11.238 14 11.2266 14C10.2766 13.9513 9.30091 13.6685 8.15566 13.1101C6.16715 12.1524 4.40784 10.7799 2.99673 9.08517C1.9123 7.8433 1.05642 6.41986 0.468609 4.88061C0.12761 4.05279 -0.0305209 3.16137 0.00485979 2.26704C0.0583521 1.572 0.206944 1.03348 0.78204 0.490656C0.955286 0.323237 1.16139 0.193419 1.3874 0.10946C1.61341 0.0255007 1.85447 -0.0108262 2.09524 0.00279012C2.33602 0.0164065 2.57135 0.0796961 2.78641 0.188599C3.00147 0.297502 3.19159 0.449655 3.34477 0.635534L5.11176 2.88769C5.37957 3.21882 5.51477 3.63728 5.49128 4.06216C5.46778 4.48704 5.28721 4.88814 4.98452 5.18785L4.49811 5.67257C5.15442 6.50354 6.68556 8.33097 8.28625 9.45779C8.4506 9.29078 8.63509 9.10275 8.78483 8.94904C9.09117 8.63591 9.50507 8.45028 9.9431 8.42956C10.3811 8.40883 10.8108 8.55455 11.1454 8.83734L13.4011 10.6991C13.5797 10.8506 13.7249 11.0375 13.8275 11.2478C13.9302 11.4581 13.988 11.6873 13.9975 11.9211C14.0104 12.1644 13.9738 12.4079 13.8899 12.6367C13.8061 12.8656 13.6767 13.0752 13.5096 13.2528C12.8681 13.9477 12.2827 14 11.461 14Z" fill="white"/>\n</svg>\n\n    </div>\n    <p class="sc__inc--actiontext" id="sc__incoming--answer">Answer</p>\n  </div>\n  <div>\n  <div id="sc__inc--decline--container">\n    <div class="sc__inc--decline">\n        ${De}\n    </div>\n    <p class="sc__inc--actiontext">Decline</p>\n  </div>\n     `, s = document.getElementById("sc__callactions"); if (!s) throw new Error("Cannot find the required element for call dialog rendering"); let i = "sc--incoming__screen"; if (!document.getElementById(i)) { let e = document.createElement("style"); e.setAttribute("id", i), e.innerHTML = n, document.getElementsByTagName("head")[0].appendChild(e) } s.innerHTML = r })(f.state.branding, e.context), n = () => { this.answer() }, r = () => { this.decline() }, document.getElementById("sc__inc--answer--container").addEventListener("click", n), document.getElementById("sc__inc--decline--container").addEventListener("click", r), this.setupMissTimer(), t({ status: !0 }) } var n, r })), this.sigsock.socket.on("cancel", ((e, t) => { f.state.callId === e && (f.commit("playRinger", !1), ke(), clearTimeout(this.missTimer), t({ status: !0 }), this.isBusy = !1, f.commit("setIsBusy", !1)) })), this.sigsock.socket.on("hold-unhold", (e => { let t = "hold_unhold_css"; if (!0 === e.hold) { let e = "\n        #sc__sdk {\n          height: 365px;\n        }\n      "; if (!document.getElementById(t)) { let n = document.getElementsByTagName("head")[0], r = document.createElement("style"); r.setAttribute("id", t), r.innerHTML = e, n.appendChild(r) } document.getElementsByClassName("hold__text") && (document.getElementsByClassName("hold__text")[0].classList.remove("sc__hide"), f.commit("mute", !0)) } else if (!1 === e.hold) { let e = document.getElementById(t); e && e.remove(), this.hold = !1, document.getElementsByClassName("hold__text")[0].classList.contains("sc__hide") || (document.getElementsByClassName("hold__text")[0].classList.add("sc__hide"), f.commit("mute", !1)) } })) } const { fetch: We } = window; window.fetch = async (...e) => { let [t, n] = e, { headers: r } = n, s = c.retries; return new Promise(((e, i) => { const o = async () => We(t, n).then((async t => { if (t.ok) e(t); else { if (401 === t.status || 404 === t.status || 400 === t.status) return void i(t); r.initialRequest ? setTimeout((() => { o() }), c.retryDelay) : s > 0 ? (s -= 1, setTimeout((() => { o() }), c.retryDelay)) : i(t) } })).catch((e => { i(e) })); o() })) }; class Ke{ async get(e, t) { return t && t.authToken && (t.Authorization = window.localStorage.getItem("act"), delete t.authToken), fetch(c.baseUrl + e, { headers: t }).then((e => e.json())).catch((e => e.json())) } async post(e, t, n) { return n && n.authToken && (n.Authorization = window.localStorage.getItem("act"), delete n.authToken), fetch(c.baseUrl + e, { method: "POST", headers: n, body: JSON.stringify(t) }).then((e => e.json())).catch((e => e.json())) } } function $e(e) { let t = /^\d+$/g; return t = new RegExp(t), t.test(e) } function ze(e) { if (e.indexOf(" ") >= 0) throw new Error("cuid must not contain any white spaces"); if (e.length < 5 || e.length > 50) throw new Error("cuid should be between 5 to 50 characters"); if (t = e, !new RegExp(/^(?=.*[a-zA-Z])(?=.*[A-Za-z])[A-Za-z0-9]+(_[a-zA-Z0-9]+)*$/).test(t)) throw new Error("invalid cuid. Please refer to the documentation"); var t } function Je({ accountId: e, apikey: t, cuid: n, cc: r, phone: s, name: i }) { if (!e) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "accountId is a required parameter" } } if (!t) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "apikey is a required parameter" } } if (!n) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "cuid is a required parameter" } } if (r && !s || !r && s) { throw { code: "ERR_INVALID_INITPARAMETERS", message: "a combination of cc and phone are mandatory, instead of passing only one of the fields" } } if (n) try { ze(n) } catch (e) { throw { code: "ERR_INVALID_INITPARAMETERS", message: e.message } } if (r && s && function (e, t) { if (e = e.trim(), t = t.trim(), e.indexOf(" ") >= 0 || t.indexOf(" ") >= 0) throw { code: "ERR_INVALID_INITPARAMETERS", message: "cc and phone must not have any white spaces" }; if (e.length < 1 || e.length > 6) throw { code: "ERR_INVALID_INITPARAMETERS", message: "cc should be between 1 to 6 characters" }; if (t.length < 5 || t.length > 15) throw { code: "ERR_INVALID_INITPARAMETERS", message: "phone should be between 5 to 15 characters" }; if (!$e(e) || !$e(t)) throw { code: "ERR_INVALID_INITPARAMETERS", message: "cc and phone should be a number without special characters" } }(r, s), i && (i.trim().length < 3 || i.trim().length > 50)) { throw { code: "ERR_INVALID_INITPARAMETERS", message: "name should be between 3 to 50 characters" } } return !0 } class Ye{ constructor(e) { "Notification" in window ? Notification.requestPermission().then((e => { f.commit("setNotificationPermission", e), console.log("value got :: ", e) })) : console.log("This browser does not support notifications."), this.stateLogger = f.stateLogger.bind(f), this.ctSdk = e, this.ringer = Be.getInstance(f.state.ringtone), this.sigsock = void 0, this.callsock = void 0, this.loginSuccesful = !1, this.sipCallTimer = null, f.events.subscribe("hangup", this.hangup.bind(this)), f.events.subscribe("setOngoingCallEvents", this.renderInCall.bind(this)), f.events.subscribe("isMuted", (e => { let t = document.getElementById("sc__ong--mute"), n = document.getElementById("sc__ong--unmute"); e === u ? (t && document.getElementById("sc__ong--mute").classList.add("sc__hide"), n && document.getElementById("sc__ong--unmute").classList.remove("sc__hide")) : (n && document.getElementById("sc__ong--unmute").classList.add("sc__hide"), t && document.getElementById("sc__ong--mute").classList.remove("sc__hide")) })) } async signin(e) { f.commit("setAccountDetails", e); let n = e.accountId, r = t; try { const { guid: t, ctAccountId: s, region: i } = this.getClevertapCredentials(); e.guid = t, e.ctAccountId = s, e.accountId = n, e.sdkVersion = r; let o = i.split("."); o.splice(1, 0, "auth"), o = o.join("."), o = "https://" + o, f.commit("setBaseUrl", o), delete e.clevertap; let l = await async function ({ ...e }) { let t = new Ke, n = { ...e, platform: "web" }; n.apiKey = e.apikey, delete n.apikey; let r = window.localStorage.getItem("jwt"); r && (n.jwt = r); let s = await t.post("/auth", n); if (s && s.error) { if (400 === s.error.statusCode) throw s.error.statusCode; if (s.error.message) throw s.error.message; throw s.error } return s && s.jwt && s.jwt !== {} && window.localStorage.setItem("jwt", s.jwt), s }(e); l.response.sigSockConfiguration && f.commit("setSigSockConfiguration", l.response.sigSockConfiguration), f.commit("setAuthResponse", l.response), f.commit("setSigsockToken", l.response.jwt), this.sigsock = await new Promise(((e, t) => { let n = new Ve, r = { platform: "web", accountId: f.state.accountId, cc: f.state.cc, phone: f.state.phone, cuid: f.state.cuid, signallingJwt: f.state.sigsockToken }, s = { reconnectionDelay: f.state.reconnectionDelay, reconnectionDelayMax: f.state.reconnectionDelayMax, randomizationFactor: f.state.randomizationFactor, timeout: 3e4, autoReconnect: !0, autoConnect: !0, transports: ["websocket"] }; n.init(f.state.sna, s, r).then((() => { e(n) })).catch((e => { console.error(e), t(e) })) })), Ge.call(this), this.loginSuccesful = !0 } catch (t) { if (console.log(t), 404 === t || 400 === t) { let e = {}; if (404 === t) throw e.code = "ERR_INVALID_CREDENTIALS", e.message = "invalid init credentials", e; if (400 === t) throw e.code = t, e.message = t.message || "Bad Request. Please recheck credentials", e } f.commit("setBaseUrl", f.state.defaultBaseUrl), setTimeout((() => { this.signin(e) }), f.state.retryDelay) } } getClevertapCredentials() { if (console.log(this.ctSdk.getCleverTapID()), !this.ctSdk || !this.ctSdk.getCleverTapID || !this.ctSdk.getCleverTapID()) { throw { code: "ERR_MISSING_CT_ID", message: "cannot find clevertap id. Signed call sdk cannot initiate" } } if (!this.ctSdk || !this.ctSdk.getAccountID || !this.ctSdk.getAccountID()) { throw { code: "ERR_MISSING_CT_ACCOUNTID", message: "cannot find clevertap account id. Signed call sdk cannot initiate" } } return { guid: this.ctSdk.getCleverTapID(), ctAccountId: this.ctSdk.getAccountID(), region: this.ctSdk.getSCDomain() } } async call(e, t, n) { if (!f.state.sipRegistered) { try { await navigator.mediaDevices.getUserMedia({ audio: !0 }) } catch (e) { if (!e || "Permission denied" !== e.message && "The request is not allowed by the user agent or the platform in the current context." !== e.message) throw console.error(e), e; { let e = { message: "Unable to get microphone access. Cannot make a call", code: "ERR_MIC_UNAVAILABLE" }; throw e } } if ("Notification" in window ? Notification.requestPermission().then((e => { f.commit("setNotificationPermission", e), console.log("value got :: ", e) })) : console.log("This browser does not support notifications."), !this.sigsock.socket.connected) { throw { code: "ERR_CONNECTION_NOT_ESTABLISHED", message: "Signed call sdk isn't connected. Please reconnect." } } return f.state.mute && f.commit("mute", !1), f.state.isMuted === u && f.commit("setIsMuted", a), new Promise(((r, i) => { if (f.state.isBusy) { return void i({ code: "ERR_OUTGOING_CALL_IN_PROGRESS", message: "Cannot initiate another call while you're on a call" }) } if (!e || !t) { return void i({ code: "ERR_INVALID_CALL_PARAMETERS", message: "CUID and context are mandatory for calling." }) } if (e === f.state.cuid) { return void i({ code: "ERR_INVALID_CALL_PARAMETERS", message: "caller and receiver cannot be same" }) } this.context = t; let o = {}; try { ze(e) } catch (e) { let t = { code: "ERR_INVALID_CALL_PARAMETERS", message: e.message }; return void i(t) } o = { cuid: e, context: t }, n && (n.recording ? (o.recording = n.recording, f.commit("setRecord", !0)) : f.commit("setRecord", !1)), f.commit("setIsBusy", !0), n && n.initiator_image && (o.customMetadata = {}, o.customMetadata.initiator_image = n.initiator_image), f.commit("setIsInitiator", !0), this.sigsock.makeCall(o).then((e => { this.ctSdk.event.push(s, { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: e.call, cuid: f.state.cuid, epoch: Date.now(), context: e.context }), f.commit("setCallsockToken", e.callJwt), f.commit("setCallId", e.call), f.commit("setCallsockHost", e.host), f.commit("setIncomingCallData", e), this.sigsock.incomingcall = e, this.callRejector = i, this.callResolver = r, Re("Outgoing call", f.state.branding, n && n.receiver_image ? n.receiver_image : null), (({ color: e }) => { let t = `\n  \n  #sc__og--cancel--container {\n    color: ${(e = e || "#ffffff") || "#ffffff"};\n    margin: 5px auto 5px; 5px;\n  }\n\n  #sc__og--cancel {\n      min-width: 40px;\n      min-height: 40px;\n      border-radius: 50%;\n      background-color: #FF453A;\n      position: relative;\n      cursor: pointer;\n    }\n\n    #sc__og--cancel>svg {\n      position: absolute;\n      top: 11px;\n      left: 10px;\n    }\n\n    .sc__og--actiontext {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 4px auto 20px auto;\n      color: inherit;\n    }`, n = document.getElementById("sc__callactions"); if (!n) throw new Error("Cannot find the required element for call dialog rendering"); let r = "sc--outgoing"; if (!document.getElementById(r)) { let e = document.createElement("style"); e.setAttribute("id", r), e.innerHTML = t, document.getElementsByTagName("head")[0].appendChild(e) } n.innerHTML = '<div id="sc__og--cancel--container">\n        <div id="sc__og--cancel">\n          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path\n              d="M1.79619 8.10012L1.93876 7.95771C1.94636 7.95012 1.95393 7.94255 1.96199 7.9345C2.66848 7.29757 3.55866 6.80807 4.76361 6.39382C6.84725 5.66603 9.06196 5.39375 11.258 5.59545C12.9029 5.70768 14.5144 6.10987 16.0181 6.78346C16.8443 7.12814 17.5862 7.64706 18.1932 8.3048C18.6466 8.83434 18.922 9.32035 18.8988 10.1108C18.8945 10.3517 18.8405 10.5892 18.7399 10.8083C18.6393 11.0275 18.4945 11.2235 18.3145 11.3841C18.1345 11.5446 17.9233 11.6661 17.6942 11.7411C17.4651 11.816 17.223 11.8427 16.9833 11.8195L14.1415 11.4749C13.718 11.4299 13.3266 11.2293 13.043 10.9121C12.7593 10.5949 12.6036 10.1836 12.606 9.75759L12.6075 9.0709C11.5559 8.94682 9.18117 8.73603 7.25235 9.07006C7.25411 9.30436 7.25646 9.56777 7.25916 9.78235C7.26372 10.2204 7.10207 10.6442 6.80682 10.9684C6.51157 11.2927 6.10462 11.4932 5.66799 11.5297L2.75636 11.8066C2.52292 11.8256 2.28817 11.7961 2.06692 11.7198C1.84566 11.6435 1.64273 11.5222 1.47085 11.3635C1.28972 11.2005 1.14358 11.0024 1.04115 10.7812C0.93872 10.56 0.88212 10.3204 0.874838 10.0765C0.837628 9.13161 1.21483 8.68084 1.79619 8.10012Z"\n              fill="white" />\n          </svg>\n        </div>\n        <p class="sc__og--actiontext">Cancel</p>\n      </div>' })(f.state.branding), f.commit("playRinger", !0); try { this.setupCancelCall() } catch (e) { i(e) } this.setupCancelTimer(); try { Me(`callsock inititated, ${f.state.sipRegistered}`, "count"), f.state.sipRegistered ? console.log("Please wait while sdk is getting ready for another call") : Fe().then((e => this.callsock = e)).catch((e => { throw console.error(e), t.hangup(), e })) } catch (e) { t.hangup() } let t = this; this.outgoingCallAcceptHandler = (e, n) => { Me("answer received", "count"), Me({ payload: { data_callId: e.callId, store_callId: f.state.callId }, message: "these are callIds in answer" }, "log"), f.state.callId === e.callId && (Me("in if block of acceptHandler", "count"), f.commit("setIsAnswered", !0), f.commit("setIsBusy", !0), f.commit("playRinger", !1), t.cancelTimer && clearTimeout(t.cancelTimer), Ie("Connecting..."), Me("about to call call_voip", "count"), f.state.sipRegistered ? (Me("called call_voip by if", "count"), f.commit("callVoip", !f.state.callVoip)) : f.events.subscribe("sipRegistered", (e => { e && f.commit("callVoip", !f.state.callVoip), f.events.unsubscribe("sipRegistered") })), n({ status: !0 }), this.removeCallListners()) }, this.outgoingCallDeclineHandler = (e, n) => { f.state.callId === e.callId ? (f.commit("disconnectCallsock", !f.state.disconnectCallsock), f.commit("disconnectSip", !f.state.disconnectSip), t.cancelTimer && clearTimeout(t.cancelTimer), f.commit("playRinger", !1), ke(), this.removeCallListners(), f.commit("setIsBusy", !1), n({ status: !0 }), 1001 === e.reasonCode ? t.callRejector("The user you are trying to reach is busy on another call") : t.callRejector("declined")) : t.callRejector(e) }, this.outgoingCallMissHandler = (e, n) => { f.state.callId === e.callId && (f.commit("disconnectCallsock", !f.state.disconnectCallsock), f.commit("disconnectSip", !f.state.disconnectSip), t.cancelTimer && clearTimeout(t.cancelTimer), f.commit("playRinger", !1), ke(), this.removeCallListners(), f.commit("setIsBusy", !1), n({ status: !0 }), t.callRejector("missed")) }, this.sigsock.socket.once("answer", this.outgoingCallAcceptHandler), this.sigsock.socket.once("decline", this.outgoingCallDeclineHandler), this.sigsock.socket.once("miss", this.outgoingCallMissHandler) })).catch((e => { this.resetState(), console.error(e), i(e) })) })) } console.log("Sip Already Registered") } removeCallListners() { this.sigsock.socket.off("miss", this.outgoingCallMissHandler), this.sigsock.socket.off("decline", this.outgoingCallDeclineHandler), this.sigsock.socket.off("answer", this.outgoingCallAcceptHandler) } setupCancelTimer() { this.cancelTimer = setTimeout((() => { f.state.isAnswered || this.dialCancel() }), 35e3) } setupMissTimer() { this.missTimer = setTimeout((() => { this.miss() }), 3e4) } async answer() { Me("inside answer", "count"); try { await navigator.mediaDevices.getUserMedia({ audio: !0 }) } catch (e) { if (this.sigsock.decline(f.state.callId, f.state.callsockToken), !e || "Permission denied" !== e.message && "The request is not allowed by the user agent or the platform in the current context." !== e.message) console.error(e); else { let e = new Error; e.message = "Unable to get microphone access. Cannot answer the call", e.code = "ERR_MIC_UNAVAILABLE", this.ctSdk.event.push(o, { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: f.state.callId, cuid: f.state.cuid, epoch: Date.now(), context: f.state.context, call_status: "microphone permission not granted", reason_code: 1002 }), console.error(e) } return ke(), f.commit("playRinger", !1), f.commit("setIsBusy", !1), void clearTimeout(this.missTimer) } f.commit("setIsAnswered", !0), f.commit("setIsBusy", !0), f.commit("playRinger", !1), Me("answer emiited on sigsock", "count"), this.sigsock.answer(f.state.accountId).then((() => { clearTimeout(this.missTimer), this.clearIncomingModal(), Ie("Ongoing call"), Pe(f.state.branding), this.renderInCall(), Me("response received on answer", "count") })).catch((e => { console.log("inside catch block of answer"), console.error(e), f.commit("setIsBusy", !1), f.commit("setIsAnswered", !1), this.hangup() })).finally((() => { clearTimeout(this.missTimer) })) } decline() { if (!f.state.canDeclineCall) return void console.log("cannot decline while answering the call"); f.commit("playRinger", !1), this.missTimer && clearTimeout(this.missTimer), ke(); let e = { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: f.state.callId, cuid: f.state.cuid, epoch: Date.now(), context: f.state.context, call_status: "declined" }; this.ctSdk.event.push(o, e), this.sigsock.decline(f.state.callId, f.state.callsockToken, "user declined").then((() => { console.log("call decline") })).catch((e => { console.error(e) })).finally((() => { f.commit("disconnectCallsock", !f.state.disconnectCallsock), f.commit("disconnectSip", !f.state.disconnectSip), this.resetState() })) } miss() { f.commit("playRinger", !1), ke(), this.missTimer && clearTimeout(this.missTimer); let e = { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: f.state.callId, cuid: f.state.cuid, epoch: Date.now(), context: f.state.context, call_status: "missed" }; this.ctSdk.event.push(o, e), this.sigsock.miss(f.state.accountId).then((() => { console.log("call missed") })).catch((e => { console.error(e) })).finally((() => { f.commit("disconnectCallsock", !f.state.disconnectCallsock), f.commit("disconnectSip", !f.state.disconnectSip), this.resetState() })) } dialCancel() { this.cancelTimer && clearTimeout(this.cancelTimer), f.commit("playRinger", !1); let e = { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), cuid: f.state.cuid, epoch: Date.now(), context: f.state.context, call_status: "cancelled" }; this.ctSdk.event.push(o, e), this.sigsock.cancel(f.state.callId).then((() => { console.log("call cancel") })).catch((e => { console.error(e) })).finally((() => { f.commit("disconnectCallsock", !f.state.disconnectCallsock), f.commit("disconnectSip", !f.state.disconnectSip) })), this.callRejector && (this.callRejector("cancelled"), this.callRejector = void 0), this.sigsock.socket.off("miss", this.outgoingCallMissHandler), this.sigsock.socket.off("decline", this.outgoingCallDeclineHandler), this.sigsock.socket.off("answer", this.outgoingCallAcceptHandler), ke(), this.resetState() } hangup() { Me("inside hangup", "count"), f.state.playRinger && f.commit("playRinger", !1), ke(); let e = { ct_account_id: this.ctSdk.getAccountID(), sc_account_id: f.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: f.state.callId, cuid: f.state.cuid, epoch: Date.now(), context: f.state.context, call_status: "over" }; this.ctSdk.event.push(o, e), f.commit("disconnectSip", !f.state.disconnectSip), f.commit("disconnectCallsock", !f.state.disconnectCallsock), Me("commited disconnect and disconnectCallsock at this time", "count"); let t = document.getElementById("hold_unhold_css"); t && t.remove(); try { this.callResolver && (this.callResolver("over"), this.callResolver = void 0), Me(`this is hangup and this is sipRegistered ${f.state.sipRegistered}`, "count"), this.resetState() } catch (e) { throw console.error(e), this.resetState(), e } } setupCancelCall() { let e = this, t = document.getElementById("sc__og--cancel--container"); if (!t) throw new Error("Cannot find cancel button in the document."); t.addEventListener("click", (function () { e.dialCancel() })) } clearIncomingModal() { document.getElementById("sc__callactions").innerHTML = null } toggleMuteUnmute() { f.commit("mute", !f.state.mute) } addMuteUnmuteHandler() { let e = this; document.getElementById("sc__ong--mute").addEventListener("click", (function () { e.toggleMuteUnmute() })), document.getElementById("sc__ong--unmute").addEventListener("click", (function () { e.toggleMuteUnmute() })) } renderInCall() { let e = this; document.getElementById("sc__sdk--timer").classList.remove("sc__hide"), this.addMuteUnmuteHandler(), document.getElementById("sc__ong--hangup--container").addEventListener("click", (function () { e.hangup() })) } isEnabled() { return !(!this.loginSuccesful || this.sipRegistered) } logout() { ke(), f.commit("disconnectSip", !f.state.disconnectSip), f.commit("disconnectCallsock", !f.state.disconnectCallsock), f.commit("disconnectSigsock", !f.state.disconnectSigsock) } disconnect() { f.commit("disconnectSigsock", !f.state.disconnectSigsock) } resetState() { Me("inside resetState", "count"), f.commit("setReconnectionAttempt", 0), f.commit("mute", !1), f.commit("setIsMuted", a), f.commit("setIsBusy", !1), f.commit("setIsInitiator", !1), f.commit("setIsAnswered", !1), f.commit("setCanDeclineCall", !0), Me("sip false on resetState function", "count"), Me("end of hangup reached", "count") } setLogLevel(e) { window.localStorage.setItem("ll", e) } } async function Xe(e) { if (!document.getElementById("sc-sdk")) { let e = document.createElement("div"); e.setAttribute("id", "sc-sdk"), document.body.appendChild(e) } if (!e.clevertap) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "Clevertap sdk not found. Please ensure that clevertap sdk is initialized and its instance is passed to Signed Call SDK" } } e.clevertap.setSCSDKVersion(t), Je(e), e.name || delete e.name, e.ringtone && f.commit("setRingtone", e.ringtone); let n = new Ye(e.clevertap); return await n.signin(e), n } })(); var s = r.Z, i = r.C; export { s as SignedCallClient, i as initSignedCall };
