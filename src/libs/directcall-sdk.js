/* eslint-disable */var e = {
  6906: e => { function t() { } e.exports = function (e, n, r) { var s = !1; return r = r || t, i.count = e, 0 === e ? n() : i; function i(e, t) { if (i.count <= 0) throw new Error("after called too many times"); --i.count, e ? (s = !0, n(e), n = r) : 0 !== i.count || s || n(null, t) } } }, 9718: e => { e.exports = function (e, t, n) { var r = e.byteLength; if (t = t || 0, n = n || r, e.slice) return e.slice(t, n); if (t < 0 && (t += r), n < 0 && (n += r), n > r && (n = r), t >= r || t >= n || 0 === r) return new ArrayBuffer(0); for (var s = new Uint8Array(e), i = new Uint8Array(n - t), o = t, a = 0; o < n; o++, a++)i[a] = s[o]; return i.buffer } }, 3010: e => { function t(e) { e = e || {}, this.ms = e.min || 100, this.max = e.max || 1e4, this.factor = e.factor || 2, this.jitter = e.jitter > 0 && e.jitter <= 1 ? e.jitter : 0, this.attempts = 0 } e.exports = t, t.prototype.duration = function () { var e = this.ms * Math.pow(this.factor, this.attempts++); if (this.jitter) { var t = Math.random(), n = Math.floor(t * this.jitter * e); e = 0 == (1 & Math.floor(10 * t)) ? e - n : e + n } return 0 | Math.min(e, this.max) }, t.prototype.reset = function () { this.attempts = 0 }, t.prototype.setMin = function (e) { this.ms = e }, t.prototype.setMax = function (e) { this.max = e }, t.prototype.setJitter = function (e) { this.jitter = e } }, 3704: (e, t) => { var n; n = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", t.encode = function (e) { var t, r = new Uint8Array(e), s = r.length, i = ""; for (t = 0; t < s; t += 3)i += n[r[t] >> 2], i += n[(3 & r[t]) << 4 | r[t + 1] >> 4], i += n[(15 & r[t + 1]) << 2 | r[t + 2] >> 6], i += n[63 & r[t + 2]]; return s % 3 == 2 ? i = i.substring(0, i.length - 1) + "=" : s % 3 == 1 && (i = i.substring(0, i.length - 2) + "=="), i }, t.decode = function (e) { var t, r, s, i, o, a = .75 * e.length, l = e.length, u = 0; "=" === e[e.length - 1] && (a--, "=" === e[e.length - 2] && a--); var c = new ArrayBuffer(a), h = new Uint8Array(c); for (t = 0; t < l; t += 4)r = n.indexOf(e[t]), s = n.indexOf(e[t + 1]), i = n.indexOf(e[t + 2]), o = n.indexOf(e[t + 3]), h[u++] = r << 2 | s >> 4, h[u++] = (15 & s) << 4 | i >> 2, h[u++] = (3 & i) << 6 | 63 & o; return c } }, 5548: e => { var t = void 0 !== t ? t : "undefined" != typeof WebKitBlobBuilder ? WebKitBlobBuilder : "undefined" != typeof MSBlobBuilder ? MSBlobBuilder : "undefined" != typeof MozBlobBuilder && MozBlobBuilder, n = function () { try { return 2 === new Blob(["hi"]).size } catch (e) { return !1 } }(), r = n && function () { try { return 2 === new Blob([new Uint8Array([1, 2])]).size } catch (e) { return !1 } }(), s = t && t.prototype.append && t.prototype.getBlob; function i(e) { return e.map((function (e) { if (e.buffer instanceof ArrayBuffer) { var t = e.buffer; if (e.byteLength !== t.byteLength) { var n = new Uint8Array(e.byteLength); n.set(new Uint8Array(t, e.byteOffset, e.byteLength)), t = n.buffer } return t } return e })) } function o(e, n) { n = n || {}; var r = new t; return i(e).forEach((function (e) { r.append(e) })), n.type ? r.getBlob(n.type) : r.getBlob() } function a(e, t) { return new Blob(i(e), t || {}) } "undefined" != typeof Blob && (o.prototype = Blob.prototype, a.prototype = Blob.prototype), e.exports = n ? r ? Blob : a : s ? o : void 0 }, 6077: e => { var t = [].slice; e.exports = function (e, n) { if ("string" == typeof n && (n = e[n]), "function" != typeof n) throw new Error("bind() requires a function"); var r = t.call(arguments, 2); return function () { return n.apply(e, r.concat(t.call(arguments))) } } }, 8767: e => { function t(e) { if (e) return function (e) { for (var n in t.prototype) e[n] = t.prototype[n]; return e }(e) } e.exports = t, t.prototype.on = t.prototype.addEventListener = function (e, t) { return this._callbacks = this._callbacks || {}, (this._callbacks["$" + e] = this._callbacks["$" + e] || []).push(t), this }, t.prototype.once = function (e, t) { function n() { this.off(e, n), t.apply(this, arguments) } return n.fn = t, this.on(e, n), this }, t.prototype.off = t.prototype.removeListener = t.prototype.removeAllListeners = t.prototype.removeEventListener = function (e, t) { if (this._callbacks = this._callbacks || {}, 0 == arguments.length) return this._callbacks = {}, this; var n, r = this._callbacks["$" + e]; if (!r) return this; if (1 == arguments.length) return delete this._callbacks["$" + e], this; for (var s = 0; s < r.length; s++)if ((n = r[s]) === t || n.fn === t) { r.splice(s, 1); break } return 0 === r.length && delete this._callbacks["$" + e], this }, t.prototype.emit = function (e) { this._callbacks = this._callbacks || {}; for (var t = new Array(arguments.length - 1), n = this._callbacks["$" + e], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; if (n) { r = 0; for (var s = (n = n.slice(0)).length; r < s; ++r)n[r].apply(this, t) } return this }, t.prototype.listeners = function (e) { return this._callbacks = this._callbacks || {}, this._callbacks["$" + e] || [] }, t.prototype.hasListeners = function (e) { return !!this.listeners(e).length } }, 3861: e => { e.exports = function (e, t) { var n = function () { }; n.prototype = t.prototype, e.prototype = new n, e.prototype.constructor = e } }, 1227: (e, t, n) => { function r() { var e; try { e = t.storage.debug } catch (e) { } return !e && "undefined" != typeof process && "env" in process && (e = process.env.DEBUG), e } (t = e.exports = n(1658)).log = function () { return "object" == typeof console && console.log && Function.prototype.apply.call(console.log, console, arguments) }, t.formatArgs = function (e) { var n = this.useColors; if (e[0] = (n ? "%c" : "") + this.namespace + (n ? " %c" : " ") + e[0] + (n ? "%c " : " ") + "+" + t.humanize(this.diff), !n) return; var r = "color: " + this.color; e.splice(1, 0, r, "color: inherit"); var s = 0, i = 0; e[0].replace(/%[a-zA-Z%]/g, (function (e) { "%%" !== e && (s++, "%c" === e && (i = s)) })), e.splice(i, 0, r) }, t.save = function (e) { try { null == e ? t.storage.removeItem("debug") : t.storage.debug = e } catch (e) { } }, t.load = r, t.useColors = function () { if ("undefined" != typeof window && window.process && "renderer" === window.process.type) return !0; if ("undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)) return !1; return "undefined" != typeof document && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance || "undefined" != typeof window && window.console && (window.console.firebug || window.console.exception && window.console.table) || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/) }, t.storage = "undefined" != typeof chrome && void 0 !== chrome.storage ? chrome.storage.local : function () { try { return window.localStorage } catch (e) { } }(), t.colors = ["#0000CC", "#0000FF", "#0033CC", "#0033FF", "#0066CC", "#0066FF", "#0099CC", "#0099FF", "#00CC00", "#00CC33", "#00CC66", "#00CC99", "#00CCCC", "#00CCFF", "#3300CC", "#3300FF", "#3333CC", "#3333FF", "#3366CC", "#3366FF", "#3399CC", "#3399FF", "#33CC00", "#33CC33", "#33CC66", "#33CC99", "#33CCCC", "#33CCFF", "#6600CC", "#6600FF", "#6633CC", "#6633FF", "#66CC00", "#66CC33", "#9900CC", "#9900FF", "#9933CC", "#9933FF", "#99CC00", "#99CC33", "#CC0000", "#CC0033", "#CC0066", "#CC0099", "#CC00CC", "#CC00FF", "#CC3300", "#CC3333", "#CC3366", "#CC3399", "#CC33CC", "#CC33FF", "#CC6600", "#CC6633", "#CC9900", "#CC9933", "#CCCC00", "#CCCC33", "#FF0000", "#FF0033", "#FF0066", "#FF0099", "#FF00CC", "#FF00FF", "#FF3300", "#FF3333", "#FF3366", "#FF3399", "#FF33CC", "#FF33FF", "#FF6600", "#FF6633", "#FF9900", "#FF9933", "#FFCC00", "#FFCC33"], t.formatters.j = function (e) { try { return JSON.stringify(e) } catch (e) { return "[UnexpectedJSONParseError]: " + e.message } }, t.enable(r()) }, 1658: (e, t, n) => { function r(e) { var n; function r() { if (r.enabled) { var e = r, s = +new Date, i = s - (n || s); e.diff = i, e.prev = n, e.curr = s, n = s; for (var o = new Array(arguments.length), a = 0; a < o.length; a++)o[a] = arguments[a]; o[0] = t.coerce(o[0]), "string" != typeof o[0] && o.unshift("%O"); var l = 0; o[0] = o[0].replace(/%([a-zA-Z%])/g, (function (n, r) { if ("%%" === n) return n; l++; var s = t.formatters[r]; if ("function" == typeof s) { var i = o[l]; n = s.call(e, i), o.splice(l, 1), l-- } return n })), t.formatArgs.call(e, o); var u = r.log || t.log || console.log.bind(console); u.apply(e, o) } } return r.namespace = e, r.enabled = t.enabled(e), r.useColors = t.useColors(), r.color = function (e) { var n, r = 0; for (n in e) r = (r << 5) - r + e.charCodeAt(n), r |= 0; return t.colors[Math.abs(r) % t.colors.length] }(e), r.destroy = s, "function" == typeof t.init && t.init(r), t.instances.push(r), r } function s() { var e = t.instances.indexOf(this); return -1 !== e && (t.instances.splice(e, 1), !0) } (t = e.exports = r.debug = r.default = r).coerce = function (e) { return e instanceof Error ? e.stack || e.message : e }, t.disable = function () { t.enable("") }, t.enable = function (e) { var n; t.save(e), t.names = [], t.skips = []; var r = ("string" == typeof e ? e : "").split(/[\s,]+/), s = r.length; for (n = 0; n < s; n++)r[n] && ("-" === (e = r[n].replace(/\*/g, ".*?"))[0] ? t.skips.push(new RegExp("^" + e.substr(1) + "$")) : t.names.push(new RegExp("^" + e + "$"))); for (n = 0; n < t.instances.length; n++) { var i = t.instances[n]; i.enabled = t.enabled(i.namespace) } }, t.enabled = function (e) { if ("*" === e[e.length - 1]) return !0; var n, r; for (n = 0, r = t.skips.length; n < r; n++)if (t.skips[n].test(e)) return !1; for (n = 0, r = t.names.length; n < r; n++)if (t.names[n].test(e)) return !0; return !1 }, t.humanize = n(7824), t.instances = [], t.names = [], t.skips = [], t.formatters = {} }, 3549: e => { e.exports = "undefined" != typeof self ? self : "undefined" != typeof window ? window : Function("return this")() }, 5983: (e, t, n) => { e.exports = n(2192), e.exports.parser = n(4455) }, 2192: (e, t, n) => { var r = n(3352), s = n(8767), i = n(1227)("engine.io-client:socket"), o = n(7355), a = n(4455), l = n(4187), u = n(1830); function c(e, t) { if (!(this instanceof c)) return new c(e, t); t = t || {}, e && "object" == typeof e && (t = e, e = null), e ? (e = l(e), t.hostname = e.host, t.secure = "https" === e.protocol || "wss" === e.protocol, t.port = e.port, e.query && (t.query = e.query)) : t.host && (t.hostname = l(t.host).host), this.secure = null != t.secure ? t.secure : "undefined" != typeof location && "https:" === location.protocol, t.hostname && !t.port && (t.port = this.secure ? "443" : "80"), this.agent = t.agent || !1, this.hostname = t.hostname || ("undefined" != typeof location ? location.hostname : "localhost"), this.port = t.port || ("undefined" != typeof location && location.port ? location.port : this.secure ? 443 : 80), this.query = t.query || {}, "string" == typeof this.query && (this.query = u.decode(this.query)), this.upgrade = !1 !== t.upgrade, this.path = (t.path || "/engine.io").replace(/\/$/, "") + "/", this.forceJSONP = !!t.forceJSONP, this.jsonp = !1 !== t.jsonp, this.forceBase64 = !!t.forceBase64, this.enablesXDR = !!t.enablesXDR, this.withCredentials = !1 !== t.withCredentials, this.timestampParam = t.timestampParam || "t", this.timestampRequests = t.timestampRequests, this.transports = t.transports || ["polling", "websocket"], this.transportOptions = t.transportOptions || {}, this.readyState = "", this.writeBuffer = [], this.prevBufferLen = 0, this.policyPort = t.policyPort || 843, this.rememberUpgrade = t.rememberUpgrade || !1, this.binaryType = null, this.onlyBinaryUpgrades = t.onlyBinaryUpgrades, this.perMessageDeflate = !1 !== t.perMessageDeflate && (t.perMessageDeflate || {}), !0 === this.perMessageDeflate && (this.perMessageDeflate = {}), this.perMessageDeflate && null == this.perMessageDeflate.threshold && (this.perMessageDeflate.threshold = 1024), this.pfx = t.pfx || void 0, this.key = t.key || void 0, this.passphrase = t.passphrase || void 0, this.cert = t.cert || void 0, this.ca = t.ca || void 0, this.ciphers = t.ciphers || void 0, this.rejectUnauthorized = void 0 === t.rejectUnauthorized || t.rejectUnauthorized, this.forceNode = !!t.forceNode, this.isReactNative = "undefined" != typeof navigator && "string" == typeof navigator.product && "reactnative" === navigator.product.toLowerCase(), ("undefined" == typeof self || this.isReactNative) && (t.extraHeaders && Object.keys(t.extraHeaders).length > 0 && (this.extraHeaders = t.extraHeaders), t.localAddress && (this.localAddress = t.localAddress)), this.id = null, this.upgrades = null, this.pingInterval = null, this.pingTimeout = null, this.pingIntervalTimer = null, this.pingTimeoutTimer = null, this.open() } e.exports = c, c.priorWebsocketSuccess = !1, s(c.prototype), c.protocol = a.protocol, c.Socket = c, c.Transport = n(6496), c.transports = n(3352), c.parser = n(4455), c.prototype.createTransport = function (e) { i('creating transport "%s"', e); var t = function (e) { var t = {}; for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]); return t }(this.query); t.EIO = a.protocol, t.transport = e; var n = this.transportOptions[e] || {}; return this.id && (t.sid = this.id), new r[e]({ query: t, socket: this, agent: n.agent || this.agent, hostname: n.hostname || this.hostname, port: n.port || this.port, secure: n.secure || this.secure, path: n.path || this.path, forceJSONP: n.forceJSONP || this.forceJSONP, jsonp: n.jsonp || this.jsonp, forceBase64: n.forceBase64 || this.forceBase64, enablesXDR: n.enablesXDR || this.enablesXDR, withCredentials: n.withCredentials || this.withCredentials, timestampRequests: n.timestampRequests || this.timestampRequests, timestampParam: n.timestampParam || this.timestampParam, policyPort: n.policyPort || this.policyPort, pfx: n.pfx || this.pfx, key: n.key || this.key, passphrase: n.passphrase || this.passphrase, cert: n.cert || this.cert, ca: n.ca || this.ca, ciphers: n.ciphers || this.ciphers, rejectUnauthorized: n.rejectUnauthorized || this.rejectUnauthorized, perMessageDeflate: n.perMessageDeflate || this.perMessageDeflate, extraHeaders: n.extraHeaders || this.extraHeaders, forceNode: n.forceNode || this.forceNode, localAddress: n.localAddress || this.localAddress, requestTimeout: n.requestTimeout || this.requestTimeout, protocols: n.protocols || void 0, isReactNative: this.isReactNative }) }, c.prototype.open = function () { var e; if (this.rememberUpgrade && c.priorWebsocketSuccess && -1 !== this.transports.indexOf("websocket")) e = "websocket"; else { if (0 === this.transports.length) { var t = this; return void setTimeout((function () { t.emit("error", "No transports available") }), 0) } e = this.transports[0] } this.readyState = "opening"; try { e = this.createTransport(e) } catch (e) { return this.transports.shift(), void this.open() } e.open(), this.setTransport(e) }, c.prototype.setTransport = function (e) { i("setting transport %s", e.name); var t = this; this.transport && (i("clearing existing transport %s", this.transport.name), this.transport.removeAllListeners()), this.transport = e, e.on("drain", (function () { t.onDrain() })).on("packet", (function (e) { t.onPacket(e) })).on("error", (function (e) { t.onError(e) })).on("close", (function () { t.onClose("transport close") })) }, c.prototype.probe = function (e) { i('probing transport "%s"', e); var t = this.createTransport(e, { probe: 1 }), n = !1, r = this; function s() { if (r.onlyBinaryUpgrades) { var s = !this.supportsBinary && r.transport.supportsBinary; n = n || s } n || (i('probe transport "%s" opened', e), t.send([{ type: "ping", data: "probe" }]), t.once("packet", (function (s) { if (!n) if ("pong" === s.type && "probe" === s.data) { if (i('probe transport "%s" pong', e), r.upgrading = !0, r.emit("upgrading", t), !t) return; c.priorWebsocketSuccess = "websocket" === t.name, i('pausing current transport "%s"', r.transport.name), r.transport.pause((function () { n || "closed" !== r.readyState && (i("changing transport and sending upgrade packet"), d(), r.setTransport(t), t.send([{ type: "upgrade" }]), r.emit("upgrade", t), t = null, r.upgrading = !1, r.flush()) })) } else { i('probe transport "%s" failed', e); var o = new Error("probe error"); o.transport = t.name, r.emit("upgradeError", o) } }))) } function o() { n || (n = !0, d(), t.close(), t = null) } function a(n) { var s = new Error("probe error: " + n); s.transport = t.name, o(), i('probe transport "%s" failed because of error: %s', e, n), r.emit("upgradeError", s) } function l() { a("transport closed") } function u() { a("socket closed") } function h(e) { t && e.name !== t.name && (i('"%s" works - aborting "%s"', e.name, t.name), o()) } function d() { t.removeListener("open", s), t.removeListener("error", a), t.removeListener("close", l), r.removeListener("close", u), r.removeListener("upgrading", h) } c.priorWebsocketSuccess = !1, t.once("open", s), t.once("error", a), t.once("close", l), this.once("close", u), this.once("upgrading", h), t.open() }, c.prototype.onOpen = function () { if (i("socket open"), this.readyState = "open", c.priorWebsocketSuccess = "websocket" === this.transport.name, this.emit("open"), this.flush(), "open" === this.readyState && this.upgrade && this.transport.pause) { i("starting upgrade probes"); for (var e = 0, t = this.upgrades.length; e < t; e++)this.probe(this.upgrades[e]) } }, c.prototype.onPacket = function (e) { if ("opening" === this.readyState || "open" === this.readyState || "closing" === this.readyState) switch (i('socket receive: type "%s", data "%s"', e.type, e.data), this.emit("packet", e), this.emit("heartbeat"), e.type) { case "open": this.onHandshake(JSON.parse(e.data)); break; case "pong": this.setPing(), this.emit("pong"); break; case "error": var t = new Error("server error"); t.code = e.data, this.onError(t); break; case "message": this.emit("data", e.data), this.emit("message", e.data) } else i('packet received with socket readyState "%s"', this.readyState) }, c.prototype.onHandshake = function (e) { this.emit("handshake", e), this.id = e.sid, this.transport.query.sid = e.sid, this.upgrades = this.filterUpgrades(e.upgrades), this.pingInterval = e.pingInterval, this.pingTimeout = e.pingTimeout, this.onOpen(), "closed" !== this.readyState && (this.setPing(), this.removeListener("heartbeat", this.onHeartbeat), this.on("heartbeat", this.onHeartbeat)) }, c.prototype.onHeartbeat = function (e) { clearTimeout(this.pingTimeoutTimer); var t = this; t.pingTimeoutTimer = setTimeout((function () { "closed" !== t.readyState && t.onClose("ping timeout") }), e || t.pingInterval + t.pingTimeout) }, c.prototype.setPing = function () { var e = this; clearTimeout(e.pingIntervalTimer), e.pingIntervalTimer = setTimeout((function () { i("writing ping packet - expecting pong within %sms", e.pingTimeout), e.ping(), e.onHeartbeat(e.pingTimeout) }), e.pingInterval) }, c.prototype.ping = function () { var e = this; this.sendPacket("ping", (function () { e.emit("ping") })) }, c.prototype.onDrain = function () { this.writeBuffer.splice(0, this.prevBufferLen), this.prevBufferLen = 0, 0 === this.writeBuffer.length ? this.emit("drain") : this.flush() }, c.prototype.flush = function () { "closed" !== this.readyState && this.transport.writable && !this.upgrading && this.writeBuffer.length && (i("flushing %d packets in socket", this.writeBuffer.length), this.transport.send(this.writeBuffer), this.prevBufferLen = this.writeBuffer.length, this.emit("flush")) }, c.prototype.write = c.prototype.send = function (e, t, n) { return this.sendPacket("message", e, t, n), this }, c.prototype.sendPacket = function (e, t, n, r) { if ("function" == typeof t && (r = t, t = void 0), "function" == typeof n && (r = n, n = null), "closing" !== this.readyState && "closed" !== this.readyState) { (n = n || {}).compress = !1 !== n.compress; var s = { type: e, data: t, options: n }; this.emit("packetCreate", s), this.writeBuffer.push(s), r && this.once("flush", r), this.flush() } }, c.prototype.close = function () { if ("opening" === this.readyState || "open" === this.readyState) { this.readyState = "closing"; var e = this; this.writeBuffer.length ? this.once("drain", (function () { this.upgrading ? r() : t() })) : this.upgrading ? r() : t() } function t() { e.onClose("forced close"), i("socket closing - telling transport to close"), e.transport.close() } function n() { e.removeListener("upgrade", n), e.removeListener("upgradeError", n), t() } function r() { e.once("upgrade", n), e.once("upgradeError", n) } return this }, c.prototype.onError = function (e) { i("socket error %j", e), c.priorWebsocketSuccess = !1, this.emit("error", e), this.onClose("transport error", e) }, c.prototype.onClose = function (e, t) { if ("opening" === this.readyState || "open" === this.readyState || "closing" === this.readyState) { i('socket close with reason: "%s"', e); clearTimeout(this.pingIntervalTimer), clearTimeout(this.pingTimeoutTimer), this.transport.removeAllListeners("close"), this.transport.close(), this.transport.removeAllListeners(), this.readyState = "closed", this.id = null, this.emit("close", e, t), this.writeBuffer = [], this.prevBufferLen = 0 } }, c.prototype.filterUpgrades = function (e) { for (var t = [], n = 0, r = e.length; n < r; n++)~o(this.transports, e[n]) && t.push(e[n]); return t } }, 6496: (e, t, n) => { var r = n(4455), s = n(8767); function i(e) { this.path = e.path, this.hostname = e.hostname, this.port = e.port, this.secure = e.secure, this.query = e.query, this.timestampParam = e.timestampParam, this.timestampRequests = e.timestampRequests, this.readyState = "", this.agent = e.agent || !1, this.socket = e.socket, this.enablesXDR = e.enablesXDR, this.withCredentials = e.withCredentials, this.pfx = e.pfx, this.key = e.key, this.passphrase = e.passphrase, this.cert = e.cert, this.ca = e.ca, this.ciphers = e.ciphers, this.rejectUnauthorized = e.rejectUnauthorized, this.forceNode = e.forceNode, this.isReactNative = e.isReactNative, this.extraHeaders = e.extraHeaders, this.localAddress = e.localAddress } e.exports = i, s(i.prototype), i.prototype.onError = function (e, t) { var n = new Error(e); return n.type = "TransportError", n.description = t, this.emit("error", n), this }, i.prototype.open = function () { return "closed" !== this.readyState && "" !== this.readyState || (this.readyState = "opening", this.doOpen()), this }, i.prototype.close = function () { return "opening" !== this.readyState && "open" !== this.readyState || (this.doClose(), this.onClose()), this }, i.prototype.send = function (e) { if ("open" !== this.readyState) throw new Error("Transport not open"); this.write(e) }, i.prototype.onOpen = function () { this.readyState = "open", this.writable = !0, this.emit("open") }, i.prototype.onData = function (e) { var t = r.decodePacket(e, this.socket.binaryType); this.onPacket(t) }, i.prototype.onPacket = function (e) { this.emit("packet", e) }, i.prototype.onClose = function () { this.readyState = "closed", this.emit("close") } }, 3352: (e, t, n) => { var r = n(2777), s = n(3416), i = n(9785), o = n(4442); t.polling = function (e) { var t = !1, n = !1, o = !1 !== e.jsonp; if ("undefined" != typeof location) { var a = "https:" === location.protocol, l = location.port; l || (l = a ? 443 : 80), t = e.hostname !== location.hostname || l !== e.port, n = e.secure !== a } if (e.xdomain = t, e.xscheme = n, "open" in new r(e) && !e.forceJSONP) return new s(e); if (!o) throw new Error("JSONP disabled"); return new i(e) }, t.websocket = o }, 9785: (e, t, n) => { var r = n(9015), s = n(3861), i = n(3549); e.exports = c; var o, a = /\n/g, l = /\\n/g; function u() { } function c(e) { r.call(this, e), this.query = this.query || {}, o || (o = i.___eio = i.___eio || []), this.index = o.length; var t = this; o.push((function (e) { t.onData(e) })), this.query.j = this.index, "function" == typeof addEventListener && addEventListener("beforeunload", (function () { t.script && (t.script.onerror = u) }), !1) } s(c, r), c.prototype.supportsBinary = !1, c.prototype.doClose = function () { this.script && (this.script.parentNode.removeChild(this.script), this.script = null), this.form && (this.form.parentNode.removeChild(this.form), this.form = null, this.iframe = null), r.prototype.doClose.call(this) }, c.prototype.doPoll = function () { var e = this, t = document.createElement("script"); this.script && (this.script.parentNode.removeChild(this.script), this.script = null), t.async = !0, t.src = this.uri(), t.onerror = function (t) { e.onError("jsonp poll error", t) }; var n = document.getElementsByTagName("script")[0]; n ? n.parentNode.insertBefore(t, n) : (document.head || document.body).appendChild(t), this.script = t, "undefined" != typeof navigator && /gecko/i.test(navigator.userAgent) && setTimeout((function () { var e = document.createElement("iframe"); document.body.appendChild(e), document.body.removeChild(e) }), 100) }, c.prototype.doWrite = function (e, t) { var n = this; if (!this.form) { var r, s = document.createElement("form"), i = document.createElement("textarea"), o = this.iframeId = "eio_iframe_" + this.index; s.className = "socketio", s.style.position = "absolute", s.style.top = "-1000px", s.style.left = "-1000px", s.target = o, s.method = "POST", s.setAttribute("accept-charset", "utf-8"), i.name = "d", s.appendChild(i), document.body.appendChild(s), this.form = s, this.area = i } function u() { c(), t() } function c() { if (n.iframe) try { n.form.removeChild(n.iframe) } catch (e) { n.onError("jsonp polling iframe removal error", e) } try { var e = '<iframe src="javascript:0" name="' + n.iframeId + '">'; r = document.createElement(e) } catch (e) { (r = document.createElement("iframe")).name = n.iframeId, r.src = "javascript:0" } r.id = n.iframeId, n.form.appendChild(r), n.iframe = r } this.form.action = this.uri(), c(), e = e.replace(l, "\\\n"), this.area.value = e.replace(a, "\\n"); try { this.form.submit() } catch (e) { } this.iframe.attachEvent ? this.iframe.onreadystatechange = function () { "complete" === n.iframe.readyState && u() } : this.iframe.onload = u } }, 3416: (e, t, n) => { var r = n(2777), s = n(9015), i = n(8767), o = n(3861), a = n(1227)("engine.io-client:polling-xhr"), l = n(3549); function u() { } function c(e) { if (s.call(this, e), this.requestTimeout = e.requestTimeout, this.extraHeaders = e.extraHeaders, "undefined" != typeof location) { var t = "https:" === location.protocol, n = location.port; n || (n = t ? 443 : 80), this.xd = "undefined" != typeof location && e.hostname !== location.hostname || n !== e.port, this.xs = e.secure !== t } } function h(e) { this.method = e.method || "GET", this.uri = e.uri, this.xd = !!e.xd, this.xs = !!e.xs, this.async = !1 !== e.async, this.data = void 0 !== e.data ? e.data : null, this.agent = e.agent, this.isBinary = e.isBinary, this.supportsBinary = e.supportsBinary, this.enablesXDR = e.enablesXDR, this.withCredentials = e.withCredentials, this.requestTimeout = e.requestTimeout, this.pfx = e.pfx, this.key = e.key, this.passphrase = e.passphrase, this.cert = e.cert, this.ca = e.ca, this.ciphers = e.ciphers, this.rejectUnauthorized = e.rejectUnauthorized, this.extraHeaders = e.extraHeaders, this.create() } if (e.exports = c, e.exports.Request = h, o(c, s), c.prototype.supportsBinary = !0, c.prototype.request = function (e) { return (e = e || {}).uri = this.uri(), e.xd = this.xd, e.xs = this.xs, e.agent = this.agent || !1, e.supportsBinary = this.supportsBinary, e.enablesXDR = this.enablesXDR, e.withCredentials = this.withCredentials, e.pfx = this.pfx, e.key = this.key, e.passphrase = this.passphrase, e.cert = this.cert, e.ca = this.ca, e.ciphers = this.ciphers, e.rejectUnauthorized = this.rejectUnauthorized, e.requestTimeout = this.requestTimeout, e.extraHeaders = this.extraHeaders, new h(e) }, c.prototype.doWrite = function (e, t) { var n = "string" != typeof e && void 0 !== e, r = this.request({ method: "POST", data: e, isBinary: n }), s = this; r.on("success", t), r.on("error", (function (e) { s.onError("xhr post error", e) })), this.sendXhr = r }, c.prototype.doPoll = function () { a("xhr poll"); var e = this.request(), t = this; e.on("data", (function (e) { t.onData(e) })), e.on("error", (function (e) { t.onError("xhr poll error", e) })), this.pollXhr = e }, i(h.prototype), h.prototype.create = function () { var e = { agent: this.agent, xdomain: this.xd, xscheme: this.xs, enablesXDR: this.enablesXDR }; e.pfx = this.pfx, e.key = this.key, e.passphrase = this.passphrase, e.cert = this.cert, e.ca = this.ca, e.ciphers = this.ciphers, e.rejectUnauthorized = this.rejectUnauthorized; var t = this.xhr = new r(e), n = this; try { a("xhr open %s: %s", this.method, this.uri), t.open(this.method, this.uri, this.async); try { if (this.extraHeaders) for (var s in t.setDisableHeaderCheck && t.setDisableHeaderCheck(!0), this.extraHeaders) this.extraHeaders.hasOwnProperty(s) && t.setRequestHeader(s, this.extraHeaders[s]) } catch (e) { } if ("POST" === this.method) try { this.isBinary ? t.setRequestHeader("Content-type", "application/octet-stream") : t.setRequestHeader("Content-type", "text/plain;charset=UTF-8") } catch (e) { } try { t.setRequestHeader("Accept", "*/*") } catch (e) { } "withCredentials" in t && (t.withCredentials = this.withCredentials), this.requestTimeout && (t.timeout = this.requestTimeout), this.hasXDR() ? (t.onload = function () { n.onLoad() }, t.onerror = function () { n.onError(t.responseText) }) : t.onreadystatechange = function () { if (2 === t.readyState) try { var e = t.getResponseHeader("Content-Type"); (n.supportsBinary && "application/octet-stream" === e || "application/octet-stream; charset=UTF-8" === e) && (t.responseType = "arraybuffer") } catch (e) { } 4 === t.readyState && (200 === t.status || 1223 === t.status ? n.onLoad() : setTimeout((function () { n.onError("number" == typeof t.status ? t.status : 0) }), 0)) }, a("xhr data %s", this.data), t.send(this.data) } catch (e) { return void setTimeout((function () { n.onError(e) }), 0) } "undefined" != typeof document && (this.index = h.requestsCount++, h.requests[this.index] = this) }, h.prototype.onSuccess = function () { this.emit("success"), this.cleanup() }, h.prototype.onData = function (e) { this.emit("data", e), this.onSuccess() }, h.prototype.onError = function (e) { this.emit("error", e), this.cleanup(!0) }, h.prototype.cleanup = function (e) { if (void 0 !== this.xhr && null !== this.xhr) { if (this.hasXDR() ? this.xhr.onload = this.xhr.onerror = u : this.xhr.onreadystatechange = u, e) try { this.xhr.abort() } catch (e) { } "undefined" != typeof document && delete h.requests[this.index], this.xhr = null } }, h.prototype.onLoad = function () { var e; try { var t; try { t = this.xhr.getResponseHeader("Content-Type") } catch (e) { } e = ("application/octet-stream" === t || "application/octet-stream; charset=UTF-8" === t) && this.xhr.response || this.xhr.responseText } catch (e) { this.onError(e) } null != e && this.onData(e) }, h.prototype.hasXDR = function () { return "undefined" != typeof XDomainRequest && !this.xs && this.enablesXDR }, h.prototype.abort = function () { this.cleanup() }, h.requestsCount = 0, h.requests = {}, "undefined" != typeof document) if ("function" == typeof attachEvent) attachEvent("onunload", d); else if ("function" == typeof addEventListener) { addEventListener("onpagehide" in l ? "pagehide" : "unload", d, !1) } function d() { for (var e in h.requests) h.requests.hasOwnProperty(e) && h.requests[e].abort() } }, 9015: (e, t, n) => { var r = n(6496), s = n(1830), i = n(4455), o = n(3861), a = n(2281), l = n(1227)("engine.io-client:polling"); e.exports = c; var u = null != new (n(2777))({ xdomain: !1 }).responseType; function c(e) { var t = e && e.forceBase64; u && !t || (this.supportsBinary = !1), r.call(this, e) } o(c, r), c.prototype.name = "polling", c.prototype.doOpen = function () { this.poll() }, c.prototype.pause = function (e) { var t = this; function n() { l("paused"), t.readyState = "paused", e() } if (this.readyState = "pausing", this.polling || !this.writable) { var r = 0; this.polling && (l("we are currently polling - waiting to pause"), r++, this.once("pollComplete", (function () { l("pre-pause polling complete"), --r || n() }))), this.writable || (l("we are currently writing - waiting to pause"), r++, this.once("drain", (function () { l("pre-pause writing complete"), --r || n() }))) } else n() }, c.prototype.poll = function () { l("polling"), this.polling = !0, this.doPoll(), this.emit("poll") }, c.prototype.onData = function (e) { var t = this; l("polling got data %s", e); i.decodePayload(e, this.socket.binaryType, (function (e, n, r) { if ("opening" === t.readyState && "open" === e.type && t.onOpen(), "close" === e.type) return t.onClose(), !1; t.onPacket(e) })), "closed" !== this.readyState && (this.polling = !1, this.emit("pollComplete"), "open" === this.readyState ? this.poll() : l('ignoring poll - transport state "%s"', this.readyState)) }, c.prototype.doClose = function () { var e = this; function t() { l("writing close packet"), e.write([{ type: "close" }]) } "open" === this.readyState ? (l("transport open - closing"), t()) : (l("transport not open - deferring close"), this.once("open", t)) }, c.prototype.write = function (e) { var t = this; this.writable = !1; var n = function () { t.writable = !0, t.emit("drain") }; i.encodePayload(e, this.supportsBinary, (function (e) { t.doWrite(e, n) })) }, c.prototype.uri = function () { var e = this.query || {}, t = this.secure ? "https" : "http", n = ""; return !1 !== this.timestampRequests && (e[this.timestampParam] = a()), this.supportsBinary || e.sid || (e.b64 = 1), e = s.encode(e), this.port && ("https" === t && 443 !== Number(this.port) || "http" === t && 80 !== Number(this.port)) && (n = ":" + this.port), e.length && (e = "?" + e), t + "://" + (-1 !== this.hostname.indexOf(":") ? "[" + this.hostname + "]" : this.hostname) + n + this.path + e } }, 4442: (e, t, n) => { var r, s, i = n(6496), o = n(4455), a = n(1830), l = n(3861), u = n(2281), c = n(1227)("engine.io-client:websocket"); if ("undefined" != typeof WebSocket ? r = WebSocket : "undefined" != typeof self && (r = self.WebSocket || self.MozWebSocket), "undefined" == typeof window) try { s = n(7020) } catch (e) { } var h = r || s; function d(e) { e && e.forceBase64 && (this.supportsBinary = !1), this.perMessageDeflate = e.perMessageDeflate, this.usingBrowserWebSocket = r && !e.forceNode, this.protocols = e.protocols, this.usingBrowserWebSocket || (h = s), i.call(this, e) } e.exports = d, l(d, i), d.prototype.name = "websocket", d.prototype.supportsBinary = !0, d.prototype.doOpen = function () { if (this.check()) { var e = this.uri(), t = this.protocols, n = {}; this.isReactNative || (n.agent = this.agent, n.perMessageDeflate = this.perMessageDeflate, n.pfx = this.pfx, n.key = this.key, n.passphrase = this.passphrase, n.cert = this.cert, n.ca = this.ca, n.ciphers = this.ciphers, n.rejectUnauthorized = this.rejectUnauthorized), this.extraHeaders && (n.headers = this.extraHeaders), this.localAddress && (n.localAddress = this.localAddress); try { this.ws = this.usingBrowserWebSocket && !this.isReactNative ? t ? new h(e, t) : new h(e) : new h(e, t, n) } catch (e) { return this.emit("error", e) } void 0 === this.ws.binaryType && (this.supportsBinary = !1), this.ws.supports && this.ws.supports.binary ? (this.supportsBinary = !0, this.ws.binaryType = "nodebuffer") : this.ws.binaryType = "arraybuffer", this.addEventListeners() } }, d.prototype.addEventListeners = function () { var e = this; this.ws.onopen = function () { e.onOpen() }, this.ws.onclose = function () { e.onClose() }, this.ws.onmessage = function (t) { e.onData(t.data) }, this.ws.onerror = function (t) { e.onError("websocket error", t) } }, d.prototype.write = function (e) { var t = this; this.writable = !1; for (var n = e.length, r = 0, s = n; r < s; r++)!function (e) { o.encodePacket(e, t.supportsBinary, (function (r) { if (!t.usingBrowserWebSocket) { var s = {}; if (e.options && (s.compress = e.options.compress), t.perMessageDeflate) ("string" == typeof r ? Buffer.byteLength(r) : r.length) < t.perMessageDeflate.threshold && (s.compress = !1) } try { t.usingBrowserWebSocket ? t.ws.send(r) : t.ws.send(r, s) } catch (e) { c("websocket closed before onclose event") } --n || i() })) }(e[r]); function i() { t.emit("flush"), setTimeout((function () { t.writable = !0, t.emit("drain") }), 0) } }, d.prototype.onClose = function () { i.prototype.onClose.call(this) }, d.prototype.doClose = function () { void 0 !== this.ws && this.ws.close() }, d.prototype.uri = function () { var e = this.query || {}, t = this.secure ? "wss" : "ws", n = ""; return this.port && ("wss" === t && 443 !== Number(this.port) || "ws" === t && 80 !== Number(this.port)) && (n = ":" + this.port), this.timestampRequests && (e[this.timestampParam] = u()), this.supportsBinary || (e.b64 = 1), (e = a.encode(e)).length && (e = "?" + e), t + "://" + (-1 !== this.hostname.indexOf(":") ? "[" + this.hostname + "]" : this.hostname) + n + this.path + e }, d.prototype.check = function () { return !(!h || "__initialize" in h && this.name === d.prototype.name) } }, 2777: (e, t, n) => { var r = n(8058), s = n(3549); e.exports = function (e) { var t = e.xdomain, n = e.xscheme, i = e.enablesXDR; try { if ("undefined" != typeof XMLHttpRequest && (!t || r)) return new XMLHttpRequest } catch (e) { } try { if ("undefined" != typeof XDomainRequest && !n && i) return new XDomainRequest } catch (e) { } if (!t) try { return new (s[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP") } catch (e) { } } }, 4455: (e, t, n) => { var r, s = n(7990), i = n(3466), o = n(9718), a = n(6906), l = n(3414); "undefined" != typeof ArrayBuffer && (r = n(3704)); var u = "undefined" != typeof navigator && /Android/i.test(navigator.userAgent), c = "undefined" != typeof navigator && /PhantomJS/i.test(navigator.userAgent), h = u || c; t.protocol = 3; var d = t.packets = { open: 0, close: 1, ping: 2, pong: 3, message: 4, upgrade: 5, noop: 6 }, f = s(d), p = { type: "error", data: "parser error" }, _ = n(5548); function m(e, t, n) { for (var r = new Array(e.length), s = a(e.length, n), i = function (e, n, s) { t(n, (function (t, n) { r[e] = n, s(t, r) })) }, o = 0; o < e.length; o++)i(o, e[o], s) } t.encodePacket = function (e, n, r, s) { "function" == typeof n && (s = n, n = !1), "function" == typeof r && (s = r, r = null); var i = void 0 === e.data ? void 0 : e.data.buffer || e.data; if ("undefined" != typeof ArrayBuffer && i instanceof ArrayBuffer) return function (e, n, r) { if (!n) return t.encodeBase64Packet(e, r); var s = e.data, i = new Uint8Array(s), o = new Uint8Array(1 + s.byteLength); o[0] = d[e.type]; for (var a = 0; a < i.length; a++)o[a + 1] = i[a]; return r(o.buffer) }(e, n, s); if (void 0 !== _ && i instanceof _) return function (e, n, r) { if (!n) return t.encodeBase64Packet(e, r); if (h) return function (e, n, r) { if (!n) return t.encodeBase64Packet(e, r); var s = new FileReader; return s.onload = function () { t.encodePacket({ type: e.type, data: s.result }, n, !0, r) }, s.readAsArrayBuffer(e.data) }(e, n, r); var s = new Uint8Array(1); s[0] = d[e.type]; var i = new _([s.buffer, e.data]); return r(i) }(e, n, s); if (i && i.base64) return function (e, n) { var r = "b" + t.packets[e.type] + e.data.data; return n(r) }(e, s); var o = d[e.type]; return void 0 !== e.data && (o += r ? l.encode(String(e.data), { strict: !1 }) : String(e.data)), s("" + o) }, t.encodeBase64Packet = function (e, n) { var r, s = "b" + t.packets[e.type]; if (void 0 !== _ && e.data instanceof _) { var i = new FileReader; return i.onload = function () { var e = i.result.split(",")[1]; n(s + e) }, i.readAsDataURL(e.data) } try { r = String.fromCharCode.apply(null, new Uint8Array(e.data)) } catch (t) { for (var o = new Uint8Array(e.data), a = new Array(o.length), l = 0; l < o.length; l++)a[l] = o[l]; r = String.fromCharCode.apply(null, a) } return s += btoa(r), n(s) }, t.decodePacket = function (e, n, r) { if (void 0 === e) return p; if ("string" == typeof e) { if ("b" === e.charAt(0)) return t.decodeBase64Packet(e.substr(1), n); if (r && !1 === (e = function (e) { try { e = l.decode(e, { strict: !1 }) } catch (e) { return !1 } return e }(e))) return p; var s = e.charAt(0); return Number(s) == s && f[s] ? e.length > 1 ? { type: f[s], data: e.substring(1) } : { type: f[s] } : p } s = new Uint8Array(e)[0]; var i = o(e, 1); return _ && "blob" === n && (i = new _([i])), { type: f[s], data: i } }, t.decodeBase64Packet = function (e, t) { var n = f[e.charAt(0)]; if (!r) return { type: n, data: { base64: !0, data: e.substr(1) } }; var s = r.decode(e.substr(1)); return "blob" === t && _ && (s = new _([s])), { type: n, data: s } }, t.encodePayload = function (e, n, r) { "function" == typeof n && (r = n, n = null); var s = i(e); if (n && s) return _ && !h ? t.encodePayloadAsBlob(e, r) : t.encodePayloadAsArrayBuffer(e, r); if (!e.length) return r("0:"); m(e, (function (e, r) { t.encodePacket(e, !!s && n, !1, (function (e) { r(null, function (e) { return e.length + ":" + e }(e)) })) }), (function (e, t) { return r(t.join("")) })) }, t.decodePayload = function (e, n, r) { if ("string" != typeof e) return t.decodePayloadAsBinary(e, n, r); var s; if ("function" == typeof n && (r = n, n = null), "" === e) return r(p, 0, 1); for (var i, o, a = "", l = 0, u = e.length; l < u; l++) { var c = e.charAt(l); if (":" === c) { if ("" === a || a != (i = Number(a))) return r(p, 0, 1); if (a != (o = e.substr(l + 1, i)).length) return r(p, 0, 1); if (o.length) { if (s = t.decodePacket(o, n, !1), p.type === s.type && p.data === s.data) return r(p, 0, 1); if (!1 === r(s, l + i, u)) return } l += i, a = "" } else a += c } return "" !== a ? r(p, 0, 1) : void 0 }, t.encodePayloadAsArrayBuffer = function (e, n) { if (!e.length) return n(new ArrayBuffer(0)); m(e, (function (e, n) { t.encodePacket(e, !0, !0, (function (e) { return n(null, e) })) }), (function (e, t) { var r = t.reduce((function (e, t) { var n; return e + (n = "string" == typeof t ? t.length : t.byteLength).toString().length + n + 2 }), 0), s = new Uint8Array(r), i = 0; return t.forEach((function (e) { var t = "string" == typeof e, n = e; if (t) { for (var r = new Uint8Array(e.length), o = 0; o < e.length; o++)r[o] = e.charCodeAt(o); n = r.buffer } s[i++] = t ? 0 : 1; var a = n.byteLength.toString(); for (o = 0; o < a.length; o++)s[i++] = parseInt(a[o]); s[i++] = 255; for (r = new Uint8Array(n), o = 0; o < r.length; o++)s[i++] = r[o] })), n(s.buffer) })) }, t.encodePayloadAsBlob = function (e, n) { m(e, (function (e, n) { t.encodePacket(e, !0, !0, (function (e) { var t = new Uint8Array(1); if (t[0] = 1, "string" == typeof e) { for (var r = new Uint8Array(e.length), s = 0; s < e.length; s++)r[s] = e.charCodeAt(s); e = r.buffer, t[0] = 0 } var i = (e instanceof ArrayBuffer ? e.byteLength : e.size).toString(), o = new Uint8Array(i.length + 1); for (s = 0; s < i.length; s++)o[s] = parseInt(i[s]); if (o[i.length] = 255, _) { var a = new _([t.buffer, o.buffer, e]); n(null, a) } })) }), (function (e, t) { return n(new _(t)) })) }, t.decodePayloadAsBinary = function (e, n, r) { "function" == typeof n && (r = n, n = null); for (var s = e, i = []; s.byteLength > 0;) { for (var a = new Uint8Array(s), l = 0 === a[0], u = "", c = 1; 255 !== a[c]; c++) { if (u.length > 310) return r(p, 0, 1); u += a[c] } s = o(s, 2 + u.length), u = parseInt(u); var h = o(s, 0, u); if (l) try { h = String.fromCharCode.apply(null, new Uint8Array(h)) } catch (e) { var d = new Uint8Array(h); h = ""; for (c = 0; c < d.length; c++)h += String.fromCharCode(d[c]) } i.push(h), s = o(s, u) } var f = i.length; i.forEach((function (e, s) { r(t.decodePacket(e, n, !0), s, f) })) } }, 7990: e => { e.exports = Object.keys || function (e) { var t = [], n = Object.prototype.hasOwnProperty; for (var r in e) n.call(e, r) && t.push(r); return t } }, 3414: e => {
    /*! https://mths.be/utf8js v2.1.2 by @mathias */
    var t, n, r, s = String.fromCharCode; function i(e) { for (var t, n, r = [], s = 0, i = e.length; s < i;)(t = e.charCodeAt(s++)) >= 55296 && t <= 56319 && s < i ? 56320 == (64512 & (n = e.charCodeAt(s++))) ? r.push(((1023 & t) << 10) + (1023 & n) + 65536) : (r.push(t), s--) : r.push(t); return r } function o(e, t) { if (e >= 55296 && e <= 57343) { if (t) throw Error("Lone surrogate U+" + e.toString(16).toUpperCase() + " is not a scalar value"); return !1 } return !0 } function a(e, t) { return s(e >> t & 63 | 128) } function l(e, t) { if (0 == (4294967168 & e)) return s(e); var n = ""; return 0 == (4294965248 & e) ? n = s(e >> 6 & 31 | 192) : 0 == (4294901760 & e) ? (o(e, t) || (e = 65533), n = s(e >> 12 & 15 | 224), n += a(e, 6)) : 0 == (4292870144 & e) && (n = s(e >> 18 & 7 | 240), n += a(e, 12), n += a(e, 6)), n += s(63 & e | 128) } function u() { if (r >= n) throw Error("Invalid byte index"); var e = 255 & t[r]; if (r++, 128 == (192 & e)) return 63 & e; throw Error("Invalid continuation byte") } function c(e) { var s, i; if (r > n) throw Error("Invalid byte index"); if (r == n) return !1; if (s = 255 & t[r], r++, 0 == (128 & s)) return s; if (192 == (224 & s)) { if ((i = (31 & s) << 6 | u()) >= 128) return i; throw Error("Invalid continuation byte") } if (224 == (240 & s)) { if ((i = (15 & s) << 12 | u() << 6 | u()) >= 2048) return o(i, e) ? i : 65533; throw Error("Invalid continuation byte") } if (240 == (248 & s) && (i = (7 & s) << 18 | u() << 12 | u() << 6 | u()) >= 65536 && i <= 1114111) return i; throw Error("Invalid UTF-8 detected") } e.exports = { version: "2.1.2", encode: function (e, t) { for (var n = !1 !== (t = t || {}).strict, r = i(e), s = r.length, o = -1, a = ""; ++o < s;)a += l(r[o], n); return a }, decode: function (e, o) { var a = !1 !== (o = o || {}).strict; t = i(e), n = t.length, r = 0; for (var l, u = []; !1 !== (l = c(a));)u.push(l); return function (e) { for (var t, n = e.length, r = -1, i = ""; ++r < n;)(t = e[r]) > 65535 && (i += s((t -= 65536) >>> 10 & 1023 | 55296), t = 56320 | 1023 & t), i += s(t); return i }(u) } }
  }, 7187: e => { var t, n = "object" == typeof Reflect ? Reflect : null, r = n && "function" == typeof n.apply ? n.apply : function (e, t, n) { return Function.prototype.apply.call(e, t, n) }; t = n && "function" == typeof n.ownKeys ? n.ownKeys : Object.getOwnPropertySymbols ? function (e) { return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)) } : function (e) { return Object.getOwnPropertyNames(e) }; var s = Number.isNaN || function (e) { return e != e }; function i() { i.init.call(this) } e.exports = i, e.exports.once = function (e, t) { return new Promise((function (n, r) { function s(n) { e.removeListener(t, i), r(n) } function i() { "function" == typeof e.removeListener && e.removeListener("error", s), n([].slice.call(arguments)) } _(e, t, i, { once: !0 }), "error" !== t && function (e, t, n) { "function" == typeof e.on && _(e, "error", t, n) }(e, s, { once: !0 }) })) }, i.EventEmitter = i, i.prototype._events = void 0, i.prototype._eventsCount = 0, i.prototype._maxListeners = void 0; var o = 10; function a(e) { if ("function" != typeof e) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof e) } function l(e) { return void 0 === e._maxListeners ? i.defaultMaxListeners : e._maxListeners } function u(e, t, n, r) { var s, i, o, u; if (a(n), void 0 === (i = e._events) ? (i = e._events = Object.create(null), e._eventsCount = 0) : (void 0 !== i.newListener && (e.emit("newListener", t, n.listener ? n.listener : n), i = e._events), o = i[t]), void 0 === o) o = i[t] = n, ++e._eventsCount; else if ("function" == typeof o ? o = i[t] = r ? [n, o] : [o, n] : r ? o.unshift(n) : o.push(n), (s = l(e)) > 0 && o.length > s && !o.warned) { o.warned = !0; var c = new Error("Possible EventEmitter memory leak detected. " + o.length + " " + String(t) + " listeners added. Use emitter.setMaxListeners() to increase limit"); c.name = "MaxListenersExceededWarning", c.emitter = e, c.type = t, c.count = o.length, u = c, console && console.warn && console.warn(u) } return e } function c() { if (!this.fired) return this.target.removeListener(this.type, this.wrapFn), this.fired = !0, 0 === arguments.length ? this.listener.call(this.target) : this.listener.apply(this.target, arguments) } function h(e, t, n) { var r = { fired: !1, wrapFn: void 0, target: e, type: t, listener: n }, s = c.bind(r); return s.listener = n, r.wrapFn = s, s } function d(e, t, n) { var r = e._events; if (void 0 === r) return []; var s = r[t]; return void 0 === s ? [] : "function" == typeof s ? n ? [s.listener || s] : [s] : n ? function (e) { for (var t = new Array(e.length), n = 0; n < t.length; ++n)t[n] = e[n].listener || e[n]; return t }(s) : p(s, s.length) } function f(e) { var t = this._events; if (void 0 !== t) { var n = t[e]; if ("function" == typeof n) return 1; if (void 0 !== n) return n.length } return 0 } function p(e, t) { for (var n = new Array(t), r = 0; r < t; ++r)n[r] = e[r]; return n } function _(e, t, n, r) { if ("function" == typeof e.on) r.once ? e.once(t, n) : e.on(t, n); else { if ("function" != typeof e.addEventListener) throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type ' + typeof e); e.addEventListener(t, (function s(i) { r.once && e.removeEventListener(t, s), n(i) })) } } Object.defineProperty(i, "defaultMaxListeners", { enumerable: !0, get: function () { return o }, set: function (e) { if ("number" != typeof e || e < 0 || s(e)) throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + e + "."); o = e } }), i.init = function () { void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 }, i.prototype.setMaxListeners = function (e) { if ("number" != typeof e || e < 0 || s(e)) throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + e + "."); return this._maxListeners = e, this }, i.prototype.getMaxListeners = function () { return l(this) }, i.prototype.emit = function (e) { for (var t = [], n = 1; n < arguments.length; n++)t.push(arguments[n]); var s = "error" === e, i = this._events; if (void 0 !== i) s = s && void 0 === i.error; else if (!s) return !1; if (s) { var o; if (t.length > 0 && (o = t[0]), o instanceof Error) throw o; var a = new Error("Unhandled error." + (o ? " (" + o.message + ")" : "")); throw a.context = o, a } var l = i[e]; if (void 0 === l) return !1; if ("function" == typeof l) r(l, this, t); else { var u = l.length, c = p(l, u); for (n = 0; n < u; ++n)r(c[n], this, t) } return !0 }, i.prototype.addListener = function (e, t) { return u(this, e, t, !1) }, i.prototype.on = i.prototype.addListener, i.prototype.prependListener = function (e, t) { return u(this, e, t, !0) }, i.prototype.once = function (e, t) { return a(t), this.on(e, h(this, e, t)), this }, i.prototype.prependOnceListener = function (e, t) { return a(t), this.prependListener(e, h(this, e, t)), this }, i.prototype.removeListener = function (e, t) { var n, r, s, i, o; if (a(t), void 0 === (r = this._events)) return this; if (void 0 === (n = r[e])) return this; if (n === t || n.listener === t) 0 == --this._eventsCount ? this._events = Object.create(null) : (delete r[e], r.removeListener && this.emit("removeListener", e, n.listener || t)); else if ("function" != typeof n) { for (s = -1, i = n.length - 1; i >= 0; i--)if (n[i] === t || n[i].listener === t) { o = n[i].listener, s = i; break } if (s < 0) return this; 0 === s ? n.shift() : function (e, t) { for (; t + 1 < e.length; t++)e[t] = e[t + 1]; e.pop() }(n, s), 1 === n.length && (r[e] = n[0]), void 0 !== r.removeListener && this.emit("removeListener", e, o || t) } return this }, i.prototype.off = i.prototype.removeListener, i.prototype.removeAllListeners = function (e) { var t, n, r; if (void 0 === (n = this._events)) return this; if (void 0 === n.removeListener) return 0 === arguments.length ? (this._events = Object.create(null), this._eventsCount = 0) : void 0 !== n[e] && (0 == --this._eventsCount ? this._events = Object.create(null) : delete n[e]), this; if (0 === arguments.length) { var s, i = Object.keys(n); for (r = 0; r < i.length; ++r)"removeListener" !== (s = i[r]) && this.removeAllListeners(s); return this.removeAllListeners("removeListener"), this._events = Object.create(null), this._eventsCount = 0, this } if ("function" == typeof (t = n[e])) this.removeListener(e, t); else if (void 0 !== t) for (r = t.length - 1; r >= 0; r--)this.removeListener(e, t[r]); return this }, i.prototype.listeners = function (e) { return d(this, e, !0) }, i.prototype.rawListeners = function (e) { return d(this, e, !1) }, i.listenerCount = function (e, t) { return "function" == typeof e.listenerCount ? e.listenerCount(t) : f.call(e, t) }, i.prototype.listenerCount = f, i.prototype.eventNames = function () { return this._eventsCount > 0 ? t(this._events) : [] } }, 3466: (e, t, n) => { var r = n(579), s = Object.prototype.toString, i = "function" == typeof Blob || "undefined" != typeof Blob && "[object BlobConstructor]" === s.call(Blob), o = "function" == typeof File || "undefined" != typeof File && "[object FileConstructor]" === s.call(File); e.exports = function e(t) { if (!t || "object" != typeof t) return !1; if (r(t)) { for (var n = 0, s = t.length; n < s; n++)if (e(t[n])) return !0; return !1 } if ("function" == typeof Buffer && Buffer.isBuffer && Buffer.isBuffer(t) || "function" == typeof ArrayBuffer && t instanceof ArrayBuffer || i && t instanceof Blob || o && t instanceof File) return !0; if (t.toJSON && "function" == typeof t.toJSON && 1 === arguments.length) return e(t.toJSON(), !0); for (var a in t) if (Object.prototype.hasOwnProperty.call(t, a) && e(t[a])) return !0; return !1 } }, 579: e => { var t = {}.toString; e.exports = Array.isArray || function (e) { return "[object Array]" == t.call(e) } }, 8058: e => { try { e.exports = "undefined" != typeof XMLHttpRequest && "withCredentials" in new XMLHttpRequest } catch (t) { e.exports = !1 } }, 7355: e => { var t = [].indexOf; e.exports = function (e, n) { if (t) return e.indexOf(n); for (var r = 0; r < e.length; ++r)if (e[r] === n) return r; return -1 } }, 7830: (e, t, n) => { var r = n(5424), s = n(965), i = n(3790), o = n(1987), a = n(7351), l = n(8063); t.settings = { authorization_user: null, password: null, realm: null, ha1: null, display_name: null, uri: null, contact_uri: null, instance_id: null, use_preloaded_route: !1, session_timers: !0, session_timers_refresh_method: s.UPDATE, no_answer_timeout: 60, register: !0, register_expires: 600, registrar_server: null, sockets: null, connection_recovery_max_interval: null, connection_recovery_min_interval: null, via_host: "".concat(r.createRandomToken(12), ".invalid") }; var u = { mandatory: { sockets: function (e) { var t = []; if (a.isSocket(e)) t.push({ socket: e }); else { if (!Array.isArray(e) || !e.length) return; var n = !0, r = !1, s = void 0; try { for (var i, o = e[Symbol.iterator](); !(n = (i = o.next()).done); n = !0) { var l = i.value; Object.prototype.hasOwnProperty.call(l, "socket") && a.isSocket(l.socket) ? t.push(l) : a.isSocket(l) && t.push({ socket: l }) } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } return t }, uri: function (e) { /^sip:/i.test(e) || (e = "".concat(s.SIP, ":").concat(e)); var t = o.parse(e); return t && t.user ? t : void 0 } }, optional: { authorization_user: function (e) { return -1 === i.parse('"'.concat(e, '"'), "quoted_string") ? void 0 : e }, user_agent: function (e) { if ("string" == typeof e) return e }, connection_recovery_max_interval: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, connection_recovery_min_interval: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, contact_uri: function (e) { if ("string" == typeof e) { var t = i.parse(e, "SIP_URI"); if (-1 !== t) return t } }, display_name: function (e) { return -1 === i.parse('"'.concat(e, '"'), "display_name") ? void 0 : e }, instance_id: function (e) { return /^uuid:/i.test(e) && (e = e.substr(5)), -1 === i.parse(e, "uuid") ? void 0 : e }, no_answer_timeout: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, session_timers: function (e) { if ("boolean" == typeof e) return e }, session_timers_refresh_method: function (e) { if ("string" == typeof e && ((e = e.toUpperCase()) === s.INVITE || e === s.UPDATE)) return e }, password: function (e) { return String(e) }, realm: function (e) { return String(e) }, ha1: function (e) { return String(e) }, register: function (e) { if ("boolean" == typeof e) return e }, register_expires: function (e) { if (r.isDecimal(e)) { var t = Number(e); if (t > 0) return t } }, registrar_server: function (e) { /^sip:/i.test(e) || (e = "".concat(s.SIP, ":").concat(e)); var t = o.parse(e); return t ? t.user ? void 0 : t : void 0 }, use_preloaded_route: function (e) { if ("boolean" == typeof e) return e } } }; t.load = function (e, t) { for (var n in u.mandatory) { if (!t.hasOwnProperty(n)) throw new l.ConfigurationError(n); var s = t[n], i = u.mandatory[n](s); if (void 0 === i) throw new l.ConfigurationError(n, s); e[n] = i } for (var o in u.optional) if (t.hasOwnProperty(o)) { var a = t[o]; if (r.isEmpty(a)) continue; var c = u.optional[o](a); if (void 0 === c) throw new l.ConfigurationError(o, a); e[o] = c } } }, 965: (e, t, n) => { var r = n(2403); e.exports = { USER_AGENT: "".concat(r.title, " ").concat(r.version), SIP: "sip", SIPS: "sips", causes: { CONNECTION_ERROR: "Connection Error", REQUEST_TIMEOUT: "Request Timeout", SIP_FAILURE_CODE: "SIP Failure Code", INTERNAL_ERROR: "Internal Error", BUSY: "Busy", REJECTED: "Rejected", REDIRECTED: "Redirected", UNAVAILABLE: "Unavailable", NOT_FOUND: "Not Found", ADDRESS_INCOMPLETE: "Address Incomplete", INCOMPATIBLE_SDP: "Incompatible SDP", MISSING_SDP: "Missing SDP", AUTHENTICATION_ERROR: "Authentication Error", BYE: "Terminated", WEBRTC_ERROR: "WebRTC Error", CANCELED: "Canceled", NO_ANSWER: "No Answer", EXPIRES: "Expires", NO_ACK: "No ACK", DIALOG_ERROR: "Dialog Error", USER_DENIED_MEDIA_ACCESS: "User Denied Media Access", BAD_MEDIA_DESCRIPTION: "Bad Media Description", RTP_TIMEOUT: "RTP Timeout" }, SIP_ERROR_CAUSES: { REDIRECTED: [300, 301, 302, 305, 380], BUSY: [486, 600], REJECTED: [403, 603], NOT_FOUND: [404, 604], UNAVAILABLE: [480, 410, 408, 430], ADDRESS_INCOMPLETE: [484, 424], INCOMPATIBLE_SDP: [488, 606], AUTHENTICATION_ERROR: [401, 407] }, ACK: "ACK", BYE: "BYE", CANCEL: "CANCEL", INFO: "INFO", INVITE: "INVITE", MESSAGE: "MESSAGE", NOTIFY: "NOTIFY", OPTIONS: "OPTIONS", REGISTER: "REGISTER", REFER: "REFER", UPDATE: "UPDATE", SUBSCRIBE: "SUBSCRIBE", REASON_PHRASE: { 100: "Trying", 180: "Ringing", 181: "Call Is Being Forwarded", 182: "Queued", 183: "Session Progress", 199: "Early Dialog Terminated", 200: "OK", 202: "Accepted", 204: "No Notification", 300: "Multiple Choices", 301: "Moved Permanently", 302: "Moved Temporarily", 305: "Use Proxy", 380: "Alternative Service", 400: "Bad Request", 401: "Unauthorized", 402: "Payment Required", 403: "Forbidden", 404: "Not Found", 405: "Method Not Allowed", 406: "Not Acceptable", 407: "Proxy Authentication Required", 408: "Request Timeout", 410: "Gone", 412: "Conditional Request Failed", 413: "Request Entity Too Large", 414: "Request-URI Too Long", 415: "Unsupported Media Type", 416: "Unsupported URI Scheme", 417: "Unknown Resource-Priority", 420: "Bad Extension", 421: "Extension Required", 422: "Session Interval Too Small", 423: "Interval Too Brief", 424: "Bad Location Information", 428: "Use Identity Header", 429: "Provide Referrer Identity", 430: "Flow Failed", 433: "Anonymity Disallowed", 436: "Bad Identity-Info", 437: "Unsupported Certificate", 438: "Invalid Identity Header", 439: "First Hop Lacks Outbound Support", 440: "Max-Breadth Exceeded", 469: "Bad Info Package", 470: "Consent Needed", 478: "Unresolvable Destination", 480: "Temporarily Unavailable", 481: "Call/Transaction Does Not Exist", 482: "Loop Detected", 483: "Too Many Hops", 484: "Address Incomplete", 485: "Ambiguous", 486: "Busy Here", 487: "Request Terminated", 488: "Not Acceptable Here", 489: "Bad Event", 491: "Request Pending", 493: "Undecipherable", 494: "Security Agreement Required", 500: "JsSIP Internal Error", 501: "Not Implemented", 502: "Bad Gateway", 503: "Service Unavailable", 504: "Server Time-out", 505: "Version Not Supported", 513: "Message Too Large", 580: "Precondition Failure", 600: "Busy Everywhere", 603: "Decline", 604: "Does Not Exist Anywhere", 606: "Not Acceptable" }, ALLOWED_METHODS: "INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO", ACCEPTED_BODY_TYPES: "application/sdp, application/dtmf-relay", MAX_FORWARDS: 69, SESSION_EXPIRES: 90, MIN_SESSION_EXPIRES: 60 } }, 316: (e, t, n) => { function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t, n) { return t && s(e.prototype, t), n && s(e, n), e } var o = n(6497), a = n(965), l = n(3754), u = n(5604), c = n(5424), h = n(1272)("JsSIP:Dialog"), d = { STATUS_EARLY: 1, STATUS_CONFIRMED: 2 }; e.exports = function () { function e(t, n, s) { var i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : d.STATUS_CONFIRMED; if (r(this, e), this._owner = t, this._ua = t._ua, this._uac_pending_reply = !1, this._uas_pending_reply = !1, !n.hasHeader("contact")) return { error: "unable to create a Dialog without Contact header field" }; n instanceof o.IncomingResponse && (i = n.status_code < 200 ? d.STATUS_EARLY : d.STATUS_CONFIRMED); var a = n.parseHeader("contact"); "UAS" === s ? (this._id = { call_id: n.call_id, local_tag: n.to_tag, remote_tag: n.from_tag, toString: function () { return this.call_id + this.local_tag + this.remote_tag } }, this._state = i, this._remote_seqnum = n.cseq, this._local_uri = n.parseHeader("to").uri, this._remote_uri = n.parseHeader("from").uri, this._remote_target = a.uri, this._route_set = n.getHeaders("record-route"), this._ack_seqnum = this._remote_seqnum) : "UAC" === s && (this._id = { call_id: n.call_id, local_tag: n.from_tag, remote_tag: n.to_tag, toString: function () { return this.call_id + this.local_tag + this.remote_tag } }, this._state = i, this._local_seqnum = n.cseq, this._local_uri = n.parseHeader("from").uri, this._remote_uri = n.parseHeader("to").uri, this._remote_target = a.uri, this._route_set = n.getHeaders("record-route").reverse(), this._ack_seqnum = null), this._ua.newDialog(this), h("new ".concat(s, " dialog created with status ").concat(this._state === d.STATUS_EARLY ? "EARLY" : "CONFIRMED")) } return i(e, null, [{ key: "C", get: function () { return d } }]), i(e, [{ key: "update", value: function (e, t) { this._state = d.STATUS_CONFIRMED, h("dialog ".concat(this._id.toString(), "  changed to CONFIRMED state")), "UAC" === t && (this._route_set = e.getHeaders("record-route").reverse()) } }, { key: "terminate", value: function () { h("dialog ".concat(this._id.toString(), " deleted")), this._ua.destroyDialog(this) } }, { key: "sendRequest", value: function (e) { var t = this, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, r = c.cloneArray(n.extraHeaders), s = n.eventHandlers || {}, i = n.body || null, o = this._createRequest(e, r, i); s.onAuthenticated = function () { t._local_seqnum += 1 }; var a = new u(this, o, s); return a.send(), o } }, { key: "receiveRequest", value: function (e) { this._checkInDialogRequest(e) && (e.method === a.ACK && null !== this._ack_seqnum ? this._ack_seqnum = null : e.method === a.INVITE && (this._ack_seqnum = e.cseq), this._owner.receiveRequest(e)) } }, { key: "_createRequest", value: function (e, t, n) { t = c.cloneArray(t), this._local_seqnum || (this._local_seqnum = Math.floor(1e4 * Math.random())); var r = e === a.CANCEL || e === a.ACK ? this._local_seqnum : this._local_seqnum += 1; return new o.OutgoingRequest(e, this._remote_target, this._ua, { cseq: r, call_id: this._id.call_id, from_uri: this._local_uri, from_tag: this._id.local_tag, to_uri: this._remote_uri, to_tag: this._id.remote_tag, route_set: this._route_set }, t, n) } }, { key: "_checkInDialogRequest", value: function (e) { var t = this; if (this._remote_seqnum) if (e.cseq < this._remote_seqnum) { if (e.method !== a.ACK) return e.reply(500), !1; if (null === this._ack_seqnum || e.cseq !== this._ack_seqnum) return !1 } else e.cseq > this._remote_seqnum && (this._remote_seqnum = e.cseq); else this._remote_seqnum = e.cseq; if (e.method === a.INVITE || e.method === a.UPDATE && e.body) { if (!0 === this._uac_pending_reply) e.reply(491); else { if (!0 === this._uas_pending_reply) { var n = 1 + (10 * Math.random() | 0); return e.reply(500, null, ["Retry-After:".concat(n)]), !1 } this._uas_pending_reply = !0; e.server_transaction.on("stateChanged", (function n() { e.server_transaction.state !== l.C.STATUS_ACCEPTED && e.server_transaction.state !== l.C.STATUS_COMPLETED && e.server_transaction.state !== l.C.STATUS_TERMINATED || (e.server_transaction.removeListener("stateChanged", n), t._uas_pending_reply = !1) })) } e.hasHeader("contact") && e.server_transaction.on("stateChanged", (function () { e.server_transaction.state === l.C.STATUS_ACCEPTED && (t._remote_target = e.parseHeader("contact").uri) })) } else e.method === a.NOTIFY && e.hasHeader("contact") && e.server_transaction.on("stateChanged", (function () { e.server_transaction.state === l.C.STATUS_COMPLETED && (t._remote_target = e.parseHeader("contact").uri) })); return !0 } }, { key: "id", get: function () { return this._id } }, { key: "local_seqnum", get: function () { return this._local_seqnum }, set: function (e) { this._local_seqnum = e } }, { key: "owner", get: function () { return this._owner } }, { key: "uac_pending_reply", get: function () { return this._uac_pending_reply }, set: function (e) { this._uac_pending_reply = e } }, { key: "uas_pending_reply", get: function () { return this._uas_pending_reply } }]), e }() }, 5604: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(965), i = n(3754), o = n(7906), a = n(2066), l = { onRequestTimeout: function () { }, onTransportError: function () { }, onSuccessResponse: function () { }, onErrorResponse: function () { }, onAuthenticated: function () { }, onDialogError: function () { } }; e.exports = function () { function e(t, n, r) { for (var s in function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._dialog = t, this._ua = t._ua, this._request = n, this._eventHandlers = r, this._reattempt = !1, this._reattemptTimer = null, l) Object.prototype.hasOwnProperty.call(l, s) && (this._eventHandlers[s] || (this._eventHandlers[s] = l[s])) } var t, n, u; return t = e, (n = [{ key: "send", value: function () { var e = this, t = new a(this._ua, this._request, { onRequestTimeout: function () { e._eventHandlers.onRequestTimeout() }, onTransportError: function () { e._eventHandlers.onTransportError() }, onAuthenticated: function (t) { e._eventHandlers.onAuthenticated(t) }, onReceiveResponse: function (t) { e._receiveResponse(t) } }); t.send(), (this._request.method === s.INVITE || this._request.method === s.UPDATE && this._request.body) && t.clientTransaction.state !== i.C.STATUS_TERMINATED && (this._dialog.uac_pending_reply = !0, t.clientTransaction.on("stateChanged", (function n() { t.clientTransaction.state !== i.C.STATUS_ACCEPTED && t.clientTransaction.state !== i.C.STATUS_COMPLETED && t.clientTransaction.state !== i.C.STATUS_TERMINATED || (t.clientTransaction.removeListener("stateChanged", n), e._dialog.uac_pending_reply = !1) }))) } }, { key: "_receiveResponse", value: function (e) { var t = this; 408 === e.status_code || 481 === e.status_code ? this._eventHandlers.onDialogError(e) : e.method === s.INVITE && 491 === e.status_code ? this._reattempt ? e.status_code >= 200 && e.status_code < 300 ? this._eventHandlers.onSuccessResponse(e) : e.status_code >= 300 && this._eventHandlers.onErrorResponse(e) : (this._request.cseq.value = this._dialog.local_seqnum += 1, this._reattemptTimer = setTimeout((function () { t._dialog.owner.status !== o.C.STATUS_TERMINATED && (t._reattempt = !0, t._request_sender.send()) }), 1e3)) : e.status_code >= 200 && e.status_code < 300 ? this._eventHandlers.onSuccessResponse(e) : e.status_code >= 300 && this._eventHandlers.onErrorResponse(e) } }, { key: "request", get: function () { return this._request } }]) && r(t.prototype, n), u && r(t, u), e }() }, 2999: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(5424), i = n(1272)("JsSIP:DigestAuthentication"), o = n(1272)("JsSIP:ERROR:DigestAuthentication"); o.log = console.warn.bind(console), e.exports = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._credentials = t, this._cnonce = null, this._nc = 0, this._ncHex = "00000000", this._algorithm = null, this._realm = null, this._nonce = null, this._opaque = null, this._stale = null, this._qop = null, this._method = null, this._uri = null, this._ha1 = null, this._response = null } var t, n, a; return t = e, n = [{ key: "get", value: function (e) { switch (e) { case "realm": return this._realm; case "ha1": return this._ha1; default: return void o('get() | cannot get "%s" parameter', e) } } }, { key: "authenticate", value: function (e, t) { var n = e.method, r = e.ruri, a = e.body, l = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; if (this._algorithm = t.algorithm, this._realm = t.realm, this._nonce = t.nonce, this._opaque = t.opaque, this._stale = t.stale, this._algorithm) { if ("MD5" !== this._algorithm) return o('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'), !1 } else this._algorithm = "MD5"; if (!this._nonce) return o("authenticate() | challenge without Digest nonce, authentication aborted"), !1; if (!this._realm) return o("authenticate() | challenge without Digest realm, authentication aborted"), !1; if (!this._credentials.password) { if (!this._credentials.ha1) return o("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"), !1; if (this._credentials.realm !== this._realm) return o('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]', this._credentials.realm, this._realm), !1 } if (t.qop) if (t.qop.indexOf("auth-int") > -1) this._qop = "auth-int"; else { if (!(t.qop.indexOf("auth") > -1)) return o('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'), !1; this._qop = "auth" } else this._qop = null; this._method = n, this._uri = r, this._cnonce = l || s.createRandomToken(12), this._nc += 1; var u, c = Number(this._nc).toString(16); return this._ncHex = "00000000".substr(0, 8 - c.length) + c, 4294967296 === this._nc && (this._nc = 1, this._ncHex = "00000001"), this._credentials.password ? this._ha1 = s.calculateMD5("".concat(this._credentials.username, ":").concat(this._realm, ":").concat(this._credentials.password)) : this._ha1 = this._credentials.ha1, "auth" === this._qop ? (u = s.calculateMD5("".concat(this._method, ":").concat(this._uri)), this._response = s.calculateMD5("".concat(this._ha1, ":").concat(this._nonce, ":").concat(this._ncHex, ":").concat(this._cnonce, ":auth:").concat(u))) : "auth-int" === this._qop ? (u = s.calculateMD5("".concat(this._method, ":").concat(this._uri, ":").concat(s.calculateMD5(a || ""))), this._response = s.calculateMD5("".concat(this._ha1, ":").concat(this._nonce, ":").concat(this._ncHex, ":").concat(this._cnonce, ":auth-int:").concat(u))) : null === this._qop && (u = s.calculateMD5("".concat(this._method, ":").concat(this._uri)), this._response = s.calculateMD5("".concat(this._ha1, ":").concat(this._nonce, ":").concat(u))), i("authenticate() | response generated"), !0 } }, { key: "toString", value: function () { var e = []; if (!this._response) throw new Error("response field does not exist, cannot generate Authorization header"); return e.push("algorithm=".concat(this._algorithm)), e.push('username="'.concat(this._credentials.username, '"')), e.push('realm="'.concat(this._realm, '"')), e.push('nonce="'.concat(this._nonce, '"')), e.push('uri="'.concat(this._uri, '"')), e.push('response="'.concat(this._response, '"')), this._opaque && e.push('opaque="'.concat(this._opaque, '"')), this._qop && (e.push("qop=".concat(this._qop)), e.push('cnonce="'.concat(this._cnonce, '"')), e.push("nc=".concat(this._ncHex))), "Digest ".concat(e.join(", ")) } }], n && r(t.prototype, n), a && r(t, a), e }() }, 8063: e => { function t(e) { return t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, t(e) } function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function r(e, n) { return !n || "object" !== t(n) && "function" != typeof n ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : n } function s(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) } function i(e) { var t = "function" == typeof Map ? new Map : void 0; return i = function (e) { if (null === e || (n = e, -1 === Function.toString.call(n).indexOf("[native code]"))) return e; var n; if ("function" != typeof e) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== t) { if (t.has(e)) return t.get(e); t.set(e, r) } function r() { return a(e, arguments, u(this).constructor) } return r.prototype = Object.create(e.prototype, { constructor: { value: r, enumerable: !1, writable: !0, configurable: !0 } }), l(r, e) }, i(e) } function o() { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Date.prototype.toString.call(Reflect.construct(Date, [], (function () { }))), !0 } catch (e) { return !1 } } function a(e, t, n) { return a = o() ? Reflect.construct : function (e, t, n) { var r = [null]; r.push.apply(r, t); var s = new (Function.bind.apply(e, r)); return n && l(s, n.prototype), s }, a.apply(null, arguments) } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } function u(e) { return u = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, u(e) } var c = function (e) { function t(e, s) { var i; return n(this, t), (i = r(this, u(t).call(this))).code = 1, i.name = "CONFIGURATION_ERROR", i.parameter = e, i.value = s, i.message = i.value ? "Invalid value ".concat(JSON.stringify(i.value), ' for parameter "').concat(i.parameter, '"') : "Missing parameter: ".concat(i.parameter), i } return s(t, e), t }(i(Error)), h = function (e) { function t(e) { var s; return n(this, t), (s = r(this, u(t).call(this))).code = 2, s.name = "INVALID_STATE_ERROR", s.status = e, s.message = "Invalid status: ".concat(e), s } return s(t, e), t }(i(Error)), d = function (e) { function t(e) { var s; return n(this, t), (s = r(this, u(t).call(this))).code = 3, s.name = "NOT_SUPPORTED_ERROR", s.message = e, s } return s(t, e), t }(i(Error)), f = function (e) { function t(e) { var s; return n(this, t), (s = r(this, u(t).call(this))).code = 4, s.name = "NOT_READY_ERROR", s.message = e, s } return s(t, e), t }(i(Error)); e.exports = { ConfigurationError: c, InvalidStateError: h, NotSupportedError: d, NotReadyError: f } }, 3790: (e, t, n) => { e.exports = function () { function e(e) { return '"' + e.replace(/\\/g, "\\\\").replace(/"/g, '\\"').replace(/\x08/g, "\\b").replace(/\t/g, "\\t").replace(/\n/g, "\\n").replace(/\f/g, "\\f").replace(/\r/g, "\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g, escape) + '"' } var t = { parse: function (t, r) { var s = { CRLF: u, DIGIT: c, ALPHA: h, HEXDIG: d, WSP: f, OCTET: p, DQUOTE: _, SP: m, HTAB: g, alphanum: v, reserved: y, unreserved: C, mark: T, escaped: S, LWS: b, SWS: E, HCOLON: A, TEXT_UTF8_TRIM: w, TEXT_UTF8char: R, UTF8_NONASCII: I, UTF8_CONT: k, LHEX: function () { var e; null === (e = c()) && (/^[a-f]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[a-f]"))); return e }, token: x, token_nodot: O, separators: function () { var e; 40 === t.charCodeAt(i) ? (e = "(", i++) : (e = null, l('"("')); null === e && (41 === t.charCodeAt(i) ? (e = ")", i++) : (e = null, l('")"')), null === e && (60 === t.charCodeAt(i) ? (e = "<", i++) : (e = null, l('"<"')), null === e && (62 === t.charCodeAt(i) ? (e = ">", i++) : (e = null, l('">"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, l('"@"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, l('","')), null === e && (59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, l('";"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, l('":"')), null === e && (92 === t.charCodeAt(i) ? (e = "\\", i++) : (e = null, l('"\\\\"')), null === e && null === (e = _()) && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, l('"/"')), null === e && (91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, l('"["')), null === e && (93 === t.charCodeAt(i) ? (e = "]", i++) : (e = null, l('"]"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, l('"?"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, l('"="')), null === e && (123 === t.charCodeAt(i) ? (e = "{", i++) : (e = null, l('"{"')), null === e && (125 === t.charCodeAt(i) ? (e = "}", i++) : (e = null, l('"}"')), null === e && null === (e = m()) && (e = g())))))))))))))))); return e }, word: N, STAR: D, SLASH: P, EQUAL: U, LPAREN: L, RPAREN: M, RAQUOT: q, LAQUOT: H, COMMA: F, SEMI: B, COLON: j, LDQUOT: V, RDQUOT: G, comment: function e() { var t, n, r, s; if (s = i, null !== (t = L())) { for (n = [], null === (r = W()) && null === (r = J()) && (r = e()); null !== r;)n.push(r), null === (r = W()) && null === (r = J()) && (r = e()); null !== n && null !== (r = M()) ? t = [t, n, r] : (t = null, i = s) } else t = null, i = s; return t }, ctext: W, quoted_string: z, quoted_string_clean: $, qdtext: K, quoted_pair: J, SIP_URI_noparams: Y, SIP_URI: X, uri_scheme: Q, uri_scheme_sips: Z, uri_scheme_sip: ee, userinfo: te, user: ne, user_unreserved: re, password: se, hostport: ie, host: oe, hostname: ae, domainlabel: le, toplabel: ue, IPv6reference: ce, IPv6address: he, h16: de, ls32: fe, IPv4address: pe, dec_octet: _e, port: me, uri_parameters: ge, uri_parameter: ve, transport_param: ye, user_param: Ce, method_param: Te, ttl_param: Se, maddr_param: be, lr_param: Ee, other_param: Ae, pname: we, pvalue: Re, paramchar: Ie, param_unreserved: ke, headers: xe, header: Oe, hname: Ne, hvalue: De, hnv_unreserved: Pe, Request_Response: function () { var e; null === (e = ct()) && (e = Ue()); return e }, Request_Line: Ue, Request_URI: Le, absoluteURI: Me, hier_part: qe, net_path: He, abs_path: Fe, opaque_part: Be, uric: je, uric_no_slash: Ve, path_segments: Ge, segment: We, param: ze, pchar: $e, scheme: Ke, authority: Je, srvr: Ye, reg_name: Xe, query: Qe, SIP_Version: Ze, INVITEm: et, ACKm: tt, OPTIONSm: nt, BYEm: rt, CANCELm: st, REGISTERm: it, SUBSCRIBEm: ot, NOTIFYm: at, REFERm: lt, Method: ut, Status_Line: ct, Status_Code: ht, extension_code: dt, Reason_Phrase: ft, Allow_Events: function () { var e, t, n, r, s, o; if (s = i, null !== (e = Mt())) { for (t = [], o = i, null !== (n = F()) && null !== (r = Mt()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = Mt()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Call_ID: function () { var e, n, r, s, o, a; s = i, o = i, null !== (e = N()) ? (a = i, 64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, l('"@"')), null !== n && null !== (r = N()) ? n = [n, r] : (n = null, i = a), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o); null !== e && (e = function (e) { Hn = t.substring(i, e) }(s)); null === e && (i = s); return e }, Contact: function () { var e, t, n, r, s, o, a; if (s = i, null === (e = D())) if (o = i, null !== (e = pt())) { for (t = [], a = i, null !== (n = F()) && null !== (r = pt()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = F()) && null !== (r = pt()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t, n; for (n = Hn.multi_header.length, t = 0; t < n; t++)if (null === Hn.multi_header[t].parsed) { Hn = null; break } Hn = null !== Hn ? Hn.multi_header : -1 }()); null === e && (i = s); return e }, contact_param: pt, name_addr: _t, display_name: mt, contact_params: gt, c_p_q: vt, c_p_expires: yt, delta_seconds: Ct, qvalue: Tt, generic_param: St, gen_value: bt, Content_Disposition: function () { var e, t, n, r, s, o; if (s = i, null !== (e = Et())) { for (t = [], o = i, null !== (n = B()) && null !== (r = At()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = B()) && null !== (r = At()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, disp_type: Et, disp_param: At, handling_param: wt, Content_Encoding: function () { var e, t, n, r, s, o; if (s = i, null !== (e = x())) { for (t = [], o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Content_Length: function () { var e, t, n; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; null !== e && (e = void (Hn = parseInt(e.join("")))); null === e && (i = n); return e }, Content_Type: function () { var e, n; n = i, null !== (e = Rt()) && (e = function (e) { Hn = t.substring(i, e) }(n)); null === e && (i = n); return e }, media_type: Rt, m_type: It, discrete_type: kt, composite_type: xt, extension_token: Ot, x_token: Nt, m_subtype: Dt, m_parameter: Pt, m_value: Ut, CSeq: function () { var e, t, n, r; r = i, null !== (e = Lt()) && null !== (t = b()) && null !== (n = ut()) ? e = [e, t, n] : (e = null, i = r); return e }, CSeq_value: Lt, Expires: function () { var e, t; t = i, null !== (e = Ct()) && (e = void (Hn = e)); null === e && (i = t); return e }, Event: function () { var e, t, n, r, s, o, a; if (s = i, o = i, null !== (e = Mt())) { for (t = [], a = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (l = e[0], e = void (Hn.event = l.join("").toLowerCase())); var l; null === e && (i = s); return e }, event_type: Mt, From: function () { var e, t, n, r, s, o, a; s = i, o = i, null === (e = Y()) && (e = _t()); if (null !== e) { for (t = [], a = i, null !== (n = B()) && null !== (r = qt()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = B()) && null !== (r = qt()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t = Hn.tag; try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params), t && Hn.setParam("tag", t) } catch (e) { Hn = -1 } }()); null === e && (i = s); return e }, from_param: qt, tag_param: Ht, Max_Forwards: function () { var e, t, n; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; null !== e && (e = void (Hn = parseInt(e.join("")))); null === e && (i = n); return e }, Min_Expires: function () { var e, t; t = i, null !== (e = Ct()) && (e = void (Hn = e)); null === e && (i = t); return e }, Name_Addr_Header: function () { var e, t, n, r, s, o, a, l, u, c; l = i, u = i, e = [], t = mt(); for (; null !== t;)e.push(t), t = mt(); if (null !== e) if (null !== (t = H())) if (null !== (n = X())) if (null !== (r = q())) { for (s = [], c = i, null !== (o = B()) && null !== (a = St()) ? o = [o, a] : (o = null, i = c); null !== o;)s.push(o), c = i, null !== (o = B()) && null !== (a = St()) ? o = [o, a] : (o = null, i = c); null !== s ? e = [e, t, n, r, s] : (e = null, i = u) } else e = null, i = u; else e = null, i = u; else e = null, i = u; else e = null, i = u; null !== e && (e = function (e) { try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params) } catch (e) { Hn = -1 } }()); null === e && (i = l); return e }, Proxy_Authenticate: function () { return Ft() }, challenge: Ft, other_challenge: Bt, auth_param: jt, digest_cln: Vt, realm: Gt, realm_value: Wt, domain: zt, URI: $t, nonce: Kt, nonce_value: Jt, opaque: Yt, stale: Xt, algorithm: Qt, qop_options: Zt, qop_value: en, Proxy_Require: function () { var e, t, n, r, s, o; if (s = i, null !== (e = x())) { for (t = [], o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Record_Route: function () { var e, t, n, r, s, o, a; if (s = i, o = i, null !== (e = tn())) { for (t = [], a = i, null !== (n = F()) && null !== (r = tn()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = F()) && null !== (r = tn()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t, n; for (n = Hn.multi_header.length, t = 0; t < n; t++)if (null === Hn.multi_header[t].parsed) { Hn = null; break } Hn = null !== Hn ? Hn.multi_header : -1 }()); null === e && (i = s); return e }, rec_route: tn, Reason: function () { var e, n, r, s, o, a, u; o = i, a = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"SIP"')); null === e && (e = x()); if (null !== e) { for (n = [], u = i, null !== (r = B()) && null !== (s = nn()) ? r = [r, s] : (r = null, i = u); null !== r;)n.push(r), u = i, null !== (r = B()) && null !== (s = nn()) ? r = [r, s] : (r = null, i = u); null !== n ? e = [e, n] : (e = null, i = a) } else e = null, i = a; null !== e && (e = function (e, t) { if (Hn.protocol = t.toLowerCase(), Hn.params || (Hn.params = {}), Hn.params.text && '"' === Hn.params.text[0]) { var n = Hn.params.text; Hn.text = n.substring(1, n.length - 1), delete Hn.params.text } }(0, e[0])); null === e && (i = o); return e }, reason_param: nn, reason_cause: rn, Require: function () { var e, t, n, r, s, o; if (s = i, null !== (e = x())) { for (t = [], o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, Route: function () { var e, t, n, r, s, o; if (s = i, null !== (e = sn())) { for (t = [], o = i, null !== (n = F()) && null !== (r = sn()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = sn()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, route_param: sn, Subscription_State: function () { var e, t, n, r, s, o; if (s = i, null !== (e = on())) { for (t = [], o = i, null !== (n = B()) && null !== (r = an()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = B()) && null !== (r = an()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, substate_value: on, subexp_params: an, event_reason_value: ln, Subject: function () { var e; return e = null !== (e = w()) ? e : "" }, Supported: function () { var e, t, n, r, s, o; if (s = i, null !== (e = x())) { for (t = [], o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = x()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e = null !== e ? e : "" }, To: function () { var e, t, n, r, s, o, a; s = i, o = i, null === (e = Y()) && (e = _t()); if (null !== e) { for (t = [], a = i, null !== (n = B()) && null !== (r = un()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = B()) && null !== (r = un()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { var t = Hn.tag; try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params), t && Hn.setParam("tag", t) } catch (e) { Hn = -1 } }()); null === e && (i = s); return e }, to_param: un, Via: function () { var e, t, n, r, s, o; if (s = i, null !== (e = cn())) { for (t = [], o = i, null !== (n = F()) && null !== (r = cn()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = F()) && null !== (r = cn()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, via_param: cn, via_params: hn, via_ttl: dn, via_maddr: fn, via_received: pn, via_branch: _n, response_port: mn, sent_protocol: gn, protocol_name: vn, transport: yn, sent_by: Cn, via_host: Tn, via_port: Sn, ttl: bn, WWW_Authenticate: function () { return Ft() }, Session_Expires: function () { var e, t, n, r, s, o; if (s = i, null !== (e = En())) { for (t = [], o = i, null !== (n = B()) && null !== (r = An()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = B()) && null !== (r = An()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, s_e_expires: En, s_e_params: An, s_e_refresher: wn, extension_header: function () { var e, t, n, r; r = i, null !== (e = x()) && null !== (t = A()) && null !== (n = Rn()) ? e = [e, t, n] : (e = null, i = r); return e }, header_value: Rn, message_body: function () { var e, t; e = [], t = p(); for (; null !== t;)e.push(t), t = p(); return e }, uuid_URI: function () { var e, n, r; r = i, "uuid:" === t.substr(i, 5) ? (e = "uuid:", i += 5) : (e = null, l('"uuid:"')); null !== e && null !== (n = In()) ? e = [e, n] : (e = null, i = r); return e }, uuid: In, hex4: kn, hex8: xn, hex12: On, Refer_To: function () { var e, t, n, r, s, o, a; s = i, o = i, null === (e = Y()) && (e = _t()); if (null !== e) { for (t = [], a = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; null !== e && (e = function (e) { try { Hn = new qn(Hn.uri, Hn.display_name, Hn.params) } catch (e) { Hn = -1 } }()); null === e && (i = s); return e }, Replaces: function () { var e, t, n, r, s, o; if (s = i, null !== (e = Nn())) { for (t = [], o = i, null !== (n = B()) && null !== (r = Dn()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = B()) && null !== (r = Dn()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e }, call_id: Nn, replaces_param: Dn, to_tag: Pn, from_tag: Un, early_flag: Ln }; if (void 0 !== r) { if (void 0 === s[r]) throw new Error("Invalid rule name: " + e(r) + ".") } else r = "CRLF"; var i = 0, o = 0, a = []; function l(e) { i < o || (i > o && (o = i, a = []), a.push(e)) } function u() { var e; return "\r\n" === t.substr(i, 2) ? (e = "\r\n", i += 2) : (e = null, l('"\\r\\n"')), e } function c() { var e; return /^[0-9]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[0-9]")), e } function h() { var e; return /^[a-zA-Z]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[a-zA-Z]")), e } function d() { var e; return /^[0-9a-fA-F]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[0-9a-fA-F]")), e } function f() { var e; return null === (e = m()) && (e = g()), e } function p() { var e; return /^[\0-\xFF]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[\\0-\\xFF]")), e } function _() { var e; return /^["]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l('["]')), e } function m() { var e; return 32 === t.charCodeAt(i) ? (e = " ", i++) : (e = null, l('" "')), e } function g() { var e; return 9 === t.charCodeAt(i) ? (e = "\t", i++) : (e = null, l('"\\t"')), e } function v() { var e; return /^[a-zA-Z0-9]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[a-zA-Z0-9]")), e } function y() { var e; return 59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, l('";"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, l('"/"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, l('"?"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, l('":"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, l('"@"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, l('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, l('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, l('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, l('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, l('","'))))))))))), e } function C() { var e; return null === (e = v()) && (e = T()), e } function T() { var e; return 45 === t.charCodeAt(i) ? (e = "-", i++) : (e = null, l('"-"')), null === e && (95 === t.charCodeAt(i) ? (e = "_", i++) : (e = null, l('"_"')), null === e && (46 === t.charCodeAt(i) ? (e = ".", i++) : (e = null, l('"."')), null === e && (33 === t.charCodeAt(i) ? (e = "!", i++) : (e = null, l('"!"')), null === e && (126 === t.charCodeAt(i) ? (e = "~", i++) : (e = null, l('"~"')), null === e && (42 === t.charCodeAt(i) ? (e = "*", i++) : (e = null, l('"*"')), null === e && (39 === t.charCodeAt(i) ? (e = "'", i++) : (e = null, l('"\'"')), null === e && (40 === t.charCodeAt(i) ? (e = "(", i++) : (e = null, l('"("')), null === e && (41 === t.charCodeAt(i) ? (e = ")", i++) : (e = null, l('")"')))))))))), e } function S() { var e, n, r, s, o; return s = i, o = i, 37 === t.charCodeAt(i) ? (e = "%", i++) : (e = null, l('"%"')), null !== e && null !== (n = d()) && null !== (r = d()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = e.join("")), null === e && (i = s), e } function b() { var e, t, n, r, s, o; for (r = i, s = i, o = i, e = [], t = f(); null !== t;)e.push(t), t = f(); if (null !== e && null !== (t = u()) ? e = [e, t] : (e = null, i = o), null !== (e = null !== e ? e : "")) { if (null !== (n = f())) for (t = []; null !== n;)t.push(n), n = f(); else t = null; null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return null !== e && (e = " "), null === e && (i = r), e } function E() { var e; return e = null !== (e = b()) ? e : "" } function A() { var e, n, r, s, o; for (s = i, o = i, e = [], null === (n = m()) && (n = g()); null !== n;)e.push(n), null === (n = m()) && (n = g()); return null !== e ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ":"), null === e && (i = s), e } function w() { var e, n, r, s, o, a, l; if (o = i, a = i, null !== (n = R())) for (e = []; null !== n;)e.push(n), n = R(); else e = null; if (null !== e) { for (n = [], l = i, r = [], s = b(); null !== s;)r.push(s), s = b(); for (null !== r && null !== (s = R()) ? r = [r, s] : (r = null, i = l); null !== r;) { for (n.push(r), l = i, r = [], s = b(); null !== s;)r.push(s), s = b(); null !== r && null !== (s = R()) ? r = [r, s] : (r = null, i = l) } null !== n ? e = [e, n] : (e = null, i = a) } else e = null, i = a; return null !== e && (e = function (e) { return t.substring(i, e) }(o)), null === e && (i = o), e } function R() { var e; return /^[!-~]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[!-~]")), null === e && (e = I()), e } function I() { var e; return /^[\x80-\uFFFF]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[\\x80-\\uFFFF]")), e } function k() { var e; return /^[\x80-\xBF]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[\\x80-\\xBF]")), e } function x() { var e, n, r; if (r = i, null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, l('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, l('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, l('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, l('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, l('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, l('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, l('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, l('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, l('"~"')))))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, l('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, l('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, l('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, l('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, l('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, l('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, l('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, l('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, l('"~"')))))))))))); else e = null; return null !== e && (e = function (e) { return t.substring(i, e) }(r)), null === e && (i = r), e } function O() { var e, n, r; if (r = i, null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, l('"-"')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, l('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, l('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, l('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, l('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, l('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, l('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, l('"~"'))))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, l('"-"')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, l('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, l('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, l('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, l('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, l('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, l('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, l('"~"'))))))))))); else e = null; return null !== e && (e = function (e) { return t.substring(i, e) }(r)), null === e && (i = r), e } function N() { var e, n, r; if (r = i, null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, l('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, l('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, l('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, l('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, l('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, l('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, l('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, l('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, l('"~"')), null === n && (40 === t.charCodeAt(i) ? (n = "(", i++) : (n = null, l('"("')), null === n && (41 === t.charCodeAt(i) ? (n = ")", i++) : (n = null, l('")"')), null === n && (60 === t.charCodeAt(i) ? (n = "<", i++) : (n = null, l('"<"')), null === n && (62 === t.charCodeAt(i) ? (n = ">", i++) : (n = null, l('">"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null === n && (92 === t.charCodeAt(i) ? (n = "\\", i++) : (n = null, l('"\\\\"')), null === n && null === (n = _()) && (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, l('"/"')), null === n && (91 === t.charCodeAt(i) ? (n = "[", i++) : (n = null, l('"["')), null === n && (93 === t.charCodeAt(i) ? (n = "]", i++) : (n = null, l('"]"')), null === n && (63 === t.charCodeAt(i) ? (n = "?", i++) : (n = null, l('"?"')), null === n && (123 === t.charCodeAt(i) ? (n = "{", i++) : (n = null, l('"{"')), null === n && (125 === t.charCodeAt(i) ? (n = "}", i++) : (n = null, l('"}"')))))))))))))))))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = v()) && (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, l('"-"')), null === n && (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, l('"."')), null === n && (33 === t.charCodeAt(i) ? (n = "!", i++) : (n = null, l('"!"')), null === n && (37 === t.charCodeAt(i) ? (n = "%", i++) : (n = null, l('"%"')), null === n && (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, l('"*"')), null === n && (95 === t.charCodeAt(i) ? (n = "_", i++) : (n = null, l('"_"')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (96 === t.charCodeAt(i) ? (n = "`", i++) : (n = null, l('"`"')), null === n && (39 === t.charCodeAt(i) ? (n = "'", i++) : (n = null, l('"\'"')), null === n && (126 === t.charCodeAt(i) ? (n = "~", i++) : (n = null, l('"~"')), null === n && (40 === t.charCodeAt(i) ? (n = "(", i++) : (n = null, l('"("')), null === n && (41 === t.charCodeAt(i) ? (n = ")", i++) : (n = null, l('")"')), null === n && (60 === t.charCodeAt(i) ? (n = "<", i++) : (n = null, l('"<"')), null === n && (62 === t.charCodeAt(i) ? (n = ">", i++) : (n = null, l('">"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null === n && (92 === t.charCodeAt(i) ? (n = "\\", i++) : (n = null, l('"\\\\"')), null === n && null === (n = _()) && (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, l('"/"')), null === n && (91 === t.charCodeAt(i) ? (n = "[", i++) : (n = null, l('"["')), null === n && (93 === t.charCodeAt(i) ? (n = "]", i++) : (n = null, l('"]"')), null === n && (63 === t.charCodeAt(i) ? (n = "?", i++) : (n = null, l('"?"')), null === n && (123 === t.charCodeAt(i) ? (n = "{", i++) : (n = null, l('"{"')), null === n && (125 === t.charCodeAt(i) ? (n = "}", i++) : (n = null, l('"}"')))))))))))))))))))))))); else e = null; return null !== e && (e = function (e) { return t.substring(i, e) }(r)), null === e && (i = r), e } function D() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (42 === t.charCodeAt(i) ? (n = "*", i++) : (n = null, l('"*"')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "*"), null === e && (i = s), e } function P() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, l('"/"')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "/"), null === e && (i = s), e } function U() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "="), null === e && (i = s), e } function L() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (40 === t.charCodeAt(i) ? (n = "(", i++) : (n = null, l('"("')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = "("), null === e && (i = s), e } function M() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (41 === t.charCodeAt(i) ? (n = ")", i++) : (n = null, l('")"')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ")"), null === e && (i = s), e } function q() { var e, n, r, s; return r = i, s = i, 62 === t.charCodeAt(i) ? (e = ">", i++) : (e = null, l('">"')), null !== e && null !== (n = E()) ? e = [e, n] : (e = null, i = s), null !== e && (e = ">"), null === e && (i = r), e } function H() { var e, n, r, s; return r = i, s = i, null !== (e = E()) ? (60 === t.charCodeAt(i) ? (n = "<", i++) : (n = null, l('"<"')), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== e && (e = "<"), null === e && (i = r), e } function F() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, l('","')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ","), null === e && (i = s), e } function B() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, l('";"')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ";"), null === e && (i = s), e } function j() { var e, n, r, s, o; return s = i, o = i, null !== (e = E()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = E()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = ":"), null === e && (i = s), e } function V() { var e, t, n, r; return n = i, r = i, null !== (e = E()) && null !== (t = _()) ? e = [e, t] : (e = null, i = r), null !== e && (e = '"'), null === e && (i = n), e } function G() { var e, t, n, r; return n = i, r = i, null !== (e = _()) && null !== (t = E()) ? e = [e, t] : (e = null, i = r), null !== e && (e = '"'), null === e && (i = n), e } function W() { var e; return /^[!-']/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[!-']")), null === e && (/^[*-[]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[*-[]")), null === e && (/^[\]-~]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[\\]-~]")), null === e && null === (e = I()) && (e = b()))), e } function z() { var e, n, r, s, o, a; if (o = i, a = i, null !== (e = E())) if (null !== (n = _())) { for (r = [], null === (s = K()) && (s = J()); null !== s;)r.push(s), null === (s = K()) && (s = J()); null !== r && null !== (s = _()) ? e = [e, n, r, s] : (e = null, i = a) } else e = null, i = a; else e = null, i = a; return null !== e && (e = function (e) { return t.substring(i, e) }(o)), null === e && (i = o), e } function $() { var e, n, r, s, o, a; if (o = i, a = i, null !== (e = E())) if (null !== (n = _())) { for (r = [], null === (s = K()) && (s = J()); null !== s;)r.push(s), null === (s = K()) && (s = J()); null !== r && null !== (s = _()) ? e = [e, n, r, s] : (e = null, i = a) } else e = null, i = a; else e = null, i = a; return null !== e && (e = function (e) { return t.substring(i - 1, e + 1) }(o)), null === e && (i = o), e } function K() { var e; return null === (e = b()) && (33 === t.charCodeAt(i) ? (e = "!", i++) : (e = null, l('"!"')), null === e && (/^[#-[]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[#-[]")), null === e && (/^[\]-~]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[\\]-~]")), null === e && (e = I())))), e } function J() { var e, n, r; return r = i, 92 === t.charCodeAt(i) ? (e = "\\", i++) : (e = null, l('"\\\\"')), null !== e ? (/^[\0-\t]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, l("[\\0-\\t]")), null === n && (/^[\x0B-\f]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, l("[\\x0B-\\f]")), null === n && (/^[\x0E-]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, l("[\\x0E-]")))), null !== n ? e = [e, n] : (e = null, i = r)) : (e = null, i = r), e } function Y() { var e, n, r, s, o, a; return o = i, a = i, null !== (e = Q()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = null !== (r = te()) ? r : "") && null !== (s = ie()) ? e = [e, n, r, s] : (e = null, i = a)) : (e = null, i = a), null !== e && (e = function (e) { try { Hn.uri = new Mn(Hn.scheme, Hn.user, Hn.host, Hn.port), delete Hn.scheme, delete Hn.user, delete Hn.host, delete Hn.host_type, delete Hn.port } catch (e) { Hn = -1 } }()), null === e && (i = o), e } function X() { var e, n, s, o, a, u, c, h; return c = i, h = i, null !== (e = Q()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (s = null !== (s = te()) ? s : "") && null !== (o = ie()) && null !== (a = ge()) && null !== (u = null !== (u = xe()) ? u : "") ? e = [e, n, s, o, a, u] : (e = null, i = h)) : (e = null, i = h), null !== e && (e = function (e) { try { Hn.uri = new Mn(Hn.scheme, Hn.user, Hn.host, Hn.port, Hn.uri_params, Hn.uri_headers), delete Hn.scheme, delete Hn.user, delete Hn.host, delete Hn.host_type, delete Hn.port, delete Hn.uri_params, "SIP_URI" === r && (Hn = Hn.uri) } catch (e) { Hn = -1 } }()), null === e && (i = c), e } function Q() { var e; return null === (e = Z()) && (e = ee()), e } function Z() { var e, n, r; return n = i, "sips" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, l('"sips"')), null !== e && (r = e, e = void (Hn.scheme = r.toLowerCase())), null === e && (i = n), e } function ee() { var e, n, r; return n = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"sip"')), null !== e && (r = e, e = void (Hn.scheme = r.toLowerCase())), null === e && (i = n), e } function te() { var e, n, r, s, o, a; return s = i, o = i, null !== (e = ne()) ? (a = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = se()) ? n = [n, r] : (n = null, i = a), null !== (n = null !== n ? n : "") ? (64 === t.charCodeAt(i) ? (r = "@", i++) : (r = null, l('"@"')), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { Hn.user = decodeURIComponent(t.substring(i - 1, e)) }(s)), null === e && (i = s), e } function ne() { var e, t; if (null === (t = C()) && null === (t = S()) && (t = re()), null !== t) for (e = []; null !== t;)e.push(t), null === (t = C()) && null === (t = S()) && (t = re()); else e = null; return e } function re() { var e; return 38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, l('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, l('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, l('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, l('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, l('","')), null === e && (59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, l('";"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, l('"?"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, l('"/"'))))))))), e } function se() { var e, n, r; for (r = i, e = [], null === (n = C()) && null === (n = S()) && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, l('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, l('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, l('","'))))))); null !== n;)e.push(n), null === (n = C()) && null === (n = S()) && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, l('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')), null === n && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, l('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, l('","'))))))); return null !== e && (e = function (e) { Hn.password = t.substring(i, e) }(r)), null === e && (i = r), e } function ie() { var e, n, r, s, o; return s = i, null !== (e = oe()) ? (o = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = me()) ? n = [n, r] : (n = null, i = o), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), e } function oe() { var e, n; return n = i, null === (e = ae()) && null === (e = pe()) && (e = ce()), null !== e && (e = function (e) { return Hn.host = t.substring(i, e).toLowerCase(), Hn.host }(n)), null === e && (i = n), e } function ae() { var e, n, r, s, o, a; for (s = i, o = i, e = [], a = i, null !== (n = le()) ? (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, l('"."')), null !== r ? n = [n, r] : (n = null, i = a)) : (n = null, i = a); null !== n;)e.push(n), a = i, null !== (n = le()) ? (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, l('"."')), null !== r ? n = [n, r] : (n = null, i = a)) : (n = null, i = a); return null !== e && null !== (n = ue()) ? (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, l('"."')), null !== (r = null !== r ? r : "") ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { return Hn.host_type = "domain", t.substring(i, e) }(s)), null === e && (i = s), e } function le() { var e, n, r, s; if (s = i, null !== (e = v())) { for (n = [], null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, l('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, l('"_"')))); null !== r;)n.push(r), null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, l('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, l('"_"')))); null !== n ? e = [e, n] : (e = null, i = s) } else e = null, i = s; return e } function ue() { var e, n, r, s; if (s = i, null !== (e = h())) { for (n = [], null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, l('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, l('"_"')))); null !== r;)n.push(r), null === (r = v()) && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, l('"-"')), null === r && (95 === t.charCodeAt(i) ? (r = "_", i++) : (r = null, l('"_"')))); null !== n ? e = [e, n] : (e = null, i = s) } else e = null, i = s; return e } function ce() { var e, n, r, s, o; return s = i, o = i, 91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, l('"["')), null !== e && null !== (n = he()) ? (93 === t.charCodeAt(i) ? (r = "]", i++) : (r = null, l('"]"')), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { return Hn.host_type = "IPv6", t.substring(i, e) }(s)), null === e && (i = s), e } function he() { var e, n, r, s, o, a, u, c, h, d, f, p, _, m, g, v; return m = i, g = i, null !== (e = de()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? (58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, l('":"')), null !== s && null !== (o = de()) ? (58 === t.charCodeAt(i) ? (a = ":", i++) : (a = null, l('":"')), null !== a && null !== (u = de()) ? (58 === t.charCodeAt(i) ? (c = ":", i++) : (c = null, l('":"')), null !== c && null !== (h = de()) ? (58 === t.charCodeAt(i) ? (d = ":", i++) : (d = null, l('":"')), null !== d && null !== (f = de()) ? (58 === t.charCodeAt(i) ? (p = ":", i++) : (p = null, l('":"')), null !== p && null !== (_ = fe()) ? e = [e, n, r, s, o, a, u, c, h, d, f, p, _] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, l('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, l('":"')), null !== u && null !== (c = de()) ? (58 === t.charCodeAt(i) ? (h = ":", i++) : (h = null, l('":"')), null !== h && null !== (d = de()) ? (58 === t.charCodeAt(i) ? (f = ":", i++) : (f = null, l('":"')), null !== f && null !== (p = fe()) ? e = [e, n, r, s, o, a, u, c, h, d, f, p] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, l('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, l('":"')), null !== u && null !== (c = de()) ? (58 === t.charCodeAt(i) ? (h = ":", i++) : (h = null, l('":"')), null !== h && null !== (d = fe()) ? e = [e, n, r, s, o, a, u, c, h, d] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, l('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, l('":"')), null !== u && null !== (c = fe()) ? e = [e, n, r, s, o, a, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, l('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = fe()) ? e = [e, n, r, s, o, a] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, l('"::"')), null !== e && null !== (n = de()) ? (58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = fe()) ? e = [e, n, r, s] : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, l('"::"')), null !== e && null !== (n = fe()) ? e = [e, n] : (e = null, i = g), null === e && (g = i, "::" === t.substr(i, 2) ? (e = "::", i += 2) : (e = null, l('"::"')), null !== e && null !== (n = de()) ? e = [e, n] : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? ("::" === t.substr(i, 2) ? (n = "::", i += 2) : (n = null, l('"::"')), null !== n && null !== (r = de()) ? (58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, l('":"')), null !== s && null !== (o = de()) ? (58 === t.charCodeAt(i) ? (a = ":", i++) : (a = null, l('":"')), null !== a && null !== (u = de()) ? (58 === t.charCodeAt(i) ? (c = ":", i++) : (c = null, l('":"')), null !== c && null !== (h = de()) ? (58 === t.charCodeAt(i) ? (d = ":", i++) : (d = null, l('":"')), null !== d && null !== (f = fe()) ? e = [e, n, r, s, o, a, u, c, h, d, f] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? ("::" === t.substr(i, 2) ? (r = "::", i += 2) : (r = null, l('"::"')), null !== r && null !== (s = de()) ? (58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, l('":"')), null !== u && null !== (c = de()) ? (58 === t.charCodeAt(i) ? (h = ":", i++) : (h = null, l('":"')), null !== h && null !== (d = fe()) ? e = [e, n, r, s, o, a, u, c, h, d] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? ("::" === t.substr(i, 2) ? (s = "::", i += 2) : (s = null, l('"::"')), null !== s && null !== (o = de()) ? (58 === t.charCodeAt(i) ? (a = ":", i++) : (a = null, l('":"')), null !== a && null !== (u = de()) ? (58 === t.charCodeAt(i) ? (c = ":", i++) : (c = null, l('":"')), null !== c && null !== (h = fe()) ? e = [e, n, r, s, o, a, u, c, h] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, l('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? ("::" === t.substr(i, 2) ? (o = "::", i += 2) : (o = null, l('"::"')), null !== o && null !== (a = de()) ? (58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, l('":"')), null !== u && null !== (c = fe()) ? e = [e, n, r, s, o, a, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, l('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? (v = i, 58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = de()) ? o = [o, a] : (o = null, i = v), null !== (o = null !== o ? o : "") ? ("::" === t.substr(i, 2) ? (a = "::", i += 2) : (a = null, l('"::"')), null !== a && null !== (u = fe()) ? e = [e, n, r, s, o, a, u] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, l('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? (v = i, 58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = de()) ? o = [o, a] : (o = null, i = v), null !== (o = null !== o ? o : "") ? (v = i, 58 === t.charCodeAt(i) ? (a = ":", i++) : (a = null, l('":"')), null !== a && null !== (u = de()) ? a = [a, u] : (a = null, i = v), null !== (a = null !== a ? a : "") ? ("::" === t.substr(i, 2) ? (u = "::", i += 2) : (u = null, l('"::"')), null !== u && null !== (c = de()) ? e = [e, n, r, s, o, a, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g), null === e && (g = i, null !== (e = de()) ? (v = i, 58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? n = [n, r] : (n = null, i = v), null !== (n = null !== n ? n : "") ? (v = i, 58 === t.charCodeAt(i) ? (r = ":", i++) : (r = null, l('":"')), null !== r && null !== (s = de()) ? r = [r, s] : (r = null, i = v), null !== (r = null !== r ? r : "") ? (v = i, 58 === t.charCodeAt(i) ? (s = ":", i++) : (s = null, l('":"')), null !== s && null !== (o = de()) ? s = [s, o] : (s = null, i = v), null !== (s = null !== s ? s : "") ? (v = i, 58 === t.charCodeAt(i) ? (o = ":", i++) : (o = null, l('":"')), null !== o && null !== (a = de()) ? o = [o, a] : (o = null, i = v), null !== (o = null !== o ? o : "") ? (v = i, 58 === t.charCodeAt(i) ? (a = ":", i++) : (a = null, l('":"')), null !== a && null !== (u = de()) ? a = [a, u] : (a = null, i = v), null !== (a = null !== a ? a : "") ? (v = i, 58 === t.charCodeAt(i) ? (u = ":", i++) : (u = null, l('":"')), null !== u && null !== (c = de()) ? u = [u, c] : (u = null, i = v), null !== (u = null !== u ? u : "") ? ("::" === t.substr(i, 2) ? (c = "::", i += 2) : (c = null, l('"::"')), null !== c ? e = [e, n, r, s, o, a, u, c] : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g)) : (e = null, i = g))))))))))))))), null !== e && (e = function (e) { return Hn.host_type = "IPv6", t.substring(i, e) }(m)), null === e && (i = m), e } function de() { var e, t, n, r, s; return s = i, null !== (e = d()) && null !== (t = null !== (t = d()) ? t : "") && null !== (n = null !== (n = d()) ? n : "") && null !== (r = null !== (r = d()) ? r : "") ? e = [e, t, n, r] : (e = null, i = s), e } function fe() { var e, n, r, s; return s = i, null !== (e = de()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n && null !== (r = de()) ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), null === e && (e = pe()), e } function pe() { var e, n, r, s, o, a, u, c, h; return c = i, h = i, null !== (e = _e()) ? (46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, l('"."')), null !== n && null !== (r = _e()) ? (46 === t.charCodeAt(i) ? (s = ".", i++) : (s = null, l('"."')), null !== s && null !== (o = _e()) ? (46 === t.charCodeAt(i) ? (a = ".", i++) : (a = null, l('"."')), null !== a && null !== (u = _e()) ? e = [e, n, r, s, o, a, u] : (e = null, i = h)) : (e = null, i = h)) : (e = null, i = h)) : (e = null, i = h), null !== e && (e = function (e) { return Hn.host_type = "IPv4", t.substring(i, e) }(c)), null === e && (i = c), e } function _e() { var e, n, r, s; return s = i, "25" === t.substr(i, 2) ? (e = "25", i += 2) : (e = null, l('"25"')), null !== e ? (/^[0-5]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, l("[0-5]")), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null === e && (s = i, 50 === t.charCodeAt(i) ? (e = "2", i++) : (e = null, l('"2"')), null !== e ? (/^[0-4]/.test(t.charAt(i)) ? (n = t.charAt(i), i++) : (n = null, l("[0-4]")), null !== n && null !== (r = c()) ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), null === e && (s = i, 49 === t.charCodeAt(i) ? (e = "1", i++) : (e = null, l('"1"')), null !== e && null !== (n = c()) && null !== (r = c()) ? e = [e, n, r] : (e = null, i = s), null === e && (s = i, /^[1-9]/.test(t.charAt(i)) ? (e = t.charAt(i), i++) : (e = null, l("[1-9]")), null !== e && null !== (n = c()) ? e = [e, n] : (e = null, i = s), null === e && (e = c())))), e } function me() { var e, t, n, r, s, o, a, l; return o = i, a = i, null !== (e = null !== (e = c()) ? e : "") && null !== (t = null !== (t = c()) ? t : "") && null !== (n = null !== (n = c()) ? n : "") && null !== (r = null !== (r = c()) ? r : "") && null !== (s = null !== (s = c()) ? s : "") ? e = [e, t, n, r, s] : (e = null, i = a), null !== e && (l = e, l = parseInt(l.join("")), Hn.port = l, e = l), null === e && (i = o), e } function ge() { var e, n, r, s; for (e = [], s = i, 59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, l('";"')), null !== n && null !== (r = ve()) ? n = [n, r] : (n = null, i = s); null !== n;)e.push(n), s = i, 59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, l('";"')), null !== n && null !== (r = ve()) ? n = [n, r] : (n = null, i = s); return e } function ve() { var e; return null === (e = ye()) && null === (e = Ce()) && null === (e = Te()) && null === (e = Se()) && null === (e = be()) && null === (e = Ee()) && (e = Ae()), e } function ye() { var e, n, r, s, o; return r = i, s = i, "transport=" === t.substr(i, 10).toLowerCase() ? (e = t.substr(i, 10), i += 10) : (e = null, l('"transport="')), null !== e ? ("udp" === t.substr(i, 3).toLowerCase() ? (n = t.substr(i, 3), i += 3) : (n = null, l('"udp"')), null === n && ("tcp" === t.substr(i, 3).toLowerCase() ? (n = t.substr(i, 3), i += 3) : (n = null, l('"tcp"')), null === n && ("sctp" === t.substr(i, 4).toLowerCase() ? (n = t.substr(i, 4), i += 4) : (n = null, l('"sctp"')), null === n && ("tls" === t.substr(i, 3).toLowerCase() ? (n = t.substr(i, 3), i += 3) : (n = null, l('"tls"')), null === n && (n = x())))), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.transport = o.toLowerCase())), null === e && (i = r), e } function Ce() { var e, n, r, s, o; return r = i, s = i, "user=" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"user="')), null !== e ? ("phone" === t.substr(i, 5).toLowerCase() ? (n = t.substr(i, 5), i += 5) : (n = null, l('"phone"')), null === n && ("ip" === t.substr(i, 2).toLowerCase() ? (n = t.substr(i, 2), i += 2) : (n = null, l('"ip"')), null === n && (n = x())), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.user = o.toLowerCase())), null === e && (i = r), e } function Te() { var e, n, r, s, o; return r = i, s = i, "method=" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, l('"method="')), null !== e && null !== (n = ut()) ? e = [e, n] : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.method = o)), null === e && (i = r), e } function Se() { var e, n, r, s, o; return r = i, s = i, "ttl=" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, l('"ttl="')), null !== e && null !== (n = bn()) ? e = [e, n] : (e = null, i = s), null !== e && (o = e[1], Hn.params || (Hn.params = {}), e = void (Hn.params.ttl = o)), null === e && (i = r), e } function be() { var e, n, r, s, o; return r = i, s = i, "maddr=" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"maddr="')), null !== e && null !== (n = oe()) ? e = [e, n] : (e = null, i = s), null !== e && (o = e[1], Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.maddr = o)), null === e && (i = r), e } function Ee() { var e, n, r, s, o, a; return s = i, o = i, "lr" === t.substr(i, 2).toLowerCase() ? (e = t.substr(i, 2), i += 2) : (e = null, l('"lr"')), null !== e ? (a = i, 61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null !== n && null !== (r = x()) ? n = [n, r] : (n = null, i = a), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o), null !== e && (Hn.uri_params || (Hn.uri_params = {}), e = void (Hn.uri_params.lr = void 0)), null === e && (i = s), e } function Ae() { var e, n, r, s, o, a, u, c; return s = i, o = i, null !== (e = we()) ? (a = i, 61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null !== n && null !== (r = Re()) ? n = [n, r] : (n = null, i = a), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o), null !== e && (u = e[0], c = e[1], Hn.uri_params || (Hn.uri_params = {}), c = void 0 === c ? void 0 : c[1], e = void (Hn.uri_params[u.toLowerCase()] = c)), null === e && (i = s), e } function we() { var e, t, n; if (n = i, null !== (t = Ie())) for (e = []; null !== t;)e.push(t), t = Ie(); else e = null; return null !== e && (e = e.join("")), null === e && (i = n), e } function Re() { var e, t, n; if (n = i, null !== (t = Ie())) for (e = []; null !== t;)e.push(t), t = Ie(); else e = null; return null !== e && (e = e.join("")), null === e && (i = n), e } function Ie() { var e; return null === (e = ke()) && null === (e = C()) && (e = S()), e } function ke() { var e; return 91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, l('"["')), null === e && (93 === t.charCodeAt(i) ? (e = "]", i++) : (e = null, l('"]"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, l('"/"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, l('":"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, l('"&"')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, l('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, l('"$"')))))))), e } function xe() { var e, n, r, s, o, a, u; if (a = i, 63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, l('"?"')), null !== e) if (null !== (n = Oe())) { for (r = [], u = i, 38 === t.charCodeAt(i) ? (s = "&", i++) : (s = null, l('"&"')), null !== s && null !== (o = Oe()) ? s = [s, o] : (s = null, i = u); null !== s;)r.push(s), u = i, 38 === t.charCodeAt(i) ? (s = "&", i++) : (s = null, l('"&"')), null !== s && null !== (o = Oe()) ? s = [s, o] : (s = null, i = u); null !== r ? e = [e, n, r] : (e = null, i = a) } else e = null, i = a; else e = null, i = a; return e } function Oe() { var e, n, r, s, o, a, u; return s = i, o = i, null !== (e = Ne()) ? (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null !== n && null !== (r = De()) ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (a = e[0], u = e[2], a = a.join("").toLowerCase(), u = u.join(""), Hn.uri_headers || (Hn.uri_headers = {}), e = void (Hn.uri_headers[a] ? Hn.uri_headers[a].push(u) : Hn.uri_headers[a] = [u])), null === e && (i = s), e } function Ne() { var e, t; if (null === (t = Pe()) && null === (t = C()) && (t = S()), null !== t) for (e = []; null !== t;)e.push(t), null === (t = Pe()) && null === (t = C()) && (t = S()); else e = null; return e } function De() { var e, t; for (e = [], null === (t = Pe()) && null === (t = C()) && (t = S()); null !== t;)e.push(t), null === (t = Pe()) && null === (t = C()) && (t = S()); return e } function Pe() { var e; return 91 === t.charCodeAt(i) ? (e = "[", i++) : (e = null, l('"["')), null === e && (93 === t.charCodeAt(i) ? (e = "]", i++) : (e = null, l('"]"')), null === e && (47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, l('"/"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, l('"?"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, l('":"')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, l('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, l('"$"')))))))), e } function Ue() { var e, t, n, r, s, o; return o = i, null !== (e = ut()) && null !== (t = m()) && null !== (n = Le()) && null !== (r = m()) && null !== (s = Ze()) ? e = [e, t, n, r, s] : (e = null, i = o), e } function Le() { var e; return null === (e = X()) && (e = Me()), e } function Me() { var e, n, r, s; return s = i, null !== (e = Ke()) ? (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null !== n ? (null === (r = qe()) && (r = Be()), null !== r ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s)) : (e = null, i = s), e } function qe() { var e, n, r, s, o; return s = i, null === (e = He()) && (e = Fe()), null !== e ? (o = i, 63 === t.charCodeAt(i) ? (n = "?", i++) : (n = null, l('"?"')), null !== n && null !== (r = Qe()) ? n = [n, r] : (n = null, i = o), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), e } function He() { var e, n, r, s; return s = i, "//" === t.substr(i, 2) ? (e = "//", i += 2) : (e = null, l('"//"')), null !== e && null !== (n = Je()) && null !== (r = null !== (r = Fe()) ? r : "") ? e = [e, n, r] : (e = null, i = s), e } function Fe() { var e, n, r; return r = i, 47 === t.charCodeAt(i) ? (e = "/", i++) : (e = null, l('"/"')), null !== e && null !== (n = Ge()) ? e = [e, n] : (e = null, i = r), e } function Be() { var e, t, n, r; if (r = i, null !== (e = Ve())) { for (t = [], n = je(); null !== n;)t.push(n), n = je(); null !== t ? e = [e, t] : (e = null, i = r) } else e = null, i = r; return e } function je() { var e; return null === (e = y()) && null === (e = C()) && (e = S()), e } function Ve() { var e; return null === (e = C()) && null === (e = S()) && (59 === t.charCodeAt(i) ? (e = ";", i++) : (e = null, l('";"')), null === e && (63 === t.charCodeAt(i) ? (e = "?", i++) : (e = null, l('"?"')), null === e && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, l('":"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, l('"@"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, l('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, l('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, l('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, l('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, l('","'))))))))))), e } function Ge() { var e, n, r, s, o, a; if (o = i, null !== (e = We())) { for (n = [], a = i, 47 === t.charCodeAt(i) ? (r = "/", i++) : (r = null, l('"/"')), null !== r && null !== (s = We()) ? r = [r, s] : (r = null, i = a); null !== r;)n.push(r), a = i, 47 === t.charCodeAt(i) ? (r = "/", i++) : (r = null, l('"/"')), null !== r && null !== (s = We()) ? r = [r, s] : (r = null, i = a); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return e } function We() { var e, n, r, s, o, a; for (o = i, e = [], n = $e(); null !== n;)e.push(n), n = $e(); if (null !== e) { for (n = [], a = i, 59 === t.charCodeAt(i) ? (r = ";", i++) : (r = null, l('";"')), null !== r && null !== (s = ze()) ? r = [r, s] : (r = null, i = a); null !== r;)n.push(r), a = i, 59 === t.charCodeAt(i) ? (r = ";", i++) : (r = null, l('";"')), null !== r && null !== (s = ze()) ? r = [r, s] : (r = null, i = a); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return e } function ze() { var e, t; for (e = [], t = $e(); null !== t;)e.push(t), t = $e(); return e } function $e() { var e; return null === (e = C()) && null === (e = S()) && (58 === t.charCodeAt(i) ? (e = ":", i++) : (e = null, l('":"')), null === e && (64 === t.charCodeAt(i) ? (e = "@", i++) : (e = null, l('"@"')), null === e && (38 === t.charCodeAt(i) ? (e = "&", i++) : (e = null, l('"&"')), null === e && (61 === t.charCodeAt(i) ? (e = "=", i++) : (e = null, l('"="')), null === e && (43 === t.charCodeAt(i) ? (e = "+", i++) : (e = null, l('"+"')), null === e && (36 === t.charCodeAt(i) ? (e = "$", i++) : (e = null, l('"$"')), null === e && (44 === t.charCodeAt(i) ? (e = ",", i++) : (e = null, l('","'))))))))), e } function Ke() { var e, n, r, s, o; if (s = i, o = i, null !== (e = h())) { for (n = [], null === (r = h()) && null === (r = c()) && (43 === t.charCodeAt(i) ? (r = "+", i++) : (r = null, l('"+"')), null === r && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, l('"-"')), null === r && (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, l('"."'))))); null !== r;)n.push(r), null === (r = h()) && null === (r = c()) && (43 === t.charCodeAt(i) ? (r = "+", i++) : (r = null, l('"+"')), null === r && (45 === t.charCodeAt(i) ? (r = "-", i++) : (r = null, l('"-"')), null === r && (46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, l('"."'))))); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return null !== e && (e = function (e) { Hn.scheme = t.substring(i, e) }(s)), null === e && (i = s), e } function Je() { var e; return null === (e = Ye()) && (e = Xe()), e } function Ye() { var e, n, r, s; return r = i, s = i, null !== (e = te()) ? (64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, l('"@"')), null !== n ? e = [e, n] : (e = null, i = s)) : (e = null, i = s), null !== (e = null !== e ? e : "") && null !== (n = ie()) ? e = [e, n] : (e = null, i = r), e = null !== e ? e : "" } function Xe() { var e, n; if (null === (n = C()) && null === (n = S()) && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, l('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, l('","')), null === n && (59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, l('";"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null === n && (64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, l('"@"')), null === n && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, l('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')))))))))), null !== n) for (e = []; null !== n;)e.push(n), null === (n = C()) && null === (n = S()) && (36 === t.charCodeAt(i) ? (n = "$", i++) : (n = null, l('"$"')), null === n && (44 === t.charCodeAt(i) ? (n = ",", i++) : (n = null, l('","')), null === n && (59 === t.charCodeAt(i) ? (n = ";", i++) : (n = null, l('";"')), null === n && (58 === t.charCodeAt(i) ? (n = ":", i++) : (n = null, l('":"')), null === n && (64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, l('"@"')), null === n && (38 === t.charCodeAt(i) ? (n = "&", i++) : (n = null, l('"&"')), null === n && (61 === t.charCodeAt(i) ? (n = "=", i++) : (n = null, l('"="')), null === n && (43 === t.charCodeAt(i) ? (n = "+", i++) : (n = null, l('"+"')))))))))); else e = null; return e } function Qe() { var e, t; for (e = [], t = je(); null !== t;)e.push(t), t = je(); return e } function Ze() { var e, n, r, s, o, a, u, h; if (u = i, h = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"SIP"')), null !== e) if (47 === t.charCodeAt(i) ? (n = "/", i++) : (n = null, l('"/"')), null !== n) { if (null !== (s = c())) for (r = []; null !== s;)r.push(s), s = c(); else r = null; if (null !== r) if (46 === t.charCodeAt(i) ? (s = ".", i++) : (s = null, l('"."')), null !== s) { if (null !== (a = c())) for (o = []; null !== a;)o.push(a), a = c(); else o = null; null !== o ? e = [e, n, r, s, o] : (e = null, i = h) } else e = null, i = h; else e = null, i = h } else e = null, i = h; else e = null, i = h; return null !== e && (e = function (e) { Hn.sip_version = t.substring(i, e) }(u)), null === e && (i = u), e } function et() { var e; return "INVITE" === t.substr(i, 6) ? (e = "INVITE", i += 6) : (e = null, l('"INVITE"')), e } function tt() { var e; return "ACK" === t.substr(i, 3) ? (e = "ACK", i += 3) : (e = null, l('"ACK"')), e } function nt() { var e; return "OPTIONS" === t.substr(i, 7) ? (e = "OPTIONS", i += 7) : (e = null, l('"OPTIONS"')), e } function rt() { var e; return "BYE" === t.substr(i, 3) ? (e = "BYE", i += 3) : (e = null, l('"BYE"')), e } function st() { var e; return "CANCEL" === t.substr(i, 6) ? (e = "CANCEL", i += 6) : (e = null, l('"CANCEL"')), e } function it() { var e; return "REGISTER" === t.substr(i, 8) ? (e = "REGISTER", i += 8) : (e = null, l('"REGISTER"')), e } function ot() { var e; return "SUBSCRIBE" === t.substr(i, 9) ? (e = "SUBSCRIBE", i += 9) : (e = null, l('"SUBSCRIBE"')), e } function at() { var e; return "NOTIFY" === t.substr(i, 6) ? (e = "NOTIFY", i += 6) : (e = null, l('"NOTIFY"')), e } function lt() { var e; return "REFER" === t.substr(i, 5) ? (e = "REFER", i += 5) : (e = null, l('"REFER"')), e } function ut() { var e, n; return n = i, null === (e = et()) && null === (e = tt()) && null === (e = nt()) && null === (e = rt()) && null === (e = st()) && null === (e = it()) && null === (e = ot()) && null === (e = at()) && null === (e = lt()) && (e = x()), null !== e && (e = function (e) { return Hn.method = t.substring(i, e), Hn.method }(n)), null === e && (i = n), e } function ct() { var e, t, n, r, s, o; return o = i, null !== (e = Ze()) && null !== (t = m()) && null !== (n = ht()) && null !== (r = m()) && null !== (s = ft()) ? e = [e, t, n, r, s] : (e = null, i = o), e } function ht() { var e, t, n; return t = i, null !== (e = dt()) && (n = e, e = void (Hn.status_code = parseInt(n.join("")))), null === e && (i = t), e } function dt() { var e, t, n, r; return r = i, null !== (e = c()) && null !== (t = c()) && null !== (n = c()) ? e = [e, t, n] : (e = null, i = r), e } function ft() { var e, n, r; for (r = i, e = [], null === (n = y()) && null === (n = C()) && null === (n = S()) && null === (n = I()) && null === (n = k()) && null === (n = m()) && (n = g()); null !== n;)e.push(n), null === (n = y()) && null === (n = C()) && null === (n = S()) && null === (n = I()) && null === (n = k()) && null === (n = m()) && (n = g()); return null !== e && (e = function (e) { Hn.reason_phrase = t.substring(i, e) }(r)), null === e && (i = r), e } function pt() { var e, t, n, r, s, o, a; if (s = i, o = i, null === (e = Y()) && (e = _t()), null !== e) { for (t = [], a = i, null !== (n = B()) && null !== (r = gt()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = B()) && null !== (r = gt()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; return null !== e && (e = function (e) { var t; Hn.multi_header || (Hn.multi_header = []); try { t = new qn(Hn.uri, Hn.display_name, Hn.params), delete Hn.uri, delete Hn.display_name, delete Hn.params } catch (e) { t = null } Hn.multi_header.push({ possition: i, offset: e, parsed: t }) }(s)), null === e && (i = s), e } function _t() { var e, t, n, r, s; return s = i, null !== (e = null !== (e = mt()) ? e : "") && null !== (t = H()) && null !== (n = X()) && null !== (r = q()) ? e = [e, t, n, r] : (e = null, i = s), e } function mt() { var e, n, r, s, o, a, l; if (o = i, a = i, null !== (e = x())) { for (n = [], l = i, null !== (r = b()) && null !== (s = x()) ? r = [r, s] : (r = null, i = l); null !== r;)n.push(r), l = i, null !== (r = b()) && null !== (s = x()) ? r = [r, s] : (r = null, i = l); null !== n ? e = [e, n] : (e = null, i = a) } else e = null, i = a; return null === e && (e = z()), null !== e && (e = function (e, n) { '"' === (n = t.substring(i, e).trim())[0] && (n = n.substring(1, n.length - 1)), Hn.display_name = n }(o, e)), null === e && (i = o), e } function gt() { var e; return null === (e = vt()) && null === (e = yt()) && (e = St()), e } function vt() { var e, n, r, s, o, a; return s = i, o = i, "q" === t.substr(i, 1).toLowerCase() ? (e = t.substr(i, 1), i++) : (e = null, l('"q"')), null !== e && null !== (n = U()) && null !== (r = Tt()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], Hn.params || (Hn.params = {}), e = void (Hn.params.q = a)), null === e && (i = s), e } function yt() { var e, n, r, s, o, a; return s = i, o = i, "expires" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, l('"expires"')), null !== e && null !== (n = U()) && null !== (r = Ct()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], Hn.params || (Hn.params = {}), e = void (Hn.params.expires = a)), null === e && (i = s), e } function Ct() { var e, t, n; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; return null !== e && (e = parseInt(e.join(""))), null === e && (i = n), e } function Tt() { var e, n, r, s, o, a, u, h; return a = i, u = i, 48 === t.charCodeAt(i) ? (e = "0", i++) : (e = null, l('"0"')), null !== e ? (h = i, 46 === t.charCodeAt(i) ? (n = ".", i++) : (n = null, l('"."')), null !== n && null !== (r = null !== (r = c()) ? r : "") && null !== (s = null !== (s = c()) ? s : "") && null !== (o = null !== (o = c()) ? o : "") ? n = [n, r, s, o] : (n = null, i = h), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = u)) : (e = null, i = u), null !== e && (e = function (e) { return parseFloat(t.substring(i, e)) }(a)), null === e && (i = a), e } function St() { var e, t, n, r, s, o, a, l; return r = i, s = i, null !== (e = x()) ? (o = i, null !== (t = U()) && null !== (n = bt()) ? t = [t, n] : (t = null, i = o), null !== (t = null !== t ? t : "") ? e = [e, t] : (e = null, i = s)) : (e = null, i = s), null !== e && (a = e[0], l = e[1], Hn.params || (Hn.params = {}), l = void 0 === l ? void 0 : l[1], e = void (Hn.params[a.toLowerCase()] = l)), null === e && (i = r), e } function bt() { var e; return null === (e = x()) && null === (e = oe()) && (e = z()), e } function Et() { var e; return "render" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"render"')), null === e && ("session" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, l('"session"')), null === e && ("icon" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, l('"icon"')), null === e && ("alert" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"alert"')), null === e && (e = x())))), e } function At() { var e; return null === (e = wt()) && (e = St()), e } function wt() { var e, n, r, s; return s = i, "handling" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, l('"handling"')), null !== e && null !== (n = U()) ? ("optional" === t.substr(i, 8).toLowerCase() ? (r = t.substr(i, 8), i += 8) : (r = null, l('"optional"')), null === r && ("required" === t.substr(i, 8).toLowerCase() ? (r = t.substr(i, 8), i += 8) : (r = null, l('"required"')), null === r && (r = x())), null !== r ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), e } function Rt() { var e, t, n, r, s, o, a, l; if (a = i, null !== (e = It())) if (null !== (t = P())) if (null !== (n = Dt())) { for (r = [], l = i, null !== (s = B()) && null !== (o = Pt()) ? s = [s, o] : (s = null, i = l); null !== s;)r.push(s), l = i, null !== (s = B()) && null !== (o = Pt()) ? s = [s, o] : (s = null, i = l); null !== r ? e = [e, t, n, r] : (e = null, i = a) } else e = null, i = a; else e = null, i = a; else e = null, i = a; return e } function It() { var e; return null === (e = kt()) && (e = xt()), e } function kt() { var e; return "text" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, l('"text"')), null === e && ("image" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"image"')), null === e && ("audio" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"audio"')), null === e && ("video" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"video"')), null === e && ("application" === t.substr(i, 11).toLowerCase() ? (e = t.substr(i, 11), i += 11) : (e = null, l('"application"')), null === e && (e = Ot()))))), e } function xt() { var e; return "message" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, l('"message"')), null === e && ("multipart" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, l('"multipart"')), null === e && (e = Ot())), e } function Ot() { var e; return null === (e = x()) && (e = Nt()), e } function Nt() { var e, n, r; return r = i, "x-" === t.substr(i, 2).toLowerCase() ? (e = t.substr(i, 2), i += 2) : (e = null, l('"x-"')), null !== e && null !== (n = x()) ? e = [e, n] : (e = null, i = r), e } function Dt() { var e; return null === (e = Ot()) && (e = x()), e } function Pt() { var e, t, n, r; return r = i, null !== (e = x()) && null !== (t = U()) && null !== (n = Ut()) ? e = [e, t, n] : (e = null, i = r), e } function Ut() { var e; return null === (e = x()) && (e = z()), e } function Lt() { var e, t, n, r; if (n = i, null !== (t = c())) for (e = []; null !== t;)e.push(t), t = c(); else e = null; return null !== e && (r = e, e = void (Hn.value = parseInt(r.join("")))), null === e && (i = n), e } function Mt() { var e, n, r, s, o, a; if (o = i, null !== (e = O())) { for (n = [], a = i, 46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, l('"."')), null !== r && null !== (s = O()) ? r = [r, s] : (r = null, i = a); null !== r;)n.push(r), a = i, 46 === t.charCodeAt(i) ? (r = ".", i++) : (r = null, l('"."')), null !== r && null !== (s = O()) ? r = [r, s] : (r = null, i = a); null !== n ? e = [e, n] : (e = null, i = o) } else e = null, i = o; return e } function qt() { var e; return null === (e = Ht()) && (e = St()), e } function Ht() { var e, n, r, s, o, a; return s = i, o = i, "tag" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"tag"')), null !== e && null !== (n = U()) && null !== (r = x()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.tag = a)), null === e && (i = s), e } function Ft() { var e, n, r, s, o, a, u, c; if (u = i, "digest" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"Digest"')), null !== e) if (null !== (n = b())) if (null !== (r = Vt())) { for (s = [], c = i, null !== (o = F()) && null !== (a = Vt()) ? o = [o, a] : (o = null, i = c); null !== o;)s.push(o), c = i, null !== (o = F()) && null !== (a = Vt()) ? o = [o, a] : (o = null, i = c); null !== s ? e = [e, n, r, s] : (e = null, i = u) } else e = null, i = u; else e = null, i = u; else e = null, i = u; return null === e && (e = Bt()), e } function Bt() { var e, t, n, r, s, o, a, l; if (a = i, null !== (e = x())) if (null !== (t = b())) if (null !== (n = jt())) { for (r = [], l = i, null !== (s = F()) && null !== (o = jt()) ? s = [s, o] : (s = null, i = l); null !== s;)r.push(s), l = i, null !== (s = F()) && null !== (o = jt()) ? s = [s, o] : (s = null, i = l); null !== r ? e = [e, t, n, r] : (e = null, i = a) } else e = null, i = a; else e = null, i = a; else e = null, i = a; return e } function jt() { var e, t, n, r; return r = i, null !== (e = x()) && null !== (t = U()) ? (null === (n = x()) && (n = z()), null !== n ? e = [e, t, n] : (e = null, i = r)) : (e = null, i = r), e } function Vt() { var e; return null === (e = Gt()) && null === (e = zt()) && null === (e = Kt()) && null === (e = Yt()) && null === (e = Xt()) && null === (e = Qt()) && null === (e = Zt()) && (e = jt()), e } function Gt() { var e, n, r, s; return s = i, "realm" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"realm"')), null !== e && null !== (n = U()) && null !== (r = Wt()) ? e = [e, n, r] : (e = null, i = s), e } function Wt() { var e, t, n; return t = i, null !== (e = $()) && (n = e, e = void (Hn.realm = n)), null === e && (i = t), e } function zt() { var e, n, r, s, o, a, u, c, h; if (c = i, "domain" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"domain"')), null !== e) if (null !== (n = U())) if (null !== (r = V())) if (null !== (s = $t())) { if (o = [], h = i, null !== (u = m())) for (a = []; null !== u;)a.push(u), u = m(); else a = null; for (null !== a && null !== (u = $t()) ? a = [a, u] : (a = null, i = h); null !== a;) { if (o.push(a), h = i, null !== (u = m())) for (a = []; null !== u;)a.push(u), u = m(); else a = null; null !== a && null !== (u = $t()) ? a = [a, u] : (a = null, i = h) } null !== o && null !== (a = G()) ? e = [e, n, r, s, o, a] : (e = null, i = c) } else e = null, i = c; else e = null, i = c; else e = null, i = c; else e = null, i = c; return e } function $t() { var e; return null === (e = Me()) && (e = Fe()), e } function Kt() { var e, n, r, s; return s = i, "nonce" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"nonce"')), null !== e && null !== (n = U()) && null !== (r = Jt()) ? e = [e, n, r] : (e = null, i = s), e } function Jt() { var e, t, n; return t = i, null !== (e = $()) && (n = e, e = void (Hn.nonce = n)), null === e && (i = t), e } function Yt() { var e, n, r, s, o, a; return s = i, o = i, "opaque" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"opaque"')), null !== e && null !== (n = U()) && null !== (r = $()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.opaque = a)), null === e && (i = s), e } function Xt() { var e, n, r, s, o; return s = i, "stale" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"stale"')), null !== e && null !== (n = U()) ? (o = i, "true" === t.substr(i, 4).toLowerCase() ? (r = t.substr(i, 4), i += 4) : (r = null, l('"true"')), null !== r && (r = void (Hn.stale = !0)), null === r && (i = o), null === r && (o = i, "false" === t.substr(i, 5).toLowerCase() ? (r = t.substr(i, 5), i += 5) : (r = null, l('"false"')), null !== r && (r = void (Hn.stale = !1)), null === r && (i = o)), null !== r ? e = [e, n, r] : (e = null, i = s)) : (e = null, i = s), e } function Qt() { var e, n, r, s, o, a; return s = i, o = i, "algorithm" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, l('"algorithm"')), null !== e && null !== (n = U()) ? ("md5" === t.substr(i, 3).toLowerCase() ? (r = t.substr(i, 3), i += 3) : (r = null, l('"MD5"')), null === r && ("md5-sess" === t.substr(i, 8).toLowerCase() ? (r = t.substr(i, 8), i += 8) : (r = null, l('"MD5-sess"')), null === r && (r = x())), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.algorithm = a.toUpperCase())), null === e && (i = s), e } function Zt() { var e, n, r, s, o, a, u, c, h, d; if (c = i, "qop" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"qop"')), null !== e) if (null !== (n = U())) if (null !== (r = V())) { if (h = i, null !== (s = en())) { for (o = [], d = i, 44 === t.charCodeAt(i) ? (a = ",", i++) : (a = null, l('","')), null !== a && null !== (u = en()) ? a = [a, u] : (a = null, i = d); null !== a;)o.push(a), d = i, 44 === t.charCodeAt(i) ? (a = ",", i++) : (a = null, l('","')), null !== a && null !== (u = en()) ? a = [a, u] : (a = null, i = d); null !== o ? s = [s, o] : (s = null, i = h) } else s = null, i = h; null !== s && null !== (o = G()) ? e = [e, n, r, s, o] : (e = null, i = c) } else e = null, i = c; else e = null, i = c; else e = null, i = c; return e } function en() { var e, n, r; return n = i, "auth-int" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, l('"auth-int"')), null === e && ("auth" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, l('"auth"')), null === e && (e = x())), null !== e && (r = e, Hn.qop || (Hn.qop = []), e = void Hn.qop.push(r.toLowerCase())), null === e && (i = n), e } function tn() { var e, t, n, r, s, o, a; if (s = i, o = i, null !== (e = _t())) { for (t = [], a = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = a); null !== n;)t.push(n), a = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = a); null !== t ? e = [e, t] : (e = null, i = o) } else e = null, i = o; return null !== e && (e = function (e) { var t; Hn.multi_header || (Hn.multi_header = []); try { t = new qn(Hn.uri, Hn.display_name, Hn.params), delete Hn.uri, delete Hn.display_name, delete Hn.params } catch (e) { t = null } Hn.multi_header.push({ possition: i, offset: e, parsed: t }) }(s)), null === e && (i = s), e } function nn() { var e; return null === (e = rn()) && (e = St()), e } function rn() { var e, n, r, s, o, a, u; if (o = i, a = i, "cause" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"cause"')), null !== e) if (null !== (n = U())) { if (null !== (s = c())) for (r = []; null !== s;)r.push(s), s = c(); else r = null; null !== r ? e = [e, n, r] : (e = null, i = a) } else e = null, i = a; else e = null, i = a; return null !== e && (u = e[2], e = void (Hn.cause = parseInt(u.join("")))), null === e && (i = o), e } function sn() { var e, t, n, r, s, o; if (s = i, null !== (e = _t())) { for (t = [], o = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = o); null !== n;)t.push(n), o = i, null !== (n = B()) && null !== (r = St()) ? n = [n, r] : (n = null, i = o); null !== t ? e = [e, t] : (e = null, i = s) } else e = null, i = s; return e } function on() { var e, n; return n = i, "active" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"active"')), null === e && ("pending" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, l('"pending"')), null === e && ("terminated" === t.substr(i, 10).toLowerCase() ? (e = t.substr(i, 10), i += 10) : (e = null, l('"terminated"')), null === e && (e = x()))), null !== e && (e = function (e) { Hn.state = t.substring(i, e) }(n)), null === e && (i = n), e } function an() { var e, n, r, s, o, a, u, c; return s = i, o = i, "reason" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"reason"')), null !== e && null !== (n = U()) && null !== (r = ln()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = void (void 0 !== (a = e[2]) && (Hn.reason = a))), null === e && (i = s), null === e && (s = i, o = i, "expires" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, l('"expires"')), null !== e && null !== (n = U()) && null !== (r = Ct()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = void (void 0 !== (c = e[2]) && (Hn.expires = c))), null === e && (i = s), null === e && (s = i, o = i, "retry_after" === t.substr(i, 11).toLowerCase() ? (e = t.substr(i, 11), i += 11) : (e = null, l('"retry_after"')), null !== e && null !== (n = U()) && null !== (r = Ct()) ? e = [e, n, r] : (e = null, i = o), null !== e && (e = void (void 0 !== (u = e[2]) && (Hn.retry_after = u))), null === e && (i = s), null === e && (e = St()))), e } function ln() { var e; return "deactivated" === t.substr(i, 11).toLowerCase() ? (e = t.substr(i, 11), i += 11) : (e = null, l('"deactivated"')), null === e && ("probation" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, l('"probation"')), null === e && ("rejected" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, l('"rejected"')), null === e && ("timeout" === t.substr(i, 7).toLowerCase() ? (e = t.substr(i, 7), i += 7) : (e = null, l('"timeout"')), null === e && ("giveup" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"giveup"')), null === e && ("noresource" === t.substr(i, 10).toLowerCase() ? (e = t.substr(i, 10), i += 10) : (e = null, l('"noresource"')), null === e && ("invariant" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, l('"invariant"')), null === e && (e = x()))))))), e } function un() { var e; return null === (e = Ht()) && (e = St()), e } function cn() { var e, t, n, r, s, o, a, l; if (a = i, null !== (e = gn())) if (null !== (t = b())) if (null !== (n = Cn())) { for (r = [], l = i, null !== (s = B()) && null !== (o = hn()) ? s = [s, o] : (s = null, i = l); null !== s;)r.push(s), l = i, null !== (s = B()) && null !== (o = hn()) ? s = [s, o] : (s = null, i = l); null !== r ? e = [e, t, n, r] : (e = null, i = a) } else e = null, i = a; else e = null, i = a; else e = null, i = a; return e } function hn() { var e; return null === (e = dn()) && null === (e = fn()) && null === (e = pn()) && null === (e = _n()) && null === (e = mn()) && (e = St()), e } function dn() { var e, n, r, s, o, a; return s = i, o = i, "ttl" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"ttl"')), null !== e && null !== (n = U()) && null !== (r = bn()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.ttl = a)), null === e && (i = s), e } function fn() { var e, n, r, s, o, a; return s = i, o = i, "maddr" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"maddr"')), null !== e && null !== (n = U()) && null !== (r = oe()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.maddr = a)), null === e && (i = s), e } function pn() { var e, n, r, s, o, a; return s = i, o = i, "received" === t.substr(i, 8).toLowerCase() ? (e = t.substr(i, 8), i += 8) : (e = null, l('"received"')), null !== e && null !== (n = U()) ? (null === (r = pe()) && (r = he()), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.received = a)), null === e && (i = s), e } function _n() { var e, n, r, s, o, a; return s = i, o = i, "branch" === t.substr(i, 6).toLowerCase() ? (e = t.substr(i, 6), i += 6) : (e = null, l('"branch"')), null !== e && null !== (n = U()) && null !== (r = x()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.branch = a)), null === e && (i = s), e } function mn() { var e, n, r, s, o, a, u; if (o = i, a = i, "rport" === t.substr(i, 5).toLowerCase() ? (e = t.substr(i, 5), i += 5) : (e = null, l('"rport"')), null !== e) { if (u = i, null !== (n = U())) { for (r = [], s = c(); null !== s;)r.push(s), s = c(); null !== r ? n = [n, r] : (n = null, i = u) } else n = null, i = u; null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = a) } else e = null, i = a; return null !== e && (e = void ("undefined" != typeof response_port && (Hn.rport = response_port.join("")))), null === e && (i = o), e } function gn() { var e, t, n, r, s, o; return o = i, null !== (e = vn()) && null !== (t = P()) && null !== (n = x()) && null !== (r = P()) && null !== (s = yn()) ? e = [e, t, n, r, s] : (e = null, i = o), e } function vn() { var e, n, r; return n = i, "sip" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"SIP"')), null === e && (e = x()), null !== e && (r = e, e = void (Hn.protocol = r)), null === e && (i = n), e } function yn() { var e, n, r; return n = i, "udp" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"UDP"')), null === e && ("tcp" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"TCP"')), null === e && ("tls" === t.substr(i, 3).toLowerCase() ? (e = t.substr(i, 3), i += 3) : (e = null, l('"TLS"')), null === e && ("sctp" === t.substr(i, 4).toLowerCase() ? (e = t.substr(i, 4), i += 4) : (e = null, l('"SCTP"')), null === e && (e = x())))), null !== e && (r = e, e = void (Hn.transport = r)), null === e && (i = n), e } function Cn() { var e, t, n, r, s; return r = i, null !== (e = Tn()) ? (s = i, null !== (t = j()) && null !== (n = Sn()) ? t = [t, n] : (t = null, i = s), null !== (t = null !== t ? t : "") ? e = [e, t] : (e = null, i = r)) : (e = null, i = r), e } function Tn() { var e, n; return n = i, null === (e = pe()) && null === (e = ce()) && (e = ae()), null !== e && (e = function (e) { Hn.host = t.substring(i, e) }(n)), null === e && (i = n), e } function Sn() { var e, t, n, r, s, o, a, l; return o = i, a = i, null !== (e = null !== (e = c()) ? e : "") && null !== (t = null !== (t = c()) ? t : "") && null !== (n = null !== (n = c()) ? n : "") && null !== (r = null !== (r = c()) ? r : "") && null !== (s = null !== (s = c()) ? s : "") ? e = [e, t, n, r, s] : (e = null, i = a), null !== e && (l = e, e = void (Hn.port = parseInt(l.join("")))), null === e && (i = o), e } function bn() { var e, t, n, r, s; return r = i, s = i, null !== (e = c()) && null !== (t = null !== (t = c()) ? t : "") && null !== (n = null !== (n = c()) ? n : "") ? e = [e, t, n] : (e = null, i = s), null !== e && (e = parseInt(e.join(""))), null === e && (i = r), e } function En() { var e, t, n; return t = i, null !== (e = Ct()) && (n = e, e = void (Hn.expires = n)), null === e && (i = t), e } function An() { var e; return null === (e = wn()) && (e = St()), e } function wn() { var e, n, r, s, o, a; return s = i, o = i, "refresher" === t.substr(i, 9).toLowerCase() ? (e = t.substr(i, 9), i += 9) : (e = null, l('"refresher"')), null !== e && null !== (n = U()) ? ("uac" === t.substr(i, 3).toLowerCase() ? (r = t.substr(i, 3), i += 3) : (r = null, l('"uac"')), null === r && ("uas" === t.substr(i, 3).toLowerCase() ? (r = t.substr(i, 3), i += 3) : (r = null, l('"uas"'))), null !== r ? e = [e, n, r] : (e = null, i = o)) : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.refresher = a.toLowerCase())), null === e && (i = s), e } function Rn() { var e, t; for (e = [], null === (t = R()) && null === (t = k()) && (t = b()); null !== t;)e.push(t), null === (t = R()) && null === (t = k()) && (t = b()); return e } function In() { var e, n, r, s, o, a, u, c, h, d, f; return d = i, f = i, null !== (e = xn()) ? (45 === t.charCodeAt(i) ? (n = "-", i++) : (n = null, l('"-"')), null !== n && null !== (r = kn()) ? (45 === t.charCodeAt(i) ? (s = "-", i++) : (s = null, l('"-"')), null !== s && null !== (o = kn()) ? (45 === t.charCodeAt(i) ? (a = "-", i++) : (a = null, l('"-"')), null !== a && null !== (u = kn()) ? (45 === t.charCodeAt(i) ? (c = "-", i++) : (c = null, l('"-"')), null !== c && null !== (h = On()) ? e = [e, n, r, s, o, a, u, c, h] : (e = null, i = f)) : (e = null, i = f)) : (e = null, i = f)) : (e = null, i = f)) : (e = null, i = f), null !== e && (e = function (e, n) { Hn = t.substring(i + 5, e) }(d, e[0])), null === e && (i = d), e } function kn() { var e, t, n, r, s; return s = i, null !== (e = d()) && null !== (t = d()) && null !== (n = d()) && null !== (r = d()) ? e = [e, t, n, r] : (e = null, i = s), e } function xn() { var e, t, n; return n = i, null !== (e = kn()) && null !== (t = kn()) ? e = [e, t] : (e = null, i = n), e } function On() { var e, t, n, r; return r = i, null !== (e = kn()) && null !== (t = kn()) && null !== (n = kn()) ? e = [e, t, n] : (e = null, i = r), e } function Nn() { var e, n, r, s, o, a; return s = i, o = i, null !== (e = N()) ? (a = i, 64 === t.charCodeAt(i) ? (n = "@", i++) : (n = null, l('"@"')), null !== n && null !== (r = N()) ? n = [n, r] : (n = null, i = a), null !== (n = null !== n ? n : "") ? e = [e, n] : (e = null, i = o)) : (e = null, i = o), null !== e && (e = function (e) { Hn.call_id = t.substring(i, e) }(s)), null === e && (i = s), e } function Dn() { var e; return null === (e = Pn()) && null === (e = Un()) && null === (e = Ln()) && (e = St()), e } function Pn() { var e, n, r, s, o, a; return s = i, o = i, "to-tag" === t.substr(i, 6) ? (e = "to-tag", i += 6) : (e = null, l('"to-tag"')), null !== e && null !== (n = U()) && null !== (r = x()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.to_tag = a)), null === e && (i = s), e } function Un() { var e, n, r, s, o, a; return s = i, o = i, "from-tag" === t.substr(i, 8) ? (e = "from-tag", i += 8) : (e = null, l('"from-tag"')), null !== e && null !== (n = U()) && null !== (r = x()) ? e = [e, n, r] : (e = null, i = o), null !== e && (a = e[2], e = void (Hn.from_tag = a)), null === e && (i = s), e } function Ln() { var e, n; return n = i, "early-only" === t.substr(i, 10) ? (e = "early-only", i += 10) : (e = null, l('"early-only"')), null !== e && (e = void (Hn.early_only = !0)), null === e && (i = n), e } var Mn = n(1987), qn = n(9437), Hn = {}; if (null === s[r]() || i !== t.length) { var Fn = Math.max(i, o), Bn = Fn < t.length ? t.charAt(Fn) : null, jn = function () { for (var e = 1, n = 1, r = !1, s = 0; s < Math.max(i, o); s++) { var a = t.charAt(s); "\n" === a ? (r || e++, n = 1, r = !1) : "\r" === a || "\u2028" === a || "\u2029" === a ? (e++, n = 1, r = !0) : (n++, r = !1) } return { line: e, column: n } }(); return new this.SyntaxError(function (e) { e.sort(); for (var t = null, n = [], r = 0; r < e.length; r++)e[r] !== t && (n.push(e[r]), t = e[r]); return n }(a), Bn, Fn, jn.line, jn.column), -1 } return Hn }, toSource: function () { return this._source }, SyntaxError: function (t, n, r, s, i) { this.name = "SyntaxError", this.expected = t, this.found = n, this.message = function (t, n) { var r; switch (t.length) { case 0: r = "end of input"; break; case 1: r = t[0]; break; default: r = t.slice(0, t.length - 1).join(", ") + " or " + t[t.length - 1] }return "Expected " + r + " but " + (n ? e(n) : "end of input") + " found." }(t, n), this.offset = r, this.line = s, this.column = i } }; return t.SyntaxError.prototype = Error.prototype, t }() }, 5979: (e, t, n) => { var r = n(2403), s = n(965), i = n(8063), o = n(5424), a = n(8387), l = n(1987), u = n(9437), c = n(3790), h = n(1288); n(1272)("JsSIP")("version %s", r.version), e.exports = { C: s, Exceptions: i, Utils: o, UA: a, URI: l, NameAddrHeader: u, WebSocketInterface: h, Grammar: c, debug: n(1272), get name() { return r.title }, get version() { return r.version } } }, 9193: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } var l = n(7187).EventEmitter, u = n(965), c = n(6497), h = n(5424), d = n(2066), f = n(8063), p = n(1272)("JsSIP:Message"); e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._ua = e, n._request = null, n._closed = !1, n._direction = null, n._local_identity = null, n._remote_identity = null, n._is_replied = !1, n._data = {}, n } var n, r, l; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) }(t, e), n = t, r = [{ key: "send", value: function (e, t) { var n = this, r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, s = e; if (void 0 === e || void 0 === t) throw new TypeError("Not enough arguments"); if (!(e = this._ua.normalizeTarget(e))) throw new TypeError("Invalid target: ".concat(s)); var i = h.cloneArray(r.extraHeaders), o = r.eventHandlers || {}, a = r.contentType || "text/plain"; for (var l in o) Object.prototype.hasOwnProperty.call(o, l) && this.on(l, o[l]); i.push("Content-Type: ".concat(a)), this._request = new c.OutgoingRequest(u.MESSAGE, e, this._ua, null, i), t && (this._request.body = t); var f = new d(this._ua, this._request, { onRequestTimeout: function () { n._onRequestTimeout() }, onTransportError: function () { n._onTransportError() }, onReceiveResponse: function (e) { n._receiveResponse(e) } }); this._newMessage("local", this._request), f.send() } }, { key: "init_incoming", value: function (e) { this._request = e, this._newMessage("remote", e), this._is_replied || (this._is_replied = !0, e.reply(200)), this._close() } }, { key: "accept", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = h.cloneArray(e.extraHeaders), n = e.body; if ("incoming" !== this._direction) throw new f.NotSupportedError('"accept" not supported for outgoing Message'); if (this._is_replied) throw new Error("incoming Message already replied"); this._is_replied = !0, this._request.reply(200, null, t, n) } }, { key: "reject", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.status_code || 480, n = e.reason_phrase, r = h.cloneArray(e.extraHeaders), s = e.body; if ("incoming" !== this._direction) throw new f.NotSupportedError('"reject" not supported for outgoing Message'); if (this._is_replied) throw new Error("incoming Message already replied"); if (t < 300 || t >= 700) throw new TypeError("Invalid status_code: ".concat(t)); this._is_replied = !0, this._request.reply(t, n, r, s) } }, { key: "_receiveResponse", value: function (e) { if (!this._closed) switch (!0) { case /^1[0-9]{2}$/.test(e.status_code): break; case /^2[0-9]{2}$/.test(e.status_code): this._succeeded("remote", e); break; default: var t = h.sipErrorCause(e.status_code); this._failed("remote", e, t) } } }, { key: "_onRequestTimeout", value: function () { this._closed || this._failed("system", null, u.causes.REQUEST_TIMEOUT) } }, { key: "_onTransportError", value: function () { this._closed || this._failed("system", null, u.causes.CONNECTION_ERROR) } }, { key: "_close", value: function () { this._closed = !0, this._ua.destroyMessage(this) } }, { key: "_newMessage", value: function (e, t) { "remote" === e ? (this._direction = "incoming", this._local_identity = t.to, this._remote_identity = t.from) : "local" === e && (this._direction = "outgoing", this._local_identity = t.from, this._remote_identity = t.to), this._ua.newMessage(this, { originator: e, message: this, request: t }) } }, { key: "_failed", value: function (e, t, n) { p("MESSAGE failed"), this._close(), p('emit "failed"'), this.emit("failed", { originator: e, response: t || null, cause: n }) } }, { key: "_succeeded", value: function (e, t) { p("MESSAGE succeeded"), this._close(), p('emit "succeeded"'), this.emit("succeeded", { originator: e, response: t }) } }, { key: "direction", get: function () { return this._direction } }, { key: "local_identity", get: function () { return this._local_identity } }, { key: "remote_identity", get: function () { return this._remote_identity } }], r && s(n.prototype, r), l && s(n, l), t }(l) }, 9437: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function s(e, t, n) { return t && r(e.prototype, t), n && r(e, n), e } var i = n(1987), o = n(3790); e.exports = function () { function e(t, n, r) { if (function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), !(t && t instanceof i)) throw new TypeError('missing or invalid "uri" parameter'); for (var s in this._uri = t, this._parameters = {}, this._display_name = n, r) Object.prototype.hasOwnProperty.call(r, s) && this.setParam(s, r[s]) } return s(e, null, [{ key: "parse", value: function (e) { return -1 !== (e = o.parse(e, "Name_Addr_Header")) ? e : void 0 } }]), s(e, [{ key: "setParam", value: function (e, t) { e && (this._parameters[e.toLowerCase()] = null == t ? null : t.toString()) } }, { key: "getParam", value: function (e) { if (e) return this._parameters[e.toLowerCase()] } }, { key: "hasParam", value: function (e) { if (e) return !!this._parameters.hasOwnProperty(e.toLowerCase()) } }, { key: "deleteParam", value: function (e) { if (e = e.toLowerCase(), this._parameters.hasOwnProperty(e)) { var t = this._parameters[e]; return delete this._parameters[e], t } } }, { key: "clearParams", value: function () { this._parameters = {} } }, { key: "clone", value: function () { return new e(this._uri.clone(), this._display_name, JSON.parse(JSON.stringify(this._parameters))) } }, { key: "toString", value: function () { var e = this._display_name || 0 === this._display_name ? '"'.concat(this._display_name, '" ') : ""; for (var t in e += "<".concat(this._uri.toString(), ">"), this._parameters) Object.prototype.hasOwnProperty.call(this._parameters, t) && (e += ";".concat(t), null !== this._parameters[t] && (e += "=".concat(this._parameters[t]))); return e } }, { key: "uri", get: function () { return this._uri } }, { key: "display_name", get: function () { return this._display_name }, set: function (e) { this._display_name = 0 === e ? "0" : e } }]), e }() }, 8407: (e, t, n) => { var r = n(3790), s = n(6497), i = n(1272)("JsSIP:ERROR:Parser"); function o(e, t) { var n = t, r = 0, s = 0; if (e.substring(n, n + 2).match(/(^\r\n)/)) return -2; for (; 0 === r;) { if (-1 === (s = e.indexOf("\r\n", n))) return s; !e.substring(s + 2, s + 4).match(/(^\r\n)/) && e.charAt(s + 2).match(/(^\s+)/) ? n = s + 2 : r = s } return r } function a(e, t, n, i) { var o, a = t.indexOf(":", n), l = t.substring(n, a).trim(), u = t.substring(a + 1, i).trim(); switch (l.toLowerCase()) { case "via": case "v": e.addHeader("via", u), 1 === e.getHeaders("via").length ? (o = e.parseHeader("Via")) && (e.via = o, e.via_branch = o.branch) : o = 0; break; case "from": case "f": e.setHeader("from", u), (o = e.parseHeader("from")) && (e.from = o, e.from_tag = o.getParam("tag")); break; case "to": case "t": e.setHeader("to", u), (o = e.parseHeader("to")) && (e.to = o, e.to_tag = o.getParam("tag")); break; case "record-route": if (-1 === (o = r.parse(u, "Record_Route"))) o = void 0; else { var c = !0, h = !1, d = void 0; try { for (var f, p = o[Symbol.iterator](); !(c = (f = p.next()).done); c = !0) { var _ = f.value; e.addHeader("record-route", u.substring(_.possition, _.offset)), e.headers["Record-Route"][e.getHeaders("record-route").length - 1].parsed = _.parsed } } catch (e) { h = !0, d = e } finally { try { c || null == p.return || p.return() } finally { if (h) throw d } } } break; case "call-id": case "i": e.setHeader("call-id", u), (o = e.parseHeader("call-id")) && (e.call_id = u); break; case "contact": case "m": if (-1 === (o = r.parse(u, "Contact"))) o = void 0; else { var m = !0, g = !1, v = void 0; try { for (var y, C = o[Symbol.iterator](); !(m = (y = C.next()).done); m = !0) { var T = y.value; e.addHeader("contact", u.substring(T.possition, T.offset)), e.headers.Contact[e.getHeaders("contact").length - 1].parsed = T.parsed } } catch (e) { g = !0, v = e } finally { try { m || null == C.return || C.return() } finally { if (g) throw v } } } break; case "content-length": case "l": e.setHeader("content-length", u), o = e.parseHeader("content-length"); break; case "content-type": case "c": e.setHeader("content-type", u), o = e.parseHeader("content-type"); break; case "cseq": e.setHeader("cseq", u), (o = e.parseHeader("cseq")) && (e.cseq = o.value), e instanceof s.IncomingResponse && (e.method = o.method); break; case "max-forwards": e.setHeader("max-forwards", u), o = e.parseHeader("max-forwards"); break; case "www-authenticate": e.setHeader("www-authenticate", u), o = e.parseHeader("www-authenticate"); break; case "proxy-authenticate": e.setHeader("proxy-authenticate", u), o = e.parseHeader("proxy-authenticate"); break; case "session-expires": case "x": e.setHeader("session-expires", u), (o = e.parseHeader("session-expires")) && (e.session_expires = o.expires, e.session_expires_refresher = o.refresher); break; case "refer-to": case "r": e.setHeader("refer-to", u), (o = e.parseHeader("refer-to")) && (e.refer_to = o); break; case "replaces": e.setHeader("replaces", u), (o = e.parseHeader("replaces")) && (e.replaces = o); break; case "event": case "o": e.setHeader("event", u), (o = e.parseHeader("event")) && (e.event = o); break; default: e.addHeader(l, u), o = 0 }return void 0 !== o || { error: 'error parsing header "'.concat(l, '"') } } i.log = console.warn.bind(console), t.parseMessage = function (e, t) { var n, l, u = e.indexOf("\r\n"); if (-1 !== u) { var c = e.substring(0, u), h = r.parse(c, "Request_Response"); if (-1 !== h) { h.status_code ? ((n = new s.IncomingResponse).status_code = h.status_code, n.reason_phrase = h.reason_phrase) : ((n = new s.IncomingRequest(t)).method = h.method, n.ruri = h.uri), n.data = e; for (var d = u + 2; ;) { if (-2 === (u = o(e, d))) { l = d + 2; break } if (-1 === u) return void i("parseMessage() | malformed message"); if (!0 !== (h = a(n, e, d, u))) return void i("parseMessage() |", h.error); d = u + 2 } if (n.hasHeader("content-length")) { var f = n.getHeader("content-length"); n.body = e.substr(l, f) } else n.body = e.substring(l); return n } i('parseMessage() | error parsing first line of SIP message: "'.concat(c, '"')) } else i("parseMessage() | no CRLF found, not a SIP message") } }, 7906: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function i(e) { return i = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, i(e) } function o(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function a(e, t, n) { return t && o(e.prototype, t), n && o(e, n), e } function l(e, t) { return l = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, l(e, t) } var u = n(7187).EventEmitter, c = n(766), h = n(965), d = n(8063), f = n(3754), p = n(5424), _ = n(306), m = n(6497), g = n(316), v = n(2066), y = n(4481), C = n(2126), T = n(5774), S = n(603), b = n(1272)("JsSIP:RTCSession"), E = n(1272)("JsSIP:ERROR:RTCSession"); E.log = console.warn.bind(console); var A = { STATUS_NULL: 0, STATUS_INVITE_SENT: 1, STATUS_1XX_RECEIVED: 2, STATUS_INVITE_RECEIVED: 3, STATUS_WAITING_FOR_ANSWER: 4, STATUS_ANSWERED: 5, STATUS_WAITING_FOR_ACK: 6, STATUS_CANCELED: 7, STATUS_TERMINATED: 8, STATUS_CONFIRMED: 9 }, w = ["audio", "video"]; e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), b("new"), (n = s(this, i(t).call(this)))._id = null, n._ua = e, n._status = A.STATUS_NULL, n._dialog = null, n._earlyDialogs = {}, n._contact = null, n._from_tag = null, n._to_tag = null, n._connection = null, n._connectionPromiseQueue = Promise.resolve(), n._request = null, n._is_canceled = !1, n._cancel_reason = "", n._is_confirmed = !1, n._late_sdp = !1, n._rtcOfferConstraints = null, n._rtcAnswerConstraints = null, n._localMediaStream = null, n._localMediaStreamLocallyGenerated = !1, n._rtcReady = !0, n._timers = { ackTimer: null, expiresTimer: null, invite2xxTimer: null, userNoAnswerTimer: null }, n._direction = null, n._local_identity = null, n._remote_identity = null, n._start_time = null, n._end_time = null, n._tones = null, n._audioMuted = !1, n._videoMuted = !1, n._localHold = !1, n._remoteHold = !1, n._sessionTimers = { enabled: n._ua.configuration.session_timers, refreshMethod: n._ua.configuration.session_timers_refresh_method, defaultExpires: h.SESSION_EXPIRES, currentExpires: null, running: !1, refresher: !1, timer: null }, n._referSubscribers = {}, n._data = {}, n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && l(e, t) }(t, e), a(t, null, [{ key: "C", get: function () { return A } }]), a(t, [{ key: "isInProgress", value: function () { switch (this._status) { case A.STATUS_NULL: case A.STATUS_INVITE_SENT: case A.STATUS_1XX_RECEIVED: case A.STATUS_INVITE_RECEIVED: case A.STATUS_WAITING_FOR_ANSWER: return !0; default: return !1 } } }, { key: "isEstablished", value: function () { switch (this._status) { case A.STATUS_ANSWERED: case A.STATUS_WAITING_FOR_ACK: case A.STATUS_CONFIRMED: return !0; default: return !1 } } }, { key: "isEnded", value: function () { switch (this._status) { case A.STATUS_CANCELED: case A.STATUS_TERMINATED: return !0; default: return !1 } } }, { key: "isMuted", value: function () { return { audio: this._audioMuted, video: this._videoMuted } } }, { key: "isOnHold", value: function () { return { local: this._localHold, remote: this._remoteHold } } }, { key: "connect", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = arguments.length > 2 ? arguments[2] : void 0; b("connect()"); var r = e, s = t.eventHandlers || {}, i = p.cloneArray(t.extraHeaders), o = t.mediaConstraints || { audio: !0, video: !0 }, a = t.mediaStream || null, l = t.pcConfig || { iceServers: [] }, u = t.rtcConstraints || null, c = t.rtcOfferConstraints || null; if (this._rtcOfferConstraints = c, this._rtcAnswerConstraints = t.rtcAnswerConstraints || null, this._data = t.data || this._data, void 0 === e) throw new TypeError("Not enough arguments"); if (this._status !== A.STATUS_NULL) throw new d.InvalidStateError(this._status); if (!window.RTCPeerConnection) throw new d.NotSupportedError("WebRTC not supported"); if (!(e = this._ua.normalizeTarget(e))) throw new TypeError("Invalid target: ".concat(r)); for (var f in this._sessionTimers.enabled && p.isDecimal(t.sessionTimersExpires) && (t.sessionTimersExpires >= h.MIN_SESSION_EXPIRES ? this._sessionTimers.defaultExpires = t.sessionTimersExpires : this._sessionTimers.defaultExpires = h.SESSION_EXPIRES), s) Object.prototype.hasOwnProperty.call(s, f) && this.on(f, s[f]); this._from_tag = p.newTag(); var _ = t.anonymous || !1, g = { from_tag: this._from_tag }; this._contact = this._ua.contact.toString({ anonymous: _, outbound: !0 }), _ && (g.from_display_name = "Anonymous", g.from_uri = "sip:anonymous@anonymous.invalid", i.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())), i.push("Privacy: id")), i.push("Contact: ".concat(this._contact)), i.push("Content-Type: application/sdp"), this._sessionTimers.enabled && i.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires)), this._request = new m.InitialOutgoingInviteRequest(e, this._ua, g, i), this._id = this._request.call_id + this._from_tag, this._createRTCConnection(l, u), this._direction = "outgoing", this._local_identity = this._request.from, this._remote_identity = this._request.to, n && n(this), this._newRTCSession("local", this._request), this._sendInitialRequest(o, c, a) } }, { key: "init_incoming", value: function (e, t) { var n, r = this; b("init_incoming()"); var s = e.getHeader("Content-Type"); e.body && "application/sdp" !== s ? e.reply(415) : (this._status = A.STATUS_INVITE_RECEIVED, this._from_tag = e.from_tag, this._id = e.call_id + this._from_tag, this._request = e, this._contact = this._ua.contact.toString(), e.hasHeader("expires") && (n = 1e3 * e.getHeader("expires")), e.to_tag = p.newTag(), this._createDialog(e, "UAS", !0) ? (e.body ? this._late_sdp = !1 : this._late_sdp = !0, this._status = A.STATUS_WAITING_FOR_ANSWER, this._timers.userNoAnswerTimer = setTimeout((function () { e.reply(408), r._failed("local", null, h.causes.NO_ANSWER) }), this._ua.configuration.no_answer_timeout), n && (this._timers.expiresTimer = setTimeout((function () { r._status === A.STATUS_WAITING_FOR_ANSWER && (e.reply(487), r._failed("system", null, h.causes.EXPIRES)) }), n)), this._direction = "incoming", this._local_identity = e.to, this._remote_identity = e.from, t && t(this), this._newRTCSession("remote", e), this._status !== A.STATUS_TERMINATED && (e.reply(180, null, ["Contact: ".concat(this._contact)]), this._progress("local", null))) : e.reply(500, "Missing Contact header field")) } }, { key: "answer", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; b("answer()"); var n, r = this._request, s = p.cloneArray(t.extraHeaders), i = t.mediaConstraints || {}, o = t.mediaStream || null, a = t.pcConfig || { iceServers: [] }, l = t.rtcConstraints || null, u = t.rtcAnswerConstraints || null, c = !1, f = !1, _ = !1, m = !1; if (this._rtcAnswerConstraints = u, this._rtcOfferConstraints = t.rtcOfferConstraints || null, this._data = t.data || this._data, "incoming" !== this._direction) throw new d.NotSupportedError('"answer" not supported for outgoing RTCSession'); if (this._status !== A.STATUS_WAITING_FOR_ANSWER) throw new d.InvalidStateError(this._status); if (this._sessionTimers.enabled && p.isDecimal(t.sessionTimersExpires) && (t.sessionTimersExpires >= h.MIN_SESSION_EXPIRES ? this._sessionTimers.defaultExpires = t.sessionTimersExpires : this._sessionTimers.defaultExpires = h.SESSION_EXPIRES), this._status = A.STATUS_ANSWERED, this._createDialog(r, "UAS")) { clearTimeout(this._timers.userNoAnswerTimer), s.unshift("Contact: ".concat(this._contact)); var g = r.parseSDP(); Array.isArray(g.media) || (g.media = [g.media]); var v = !0, y = !1, C = void 0; try { for (var T, S = g.media[Symbol.iterator](); !(v = (T = S.next()).done); v = !0) { var w = T.value; "audio" === w.type && (c = !0, w.direction && "sendrecv" !== w.direction || (_ = !0)), "video" === w.type && (f = !0, w.direction && "sendrecv" !== w.direction || (m = !0)) } } catch (e) { y = !0, C = e } finally { try { v || null == S.return || S.return() } finally { if (y) throw C } } if (o && !1 === i.audio) { n = o.getAudioTracks(); var R = !0, I = !1, k = void 0; try { for (var x, O = n[Symbol.iterator](); !(R = (x = O.next()).done); R = !0) { var N = x.value; o.removeTrack(N) } } catch (e) { I = !0, k = e } finally { try { R || null == O.return || O.return() } finally { if (I) throw k } } } if (o && !1 === i.video) { n = o.getVideoTracks(); var D = !0, P = !1, U = void 0; try { for (var L, M = n[Symbol.iterator](); !(D = (L = M.next()).done); D = !0) { var q = L.value; o.removeTrack(q) } } catch (e) { P = !0, U = e } finally { try { D || null == M.return || M.return() } finally { if (P) throw U } } } o || void 0 !== i.audio || (i.audio = _), o || void 0 !== i.video || (i.video = m), o || c || (i.audio = !1), o || f || (i.video = !1), this._createRTCConnection(a, l), Promise.resolve().then((function () { return o || (i.audio || i.video ? (e._localMediaStreamLocallyGenerated = !0, navigator.mediaDevices.getUserMedia(i).catch((function (t) { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); throw r.reply(480), e._failed("local", null, h.causes.USER_DENIED_MEDIA_ACCESS), E('emit "getusermediafailed" [error:%o]', t), e.emit("getusermediafailed", t), new Error("getUserMedia() failed") }))) : void 0) })).then((function (t) { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); e._localMediaStream = t, t && e._connection.addStream(t) })).then((function () { if (!e._late_sdp) { var t = { originator: "remote", type: "offer", sdp: r.body }; b('emit "sdp"'), e.emit("sdp", t); var n = new RTCSessionDescription({ type: "offer", sdp: t.sdp }); return e._connectionPromiseQueue = e._connectionPromiseQueue.then((function () { return e._connection.setRemoteDescription(n) })).catch((function (t) { throw r.reply(488), e._failed("system", null, h.causes.WEBRTC_ERROR), E('emit "peerconnection:setremotedescriptionfailed" [error:%o]', t), e.emit("peerconnection:setremotedescriptionfailed", t), new Error("peerconnection.setRemoteDescription() failed") })), e._connectionPromiseQueue } })).then((function () { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); return e._connecting(r), e._late_sdp ? e._createLocalDescription("offer", e._rtcOfferConstraints).catch((function () { throw r.reply(500), new Error("_createLocalDescription() failed") })) : e._createLocalDescription("answer", u).catch((function () { throw r.reply(500), new Error("_createLocalDescription() failed") })) })).then((function (t) { if (e._status === A.STATUS_TERMINATED) throw new Error("terminated"); e._handleSessionTimersInIncomingRequest(r, s), r.reply(200, null, s, t, (function () { e._status = A.STATUS_WAITING_FOR_ACK, e._setInvite2xxTimer(r, t), e._setACKTimer(), e._accepted("local") }), (function () { e._failed("system", null, h.causes.CONNECTION_ERROR) })) })).catch((function (t) { e._status !== A.STATUS_TERMINATED && E(t) })) } else r.reply(500, "Error creating dialog") } }, { key: "terminate", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; b("terminate()"); var n, r = t.cause || h.causes.BYE, s = p.cloneArray(t.extraHeaders), i = t.body, o = t.status_code, a = t.reason_phrase; if (this._status === A.STATUS_TERMINATED) throw new d.InvalidStateError(this._status); switch (this._status) { case A.STATUS_NULL: case A.STATUS_INVITE_SENT: case A.STATUS_1XX_RECEIVED: if (b("canceling session"), o && (o < 200 || o >= 700)) throw new TypeError("Invalid status_code: ".concat(o)); o && (a = a || h.REASON_PHRASE[o] || "", n = "SIP ;cause=".concat(o, ' ;text="').concat(a, '"')), this._status === A.STATUS_NULL || this._status === A.STATUS_INVITE_SENT ? (this._is_canceled = !0, this._cancel_reason = n) : this._status === A.STATUS_1XX_RECEIVED && this._request.cancel(n), this._status = A.STATUS_CANCELED, this._failed("local", null, h.causes.CANCELED); break; case A.STATUS_WAITING_FOR_ANSWER: case A.STATUS_ANSWERED: if (b("rejecting session"), (o = o || 480) < 300 || o >= 700) throw new TypeError("Invalid status_code: ".concat(o)); this._request.reply(o, a, s, i), this._failed("local", null, h.causes.REJECTED); break; case A.STATUS_WAITING_FOR_ACK: case A.STATUS_CONFIRMED: if (b("terminating session"), a = t.reason_phrase || h.REASON_PHRASE[o] || "", o && (o < 200 || o >= 700)) throw new TypeError("Invalid status_code: ".concat(o)); if (o && s.push("Reason: SIP ;cause=".concat(o, '; text="').concat(a, '"')), this._status === A.STATUS_WAITING_FOR_ACK && "incoming" === this._direction && this._request.server_transaction.state !== f.C.STATUS_TERMINATED) { var l = this._dialog; this.receiveRequest = function (t) { t.method === h.ACK && (e.sendRequest(h.BYE, { extraHeaders: s, body: i }), l.terminate()) }, this._request.server_transaction.on("stateChanged", (function () { e._request.server_transaction.state === f.C.STATUS_TERMINATED && (e.sendRequest(h.BYE, { extraHeaders: s, body: i }), l.terminate()) })), this._ended("local", null, r), this._dialog = l, this._ua.newDialog(l) } else this.sendRequest(h.BYE, { extraHeaders: s, body: i }), this._ended("local", null, r) } } }, { key: "sendDTMF", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; b("sendDTMF() | tones: %s", e); var n = 0, r = t.duration || null, s = t.interToneGap || null; if (void 0 === e) throw new TypeError("Not enough arguments"); if (this._status !== A.STATUS_CONFIRMED && this._status !== A.STATUS_WAITING_FOR_ACK) throw new d.InvalidStateError(this._status); if ("number" == typeof e && (e = e.toString()), !e || "string" != typeof e || !e.match(/^[0-9A-DR#*,]+$/i)) throw new TypeError("Invalid tones: ".concat(e)); if (r && !p.isDecimal(r)) throw new TypeError("Invalid tone duration: ".concat(r)); if (r ? r < y.C.MIN_DURATION ? (b('"duration" value is lower than the minimum allowed, setting it to '.concat(y.C.MIN_DURATION, " milliseconds")), r = y.C.MIN_DURATION) : r > y.C.MAX_DURATION ? (b('"duration" value is greater than the maximum allowed, setting it to '.concat(y.C.MAX_DURATION, " milliseconds")), r = y.C.MAX_DURATION) : r = Math.abs(r) : r = y.C.DEFAULT_DURATION, t.duration = r, s && !p.isDecimal(s)) throw new TypeError("Invalid interToneGap: ".concat(s)); function i() { var e, o = this; if (this._status === A.STATUS_TERMINATED || !this._tones || n >= this._tones.length) this._tones = null; else { var a = this._tones[n]; if (n += 1, "," === a) e = 2e3; else { var l = new y(this); t.eventHandlers = { onFailed: function () { o._tones = null } }, l.send(a, t), e = r + s } setTimeout(i.bind(this), e) } } s ? s < y.C.MIN_INTER_TONE_GAP ? (b('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(y.C.MIN_INTER_TONE_GAP, " milliseconds")), s = y.C.MIN_INTER_TONE_GAP) : s = Math.abs(s) : s = y.C.DEFAULT_INTER_TONE_GAP, this._tones ? this._tones += e : (this._tones = e, i.call(this)) } }, { key: "sendInfo", value: function (e, t) { var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; if (b("sendInfo()"), this._status !== A.STATUS_CONFIRMED && this._status !== A.STATUS_WAITING_FOR_ACK) throw new d.InvalidStateError(this._status); var r = new C(this); r.send(e, t, n) } }, { key: "mute", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : { audio: !0, video: !1 }; b("mute()"); var t = !1, n = !1; !1 === this._audioMuted && e.audio && (t = !0, this._audioMuted = !0, this._toogleMuteAudio(!0)), !1 === this._videoMuted && e.video && (n = !0, this._videoMuted = !0, this._toogleMuteVideo(!0)), !0 !== t && !0 !== n || this._onmute({ audio: t, video: n }) } }, { key: "unmute", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : { audio: !0, video: !0 }; b("unmute()"); var t = !1, n = !1; !0 === this._audioMuted && e.audio && (t = !0, this._audioMuted = !1, !1 === this._localHold && this._toogleMuteAudio(!1)), !0 === this._videoMuted && e.video && (n = !0, this._videoMuted = !1, !1 === this._localHold && this._toogleMuteVideo(!1)), !0 !== t && !0 !== n || this._onunmute({ audio: t, video: n }) } }, { key: "hold", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = arguments.length > 1 ? arguments[1] : void 0; if (b("hold()"), this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!0 === this._localHold) return !1; if (!this._isReadyToReOffer()) return !1; this._localHold = !0, this._onhold("local"); var r = { succeeded: function () { n && n() }, failed: function () { e.terminate({ cause: h.causes.WEBRTC_ERROR, status_code: 500, reason_phrase: "Hold Failed" }) } }; return t.useUpdate ? this._sendUpdate({ sdpOffer: !0, eventHandlers: r, extraHeaders: t.extraHeaders }) : this._sendReinvite({ eventHandlers: r, extraHeaders: t.extraHeaders }), !0 } }, { key: "unhold", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = arguments.length > 1 ? arguments[1] : void 0; if (b("unhold()"), this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!1 === this._localHold) return !1; if (!this._isReadyToReOffer()) return !1; this._localHold = !1, this._onunhold("local"); var r = { succeeded: function () { n && n() }, failed: function () { e.terminate({ cause: h.causes.WEBRTC_ERROR, status_code: 500, reason_phrase: "Unhold Failed" }) } }; return t.useUpdate ? this._sendUpdate({ sdpOffer: !0, eventHandlers: r, extraHeaders: t.extraHeaders }) : this._sendReinvite({ eventHandlers: r, extraHeaders: t.extraHeaders }), !0 } }, { key: "renegotiate", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = arguments.length > 1 ? arguments[1] : void 0; b("renegotiate()"); var r = t.rtcOfferConstraints || null; if (this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!this._isReadyToReOffer()) return !1; var s = { succeeded: function () { n && n() }, failed: function () { e.terminate({ cause: h.causes.WEBRTC_ERROR, status_code: 500, reason_phrase: "Media Renegotiation Failed" }) } }; return this._setLocalMediaStatus(), t.useUpdate ? this._sendUpdate({ sdpOffer: !0, eventHandlers: s, rtcOfferConstraints: r, extraHeaders: t.extraHeaders }) : this._sendReinvite({ eventHandlers: s, rtcOfferConstraints: r, extraHeaders: t.extraHeaders }), !0 } }, { key: "refer", value: function (e, t) { var n = this; b("refer()"); var r = e; if (this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; if (!(e = this._ua.normalizeTarget(e))) throw new TypeError("Invalid target: ".concat(r)); var s = new S(this); s.sendRefer(e, t); var i = s.id; return this._referSubscribers[i] = s, s.on("requestFailed", (function () { delete n._referSubscribers[i] })), s.on("accepted", (function () { delete n._referSubscribers[i] })), s.on("failed", (function () { delete n._referSubscribers[i] })), s } }, { key: "sendRequest", value: function (e, t) { return b("sendRequest()"), this._dialog.sendRequest(e, t) } }, { key: "receiveRequest", value: function (e) { var t = this; if (b("receiveRequest()"), e.method === h.CANCEL) this._status !== A.STATUS_WAITING_FOR_ANSWER && this._status !== A.STATUS_ANSWERED || (this._status = A.STATUS_CANCELED, this._request.reply(487), this._failed("remote", e, h.causes.CANCELED)); else switch (e.method) { case h.ACK: if (this._status !== A.STATUS_WAITING_FOR_ACK) return; if (this._status = A.STATUS_CONFIRMED, clearTimeout(this._timers.ackTimer), clearTimeout(this._timers.invite2xxTimer), this._late_sdp) { if (!e.body) { this.terminate({ cause: h.causes.MISSING_SDP, status_code: 400 }); break } var n = { originator: "remote", type: "answer", sdp: e.body }; b('emit "sdp"'), this.emit("sdp", n); var r = new RTCSessionDescription({ type: "answer", sdp: n.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(r) })).then((function () { t._is_confirmed || t._confirmed("remote", e) })).catch((function (e) { t.terminate({ cause: h.causes.BAD_MEDIA_DESCRIPTION, status_code: 488 }), E('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })) } else this._is_confirmed || this._confirmed("remote", e); break; case h.BYE: this._status === A.STATUS_CONFIRMED ? (e.reply(200), this._ended("remote", e, h.causes.BYE)) : this._status === A.STATUS_INVITE_RECEIVED ? (e.reply(200), this._request.reply(487, "BYE Received"), this._ended("remote", e, h.causes.BYE)) : e.reply(403, "Wrong Status"); break; case h.INVITE: this._status === A.STATUS_CONFIRMED ? e.hasHeader("replaces") ? this._receiveReplaces(e) : this._receiveReinvite(e) : e.reply(403, "Wrong Status"); break; case h.INFO: if (this._status === A.STATUS_1XX_RECEIVED || this._status === A.STATUS_WAITING_FOR_ANSWER || this._status === A.STATUS_ANSWERED || this._status === A.STATUS_WAITING_FOR_ACK || this._status === A.STATUS_CONFIRMED) { var s = e.getHeader("content-type"); s && s.match(/^application\/dtmf-relay/i) ? new y(this).init_incoming(e) : void 0 !== s ? new C(this).init_incoming(e) : e.reply(415) } else e.reply(403, "Wrong Status"); break; case h.UPDATE: this._status === A.STATUS_CONFIRMED ? this._receiveUpdate(e) : e.reply(403, "Wrong Status"); break; case h.REFER: this._status === A.STATUS_CONFIRMED ? this._receiveRefer(e) : e.reply(403, "Wrong Status"); break; case h.NOTIFY: this._status === A.STATUS_CONFIRMED ? this._receiveNotify(e) : e.reply(403, "Wrong Status"); break; default: e.reply(501) } } }, { key: "onTransportError", value: function () { E("onTransportError()"), this._status !== A.STATUS_TERMINATED && this.terminate({ status_code: 500, reason_phrase: h.causes.CONNECTION_ERROR, cause: h.causes.CONNECTION_ERROR }) } }, { key: "onRequestTimeout", value: function () { E("onRequestTimeout()"), this._status !== A.STATUS_TERMINATED && this.terminate({ status_code: 408, reason_phrase: h.causes.REQUEST_TIMEOUT, cause: h.causes.REQUEST_TIMEOUT }) } }, { key: "onDialogError", value: function () { E("onDialogError()"), this._status !== A.STATUS_TERMINATED && this.terminate({ status_code: 500, reason_phrase: h.causes.DIALOG_ERROR, cause: h.causes.DIALOG_ERROR }) } }, { key: "newDTMF", value: function (e) { b("newDTMF()"), this.emit("newDTMF", e) } }, { key: "newInfo", value: function (e) { b("newInfo()"), this.emit("newInfo", e) } }, { key: "_isReadyToReOffer", value: function () { return this._rtcReady ? this._dialog ? !0 !== this._dialog.uac_pending_reply && !0 !== this._dialog.uas_pending_reply || (b("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"), !1) : (b("_isReadyToReOffer() | session not established yet"), !1) : (b("_isReadyToReOffer() | internal WebRTC status not ready"), !1) } }, { key: "_close", value: function () { if (b("close()"), this._status !== A.STATUS_TERMINATED) { if (this._status = A.STATUS_TERMINATED, this._connection) try { this._connection.close() } catch (e) { E("close() | error closing the RTCPeerConnection: %o", e) } for (var e in this._localMediaStream && this._localMediaStreamLocallyGenerated && (b("close() | closing local MediaStream"), p.closeMediaStream(this._localMediaStream)), this._timers) Object.prototype.hasOwnProperty.call(this._timers, e) && clearTimeout(this._timers[e]); for (var t in clearTimeout(this._sessionTimers.timer), this._dialog && (this._dialog.terminate(), delete this._dialog), this._earlyDialogs) Object.prototype.hasOwnProperty.call(this._earlyDialogs, t) && (this._earlyDialogs[t].terminate(), delete this._earlyDialogs[t]); for (var n in this._referSubscribers) Object.prototype.hasOwnProperty.call(this._referSubscribers, n) && delete this._referSubscribers[n]; this._ua.destroyRTCSession(this) } } }, { key: "_setInvite2xxTimer", value: function (e, t) { var n = _.T1; this._timers.invite2xxTimer = setTimeout(function r() { this._status === A.STATUS_WAITING_FOR_ACK && (e.reply(200, null, ["Contact: ".concat(this._contact)], t), n < _.T2 && (n *= 2) > _.T2 && (n = _.T2), this._timers.invite2xxTimer = setTimeout(r.bind(this), n)) }.bind(this), n) } }, { key: "_setACKTimer", value: function () { var e = this; this._timers.ackTimer = setTimeout((function () { e._status === A.STATUS_WAITING_FOR_ACK && (b("no ACK received, terminating the session"), clearTimeout(e._timers.invite2xxTimer), e.sendRequest(h.BYE), e._ended("remote", null, h.causes.NO_ACK)) }), _.TIMER_H) } }, { key: "_createRTCConnection", value: function (e, t) { var n = this; this._connection = new RTCPeerConnection(e, t), this._connection.addEventListener("iceconnectionstatechange", (function () { "failed" === n._connection.iceConnectionState && n.terminate({ cause: h.causes.RTP_TIMEOUT, status_code: 408, reason_phrase: h.causes.RTP_TIMEOUT }) })), b('emit "peerconnection"'), this.emit("peerconnection", { peerconnection: this._connection }) } }, { key: "_createLocalDescription", value: function (e, t) { var n = this; if (b("createLocalDescription()"), "offer" !== e && "answer" !== e) throw new Error('createLocalDescription() | invalid type "'.concat(e, '"')); var r = this._connection; return this._rtcReady = !1, Promise.resolve().then((function () { return "offer" === e ? r.createOffer(t).catch((function (e) { return E('emit "peerconnection:createofferfailed" [error:%o]', e), n.emit("peerconnection:createofferfailed", e), Promise.reject(e) })) : r.createAnswer(t).catch((function (e) { return E('emit "peerconnection:createanswerfailed" [error:%o]', e), n.emit("peerconnection:createanswerfailed", e), Promise.reject(e) })) })).then((function (e) { return r.setLocalDescription(e).catch((function (e) { return n._rtcReady = !0, E('emit "peerconnection:setlocaldescriptionfailed" [error:%o]', e), n.emit("peerconnection:setlocaldescriptionfailed", e), Promise.reject(e) })) })).then((function () { if ("complete" === r.iceGatheringState) { n._rtcReady = !0; var t = { originator: "local", type: e, sdp: r.localDescription.sdp }; return b('emit "sdp"'), n.emit("sdp", t), Promise.resolve(t.sdp) } return new Promise((function (t) { var s, i = !1, o = function () { r.removeEventListener("icecandidate", s), i = !0, n._rtcReady = !0; var o = { originator: "local", type: e, sdp: r.localDescription.sdp }; b('emit "sdp"'), n.emit("sdp", o), t(o.sdp) }; r.addEventListener("icecandidate", s = function (e) { var t = e.candidate; t ? n.emit("icecandidate", { candidate: t, ready: o }) : i || o() }) })) })) } }, { key: "_createDialog", value: function (e, t, n) { var r = "UAS" === t ? e.to_tag : e.from_tag, s = "UAS" === t ? e.from_tag : e.to_tag, i = e.call_id + r + s, o = this._earlyDialogs[i]; if (n) return !!o || ((o = new g(this, e, t, g.C.STATUS_EARLY)).error ? (b(o.error), this._failed("remote", e, h.causes.INTERNAL_ERROR), !1) : (this._earlyDialogs[i] = o, !0)); if (this._from_tag = e.from_tag, this._to_tag = e.to_tag, o) return o.update(e, t), this._dialog = o, delete this._earlyDialogs[i], !0; var a = new g(this, e, t); return a.error ? (b(a.error), this._failed("remote", e, h.causes.INTERNAL_ERROR), !1) : (this._dialog = a, !0) } }, { key: "_receiveReinvite", value: function (e) { var t = this; b("receiveReinvite()"); var n = e.getHeader("Content-Type"), r = { request: e, callback: void 0, reject: function () { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; s = !0; var n = t.status_code || 403, r = t.reason_phrase || "", i = p.cloneArray(t.extraHeaders); if (this._status !== A.STATUS_CONFIRMED) return !1; if (n < 300 || n >= 700) throw new TypeError("Invalid status_code: ".concat(n)); e.reply(n, r, i) }.bind(this) }, s = !1; if (this.emit("reinvite", r), !s) { if (this._late_sdp = !1, !e.body) return this._late_sdp = !0, void (this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._createLocalDescription("offer", t._rtcOfferConstraints) })).then((function (e) { i.call(t, e) })).catch((function () { e.reply(500) }))); if ("application/sdp" !== n) return b("invalid Content-Type"), void e.reply(415); this._processInDialogSdpOffer(e).then((function (e) { t._status !== A.STATUS_TERMINATED && i.call(t, e) })).catch((function (e) { E(e) })) } function i(t) { var n = this, s = ["Contact: ".concat(this._contact)]; this._handleSessionTimersInIncomingRequest(e, s), this._late_sdp && (t = this._mangleOffer(t)), e.reply(200, null, s, t, (function () { n._status = A.STATUS_WAITING_FOR_ACK, n._setInvite2xxTimer(e, t), n._setACKTimer() })), "function" == typeof r.callback && r.callback() } } }, { key: "_receiveUpdate", value: function (e) { var t = this; b("receiveUpdate()"); var n = e.getHeader("Content-Type"), r = { request: e, callback: void 0, reject: function () { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; s = !0; var n = t.status_code || 403, r = t.reason_phrase || "", i = p.cloneArray(t.extraHeaders); if (this._status !== A.STATUS_CONFIRMED) return !1; if (n < 300 || n >= 700) throw new TypeError("Invalid status_code: ".concat(n)); e.reply(n, r, i) }.bind(this) }, s = !1; if (this.emit("update", r), !s) if (e.body) { if ("application/sdp" !== n) return b("invalid Content-Type"), void e.reply(415); this._processInDialogSdpOffer(e).then((function (e) { t._status !== A.STATUS_TERMINATED && i.call(t, e) })).catch((function (e) { E(e) })) } else i.call(this, null); function i(t) { var n = ["Contact: ".concat(this._contact)]; this._handleSessionTimersInIncomingRequest(e, n), e.reply(200, null, n, t), "function" == typeof r.callback && r.callback() } } }, { key: "_processInDialogSdpOffer", value: function (e) { var t = this; b("_processInDialogSdpOffer()"); var n = e.parseSDP(), r = !1, s = !0, i = !1, o = void 0; try { for (var a, l = n.media[Symbol.iterator](); !(s = (a = l.next()).done); s = !0) { var u = a.value; if (-1 !== w.indexOf(u.type)) { var c = u.direction || n.direction || "sendrecv"; if ("sendonly" !== c && "inactive" !== c) { r = !1; break } r = !0 } } } catch (e) { i = !0, o = e } finally { try { s || null == l.return || l.return() } finally { if (i) throw o } } var h = { originator: "remote", type: "offer", sdp: e.body }; b('emit "sdp"'), this.emit("sdp", h); var d = new RTCSessionDescription({ type: "offer", sdp: h.sdp }); return this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { if (t._status === A.STATUS_TERMINATED) throw new Error("terminated"); return t._connection.setRemoteDescription(d).catch((function (n) { throw e.reply(488), E('emit "peerconnection:setremotedescriptionfailed" [error:%o]', n), t.emit("peerconnection:setremotedescriptionfailed", n), new Error("peerconnection.setRemoteDescription() failed") })) })).then((function () { if (t._status === A.STATUS_TERMINATED) throw new Error("terminated"); !0 === t._remoteHold && !1 === r ? (t._remoteHold = !1, t._onunhold("remote")) : !1 === t._remoteHold && !0 === r && (t._remoteHold = !0, t._onhold("remote")) })).then((function () { if (t._status === A.STATUS_TERMINATED) throw new Error("terminated"); return t._createLocalDescription("answer", t._rtcAnswerConstraints).catch((function () { throw e.reply(500), new Error("_createLocalDescription() failed") })) })), this._connectionPromiseQueue } }, { key: "_receiveRefer", value: function (e) { var n = this; if (b("receiveRefer()"), void 0 === r(e.refer_to)) return b("no Refer-To header field present in REFER"), void e.reply(400); if (e.refer_to.uri.scheme !== h.SIP) return b("Refer-To header field points to a non-SIP URI scheme"), void e.reply(416); e.reply(202); var s = new T(this, e.cseq); function i(n) { var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; if (n = "function" == typeof n ? n : null, this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; var i = new t(this._ua); if (i.on("progress", (function (e) { var t = e.response; s.notify(t.status_code, t.reason_phrase) })), i.on("accepted", (function (e) { var t = e.response; s.notify(t.status_code, t.reason_phrase) })), i.on("failed", (function (e) { var t = e.message, n = e.cause; t ? s.notify(t.status_code, t.reason_phrase) : s.notify(487, n) })), e.refer_to.uri.hasHeader("replaces")) { var o = decodeURIComponent(e.refer_to.uri.getHeader("replaces")); r.extraHeaders = p.cloneArray(r.extraHeaders), r.extraHeaders.push("Replaces: ".concat(o)) } i.connect(e.refer_to.uri.toAor(), r, n) } function o() { s.notify(603) } b('emit "refer"'), this.emit("refer", { request: e, accept: function (e, t) { i.call(n, e, t) }, reject: function () { o.call(n) } }) } }, { key: "_receiveNotify", value: function (e) { if (b("receiveNotify()"), void 0 === r(e.event) && e.reply(400), "refer" === e.event.event) { var t, n; if (e.event.params && e.event.params.id) t = e.event.params.id, n = this._referSubscribers[t]; else { if (1 !== Object.keys(this._referSubscribers).length) return void e.reply(400, "Missing event id parameter"); n = this._referSubscribers[Object.keys(this._referSubscribers)[0]] } if (!n) return void e.reply(481, "Subscription does not exist"); n.receiveNotify(e), e.reply(200) } else e.reply(489) } }, { key: "_receiveReplaces", value: function (e) { var n = this; function r(n) { var r = this; if (this._status !== A.STATUS_WAITING_FOR_ACK && this._status !== A.STATUS_CONFIRMED) return !1; var s = new t(this._ua); s.on("confirmed", (function () { r.terminate() })), s.init_incoming(e, n) } function s() { b("Replaced INVITE rejected by the user"), e.reply(486) } b("receiveReplaces()"), this.emit("replaces", { request: e, accept: function (e) { r.call(n, e) }, reject: function () { s.call(n) } }) } }, { key: "_sendInitialRequest", value: function (e, t, n) { var r = this, s = new v(this._ua, this._request, { onRequestTimeout: function () { r.onRequestTimeout() }, onTransportError: function () { r.onTransportError() }, onAuthenticated: function (e) { r._request = e }, onReceiveResponse: function (e) { r._receiveInviteResponse(e) } }); Promise.resolve().then((function () { return n || (e.audio || e.video ? (r._localMediaStreamLocallyGenerated = !0, navigator.mediaDevices.getUserMedia(e).catch((function (e) { if (r._status === A.STATUS_TERMINATED) throw new Error("terminated"); throw r._failed("local", null, h.causes.USER_DENIED_MEDIA_ACCESS), E('emit "getusermediafailed" [error:%o]', e), r.emit("getusermediafailed", e), e }))) : void 0) })).then((function (e) { if (r._status === A.STATUS_TERMINATED) throw new Error("terminated"); return r._localMediaStream = e, e && r._connection.addStream(e), r._connecting(r._request), r._createLocalDescription("offer", t).catch((function (e) { throw r._failed("local", null, h.causes.WEBRTC_ERROR), e })) })).then((function (e) { if (r._is_canceled || r._status === A.STATUS_TERMINATED) throw new Error("terminated"); r._request.body = e, r._status = A.STATUS_INVITE_SENT, b('emit "sending" [request:%o]', r._request), r.emit("sending", { request: r._request }), s.send() })).catch((function (e) { r._status !== A.STATUS_TERMINATED && E(e) })) } }, { key: "_receiveInviteResponse", value: function (e) { var t = this; if (b("receiveInviteResponse()"), this._dialog && e.status_code >= 200 && e.status_code <= 299) { if (this._dialog.id.call_id === e.call_id && this._dialog.id.local_tag === e.from_tag && this._dialog.id.remote_tag === e.to_tag) return void this.sendRequest(h.ACK); var n = new g(this, e, "UAC"); return void 0 !== n.error ? void b(n.error) : (this.sendRequest(h.ACK), void this.sendRequest(h.BYE)) } if (this._is_canceled) e.status_code >= 100 && e.status_code < 200 ? this._request.cancel(this._cancel_reason) : e.status_code >= 200 && e.status_code < 299 && this._acceptAndTerminate(e); else if (this._status === A.STATUS_INVITE_SENT || this._status === A.STATUS_1XX_RECEIVED) switch (!0) { case /^100$/.test(e.status_code): this._status = A.STATUS_1XX_RECEIVED; break; case /^1[0-9]{2}$/.test(e.status_code): if (!e.to_tag) { b("1xx response received without to tag"); break } if (e.hasHeader("contact") && !this._createDialog(e, "UAC", !0)) break; if (this._status = A.STATUS_1XX_RECEIVED, this._progress("remote", e), !e.body) break; var r = { originator: "remote", type: "answer", sdp: e.body }; b('emit "sdp"'), this.emit("sdp", r); var s = new RTCSessionDescription({ type: "answer", sdp: r.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(s) })).catch((function (e) { E('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })); break; case /^2[0-9]{2}$/.test(e.status_code): if (this._status = A.STATUS_CONFIRMED, !e.body) { this._acceptAndTerminate(e, 400, h.causes.MISSING_SDP), this._failed("remote", e, h.causes.BAD_MEDIA_DESCRIPTION); break } if (!this._createDialog(e, "UAC")) break; var i = { originator: "remote", type: "answer", sdp: e.body }; b('emit "sdp"'), this.emit("sdp", i); var o = new RTCSessionDescription({ type: "answer", sdp: i.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { if ("stable" === t._connection.signalingState) return t._connection.createOffer().then((function (e) { return t._connection.setLocalDescription(e) })).catch((function (n) { t._acceptAndTerminate(e, 500, n.toString()), t._failed("local", e, h.causes.WEBRTC_ERROR) })) })).then((function () { t._connection.setRemoteDescription(o).then((function () { t._handleSessionTimersInIncomingResponse(e), t._accepted("remote", e), t.sendRequest(h.ACK), t._confirmed("local", null) })).catch((function (n) { t._acceptAndTerminate(e, 488, "Not Acceptable Here"), t._failed("remote", e, h.causes.BAD_MEDIA_DESCRIPTION), E('emit "peerconnection:setremotedescriptionfailed" [error:%o]', n), t.emit("peerconnection:setremotedescriptionfailed", n) })) })); break; default: var a = p.sipErrorCause(e.status_code); this._failed("remote", e, a) } } }, { key: "_sendReinvite", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; b("sendReinvite()"); var n = p.cloneArray(t.extraHeaders), r = t.eventHandlers || {}, s = t.rtcOfferConstraints || this._rtcOfferConstraints || null, i = !1; function o(e) { var t = this; if (this._status !== A.STATUS_TERMINATED && (this.sendRequest(h.ACK), !i)) if (this._handleSessionTimersInIncomingResponse(e), e.body) if ("application/sdp" === e.getHeader("Content-Type")) { var n = { originator: "remote", type: "answer", sdp: e.body }; b('emit "sdp"'), this.emit("sdp", n); var s = new RTCSessionDescription({ type: "answer", sdp: n.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(s) })).then((function () { r.succeeded && r.succeeded(e) })).catch((function (e) { a.call(t), E('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })) } else a.call(this); else a.call(this) } function a(e) { r.failed && r.failed(e) } n.push("Contact: ".concat(this._contact)), n.push("Content-Type: application/sdp"), this._sessionTimers.running && n.push("Session-Expires: ".concat(this._sessionTimers.currentExpires, ";refresher=").concat(this._sessionTimers.refresher ? "uac" : "uas")), this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return e._createLocalDescription("offer", s) })).then((function (t) { t = e._mangleOffer(t), e.sendRequest(h.INVITE, { extraHeaders: n, body: t, eventHandlers: { onSuccessResponse: function (t) { o.call(e, t), i = !0 }, onErrorResponse: function (t) { a.call(e, t) }, onTransportError: function () { e.onTransportError() }, onRequestTimeout: function () { e.onRequestTimeout() }, onDialogError: function () { e.onDialogError() } } }) })).catch((function () { a() })) } }, { key: "_sendUpdate", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; b("sendUpdate()"); var n = p.cloneArray(t.extraHeaders), r = t.eventHandlers || {}, s = t.rtcOfferConstraints || this._rtcOfferConstraints || null, i = t.sdpOffer || !1, o = !1; function a(e) { var t = this; if (this._status !== A.STATUS_TERMINATED && !o) if (this._handleSessionTimersInIncomingResponse(e), i) { if (!e.body) return void l.call(this); if ("application/sdp" !== e.getHeader("Content-Type")) return void l.call(this); var n = { originator: "remote", type: "answer", sdp: e.body }; b('emit "sdp"'), this.emit("sdp", n); var s = new RTCSessionDescription({ type: "answer", sdp: n.sdp }); this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return t._connection.setRemoteDescription(s) })).then((function () { r.succeeded && r.succeeded(e) })).catch((function (e) { l.call(t), E('emit "peerconnection:setremotedescriptionfailed" [error:%o]', e), t.emit("peerconnection:setremotedescriptionfailed", e) })) } else r.succeeded && r.succeeded(e) } function l(e) { r.failed && r.failed(e) } n.push("Contact: ".concat(this._contact)), this._sessionTimers.running && n.push("Session-Expires: ".concat(this._sessionTimers.currentExpires, ";refresher=").concat(this._sessionTimers.refresher ? "uac" : "uas")), i ? (n.push("Content-Type: application/sdp"), this._connectionPromiseQueue = this._connectionPromiseQueue.then((function () { return e._createLocalDescription("offer", s) })).then((function (t) { t = e._mangleOffer(t), e.sendRequest(h.UPDATE, { extraHeaders: n, body: t, eventHandlers: { onSuccessResponse: function (t) { a.call(e, t), o = !0 }, onErrorResponse: function (t) { l.call(e, t) }, onTransportError: function () { e.onTransportError() }, onRequestTimeout: function () { e.onRequestTimeout() }, onDialogError: function () { e.onDialogError() } } }) })).catch((function () { l.call(e) }))) : this.sendRequest(h.UPDATE, { extraHeaders: n, eventHandlers: { onSuccessResponse: function (t) { a.call(e, t) }, onErrorResponse: function (t) { l.call(e, t) }, onTransportError: function () { e.onTransportError() }, onRequestTimeout: function () { e.onRequestTimeout() }, onDialogError: function () { e.onDialogError() } } }) } }, { key: "_acceptAndTerminate", value: function (e, t, n) { b("acceptAndTerminate()"); var r = []; t && (n = n || h.REASON_PHRASE[t] || "", r.push("Reason: SIP ;cause=".concat(t, '; text="').concat(n, '"'))), (this._dialog || this._createDialog(e, "UAC")) && (this.sendRequest(h.ACK), this.sendRequest(h.BYE, { extraHeaders: r })), this._status = A.STATUS_TERMINATED } }, { key: "_mangleOffer", value: function (e) { if (!this._localHold && !this._remoteHold) return e; if (e = c.parse(e), this._localHold && !this._remoteHold) { b("mangleOffer() | me on hold, mangling offer"); var t = !0, n = !1, r = void 0; try { for (var s, i = e.media[Symbol.iterator](); !(t = (s = i.next()).done); t = !0) { var o = s.value; -1 !== w.indexOf(o.type) && (o.direction ? "sendrecv" === o.direction ? o.direction = "sendonly" : "recvonly" === o.direction && (o.direction = "inactive") : o.direction = "sendonly") } } catch (e) { n = !0, r = e } finally { try { t || null == i.return || i.return() } finally { if (n) throw r } } } else if (this._localHold && this._remoteHold) { b("mangleOffer() | both on hold, mangling offer"); var a = !0, l = !1, u = void 0; try { for (var h, d = e.media[Symbol.iterator](); !(a = (h = d.next()).done); a = !0) { var f = h.value; -1 !== w.indexOf(f.type) && (f.direction = "inactive") } } catch (e) { l = !0, u = e } finally { try { a || null == d.return || d.return() } finally { if (l) throw u } } } else if (this._remoteHold) { b("mangleOffer() | remote on hold, mangling offer"); var p = !0, _ = !1, m = void 0; try { for (var g, v = e.media[Symbol.iterator](); !(p = (g = v.next()).done); p = !0) { var y = g.value; -1 !== w.indexOf(y.type) && (y.direction ? "sendrecv" === y.direction ? y.direction = "recvonly" : "recvonly" === y.direction && (y.direction = "inactive") : y.direction = "recvonly") } } catch (e) { _ = !0, m = e } finally { try { p || null == v.return || v.return() } finally { if (_) throw m } } } return c.write(e) } }, { key: "_setLocalMediaStatus", value: function () { var e = !0, t = !0; (this._localHold || this._remoteHold) && (e = !1, t = !1), this._audioMuted && (e = !1), this._videoMuted && (t = !1), this._toogleMuteAudio(!e), this._toogleMuteVideo(!t) } }, { key: "_handleSessionTimersInIncomingRequest", value: function (e, t) { var n; this._sessionTimers.enabled && (e.session_expires && e.session_expires >= h.MIN_SESSION_EXPIRES ? (this._sessionTimers.currentExpires = e.session_expires, n = e.session_expires_refresher || "uas") : (this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires, n = "uas"), t.push("Session-Expires: ".concat(this._sessionTimers.currentExpires, ";refresher=").concat(n)), this._sessionTimers.refresher = "uas" === n, this._runSessionTimer()) } }, { key: "_handleSessionTimersInIncomingResponse", value: function (e) { var t; this._sessionTimers.enabled && (e.session_expires && e.session_expires >= h.MIN_SESSION_EXPIRES ? (this._sessionTimers.currentExpires = e.session_expires, t = e.session_expires_refresher || "uac") : (this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires, t = "uac"), this._sessionTimers.refresher = "uac" === t, this._runSessionTimer()) } }, { key: "_runSessionTimer", value: function () { var e = this, t = this._sessionTimers.currentExpires; this._sessionTimers.running = !0, clearTimeout(this._sessionTimers.timer), this._sessionTimers.refresher ? this._sessionTimers.timer = setTimeout((function () { e._status !== A.STATUS_TERMINATED && (b("runSessionTimer() | sending session refresh request"), e._sessionTimers.refreshMethod === h.UPDATE ? e._sendUpdate() : e._sendReinvite()) }), 500 * t) : this._sessionTimers.timer = setTimeout((function () { e._status !== A.STATUS_TERMINATED && (E("runSessionTimer() | timer expired, terminating the session"), e.terminate({ cause: h.causes.REQUEST_TIMEOUT, status_code: 408, reason_phrase: "Session Timer Expired" })) }), 1100 * t) } }, { key: "_toogleMuteAudio", value: function (e) { var t = this._connection.getLocalStreams(), n = !0, r = !1, s = void 0; try { for (var i, o = t[Symbol.iterator](); !(n = (i = o.next()).done); n = !0) { var a = i.value.getAudioTracks(), l = !0, u = !1, c = void 0; try { for (var h, d = a[Symbol.iterator](); !(l = (h = d.next()).done); l = !0) { h.value.enabled = !e } } catch (e) { u = !0, c = e } finally { try { l || null == d.return || d.return() } finally { if (u) throw c } } } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } }, { key: "_toogleMuteVideo", value: function (e) { var t = this._connection.getLocalStreams(), n = !0, r = !1, s = void 0; try { for (var i, o = t[Symbol.iterator](); !(n = (i = o.next()).done); n = !0) { var a = i.value.getVideoTracks(), l = !0, u = !1, c = void 0; try { for (var h, d = a[Symbol.iterator](); !(l = (h = d.next()).done); l = !0) { h.value.enabled = !e } } catch (e) { u = !0, c = e } finally { try { l || null == d.return || d.return() } finally { if (u) throw c } } } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } }, { key: "_newRTCSession", value: function (e, t) { b("newRTCSession()"), this._ua.newRTCSession(this, { originator: e, session: this, request: t }) } }, { key: "_connecting", value: function (e) { b("session connecting"), b('emit "connecting"'), this.emit("connecting", { request: e }) } }, { key: "_progress", value: function (e, t) { b("session progress"), b('emit "progress"'), this.emit("progress", { originator: e, response: t || null }) } }, { key: "_accepted", value: function (e, t) { b("session accepted"), this._start_time = new Date, b('emit "accepted"'), this.emit("accepted", { originator: e, response: t || null }) } }, { key: "_confirmed", value: function (e, t) { b("session confirmed"), this._is_confirmed = !0, b('emit "confirmed"'), this.emit("confirmed", { originator: e, ack: t || null }) } }, { key: "_ended", value: function (e, t, n) { b("session ended"), this._end_time = new Date, this._close(), b('emit "ended"'), this.emit("ended", { originator: e, message: t || null, cause: n }) } }, { key: "_failed", value: function (e, t, n) { b("session failed"), this._close(), b('emit "failed"'), this.emit("failed", { originator: e, message: t || null, cause: n }) } }, { key: "_onhold", value: function (e) { b("session onhold"), this._setLocalMediaStatus(), b('emit "hold"'), this.emit("hold", { originator: e }) } }, { key: "_onunhold", value: function (e) { b("session onunhold"), this._setLocalMediaStatus(), b('emit "unhold"'), this.emit("unhold", { originator: e }) } }, { key: "_onmute", value: function (e) { var t = e.audio, n = e.video; b("session onmute"), this._setLocalMediaStatus(), b('emit "muted"'), this.emit("muted", { audio: t, video: n }) } }, { key: "_onunmute", value: function (e) { var t = e.audio, n = e.video; b("session onunmute"), this._setLocalMediaStatus(), b('emit "unmuted"'), this.emit("unmuted", { audio: t, video: n }) } }, { key: "C", get: function () { return A } }, { key: "causes", get: function () { return h.causes } }, { key: "id", get: function () { return this._id } }, { key: "connection", get: function () { return this._connection } }, { key: "contact", get: function () { return this._contact } }, { key: "direction", get: function () { return this._direction } }, { key: "local_identity", get: function () { return this._local_identity } }, { key: "remote_identity", get: function () { return this._remote_identity } }, { key: "start_time", get: function () { return this._start_time } }, { key: "end_time", get: function () { return this._end_time } }, { key: "data", get: function () { return this._data }, set: function (e) { this._data = e } }, { key: "status", get: function () { return this._status } }]), t }(u) }, 4481: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } var l = n(7187).EventEmitter, u = n(965), c = n(8063), h = n(5424), d = n(1272)("JsSIP:RTCSession:DTMF"); n(1272)("JsSIP:ERROR:RTCSession:DTMF").log = console.warn.bind(console); var f = { MIN_DURATION: 70, MAX_DURATION: 6e3, DEFAULT_DURATION: 100, MIN_INTER_TONE_GAP: 50, DEFAULT_INTER_TONE_GAP: 500 }; e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._session = e, n._direction = null, n._tone = null, n._duration = null, n._request = null, n } var n, r, l; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) }(t, e), n = t, r = [{ key: "send", value: function (e) { var t = this, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; if (void 0 === e) throw new TypeError("Not enough arguments"); if (this._direction = "outgoing", this._session.status !== this._session.C.STATUS_CONFIRMED && this._session.status !== this._session.C.STATUS_WAITING_FOR_ACK) throw new c.InvalidStateError(this._session.status); var r = h.cloneArray(n.extraHeaders); if (this.eventHandlers = n.eventHandlers || {}, "string" == typeof e) e = e.toUpperCase(); else { if ("number" != typeof e) throw new TypeError("Invalid tone: ".concat(e)); e = e.toString() } if (!e.match(/^[0-9A-DR#*]$/)) throw new TypeError("Invalid tone: ".concat(e)); this._tone = e, this._duration = n.duration, r.push("Content-Type: application/dtmf-relay"); var s = "Signal=".concat(this._tone, "\r\n"); s += "Duration=".concat(this._duration), this._session.newDTMF({ originator: "local", dtmf: this, request: this._request }), this._session.sendRequest(u.INFO, { extraHeaders: r, eventHandlers: { onSuccessResponse: function (e) { t.emit("succeeded", { originator: "remote", response: e }) }, onErrorResponse: function (e) { t.eventHandlers.onFailed && t.eventHandlers.onFailed(), t.emit("failed", { originator: "remote", response: e }) }, onRequestTimeout: function () { t._session.onRequestTimeout() }, onTransportError: function () { t._session.onTransportError() }, onDialogError: function () { t._session.onDialogError() } }, body: s }) } }, { key: "init_incoming", value: function (e) { var t = /^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/, n = /^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/; if (this._direction = "incoming", this._request = e, e.reply(200), e.body) { var r = e.body.split("\n"); r.length >= 1 && t.test(r[0]) && (this._tone = r[0].replace(t, "$2")), r.length >= 2 && n.test(r[1]) && (this._duration = parseInt(r[1].replace(n, "$2"), 10)) } this._duration || (this._duration = f.DEFAULT_DURATION), this._tone ? this._session.newDTMF({ originator: "remote", dtmf: this, request: e }) : d("invalid INFO DTMF received, discarded") } }, { key: "tone", get: function () { return this._tone } }, { key: "duration", get: function () { return this._duration } }], r && s(n.prototype, r), l && s(n, l), t }(l), e.exports.C = f }, 2126: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } var l = n(7187).EventEmitter; n(1272)("JsSIP:ERROR:RTCSession:Info").log = console.warn.bind(console); var u = n(965), c = n(8063), h = n(5424); e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._session = e, n._direction = null, n._contentType = null, n._body = null, n } var n, r, l; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) }(t, e), n = t, r = [{ key: "send", value: function (e, t) { var n = this, r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}; if (this._direction = "outgoing", void 0 === e) throw new TypeError("Not enough arguments"); if (this._session.status !== this._session.C.STATUS_CONFIRMED && this._session.status !== this._session.C.STATUS_WAITING_FOR_ACK) throw new c.InvalidStateError(this._session.status); this._contentType = e, this._body = t; var s = h.cloneArray(r.extraHeaders); s.push("Content-Type: ".concat(e)), this._session.newInfo({ originator: "local", info: this, request: this.request }), this._session.sendRequest(u.INFO, { extraHeaders: s, eventHandlers: { onSuccessResponse: function (e) { n.emit("succeeded", { originator: "remote", response: e }) }, onErrorResponse: function (e) { n.emit("failed", { originator: "remote", response: e }) }, onTransportError: function () { n._session.onTransportError() }, onRequestTimeout: function () { n._session.onRequestTimeout() }, onDialogError: function () { n._session.onDialogError() } }, body: t }) } }, { key: "init_incoming", value: function (e) { this._direction = "incoming", this.request = e, e.reply(200), this._contentType = e.getHeader("content-type"), this._body = e.body, this._session.newInfo({ originator: "remote", info: this, request: e }) } }, { key: "contentType", get: function () { return this._contentType } }, { key: "body", get: function () { return this._body } }], r && s(n.prototype, r), l && s(n, l), t }(l) }, 5774: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(965), i = n(1272)("JsSIP:RTCSession:ReferNotifier"), o = "refer", a = "message/sipfrag;version=2.0", l = 300; e.exports = function () { function e(t, n, r) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._session = t, this._id = n, this._expires = r || l, this._active = !0, this.notify(100) } var t, n, u; return t = e, (n = [{ key: "notify", value: function (e, t) { var n; i("notify()"), !1 !== this._active && (t = t || s.REASON_PHRASE[e] || "", n = e >= 200 ? "terminated;reason=noresource" : "active;expires=".concat(this._expires), this._session.sendRequest(s.NOTIFY, { extraHeaders: ["Event: ".concat(o, ";id=").concat(this._id), "Subscription-State: ".concat(n), "Content-Type: ".concat(a)], body: "SIP/2.0 ".concat(e, " ").concat(t), eventHandlers: { onErrorResponse: function () { this._active = !1 } } })) } }]) && r(t.prototype, n), u && r(t, u), e }() }, 603: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function o(e) { return o = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, o(e) } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } var l = n(7187).EventEmitter, u = n(965), c = n(3790), h = n(5424), d = n(1272)("JsSIP:RTCSession:ReferSubscriber"); e.exports = function (e) { function t(e) { var n; return function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), (n = i(this, o(t).call(this)))._id = null, n._session = e, n } var n, r, l; return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) }(t, e), n = t, r = [{ key: "sendRefer", value: function (e) { var t = this, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; d("sendRefer()"); var r = h.cloneArray(n.extraHeaders), s = n.eventHandlers || {}; for (var i in s) Object.prototype.hasOwnProperty.call(s, i) && this.on(i, s[i]); var o = null; n.replaces && (o = n.replaces._request.call_id, o += ";to-tag=".concat(n.replaces._to_tag), o += ";from-tag=".concat(n.replaces._from_tag), o = encodeURIComponent(o)); var a = "Refer-To: <".concat(e).concat(o ? "?Replaces=".concat(o) : "", ">"); r.push(a), r.push("Contact: ".concat(this._session.contact)); var l = this._session.sendRequest(u.REFER, { extraHeaders: r, eventHandlers: { onSuccessResponse: function (e) { t._requestSucceeded(e) }, onErrorResponse: function (e) { t._requestFailed(e, u.causes.REJECTED) }, onTransportError: function () { t._requestFailed(null, u.causes.CONNECTION_ERROR) }, onRequestTimeout: function () { t._requestFailed(null, u.causes.REQUEST_TIMEOUT) }, onDialogError: function () { t._requestFailed(null, u.causes.DIALOG_ERROR) } } }); this._id = l.cseq } }, { key: "receiveNotify", value: function (e) { if (d("receiveNotify()"), e.body) { var t = c.parse(e.body.trim(), "Status_Line"); if (-1 !== t) switch (!0) { case /^100$/.test(t.status_code): this.emit("trying", { request: e, status_line: t }); break; case /^1[0-9]{2}$/.test(t.status_code): this.emit("progress", { request: e, status_line: t }); break; case /^2[0-9]{2}$/.test(t.status_code): this.emit("accepted", { request: e, status_line: t }); break; default: this.emit("failed", { request: e, status_line: t }) } else d('receiveNotify() | error parsing NOTIFY body: "'.concat(e.body, '"')) } } }, { key: "_requestSucceeded", value: function (e) { d("REFER succeeded"), d('emit "requestSucceeded"'), this.emit("requestSucceeded", { response: e }) } }, { key: "_requestFailed", value: function (e, t) { d("REFER failed"), d('emit "requestFailed"'), this.emit("requestFailed", { response: e || null, cause: t }) } }, { key: "id", get: function () { return this._id } }], r && s(n.prototype, r), l && s(n, l), t }(l) }, 116: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(5424), i = n(965), o = n(6497), a = n(2066), l = n(1272)("JsSIP:Registrator"); e.exports = function () { function e(t, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e); this._ua = t, this._transport = n, this._registrar = t.configuration.registrar_server, this._expires = t.configuration.register_expires, this._call_id = s.createRandomToken(22), this._cseq = 0, this._to_uri = t.configuration.uri, this._registrationTimer = null, this._registering = !1, this._registered = !1, this._contact = this._ua.contact.toString(), this._contact += ";+sip.ice", this._extraHeaders = [], this._extraContactParams = "", this._contact += ";reg-id=".concat(1), this._contact += ';+sip.instance="<urn:uuid:'.concat(this._ua.configuration.instance_id, '>"') } var t, n, u; return t = e, n = [{ key: "setExtraHeaders", value: function (e) { Array.isArray(e) || (e = []), this._extraHeaders = e.slice() } }, { key: "setExtraContactParams", value: function (e) { for (var t in e instanceof Object || (e = {}), this._extraContactParams = "", e) if (Object.prototype.hasOwnProperty.call(e, t)) { var n = e[t]; this._extraContactParams += ";".concat(t), n && (this._extraContactParams += "=".concat(n)) } } }, { key: "register", value: function () { var e = this; if (this._registering) l("Register request in progress..."); else { var t = this._extraHeaders.slice(); t.push("Contact: ".concat(this._contact, ";expires=").concat(this._expires).concat(this._extraContactParams)), t.push("Expires: ".concat(this._expires)); var n = new o.OutgoingRequest(i.REGISTER, this._registrar, this._ua, { to_uri: this._to_uri, call_id: this._call_id, cseq: this._cseq += 1 }, t), r = new a(this._ua, n, { onRequestTimeout: function () { e._registrationFailure(null, i.causes.REQUEST_TIMEOUT) }, onTransportError: function () { e._registrationFailure(null, i.causes.CONNECTION_ERROR) }, onAuthenticated: function () { e._cseq += 1 }, onReceiveResponse: function (t) { var n, r, o = t.getHeaders("contact").length; if (t.cseq === e._cseq) switch (null !== e._registrationTimer && (clearTimeout(e._registrationTimer), e._registrationTimer = null), !0) { case /^1[0-9]{2}$/.test(t.status_code): break; case /^2[0-9]{2}$/.test(t.status_code): if (e._registering = !1, !o) { l("no Contact header in response to REGISTER, response ignored"); break } for (; o--;) { if ((n = t.parseHeader("contact", o)).uri.user === e._ua.contact.uri.user) { r = n.getParam("expires"); break } n = null } if (!n) { l("no Contact header pointing to us, response ignored"); break } !r && t.hasHeader("expires") && (r = t.getHeader("expires")), r || (r = e._expires), (r = Number(r)) < 10 && (r = 10), e._registrationTimer = setTimeout((function () { e._registrationTimer = null, 0 === e._ua.listeners("registrationExpiring").length ? e.register() : e._ua.emit("registrationExpiring") }), 1e3 * r - 5e3), n.hasParam("temp-gruu") && (e._ua.contact.temp_gruu = n.getParam("temp-gruu").replace(/"/g, "")), n.hasParam("pub-gruu") && (e._ua.contact.pub_gruu = n.getParam("pub-gruu").replace(/"/g, "")), e._registered || (e._registered = !0, e._ua.registered({ response: t })); break; case /^423$/.test(t.status_code): t.hasHeader("min-expires") ? (e._expires = Number(t.getHeader("min-expires")), e._expires < 10 && (e._expires = 10), e.register()) : (l("423 response received for REGISTER without Min-Expires"), e._registrationFailure(t, i.causes.SIP_FAILURE_CODE)); break; default: var a = s.sipErrorCause(t.status_code); e._registrationFailure(t, a) } } }); this._registering = !0, r.send() } } }, { key: "unregister", value: function () { var e = this, t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; if (this._registered) { this._registered = !1, null !== this._registrationTimer && (clearTimeout(this._registrationTimer), this._registrationTimer = null); var n = this._extraHeaders.slice(); t.all ? n.push("Contact: *".concat(this._extraContactParams)) : n.push("Contact: ".concat(this._contact, ";expires=0").concat(this._extraContactParams)), n.push("Expires: 0"); var r = new o.OutgoingRequest(i.REGISTER, this._registrar, this._ua, { to_uri: this._to_uri, call_id: this._call_id, cseq: this._cseq += 1 }, n), u = new a(this._ua, r, { onRequestTimeout: function () { e._unregistered(null, i.causes.REQUEST_TIMEOUT) }, onTransportError: function () { e._unregistered(null, i.causes.CONNECTION_ERROR) }, onAuthenticated: function () { e._cseq += 1 }, onReceiveResponse: function (t) { switch (!0) { case /^1[0-9]{2}$/.test(t.status_code): break; case /^2[0-9]{2}$/.test(t.status_code): e._unregistered(t); break; default: var n = s.sipErrorCause(t.status_code); e._unregistered(t, n) } } }); u.send() } else l("already unregistered") } }, { key: "close", value: function () { this._registered && this.unregister() } }, { key: "onTransportClosed", value: function () { this._registering = !1, null !== this._registrationTimer && (clearTimeout(this._registrationTimer), this._registrationTimer = null), this._registered && (this._registered = !1, this._ua.unregistered({})) } }, { key: "_registrationFailure", value: function (e, t) { this._registering = !1, this._ua.registrationFailed({ response: e || null, cause: t }), this._registered && (this._registered = !1, this._ua.unregistered({ response: e || null, cause: t })) } }, { key: "_unregistered", value: function (e, t) { this._registering = !1, this._registered = !1, this._ua.unregistered({ response: e || null, cause: t || null }) } }, { key: "registered", get: function () { return this._registered } }], n && r(t.prototype, n), u && r(t, u), e }() }, 2066: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(965), i = n(2999), o = n(3754), a = n(1272)("JsSIP:RequestSender"), l = { onRequestTimeout: function () { }, onTransportError: function () { }, onReceiveResponse: function () { }, onAuthenticated: function () { } }; e.exports = function () { function e(t, n, r) { for (var i in function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this._ua = t, this._eventHandlers = r, this._method = n.method, this._request = n, this._auth = null, this._challenged = !1, this._staled = !1, l) Object.prototype.hasOwnProperty.call(l, i) && (this._eventHandlers[i] || (this._eventHandlers[i] = l[i])); t.status !== t.C.STATUS_USER_CLOSED || this._method === s.BYE && this._method === s.ACK || this._eventHandlers.onTransportError() } var t, n, u; return t = e, (n = [{ key: "send", value: function () { var e = this, t = { onRequestTimeout: function () { e._eventHandlers.onRequestTimeout() }, onTransportError: function () { e._eventHandlers.onTransportError() }, onReceiveResponse: function (t) { e._receiveResponse(t) } }; switch (this._method) { case "INVITE": this.clientTransaction = new o.InviteClientTransaction(this._ua, this._ua.transport, this._request, t); break; case "ACK": this.clientTransaction = new o.AckClientTransaction(this._ua, this._ua.transport, this._request, t); break; default: this.clientTransaction = new o.NonInviteClientTransaction(this._ua, this._ua.transport, this._request, t) }this.clientTransaction.send() } }, { key: "_receiveResponse", value: function (e) { var t, n, r = e.status_code; if (401 !== r && 407 !== r || null === this._ua.configuration.password && null === this._ua.configuration.ha1) this._eventHandlers.onReceiveResponse(e); else { if (401 === e.status_code ? (t = e.parseHeader("www-authenticate"), n = "authorization") : (t = e.parseHeader("proxy-authenticate"), n = "proxy-authorization"), !t) return a("".concat(e.status_code, " with wrong or missing challenge, cannot authenticate")), void this._eventHandlers.onReceiveResponse(e); if (!this._challenged || !this._staled && !0 === t.stale) { if (this._auth || (this._auth = new i({ username: this._ua.configuration.authorization_user, password: this._ua.configuration.password, realm: this._ua.configuration.realm, ha1: this._ua.configuration.ha1 })), !this._auth.authenticate(this._request, t)) return void this._eventHandlers.onReceiveResponse(e); this._challenged = !0, this._ua.set("realm", this._auth.get("realm")), this._ua.set("ha1", this._auth.get("ha1")), t.stale && (this._staled = !0), this._request = this._request.clone(), this._request.cseq += 1, this._request.setHeader("cseq", "".concat(this._request.cseq, " ").concat(this._method)), this._request.setHeader(n, this._auth.toString()), this._eventHandlers.onAuthenticated(this._request), this.send() } else this._eventHandlers.onReceiveResponse(e) } } }]) && r(t.prototype, n), u && r(t, u), e }() }, 6497: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) : t } function i(e) { return i = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, i(e) } function o(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } function l(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function u(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function c(e, t, n) { return t && u(e.prototype, t), n && u(e, n), e } var h = n(766), d = n(965), f = n(5424), p = n(9437), _ = n(3790), m = n(1272)("JsSIP:SIPMessage"), g = function () { function e(t, n, r, s, i, o) { if (l(this, e), !t || !n || !r) return null; s = s || {}, this.ua = r, this.headers = {}, this.method = t, this.ruri = n, this.body = o, this.extraHeaders = f.cloneArray(i), s.route_set ? this.setHeader("route", s.route_set) : r.configuration.use_preloaded_route && this.setHeader("route", "<".concat(r.transport.sip_uri, ";lr>")), this.setHeader("via", ""), this.setHeader("max-forwards", d.MAX_FORWARDS); var a, u = s.to_display_name || 0 === s.to_display_name ? '"'.concat(s.to_display_name, '" ') : ""; u += "<".concat(s.to_uri || n, ">"), u += s.to_tag ? ";tag=".concat(s.to_tag) : "", this.to = p.parse(u), this.setHeader("to", u), a = s.from_display_name || 0 === s.from_display_name ? '"'.concat(s.from_display_name, '" ') : r.configuration.display_name ? '"'.concat(r.configuration.display_name, '" ') : "", a += "<".concat(s.from_uri || r.configuration.uri, ">;tag="), a += s.from_tag || f.newTag(), this.from = p.parse(a), this.setHeader("from", a); var c = s.call_id || r.configuration.jssip_id + f.createRandomToken(15); this.call_id = c, this.setHeader("call-id", c); var h = s.cseq || Math.floor(1e4 * Math.random()); this.cseq = h, this.setHeader("cseq", "".concat(h, " ").concat(t)) } return c(e, [{ key: "setHeader", value: function (e, t) { for (var n = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), r = 0; r < this.extraHeaders.length; r++)n.test(this.extraHeaders[r]) && this.extraHeaders.splice(r, 1); this.headers[f.headerize(e)] = Array.isArray(t) ? t : [t] } }, { key: "getHeader", value: function (e) { var t = this.headers[f.headerize(e)]; if (t) { if (t[0]) return t[0] } else { var n = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), r = !0, s = !1, i = void 0; try { for (var o, a = this.extraHeaders[Symbol.iterator](); !(r = (o = a.next()).done); r = !0) { var l = o.value; if (n.test(l)) return l.substring(l.indexOf(":") + 1).trim() } } catch (e) { s = !0, i = e } finally { try { r || null == a.return || a.return() } finally { if (s) throw i } } } } }, { key: "getHeaders", value: function (e) { var t = this.headers[f.headerize(e)], n = []; if (t) { var r = !0, s = !1, i = void 0; try { for (var o, a = t[Symbol.iterator](); !(r = (o = a.next()).done); r = !0) { var l = o.value; n.push(l) } } catch (e) { s = !0, i = e } finally { try { r || null == a.return || a.return() } finally { if (s) throw i } } return n } var u = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), c = !0, h = !1, d = void 0; try { for (var p, _ = this.extraHeaders[Symbol.iterator](); !(c = (p = _.next()).done); c = !0) { var m = p.value; u.test(m) && n.push(m.substring(m.indexOf(":") + 1).trim()) } } catch (e) { h = !0, d = e } finally { try { c || null == _.return || _.return() } finally { if (h) throw d } } return n } }, { key: "hasHeader", value: function (e) { if (this.headers[f.headerize(e)]) return !0; var t = new RegExp("^\\s*".concat(e, "\\s*:"), "i"), n = !0, r = !1, s = void 0; try { for (var i, o = this.extraHeaders[Symbol.iterator](); !(n = (i = o.next()).done); n = !0) { var a = i.value; if (t.test(a)) return !0 } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } return !1 } }, { key: "parseSDP", value: function (e) { return !e && this.sdp || (this.sdp = h.parse(this.body || "")), this.sdp } }, { key: "toString", value: function () { var e = "".concat(this.method, " ").concat(this.ruri, " SIP/2.0\r\n"); for (var t in this.headers) if (Object.prototype.hasOwnProperty.call(this.headers, t)) { var n = !0, r = !1, s = void 0; try { for (var i, o = this.headers[t][Symbol.iterator](); !(n = (i = o.next()).done); n = !0) { var a = i.value; e += "".concat(t, ": ").concat(a, "\r\n") } } catch (e) { r = !0, s = e } finally { try { n || null == o.return || o.return() } finally { if (r) throw s } } } var l = !0, u = !1, c = void 0; try { for (var h, p = this.extraHeaders[Symbol.iterator](); !(l = (h = p.next()).done); l = !0) { var _ = h.value; e += "".concat(_.trim(), "\r\n") } } catch (e) { u = !0, c = e } finally { try { l || null == p.return || p.return() } finally { if (u) throw c } } var m = []; switch (this.method) { case d.REGISTER: m.push("path", "gruu"); break; case d.INVITE: this.ua.configuration.session_timers && m.push("timer"), (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) && m.push("gruu"), m.push("ice", "replaces"); break; case d.UPDATE: this.ua.configuration.session_timers && m.push("timer"), m.push("ice") }m.push("outbound"); var g = this.ua.configuration.user_agent || d.USER_AGENT; if (e += "Allow: ".concat(d.ALLOWED_METHODS, "\r\n"), e += "Supported: ".concat(m, "\r\n"), e += "User-Agent: ".concat(g, "\r\n"), this.body) { var v = f.str_utf8_length(this.body); e += "Content-Length: ".concat(v, "\r\n\r\n"), e += this.body } else e += "Content-Length: 0\r\n\r\n"; return e } }, { key: "clone", value: function () { var t = new e(this.method, this.ruri, this.ua); return Object.keys(this.headers).forEach((function (e) { t.headers[e] = this.headers[e].slice() }), this), t.body = this.body, t.extraHeaders = f.cloneArray(this.extraHeaders), t.to = this.to, t.from = this.from, t.call_id = this.call_id, t.cseq = this.cseq, t } }]), e }(), v = function (e) { function t(e, n, r, o, a) { var u; return l(this, t), (u = s(this, i(t).call(this, d.INVITE, e, n, r, o, a))).transaction = null, u } return o(t, e), c(t, [{ key: "cancel", value: function (e) { this.transaction.cancel(e) } }, { key: "clone", value: function () { var e = new t(this.ruri, this.ua); return Object.keys(this.headers).forEach((function (t) { e.headers[t] = this.headers[t].slice() }), this), e.body = this.body, e.extraHeaders = f.cloneArray(this.extraHeaders), e.to = this.to, e.from = this.from, e.call_id = this.call_id, e.cseq = this.cseq, e.transaction = this.transaction, e } }]), t }(g), y = function () { function e() { l(this, e), this.data = null, this.headers = null, this.method = null, this.via = null, this.via_branch = null, this.call_id = null, this.cseq = null, this.from = null, this.from_tag = null, this.to = null, this.to_tag = null, this.body = null, this.sdp = null } return c(e, [{ key: "addHeader", value: function (e, t) { var n = { raw: t }; e = f.headerize(e), this.headers[e] ? this.headers[e].push(n) : this.headers[e] = [n] } }, { key: "getHeader", value: function (e) { var t = this.headers[f.headerize(e)]; if (t) return t[0] ? t[0].raw : void 0 } }, { key: "getHeaders", value: function (e) { var t = this.headers[f.headerize(e)], n = []; if (!t) return []; var r = !0, s = !1, i = void 0; try { for (var o, a = t[Symbol.iterator](); !(r = (o = a.next()).done); r = !0) { var l = o.value; n.push(l.raw) } } catch (e) { s = !0, i = e } finally { try { r || null == a.return || a.return() } finally { if (s) throw i } } return n } }, { key: "hasHeader", value: function (e) { return !!this.headers[f.headerize(e)] } }, { key: "parseHeader", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0; if (e = f.headerize(e), this.headers[e]) { if (!(t >= this.headers[e].length)) { var n = this.headers[e][t], r = n.raw; if (n.parsed) return n.parsed; var s = _.parse(r, e.replace(/-/g, "_")); return -1 === s ? (this.headers[e].splice(t, 1), void m('error parsing "'.concat(e, '" header field with value "').concat(r, '"'))) : (n.parsed = s, s) } m('not so many "'.concat(e, '" headers present')) } else m('header "'.concat(e, '" not present')) } }, { key: "s", value: function (e, t) { return this.parseHeader(e, t) } }, { key: "setHeader", value: function (e, t) { var n = { raw: t }; this.headers[f.headerize(e)] = [n] } }, { key: "parseSDP", value: function (e) { return !e && this.sdp || (this.sdp = h.parse(this.body || "")), this.sdp } }, { key: "toString", value: function () { return this.data } }]), e }(), C = function (e) { function t(e) { var n; return l(this, t), (n = s(this, i(t).call(this))).ua = e, n.headers = {}, n.ruri = null, n.transport = null, n.server_transaction = null, n } return o(t, e), c(t, [{ key: "reply", value: function (e, t, n, r, s, i) { var o = [], a = this.getHeader("To"); if (t = t || null, !(e = e || null) || e < 100 || e > 699) throw new TypeError("Invalid status_code: ".concat(e)); if (t && "string" != typeof t && !(t instanceof String)) throw new TypeError("Invalid reason_phrase: ".concat(t)); t = t || d.REASON_PHRASE[e] || "", n = f.cloneArray(n); var l = "SIP/2.0 ".concat(e, " ").concat(t, "\r\n"); if (this.method === d.INVITE && e > 100 && e <= 200) { var u = this.getHeaders("record-route"), c = !0, h = !1, p = void 0; try { for (var _, m = u[Symbol.iterator](); !(c = (_ = m.next()).done); c = !0) { var g = _.value; l += "Record-Route: ".concat(g, "\r\n") } } catch (e) { h = !0, p = e } finally { try { c || null == m.return || m.return() } finally { if (h) throw p } } } var v = this.getHeaders("via"), y = !0, C = !1, T = void 0; try { for (var S, b = v[Symbol.iterator](); !(y = (S = b.next()).done); y = !0) { var E = S.value; l += "Via: ".concat(E, "\r\n") } } catch (e) { C = !0, T = e } finally { try { y || null == b.return || b.return() } finally { if (C) throw T } } !this.to_tag && e > 100 ? a += ";tag=".concat(f.newTag()) : this.to_tag && !this.s("to").hasParam("tag") && (a += ";tag=".concat(this.to_tag)), l += "To: ".concat(a, "\r\n"), l += "From: ".concat(this.getHeader("From"), "\r\n"), l += "Call-ID: ".concat(this.call_id, "\r\n"), l += "CSeq: ".concat(this.cseq, " ").concat(this.method, "\r\n"); var A = !0, w = !1, R = void 0; try { for (var I, k = n[Symbol.iterator](); !(A = (I = k.next()).done); A = !0) { var x = I.value; l += "".concat(x.trim(), "\r\n") } } catch (e) { w = !0, R = e } finally { try { A || null == k.return || k.return() } finally { if (w) throw R } } switch (this.method) { case d.INVITE: this.ua.configuration.session_timers && o.push("timer"), (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) && o.push("gruu"), o.push("ice", "replaces"); break; case d.UPDATE: this.ua.configuration.session_timers && o.push("timer"), r && o.push("ice"), o.push("replaces") }if (o.push("outbound"), this.method === d.OPTIONS ? (l += "Allow: ".concat(d.ALLOWED_METHODS, "\r\n"), l += "Accept: ".concat(d.ACCEPTED_BODY_TYPES, "\r\n")) : 405 === e ? l += "Allow: ".concat(d.ALLOWED_METHODS, "\r\n") : 415 === e && (l += "Accept: ".concat(d.ACCEPTED_BODY_TYPES, "\r\n")), l += "Supported: ".concat(o, "\r\n"), r) { var O = f.str_utf8_length(r); l += "Content-Type: application/sdp\r\n", l += "Content-Length: ".concat(O, "\r\n\r\n"), l += r } else l += "Content-Length: ".concat(0, "\r\n\r\n"); this.server_transaction.receiveResponse(e, l, s, i) } }, { key: "reply_sl", value: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null, t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, n = this.getHeaders("via"); if (!e || e < 100 || e > 699) throw new TypeError("Invalid status_code: ".concat(e)); if (t && "string" != typeof t && !(t instanceof String)) throw new TypeError("Invalid reason_phrase: ".concat(t)); t = t || d.REASON_PHRASE[e] || ""; var r = "SIP/2.0 ".concat(e, " ").concat(t, "\r\n"), s = !0, i = !1, o = void 0; try { for (var a, l = n[Symbol.iterator](); !(s = (a = l.next()).done); s = !0) { var u = a.value; r += "Via: ".concat(u, "\r\n") } } catch (e) { i = !0, o = e } finally { try { s || null == l.return || l.return() } finally { if (i) throw o } } var c = this.getHeader("To"); !this.to_tag && e > 100 ? c += ";tag=".concat(f.newTag()) : this.to_tag && !this.s("to").hasParam("tag") && (c += ";tag=".concat(this.to_tag)), r += "To: ".concat(c, "\r\n"), r += "From: ".concat(this.getHeader("From"), "\r\n"), r += "Call-ID: ".concat(this.call_id, "\r\n"), r += "CSeq: ".concat(this.cseq, " ").concat(this.method, "\r\n"), r += "Content-Length: ".concat(0, "\r\n\r\n"), this.transport.send(r) } }]), t }(y), T = function (e) { function t() { var e; return l(this, t), (e = s(this, i(t).call(this))).headers = {}, e.status_code = null, e.reason_phrase = null, e } return o(t, e), t }(y); e.exports = { OutgoingRequest: g, InitialOutgoingInviteRequest: v, IncomingRequest: C, IncomingResponse: T } }, 7351: (e, t, n) => { var r = n(5424), s = n(3790), i = n(1272)("JsSIP:ERROR:Socket"); i.log = console.warn.bind(console), t.isSocket = function (e) { if (Array.isArray(e)) return !1; if (void 0 === e) return i("undefined JsSIP.Socket instance"), !1; try { if (!r.isString(e.url)) throw i("missing or invalid JsSIP.Socket url property"), new Error; if (!r.isString(e.via_transport)) throw i("missing or invalid JsSIP.Socket via_transport property"), new Error; if (-1 === s.parse(e.sip_uri, "SIP_URI")) throw i("missing or invalid JsSIP.Socket sip_uri property"), new Error } catch (e) { return !1 } try { ["connect", "disconnect", "send"].forEach((function (t) { if (!r.isFunction(e[t])) throw i("missing or invalid JsSIP.Socket method: ".concat(t)), new Error })) } catch (e) { return !1 } return !0 } }, 306: e => { var t = 500; e.exports = { T1: t, T2: 4e3, T4: 5e3, TIMER_B: 32e3, TIMER_D: 0, TIMER_F: 32e3, TIMER_H: 32e3, TIMER_I: 0, TIMER_J: 0, TIMER_K: 0, TIMER_L: 32e3, TIMER_M: 32e3, PROVISIONAL_RESPONSE_INTERVAL: 6e4 } }, 3754: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function i(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function o(e, t, n) { return t && i(e.prototype, t), n && i(e, n), e } function a(e, t) { return !t || "object" !== r(t) && "function" != typeof t ? h(e) : t } function l(e) { return l = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, l(e) } function u(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && c(e, t) } function c(e, t) { return c = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, c(e, t) } function h(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } var d = n(7187).EventEmitter, f = n(965), p = n(6497), _ = n(306), m = n(1272)("JsSIP:NonInviteClientTransaction"), g = n(1272)("JsSIP:InviteClientTransaction"), v = n(1272)("JsSIP:AckClientTransaction"), y = n(1272)("JsSIP:NonInviteServerTransaction"), C = n(1272)("JsSIP:InviteServerTransaction"), T = { STATUS_TRYING: 1, STATUS_PROCEEDING: 2, STATUS_CALLING: 3, STATUS_ACCEPTED: 4, STATUS_COMPLETED: 5, STATUS_TERMINATED: 6, STATUS_CONFIRMED: 7, NON_INVITE_CLIENT: "nict", NON_INVITE_SERVER: "nist", INVITE_CLIENT: "ict", INVITE_SERVER: "ist" }, S = function (e) { function t(e, n, r, i) { var o; s(this, t), (o = a(this, l(t).call(this))).type = T.NON_INVITE_CLIENT, o.id = "z9hG4bK".concat(Math.floor(1e7 * Math.random())), o.ua = e, o.transport = n, o.request = r, o.eventHandlers = i; var u = "SIP/2.0/".concat(n.via_transport); return u += " ".concat(e.configuration.via_host, ";branch=").concat(o.id), o.request.setHeader("via", u), o.ua.newTransaction(h(h(o))), o } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "send", value: function () { var e = this; this.stateChanged(T.STATUS_TRYING), this.F = setTimeout((function () { e.timer_F() }), _.TIMER_F), this.transport.send(this.request) || this.onTransportError() } }, { key: "onTransportError", value: function () { m("transport error occurred, deleting transaction ".concat(this.id)), clearTimeout(this.F), clearTimeout(this.K), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this), this.eventHandlers.onTransportError() } }, { key: "timer_F", value: function () { m("Timer F expired for transaction ".concat(this.id)), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this), this.eventHandlers.onRequestTimeout() } }, { key: "timer_K", value: function () { this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "receiveResponse", value: function (e) { var t = this, n = e.status_code; if (n < 200) switch (this.state) { case T.STATUS_TRYING: case T.STATUS_PROCEEDING: this.stateChanged(T.STATUS_PROCEEDING), this.eventHandlers.onReceiveResponse(e) } else switch (this.state) { case T.STATUS_TRYING: case T.STATUS_PROCEEDING: this.stateChanged(T.STATUS_COMPLETED), clearTimeout(this.F), 408 === n ? this.eventHandlers.onRequestTimeout() : this.eventHandlers.onReceiveResponse(e), this.K = setTimeout((function () { t.timer_K() }), _.TIMER_K) } } }, { key: "C", get: function () { return T } }]), t }(d), b = function (e) { function t(e, n, r, i) { var o; s(this, t), (o = a(this, l(t).call(this))).type = T.INVITE_CLIENT, o.id = "z9hG4bK".concat(Math.floor(1e7 * Math.random())), o.ua = e, o.transport = n, o.request = r, o.eventHandlers = i, r.transaction = h(h(o)); var u = "SIP/2.0/".concat(n.via_transport); return u += " ".concat(e.configuration.via_host, ";branch=").concat(o.id), o.request.setHeader("via", u), o.ua.newTransaction(h(h(o))), o } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "send", value: function () { var e = this; this.stateChanged(T.STATUS_CALLING), this.B = setTimeout((function () { e.timer_B() }), _.TIMER_B), this.transport.send(this.request) || this.onTransportError() } }, { key: "onTransportError", value: function () { clearTimeout(this.B), clearTimeout(this.D), clearTimeout(this.M), this.state !== T.STATUS_ACCEPTED && (g("transport error occurred, deleting transaction ".concat(this.id)), this.eventHandlers.onTransportError()), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "timer_M", value: function () { g("Timer M expired for transaction ".concat(this.id)), this.state === T.STATUS_ACCEPTED && (clearTimeout(this.B), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "timer_B", value: function () { g("Timer B expired for transaction ".concat(this.id)), this.state === T.STATUS_CALLING && (this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this), this.eventHandlers.onRequestTimeout()) } }, { key: "timer_D", value: function () { g("Timer D expired for transaction ".concat(this.id)), clearTimeout(this.B), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "sendACK", value: function (e) { var t = this, n = new p.OutgoingRequest(f.ACK, this.request.ruri, this.ua, { route_set: this.request.getHeader("route"), call_id: this.request.getHeader("call-id"), cseq: this.request.cseq }); n.setHeader("from", this.request.getHeader("from")), n.setHeader("via", this.request.getHeader("via")), n.setHeader("to", e.getHeader("to")), this.D = setTimeout((function () { t.timer_D() }), _.TIMER_D), this.transport.send(n) } }, { key: "cancel", value: function (e) { if (this.state === T.STATUS_PROCEEDING) { var t = new p.OutgoingRequest(f.CANCEL, this.request.ruri, this.ua, { route_set: this.request.getHeader("route"), call_id: this.request.getHeader("call-id"), cseq: this.request.cseq }); t.setHeader("from", this.request.getHeader("from")), t.setHeader("via", this.request.getHeader("via")), t.setHeader("to", this.request.getHeader("to")), e && t.setHeader("reason", e), this.transport.send(t) } } }, { key: "receiveResponse", value: function (e) { var t = this, n = e.status_code; if (n >= 100 && n <= 199) switch (this.state) { case T.STATUS_CALLING: this.stateChanged(T.STATUS_PROCEEDING), this.eventHandlers.onReceiveResponse(e); break; case T.STATUS_PROCEEDING: this.eventHandlers.onReceiveResponse(e) } else if (n >= 200 && n <= 299) switch (this.state) { case T.STATUS_CALLING: case T.STATUS_PROCEEDING: this.stateChanged(T.STATUS_ACCEPTED), this.M = setTimeout((function () { t.timer_M() }), _.TIMER_M), this.eventHandlers.onReceiveResponse(e); break; case T.STATUS_ACCEPTED: this.eventHandlers.onReceiveResponse(e) } else if (n >= 300 && n <= 699) switch (this.state) { case T.STATUS_CALLING: case T.STATUS_PROCEEDING: this.stateChanged(T.STATUS_COMPLETED), this.sendACK(e), this.eventHandlers.onReceiveResponse(e); break; case T.STATUS_COMPLETED: this.sendACK(e) } } }, { key: "C", get: function () { return T } }]), t }(d), E = function (e) { function t(e, n, r, i) { var o; s(this, t), (o = a(this, l(t).call(this))).id = "z9hG4bK".concat(Math.floor(1e7 * Math.random())), o.transport = n, o.request = r, o.eventHandlers = i; var u = "SIP/2.0/".concat(n.via_transport); return u += " ".concat(e.configuration.via_host, ";branch=").concat(o.id), o.request.setHeader("via", u), o } return u(t, e), o(t, [{ key: "send", value: function () { this.transport.send(this.request) || this.onTransportError() } }, { key: "onTransportError", value: function () { v("transport error occurred for transaction ".concat(this.id)), this.eventHandlers.onTransportError() } }, { key: "C", get: function () { return T } }]), t }(d), A = function (e) { function t(e, n, r) { var i; return s(this, t), (i = a(this, l(t).call(this))).type = T.NON_INVITE_SERVER, i.id = r.via_branch, i.ua = e, i.transport = n, i.request = r, i.last_response = "", r.server_transaction = h(h(i)), i.state = T.STATUS_TRYING, e.newTransaction(h(h(i))), i } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "timer_J", value: function () { y("Timer J expired for transaction ".concat(this.id)), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "onTransportError", value: function () { this.transportError || (this.transportError = !0, y("transport error occurred, deleting transaction ".concat(this.id)), clearTimeout(this.J), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "receiveResponse", value: function (e, t, n, r) { var s = this; if (100 === e) switch (this.state) { case T.STATUS_TRYING: this.stateChanged(T.STATUS_PROCEEDING), this.transport.send(t) || this.onTransportError(); break; case T.STATUS_PROCEEDING: this.last_response = t, this.transport.send(t) ? n && n() : (this.onTransportError(), r && r()) } else if (e >= 200 && e <= 699) switch (this.state) { case T.STATUS_TRYING: case T.STATUS_PROCEEDING: this.stateChanged(T.STATUS_COMPLETED), this.last_response = t, this.J = setTimeout((function () { s.timer_J() }), _.TIMER_J), this.transport.send(t) ? n && n() : (this.onTransportError(), r && r()) } } }, { key: "C", get: function () { return T } }]), t }(d), w = function (e) { function t(e, n, r) { var i; return s(this, t), (i = a(this, l(t).call(this))).type = T.INVITE_SERVER, i.id = r.via_branch, i.ua = e, i.transport = n, i.request = r, i.last_response = "", r.server_transaction = h(h(i)), i.state = T.STATUS_PROCEEDING, e.newTransaction(h(h(i))), i.resendProvisionalTimer = null, r.reply(100), i } return u(t, e), o(t, [{ key: "stateChanged", value: function (e) { this.state = e, this.emit("stateChanged") } }, { key: "timer_H", value: function () { C("Timer H expired for transaction ".concat(this.id)), this.state === T.STATUS_COMPLETED && C("ACK not received, dialog will be terminated"), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this) } }, { key: "timer_I", value: function () { this.stateChanged(T.STATUS_TERMINATED) } }, { key: "timer_L", value: function () { C("Timer L expired for transaction ".concat(this.id)), this.state === T.STATUS_ACCEPTED && (this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "onTransportError", value: function () { this.transportError || (this.transportError = !0, C("transport error occurred, deleting transaction ".concat(this.id)), null !== this.resendProvisionalTimer && (clearInterval(this.resendProvisionalTimer), this.resendProvisionalTimer = null), clearTimeout(this.L), clearTimeout(this.H), clearTimeout(this.I), this.stateChanged(T.STATUS_TERMINATED), this.ua.destroyTransaction(this)) } }, { key: "resend_provisional", value: function () { this.transport.send(this.last_response) || this.onTransportError() } }, { key: "receiveResponse", value: function (e, t, n, r) { var s = this; if (e >= 100 && e <= 199 && this.state === T.STATUS_PROCEEDING) this.transport.send(t) || this.onTransportError(), this.last_response = t; if (e > 100 && e <= 199 && this.state === T.STATUS_PROCEEDING) null === this.resendProvisionalTimer && (this.resendProvisionalTimer = setInterval((function () { s.resend_provisional() }), _.PROVISIONAL_RESPONSE_INTERVAL)); else if (e >= 200 && e <= 299) switch (this.state) { case T.STATUS_PROCEEDING: this.stateChanged(T.STATUS_ACCEPTED), this.last_response = t, this.L = setTimeout((function () { s.timer_L() }), _.TIMER_L), null !== this.resendProvisionalTimer && (clearInterval(this.resendProvisionalTimer), this.resendProvisionalTimer = null); case T.STATUS_ACCEPTED: this.transport.send(t) ? n && n() : (this.onTransportError(), r && r()) } else if (e >= 300 && e <= 699 && this.state === T.STATUS_PROCEEDING) null !== this.resendProvisionalTimer && (clearInterval(this.resendProvisionalTimer), this.resendProvisionalTimer = null), this.transport.send(t) ? (this.stateChanged(T.STATUS_COMPLETED), this.H = setTimeout((function () { s.timer_H() }), _.TIMER_H), n && n()) : (this.onTransportError(), r && r()) } }, { key: "C", get: function () { return T } }]), t }(d); e.exports = { C: T, NonInviteClientTransaction: S, InviteClientTransaction: b, AckClientTransaction: E, NonInviteServerTransaction: A, InviteServerTransaction: w, checkTransaction: function (e, t) { var n, r = e._transactions; switch (t.method) { case f.INVITE: if (n = r.ist[t.via_branch]) { if (n.state === T.STATUS_PROCEEDING) n.transport.send(n.last_response); return !0 } break; case f.ACK: if (!(n = r.ist[t.via_branch])) return !1; if (n.state === T.STATUS_ACCEPTED) return !1; if (n.state === T.STATUS_COMPLETED) return n.state = T.STATUS_CONFIRMED, n.I = setTimeout((function () { n.timer_I() }), _.TIMER_I), !0; break; case f.CANCEL: return (n = r.ist[t.via_branch]) ? (t.reply_sl(200), n.state !== T.STATUS_PROCEEDING) : (t.reply_sl(481), !0); default: if (n = r.nist[t.via_branch]) { switch (n.state) { case T.STATUS_TRYING: break; case T.STATUS_PROCEEDING: case T.STATUS_COMPLETED: n.transport.send(n.last_response) }return !0 } } } } }, 6103: (e, t, n) => { function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var i = n(7351), o = n(1272)("JsSIP:Transport"), a = n(1272)("JsSIP:ERROR:Transport"); a.log = console.warn.bind(console); var l = { STATUS_CONNECTED: 0, STATUS_CONNECTING: 1, STATUS_DISCONNECTED: 2, SOCKET_STATUS_READY: 0, SOCKET_STATUS_ERROR: 1, recovery_options: { min_interval: 2, max_interval: 30 } }; e.exports = function () { function e(t) { var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : l.recovery_options; if (r(this, e), o("new()"), this.status = l.STATUS_DISCONNECTED, this.socket = null, this.sockets = [], this.recovery_options = n, this.recover_attempts = 0, this.recovery_timer = null, this.close_requested = !1, void 0 === t) throw new TypeError("Invalid argument. undefined 'sockets' argument"); t instanceof Array || (t = [t]), t.forEach((function (e) { if (!i.isSocket(e.socket)) throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance"); if (e.weight && !Number(e.weight)) throw new TypeError("Invalid argument. 'weight' attribute is not a number"); this.sockets.push({ socket: e.socket, weight: e.weight || 0, status: l.SOCKET_STATUS_READY }) }), this), this._getSocket() } var t, n, u; return t = e, (n = [{ key: "connect", value: function () { o("connect()"), this.isConnected() ? o("Transport is already connected") : this.isConnecting() ? o("Transport is connecting") : (this.close_requested = !1, this.status = l.STATUS_CONNECTING, this.onconnecting({ socket: this.socket, attempts: this.recover_attempts }), this.close_requested || (this.socket.onconnect = this._onConnect.bind(this), this.socket.ondisconnect = this._onDisconnect.bind(this), this.socket.ondata = this._onData.bind(this), this.socket.connect())) } }, { key: "disconnect", value: function () { o("close()"), this.close_requested = !0, this.recover_attempts = 0, this.status = l.STATUS_DISCONNECTED, null !== this.recovery_timer && (clearTimeout(this.recovery_timer), this.recovery_timer = null), this.socket.onconnect = function () { }, this.socket.ondisconnect = function () { }, this.socket.ondata = function () { }, this.socket.disconnect(), this.ondisconnect({ socket: this.socket, error: !1 }) } }, { key: "send", value: function (e) { if (o("send()"), !this.isConnected()) return a("unable to send message, transport is not connected"), !1; var t = e.toString(); return o("sending message:\n\n".concat(t, "\n")), this.socket.send(t) } }, { key: "isConnected", value: function () { return this.status === l.STATUS_CONNECTED } }, { key: "isConnecting", value: function () { return this.status === l.STATUS_CONNECTING } }, { key: "_reconnect", value: function () { var e = this; this.recover_attempts += 1; var t = Math.floor(Math.random() * Math.pow(2, this.recover_attempts) + 1); t < this.recovery_options.min_interval ? t = this.recovery_options.min_interval : t > this.recovery_options.max_interval && (t = this.recovery_options.max_interval), o("reconnection attempt: ".concat(this.recover_attempts, ". next connection attempt in ").concat(t, " seconds")), this.recovery_timer = setTimeout((function () { e.close_requested || e.isConnected() || e.isConnecting() || (e._getSocket(), e.connect()) }), 1e3 * t) } }, { key: "_getSocket", value: function () { var e = []; if (this.sockets.forEach((function (t) { t.status !== l.SOCKET_STATUS_ERROR && (0 === e.length ? e.push(t) : t.weight > e[0].weight ? e = [t] : t.weight === e[0].weight && e.push(t)) })), 0 === e.length) return this.sockets.forEach((function (e) { e.status = l.SOCKET_STATUS_READY })), void this._getSocket(); var t = Math.floor(Math.random() * e.length); this.socket = e[t].socket } }, { key: "_onConnect", value: function () { this.recover_attempts = 0, this.status = l.STATUS_CONNECTED, null !== this.recovery_timer && (clearTimeout(this.recovery_timer), this.recovery_timer = null), this.onconnect({ socket: this }) } }, { key: "_onDisconnect", value: function (e, t, n) { this.status = l.STATUS_DISCONNECTED, this.ondisconnect({ socket: this.socket, error: e, code: t, reason: n }), this.close_requested || (this.sockets.forEach((function (e) { this.socket === e.socket && (e.status = l.SOCKET_STATUS_ERROR) }), this), this._reconnect(e)) } }, { key: "_onData", value: function (e) { if ("\r\n" !== e) { if ("string" != typeof e) { try { e = String.fromCharCode.apply(null, new Uint8Array(e)) } catch (e) { return void o("received binary message failed to be converted into string, message discarded") } o("received binary message:\n\n".concat(e, "\n")) } else o("received text message:\n\n".concat(e, "\n")); this.ondata({ transport: this, message: e }) } else o("received message with CRLF Keep Alive response") } }, { key: "via_transport", get: function () { return this.socket.via_transport } }, { key: "url", get: function () { return this.socket.url } }, { key: "sip_uri", get: function () { return this.socket.sip_uri } }]) && s(t.prototype, n), u && s(t, u), e }() }, 8387: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } function s(e) { return s = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, s(e) } function i(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function o(e, t, n) { return t && i(e.prototype, t), n && i(e, n), e } function a(e, t) { return a = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, a(e, t) } function l(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } var u = n(7187).EventEmitter, c = n(965), h = n(116), d = n(7906), f = n(9193), p = n(3754), _ = n(6103), m = n(5424), g = n(8063), v = n(1987), y = n(3790), C = n(8407), T = n(6497), S = n(5710), b = n(7830), E = n(1272)("JsSIP:UA"), A = n(1272)("JsSIP:ERROR:UA"); A.log = console.warn.bind(console); var w = { STATUS_INIT: 0, STATUS_READY: 1, STATUS_USER_CLOSED: 2, STATUS_NOT_READY: 3, CONFIGURATION_ERROR: 1, NETWORK_ERROR: 2 }; function R(e) { this.emit("connecting", e) } function I(e) { this._status !== w.STATUS_USER_CLOSED && (this._status = w.STATUS_READY, this._error = null, this.emit("connected", e), this._dynConfiguration.register && this._registrator.register()) } function k(e) { for (var t = ["nict", "ict", "nist", "ist"], n = 0; n < t.length; n++) { var r = t[n]; for (var s in this._transactions[r]) Object.prototype.hasOwnProperty.call(this._transactions[r], s) && this._transactions[r][s].onTransportError() } this.emit("disconnected", e), this._registrator.onTransportClosed(), this._status !== w.STATUS_USER_CLOSED && (this._status = w.STATUS_NOT_READY, this._error = w.NETWORK_ERROR) } function x(e) { var t = e.transport, n = e.message; if ((n = C.parseMessage(n, this)) && !(this._status === w.STATUS_USER_CLOSED && n instanceof T.IncomingRequest) && S(n, this, t)) if (n instanceof T.IncomingRequest) n.transport = t, this.receiveRequest(n); else if (n instanceof T.IncomingResponse) { var r; switch (n.method) { case c.INVITE: (r = this._transactions.ict[n.via_branch]) && r.receiveResponse(n); break; case c.ACK: break; default: (r = this._transactions.nict[n.via_branch]) && r.receiveResponse(n) } } } e.exports = function (e) { function t(e) { var n; if (function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, t), E("new() [configuration:%o]", e), (n = function (e, t) { return !t || "object" !== r(t) && "function" != typeof t ? l(e) : t }(this, s(t).call(this)))._cache = { credentials: {} }, n._configuration = Object.assign({}, b.settings), n._dynConfiguration = {}, n._dialogs = {}, n._applicants = {}, n._sessions = {}, n._transport = null, n._contact = null, n._status = w.STATUS_INIT, n._error = null, n._transactions = { nist: {}, nict: {}, ist: {}, ict: {} }, n._data = {}, n._closeTimer = null, void 0 === e) throw new TypeError("Not enough arguments"); try { n._loadConfig(e) } catch (e) { throw n._status = w.STATUS_NOT_READY, n._error = w.CONFIGURATION_ERROR, e } return n._registrator = new h(l(l(n))), n } return function (e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && a(e, t) }(t, e), o(t, null, [{ key: "C", get: function () { return w } }]), o(t, [{ key: "start", value: function () { E("start()"), this._status === w.STATUS_INIT ? this._transport.connect() : this._status === w.STATUS_USER_CLOSED ? (E("restarting UA"), null !== this._closeTimer && (clearTimeout(this._closeTimer), this._closeTimer = null, this._transport.disconnect()), this._status = w.STATUS_INIT, this._transport.connect()) : this._status === w.STATUS_READY ? E("UA is in READY status, not restarted") : E("ERROR: connection is down, Auto-Recovery system is trying to reconnect"), this._dynConfiguration.register = this._configuration.register } }, { key: "register", value: function () { E("register()"), this._dynConfiguration.register = !0, this._registrator.register() } }, { key: "unregister", value: function (e) { E("unregister()"), this._dynConfiguration.register = !1, this._registrator.unregister(e) } }, { key: "registrator", value: function () { return this._registrator } }, { key: "isRegistered", value: function () { return this._registrator.registered } }, { key: "isConnected", value: function () { return this._transport.isConnected() } }, { key: "call", value: function (e, t) { E("call()"); var n = new d(this); return n.connect(e, t), n } }, { key: "sendMessage", value: function (e, t, n) { E("sendMessage()"); var r = new f(this); return r.send(e, t, n), r } }, { key: "terminateSessions", value: function (e) { for (var t in E("terminateSessions()"), this._sessions) this._sessions[t].isEnded() || this._sessions[t].terminate(e) } }, { key: "stop", value: function () { var e = this; if (E("stop()"), this._dynConfiguration = {}, this._status !== w.STATUS_USER_CLOSED) { this._registrator.close(); var t = Object.keys(this._sessions).length; for (var n in this._sessions) if (Object.prototype.hasOwnProperty.call(this._sessions, n)) { E("closing session ".concat(n)); try { this._sessions[n].terminate() } catch (e) { } } for (var r in this._applicants) if (Object.prototype.hasOwnProperty.call(this._applicants, r)) try { this._applicants[r].close() } catch (e) { } this._status = w.STATUS_USER_CLOSED, 0 === Object.keys(this._transactions.nict).length + Object.keys(this._transactions.nist).length + Object.keys(this._transactions.ict).length + Object.keys(this._transactions.ist).length && 0 === t ? this._transport.disconnect() : this._closeTimer = setTimeout((function () { e._closeTimer = null, e._transport.disconnect() }), 2e3) } else E("UA already closed") } }, { key: "normalizeTarget", value: function (e) { return m.normalizeTarget(e, this._configuration.hostport_params) } }, { key: "get", value: function (e) { switch (e) { case "realm": return this._configuration.realm; case "ha1": return this._configuration.ha1; default: return void A('get() | cannot get "%s" parameter in runtime', e) } } }, { key: "set", value: function (e, t) { switch (e) { case "password": this._configuration.password = String(t); break; case "realm": this._configuration.realm = String(t); break; case "ha1": this._configuration.ha1 = String(t), this._configuration.password = null; break; case "display_name": if (-1 === y.parse('"'.concat(t, '"'), "display_name")) return A('set() | wrong "display_name"'), !1; this._configuration.display_name = t; break; default: return A('set() | cannot set "%s" parameter in runtime', e), !1 }return !0 } }, { key: "newTransaction", value: function (e) { this._transactions[e.type][e.id] = e, this.emit("newTransaction", { transaction: e }) } }, { key: "destroyTransaction", value: function (e) { delete this._transactions[e.type][e.id], this.emit("transactionDestroyed", { transaction: e }) } }, { key: "newDialog", value: function (e) { this._dialogs[e.id] = e } }, { key: "destroyDialog", value: function (e) { delete this._dialogs[e.id] } }, { key: "newMessage", value: function (e, t) { this._applicants[e] = e, this.emit("newMessage", t) } }, { key: "destroyMessage", value: function (e) { delete this._applicants[e] } }, { key: "newRTCSession", value: function (e, t) { this._sessions[e.id] = e, this.emit("newRTCSession", t) } }, { key: "destroyRTCSession", value: function (e) { delete this._sessions[e.id] } }, { key: "registered", value: function (e) { this.emit("registered", e) } }, { key: "unregistered", value: function (e) { this.emit("unregistered", e) } }, { key: "registrationFailed", value: function (e) { this.emit("registrationFailed", e) } }, { key: "receiveRequest", value: function (e) { var t = e.method; if (e.ruri.user !== this._configuration.uri.user && e.ruri.user !== this._contact.uri.user) return E("Request-URI does not point to us"), void (e.method !== c.ACK && e.reply_sl(404)); if (e.ruri.scheme !== c.SIPS) { if (!p.checkTransaction(this, e)) { if (t === c.INVITE ? new p.InviteServerTransaction(this, this._transport, e) : t !== c.ACK && t !== c.CANCEL && new p.NonInviteServerTransaction(this, this._transport, e), t === c.OPTIONS) e.reply(200); else if (t === c.MESSAGE) { if (0 === this.listeners("newMessage").length) return void e.reply(405); new f(this).init_incoming(e) } else if (t === c.INVITE && !e.to_tag && 0 === this.listeners("newRTCSession").length) return void e.reply(405); var n, r; if (e.to_tag) (n = this._findDialog(e.call_id, e.from_tag, e.to_tag)) ? n.receiveRequest(e) : t === c.NOTIFY ? (r = this._findSession(e)) ? r.receiveRequest(e) : (E("received NOTIFY request for a non existent subscription"), e.reply(481, "Subscription does not exist")) : t !== c.ACK && e.reply(481); else switch (t) { case c.INVITE: if (window.RTCPeerConnection) if (e.hasHeader("replaces")) { var s = e.replaces; (n = this._findDialog(s.call_id, s.from_tag, s.to_tag)) ? (r = n.owner).isEnded() ? e.reply(603) : r.receiveRequest(e) : e.reply(481) } else (r = new d(this)).init_incoming(e); else A("INVITE received but WebRTC is not supported"), e.reply(488); break; case c.BYE: e.reply(481); break; case c.CANCEL: (r = this._findSession(e)) ? r.receiveRequest(e) : E("received CANCEL request for a non existent session"); break; case c.ACK: break; default: e.reply(405) } } } else e.reply_sl(416) } }, { key: "_findSession", value: function (e) { var t = e.call_id, n = e.from_tag, r = e.to_tag, s = t + n, i = this._sessions[s], o = t + r, a = this._sessions[o]; return i || (a || null) } }, { key: "_findDialog", value: function (e, t, n) { var r = e + t + n, s = this._dialogs[r]; return s || (r = e + n + t, (s = this._dialogs[r]) || null) } }, { key: "_loadConfig", value: function (e) { try { b.load(this._configuration, e) } catch (e) { throw e } 0 === this._configuration.display_name && (this._configuration.display_name = "0"), this._configuration.instance_id || (this._configuration.instance_id = m.newUUID()), this._configuration.jssip_id = m.createRandomToken(5); var t = this._configuration.uri.clone(); t.user = null, this._configuration.hostport_params = t.toString().replace(/^sip:/i, ""); try { this._transport = new _(this._configuration.sockets, { max_interval: this._configuration.connection_recovery_max_interval, min_interval: this._configuration.connection_recovery_min_interval }), this._transport.onconnecting = R.bind(this), this._transport.onconnect = I.bind(this), this._transport.ondisconnect = k.bind(this), this._transport.ondata = x.bind(this) } catch (e) { throw A(e), new g.ConfigurationError("sockets", this._configuration.sockets) } if (delete this._configuration.sockets, this._configuration.authorization_user || (this._configuration.authorization_user = this._configuration.uri.user), !this._configuration.registrar_server) { var n = this._configuration.uri.clone(); n.user = null, n.clearParams(), n.clearHeaders(), this._configuration.registrar_server = n } this._configuration.no_answer_timeout *= 1e3, this._configuration.contact_uri ? this._configuration.via_host = this._configuration.contact_uri.host : this._configuration.contact_uri = new v("sip", m.createRandomToken(8), this._configuration.via_host, null, { transport: "ws" }), this._contact = { pub_gruu: null, temp_gruu: null, uri: this._configuration.contact_uri, toString: function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.anonymous || null, n = e.outbound || null, r = "<"; return r += t ? this.temp_gruu || "sip:anonymous@anonymous.invalid;transport=ws" : this.pub_gruu || this.uri.toString(), !n || (t ? this.temp_gruu : this.pub_gruu) || (r += ";ob"), r += ">" } }; var r = ["password", "realm", "ha1", "display_name", "register"]; for (var s in this._configuration) Object.prototype.hasOwnProperty.call(this._configuration, s) && (-1 !== r.indexOf(s) ? Object.defineProperty(this._configuration, s, { writable: !0, configurable: !1 }) : Object.defineProperty(this._configuration, s, { writable: !1, configurable: !1 })); for (var i in E("configuration parameters after validation:"), this._configuration) if (Object.prototype.hasOwnProperty.call(b.settings, i)) switch (i) { case "uri": case "registrar_server": E("- ".concat(i, ": ").concat(this._configuration[i])); break; case "password": case "ha1": E("- ".concat(i, ": NOT SHOWN")); break; default: E("- ".concat(i, ": ").concat(JSON.stringify(this._configuration[i]))) } } }, { key: "C", get: function () { return w } }, { key: "status", get: function () { return this._status } }, { key: "contact", get: function () { return this._contact } }, { key: "configuration", get: function () { return this._configuration } }, { key: "transport", get: function () { return this._transport } }]), t }(u) }, 1987: (e, t, n) => { function r(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function s(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function i(e, t, n) { return t && s(e.prototype, t), n && s(e, n), e } var o = n(965), a = n(5424), l = n(3790); e.exports = function () { function e(t, n, s, i) { var a = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}, l = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : {}; if (r(this, e), !s) throw new TypeError('missing or invalid "host" parameter'); for (var u in this._parameters = {}, this._headers = {}, this._scheme = t || o.SIP, this._user = n, this._host = s, this._port = i, a) Object.prototype.hasOwnProperty.call(a, u) && this.setParam(u, a[u]); for (var c in l) Object.prototype.hasOwnProperty.call(l, c) && this.setHeader(c, l[c]) } return i(e, null, [{ key: "parse", value: function (e) { return -1 !== (e = l.parse(e, "SIP_URI")) ? e : void 0 } }]), i(e, [{ key: "setParam", value: function (e, t) { e && (this._parameters[e.toLowerCase()] = null == t ? null : t.toString()) } }, { key: "getParam", value: function (e) { if (e) return this._parameters[e.toLowerCase()] } }, { key: "hasParam", value: function (e) { if (e) return !!this._parameters.hasOwnProperty(e.toLowerCase()) } }, { key: "deleteParam", value: function (e) { if (e = e.toLowerCase(), this._parameters.hasOwnProperty(e)) { var t = this._parameters[e]; return delete this._parameters[e], t } } }, { key: "clearParams", value: function () { this._parameters = {} } }, { key: "setHeader", value: function (e, t) { this._headers[a.headerize(e)] = Array.isArray(t) ? t : [t] } }, { key: "getHeader", value: function (e) { if (e) return this._headers[a.headerize(e)] } }, { key: "hasHeader", value: function (e) { if (e) return !!this._headers.hasOwnProperty(a.headerize(e)) } }, { key: "deleteHeader", value: function (e) { if (e = a.headerize(e), this._headers.hasOwnProperty(e)) { var t = this._headers[e]; return delete this._headers[e], t } } }, { key: "clearHeaders", value: function () { this._headers = {} } }, { key: "clone", value: function () { return new e(this._scheme, this._user, this._host, this._port, JSON.parse(JSON.stringify(this._parameters)), JSON.parse(JSON.stringify(this._headers))) } }, { key: "toString", value: function () { var e = [], t = "".concat(this._scheme, ":"); for (var n in this._user && (t += "".concat(a.escapeUser(this._user), "@")), t += this._host, (this._port || 0 === this._port) && (t += ":".concat(this._port)), this._parameters) Object.prototype.hasOwnProperty.call(this._parameters, n) && (t += ";".concat(n), null !== this._parameters[n] && (t += "=".concat(this._parameters[n]))); for (var r in this._headers) if (Object.prototype.hasOwnProperty.call(this._headers, r)) { var s = !0, i = !1, o = void 0; try { for (var l, u = this._headers[r][Symbol.iterator](); !(s = (l = u.next()).done); s = !0) { var c = l.value; e.push("".concat(r, "=").concat(c)) } } catch (e) { i = !0, o = e } finally { try { s || null == u.return || u.return() } finally { if (i) throw o } } } return e.length > 0 && (t += "?".concat(e.join("&"))), t } }, { key: "toAor", value: function (e) { var t = "".concat(this._scheme, ":"); return this._user && (t += "".concat(a.escapeUser(this._user), "@")), t += this._host, e && (this._port || 0 === this._port) && (t += ":".concat(this._port)), t } }, { key: "scheme", get: function () { return this._scheme }, set: function (e) { this._scheme = e.toLowerCase() } }, { key: "user", get: function () { return this._user }, set: function (e) { this._user = e } }, { key: "host", get: function () { return this._host }, set: function (e) { this._host = e.toLowerCase() } }, { key: "port", get: function () { return this._port }, set: function (e) { this._port = 0 === e ? e : parseInt(e, 10) || null } }]), e }() }, 5424: (e, t, n) => { function r(e) { return r = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, r(e) } var s = n(965), i = n(1987), o = n(3790); t.str_utf8_length = function (e) { return unescape(encodeURIComponent(e)).length }; var a = t.isFunction = function (e) { return void 0 !== e && "[object Function]" === Object.prototype.toString.call(e) }; t.isString = function (e) { return void 0 !== e && "[object String]" === Object.prototype.toString.call(e) }, t.isDecimal = function (e) { return !isNaN(e) && parseFloat(e) === parseInt(e, 10) }, t.isEmpty = function (e) { return null === e || "" === e || void 0 === e || Array.isArray(e) && 0 === e.length || "number" == typeof e && isNaN(e) }, t.hasMethods = function (e) { for (var t = arguments.length, n = new Array(t > 1 ? t - 1 : 0), r = 1; r < t; r++)n[r - 1] = arguments[r]; for (var s = 0; s < n.length; s++) { var i = n[s]; if (a(e[i])) return !1 } return !0 }; var l = t.createRandomToken = function (e) { var t, n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 32, r = ""; for (t = 0; t < e; t++)r += (Math.random() * n | 0).toString(n); return r }; t.newTag = function () { return l(10) }, t.newUUID = function () { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (function (e) { var t = 16 * Math.random() | 0; return ("x" === e ? t : 3 & t | 8).toString(16) })) }, t.hostType = function (e) { if (e) return -1 !== (e = o.parse(e, "host")) ? e.host_type : void 0 }; var u = t.escapeUser = function (e) { return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi, ":").replace(/%2B/gi, "+").replace(/%3F/gi, "?").replace(/%2F/gi, "/") }; t.normalizeTarget = function (e, t) { if (e) { if (e instanceof i) return e; if ("string" == typeof e) { var n, r, o, a = e.split("@"); switch (a.length) { case 1: if (!t) return; n = e, r = t; break; case 2: n = a[0], r = a[1]; break; default: n = a.slice(0, a.length - 1).join("@"), r = a[a.length - 1] }return n = n.replace(/^(sips?|tel):/i, ""), /^[-.()]*\+?[0-9\-.()]+$/.test(n) && (n = n.replace(/[-.()]/g, "")), e = "".concat(s.SIP, ":").concat(u(n), "@").concat(r), (o = i.parse(e)) ? o : void 0 } } else; }, t.headerize = function (e) { var t, n = { "Call-Id": "Call-ID", Cseq: "CSeq", "Www-Authenticate": "WWW-Authenticate" }, r = e.toLowerCase().replace(/_/g, "-").split("-"), s = "", i = r.length; for (t = 0; t < i; t++)0 !== t && (s += "-"), s += r[t].charAt(0).toUpperCase() + r[t].substring(1); return n[s] && (s = n[s]), s }, t.sipErrorCause = function (e) { for (var t in s.SIP_ERROR_CAUSES) if (-1 !== s.SIP_ERROR_CAUSES[t].indexOf(e)) return s.causes[t]; return s.causes.SIP_FAILURE_CODE }, t.getRandomTestNetIP = function () { return "192.0.2.".concat((e = 1, t = 254, Math.floor(Math.random() * (t - e + 1) + e))); var e, t }, t.calculateMD5 = function (e) { function t(e, t) { return e << t | e >>> 32 - t } function n(e, t) { var n = 2147483648 & e, r = 2147483648 & t, s = 1073741824 & e, i = 1073741824 & t, o = (1073741823 & e) + (1073741823 & t); return s & i ? 2147483648 ^ o ^ n ^ r : s | i ? 1073741824 & o ? 3221225472 ^ o ^ n ^ r : 1073741824 ^ o ^ n ^ r : o ^ n ^ r } function r(e, r, s, i, o, a, l) { return e = n(e, n(n(function (e, t, n) { return e & t | ~e & n }(r, s, i), o), l)), n(t(e, a), r) } function s(e, r, s, i, o, a, l) { return e = n(e, n(n(function (e, t, n) { return e & n | t & ~n }(r, s, i), o), l)), n(t(e, a), r) } function i(e, r, s, i, o, a, l) { return e = n(e, n(n(function (e, t, n) { return e ^ t ^ n }(r, s, i), o), l)), n(t(e, a), r) } function o(e, r, s, i, o, a, l) { return e = n(e, n(n(function (e, t, n) { return t ^ (e | ~n) }(r, s, i), o), l)), n(t(e, a), r) } function a(e) { var t, n = "", r = ""; for (t = 0; t <= 3; t++)n += (r = "0".concat((e >>> 8 * t & 255).toString(16))).substr(r.length - 2, 2); return n } var l, u, c, h, d, f, p, _, m, g; for (l = function (e) { for (var t, n = e.length, r = n + 8, s = 16 * ((r - r % 64) / 64 + 1), i = new Array(s - 1), o = 0, a = 0; a < n;)o = a % 4 * 8, i[t = (a - a % 4) / 4] = i[t] | e.charCodeAt(a) << o, a++; return o = a % 4 * 8, i[t = (a - a % 4) / 4] = i[t] | 128 << o, i[s - 2] = n << 3, i[s - 1] = n >>> 29, i }(e = function (e) { e = e.replace(/\r\n/g, "\n"); for (var t = "", n = 0; n < e.length; n++) { var r = e.charCodeAt(n); r < 128 ? t += String.fromCharCode(r) : r > 127 && r < 2048 ? (t += String.fromCharCode(r >> 6 | 192), t += String.fromCharCode(63 & r | 128)) : (t += String.fromCharCode(r >> 12 | 224), t += String.fromCharCode(r >> 6 & 63 | 128), t += String.fromCharCode(63 & r | 128)) } return t }(e)), p = 1732584193, _ = 4023233417, m = 2562383102, g = 271733878, u = 0; u < l.length; u += 16)c = p, h = _, d = m, f = g, p = r(p, _, m, g, l[u + 0], 7, 3614090360), g = r(g, p, _, m, l[u + 1], 12, 3905402710), m = r(m, g, p, _, l[u + 2], 17, 606105819), _ = r(_, m, g, p, l[u + 3], 22, 3250441966), p = r(p, _, m, g, l[u + 4], 7, 4118548399), g = r(g, p, _, m, l[u + 5], 12, 1200080426), m = r(m, g, p, _, l[u + 6], 17, 2821735955), _ = r(_, m, g, p, l[u + 7], 22, 4249261313), p = r(p, _, m, g, l[u + 8], 7, 1770035416), g = r(g, p, _, m, l[u + 9], 12, 2336552879), m = r(m, g, p, _, l[u + 10], 17, 4294925233), _ = r(_, m, g, p, l[u + 11], 22, 2304563134), p = r(p, _, m, g, l[u + 12], 7, 1804603682), g = r(g, p, _, m, l[u + 13], 12, 4254626195), m = r(m, g, p, _, l[u + 14], 17, 2792965006), p = s(p, _ = r(_, m, g, p, l[u + 15], 22, 1236535329), m, g, l[u + 1], 5, 4129170786), g = s(g, p, _, m, l[u + 6], 9, 3225465664), m = s(m, g, p, _, l[u + 11], 14, 643717713), _ = s(_, m, g, p, l[u + 0], 20, 3921069994), p = s(p, _, m, g, l[u + 5], 5, 3593408605), g = s(g, p, _, m, l[u + 10], 9, 38016083), m = s(m, g, p, _, l[u + 15], 14, 3634488961), _ = s(_, m, g, p, l[u + 4], 20, 3889429448), p = s(p, _, m, g, l[u + 9], 5, 568446438), g = s(g, p, _, m, l[u + 14], 9, 3275163606), m = s(m, g, p, _, l[u + 3], 14, 4107603335), _ = s(_, m, g, p, l[u + 8], 20, 1163531501), p = s(p, _, m, g, l[u + 13], 5, 2850285829), g = s(g, p, _, m, l[u + 2], 9, 4243563512), m = s(m, g, p, _, l[u + 7], 14, 1735328473), p = i(p, _ = s(_, m, g, p, l[u + 12], 20, 2368359562), m, g, l[u + 5], 4, 4294588738), g = i(g, p, _, m, l[u + 8], 11, 2272392833), m = i(m, g, p, _, l[u + 11], 16, 1839030562), _ = i(_, m, g, p, l[u + 14], 23, 4259657740), p = i(p, _, m, g, l[u + 1], 4, 2763975236), g = i(g, p, _, m, l[u + 4], 11, 1272893353), m = i(m, g, p, _, l[u + 7], 16, 4139469664), _ = i(_, m, g, p, l[u + 10], 23, 3200236656), p = i(p, _, m, g, l[u + 13], 4, 681279174), g = i(g, p, _, m, l[u + 0], 11, 3936430074), m = i(m, g, p, _, l[u + 3], 16, 3572445317), _ = i(_, m, g, p, l[u + 6], 23, 76029189), p = i(p, _, m, g, l[u + 9], 4, 3654602809), g = i(g, p, _, m, l[u + 12], 11, 3873151461), m = i(m, g, p, _, l[u + 15], 16, 530742520), p = o(p, _ = i(_, m, g, p, l[u + 2], 23, 3299628645), m, g, l[u + 0], 6, 4096336452), g = o(g, p, _, m, l[u + 7], 10, 1126891415), m = o(m, g, p, _, l[u + 14], 15, 2878612391), _ = o(_, m, g, p, l[u + 5], 21, 4237533241), p = o(p, _, m, g, l[u + 12], 6, 1700485571), g = o(g, p, _, m, l[u + 3], 10, 2399980690), m = o(m, g, p, _, l[u + 10], 15, 4293915773), _ = o(_, m, g, p, l[u + 1], 21, 2240044497), p = o(p, _, m, g, l[u + 8], 6, 1873313359), g = o(g, p, _, m, l[u + 15], 10, 4264355552), m = o(m, g, p, _, l[u + 6], 15, 2734768916), _ = o(_, m, g, p, l[u + 13], 21, 1309151649), p = o(p, _, m, g, l[u + 4], 6, 4149444226), g = o(g, p, _, m, l[u + 11], 10, 3174756917), m = o(m, g, p, _, l[u + 2], 15, 718787259), _ = o(_, m, g, p, l[u + 9], 21, 3951481745), p = n(p, c), _ = n(_, h), m = n(m, d), g = n(g, f); return (a(p) + a(_) + a(m) + a(g)).toLowerCase() }, t.closeMediaStream = function (e) { if (e) try { var t; if (e.getTracks) { t = e.getTracks(); var n = !0, s = !1, i = void 0; try { for (var o, a = t[Symbol.iterator](); !(n = (o = a.next()).done); n = !0) { o.value.stop() } } catch (e) { s = !0, i = e } finally { try { n || null == a.return || a.return() } finally { if (s) throw i } } } else { t = e.getAudioTracks(); var l = !0, u = !1, c = void 0; try { for (var h, d = t[Symbol.iterator](); !(l = (h = d.next()).done); l = !0) { h.value.stop() } } catch (e) { u = !0, c = e } finally { try { l || null == d.return || d.return() } finally { if (u) throw c } } t = e.getVideoTracks(); var f = !0, p = !1, _ = void 0; try { for (var m, g = t[Symbol.iterator](); !(f = (m = g.next()).done); f = !0) { m.value.stop() } } catch (e) { p = !0, _ = e } finally { try { f || null == g.return || g.return() } finally { if (p) throw _ } } } } catch (t) { "function" != typeof e.stop && "object" !== r(e.stop) || e.stop() } }, t.cloneArray = function (e) { return e && e.slice() || [] } }, 1288: (e, t, n) => { function r(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var s = n(3790), i = n(1272)("JsSIP:WebSocketInterface"), o = n(1272)("JsSIP:ERROR:WebSocketInterface"); o.log = console.warn.bind(console), e.exports = function () { function e(t) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), i('new() [url:"%s"]', t), this._url = t, this._sip_uri = null, this._via_transport = null, this._ws = null; var n = s.parse(t, "absoluteURI"); if (-1 === n) throw o("invalid WebSocket URI: ".concat(t)), new TypeError("Invalid argument: ".concat(t)); if ("wss" !== n.scheme && "ws" !== n.scheme) throw o("invalid WebSocket URI scheme: ".concat(n.scheme)), new TypeError("Invalid argument: ".concat(t)); this._sip_uri = "sip:".concat(n.host).concat(n.port ? ":".concat(n.port) : "", ";transport=ws"), this._via_transport = n.scheme.toUpperCase() } var t, n, a; return t = e, (n = [{ key: "connect", value: function () { if (i("connect()"), this.isConnected()) i("WebSocket ".concat(this._url, " is already connected")); else if (this.isConnecting()) i("WebSocket ".concat(this._url, " is connecting")); else { this._ws && this.disconnect(), i("connecting to WebSocket ".concat(this._url)); try { this._ws = new WebSocket(this._url, "sip"), this._ws.binaryType = "arraybuffer", this._ws.onopen = this._onOpen.bind(this), this._ws.onclose = this._onClose.bind(this), this._ws.onmessage = this._onMessage.bind(this), this._ws.onerror = this._onError.bind(this) } catch (e) { this._onError(e) } } } }, { key: "disconnect", value: function () { i("disconnect()"), this._ws && (this._ws.onopen = function () { }, this._ws.onclose = function () { }, this._ws.onmessage = function () { }, this._ws.onerror = function () { }, this._ws.close(), this._ws = null) } }, { key: "send", value: function (e) { return i("send()"), this.isConnected() ? (this._ws.send(e), !0) : (o("unable to send message, WebSocket is not open"), !1) } }, { key: "isConnected", value: function () { return this._ws && this._ws.readyState === this._ws.OPEN } }, { key: "isConnecting", value: function () { return this._ws && this._ws.readyState === this._ws.CONNECTING } }, { key: "_onOpen", value: function () { i("WebSocket ".concat(this._url, " connected")), this.onconnect() } }, { key: "_onClose", value: function (e) { var t = e.wasClean, n = e.code, r = e.reason; i("WebSocket ".concat(this._url, " closed")), !1 === t && i("WebSocket abrupt disconnection"); var s = { socket: this, error: !t, code: n, reason: r }; this.ondisconnect(s) } }, { key: "_onMessage", value: function (e) { var t = e.data; i("received WebSocket message"), this.ondata(t) } }, { key: "_onError", value: function (e) { o("WebSocket ".concat(this._url, " error: ").concat(e)) } }, { key: "via_transport", get: function () { return this._via_transport }, set: function (e) { this._via_transport = e.toUpperCase() } }, { key: "sip_uri", get: function () { return this._sip_uri } }, { key: "url", get: function () { return this._url } }]) && r(t.prototype, n), a && r(t, a), e }() }, 5710: (e, t, n) => { var r, s, i, o = n(965), a = n(6497), l = n(5424), u = n(1272)("JsSIP:sanityCheck"), c = [function () { for (var e = ["from", "to", "call_id", "cseq", "via"], t = 0; t < e.length; t++) { var n = e[t]; if (!r.hasHeader(n)) return u("missing mandatory header field : ".concat(n, ", dropping the response")), !1 } }], h = [function () { if ("sip" !== r.s("to").uri.scheme) return f(416), !1 }, function () { if (!r.to_tag && r.call_id.substr(0, 5) === s.configuration.jssip_id) return f(482), !1 }, function () { var e = l.str_utf8_length(r.body), t = r.getHeader("content-length"); if (e < t) return f(400), !1 }, function () { var e, t = r.from_tag, n = r.call_id, i = r.cseq; if (r.to_tag) return; if (r.method === o.INVITE) { if (s._transactions.ist[r.via_branch]) return !1; for (var a in s._transactions.ist) if (Object.prototype.hasOwnProperty.call(s._transactions.ist, a) && (e = s._transactions.ist[a]).request.from_tag === t && e.request.call_id === n && e.request.cseq === i) return f(482), !1 } else { if (s._transactions.nist[r.via_branch]) return !1; for (var l in s._transactions.nist) if (Object.prototype.hasOwnProperty.call(s._transactions.nist, l) && (e = s._transactions.nist[l]).request.from_tag === t && e.request.call_id === n && e.request.cseq === i) return f(482), !1 } }], d = [function () { if (r.getHeaders("via").length > 1) return u("more than one Via header field present in the response, dropping the response"), !1 }, function () { var e = l.str_utf8_length(r.body), t = r.getHeader("content-length"); if (e < t) return u("message body length is lower than the value in Content-Length header field, dropping the response"), !1 }]; function f(e) { var t, n = r.getHeaders("via"), s = "SIP/2.0 ".concat(e, " ").concat(o.REASON_PHRASE[e], "\r\n"), a = !0, u = !1, c = void 0; try { for (var h, d = n[Symbol.iterator](); !(a = (h = d.next()).done); a = !0) { var f = h.value; s += "Via: ".concat(f, "\r\n") } } catch (e) { u = !0, c = e } finally { try { a || null == d.return || d.return() } finally { if (u) throw c } } t = r.getHeader("To"), r.to_tag || (t += ";tag=".concat(l.newTag())), s += "To: ".concat(t, "\r\n"), s += "From: ".concat(r.getHeader("From"), "\r\n"), s += "Call-ID: ".concat(r.call_id, "\r\n"), s += "CSeq: ".concat(r.cseq, " ").concat(r.method, "\r\n"), s += "\r\n", i.send(s) } e.exports = function (e, t, n) { r = e, s = t, i = n; for (var o = 0; o < c.length; o++) { if (!1 === (0, c[o])()) return !1 } if (r instanceof a.IncomingRequest) for (var l = 0; l < h.length; l++) { if (!1 === (0, h[l])()) return !1 } else if (r instanceof a.IncomingResponse) for (var u = 0; u < d.length; u++) { if (!1 === (0, d[u])()) return !1 } return !0 } }, 1272: (e, t, n) => { t.log = function (...e) { return "object" == typeof console && console.log && console.log(...e) }, t.formatArgs = function (t) { if (t[0] = (this.useColors ? "%c" : "") + this.namespace + (this.useColors ? " %c" : " ") + t[0] + (this.useColors ? "%c " : " ") + "+" + e.exports.humanize(this.diff), !this.useColors) return; const n = "color: " + this.color; t.splice(1, 0, n, "color: inherit"); let r = 0, s = 0; t[0].replace(/%[a-zA-Z%]/g, (e => { "%%" !== e && (r++, "%c" === e && (s = r)) })), t.splice(s, 0, n) }, t.save = function (e) { try { e ? t.storage.setItem("debug", e) : t.storage.removeItem("debug") } catch (e) { } }, t.load = function () { let e; try { e = t.storage.getItem("debug") } catch (e) { } !e && "undefined" != typeof process && "env" in process && (e = process.env.DEBUG); return e }, t.useColors = function () { if ("undefined" != typeof window && window.process && ("renderer" === window.process.type || window.process.__nwjs)) return !0; if ("undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)) return !1; return "undefined" != typeof document && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance || "undefined" != typeof window && window.console && (window.console.firebug || window.console.exception && window.console.table) || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 || "undefined" != typeof navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/) }, t.storage = function () { try { return localStorage } catch (e) { } }(), t.colors = ["#0000CC", "#0000FF", "#0033CC", "#0033FF", "#0066CC", "#0066FF", "#0099CC", "#0099FF", "#00CC00", "#00CC33", "#00CC66", "#00CC99", "#00CCCC", "#00CCFF", "#3300CC", "#3300FF", "#3333CC", "#3333FF", "#3366CC", "#3366FF", "#3399CC", "#3399FF", "#33CC00", "#33CC33", "#33CC66", "#33CC99", "#33CCCC", "#33CCFF", "#6600CC", "#6600FF", "#6633CC", "#6633FF", "#66CC00", "#66CC33", "#9900CC", "#9900FF", "#9933CC", "#9933FF", "#99CC00", "#99CC33", "#CC0000", "#CC0033", "#CC0066", "#CC0099", "#CC00CC", "#CC00FF", "#CC3300", "#CC3333", "#CC3366", "#CC3399", "#CC33CC", "#CC33FF", "#CC6600", "#CC6633", "#CC9900", "#CC9933", "#CCCC00", "#CCCC33", "#FF0000", "#FF0033", "#FF0066", "#FF0099", "#FF00CC", "#FF00FF", "#FF3300", "#FF3333", "#FF3366", "#FF3399", "#FF33CC", "#FF33FF", "#FF6600", "#FF6633", "#FF9900", "#FF9933", "#FFCC00", "#FFCC33"], e.exports = n(669)(t); const { formatters: r } = e.exports; r.j = function (e) { try { return JSON.stringify(e) } catch (e) { return "[UnexpectedJSONParseError]: " + e.message } } }, 669: (e, t, n) => { e.exports = function (e) { function t(e) { let t = 0; for (let n = 0; n < e.length; n++)t = (t << 5) - t + e.charCodeAt(n), t |= 0; return r.colors[Math.abs(t) % r.colors.length] } function r(e) { let n; function o(...e) { if (!o.enabled) return; const t = o, s = Number(new Date), i = s - (n || s); t.diff = i, t.prev = n, t.curr = s, n = s, e[0] = r.coerce(e[0]), "string" != typeof e[0] && e.unshift("%O"); let a = 0; e[0] = e[0].replace(/%([a-zA-Z%])/g, ((n, s) => { if ("%%" === n) return n; a++; const i = r.formatters[s]; if ("function" == typeof i) { const r = e[a]; n = i.call(t, r), e.splice(a, 1), a-- } return n })), r.formatArgs.call(t, e); (t.log || r.log).apply(t, e) } return o.namespace = e, o.enabled = r.enabled(e), o.useColors = r.useColors(), o.color = t(e), o.destroy = s, o.extend = i, "function" == typeof r.init && r.init(o), r.instances.push(o), o } function s() { const e = r.instances.indexOf(this); return -1 !== e && (r.instances.splice(e, 1), !0) } function i(e, t) { return r(this.namespace + (void 0 === t ? ":" : t) + e) } function o(e) { return e.toString().substring(2, e.toString().length - 2).replace(/\.\*\?$/, "*") } return r.debug = r, r.default = r, r.coerce = function (e) { if (e instanceof Error) return e.stack || e.message; return e }, r.disable = function () { const e = [...r.names.map(o), ...r.skips.map(o).map((e => "-" + e))].join(","); return r.enable(""), e }, r.enable = function (e) { let t; r.save(e), r.names = [], r.skips = []; const n = ("string" == typeof e ? e : "").split(/[\s,]+/), s = n.length; for (t = 0; t < s; t++)n[t] && ("-" === (e = n[t].replace(/\*/g, ".*?"))[0] ? r.skips.push(new RegExp("^" + e.substr(1) + "$")) : r.names.push(new RegExp("^" + e + "$"))); for (t = 0; t < r.instances.length; t++) { const e = r.instances[t]; e.enabled = r.enabled(e.namespace) } }, r.enabled = function (e) { if ("*" === e[e.length - 1]) return !0; let t, n; for (t = 0, n = r.skips.length; t < n; t++)if (r.skips[t].test(e)) return !1; for (t = 0, n = r.names.length; t < n; t++)if (r.names[t].test(e)) return !0; return !1 }, r.humanize = n(5797), Object.keys(e).forEach((t => { r[t] = e[t] })), r.instances = [], r.names = [], r.skips = [], r.formatters = {}, r.selectColor = t, r.enable(r.load()), r } }, 5797: e => { var t = 1e3, n = 60 * t, r = 60 * n, s = 24 * r, i = 7 * s, o = 365.25 * s; function a(e, t, n, r) { var s = t >= 1.5 * n; return Math.round(e / n) + " " + r + (s ? "s" : "") } e.exports = function (e, l) { l = l || {}; var u = typeof e; if ("string" === u && e.length > 0) return function (e) { if ((e = String(e)).length > 100) return; var a = /^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e); if (!a) return; var l = parseFloat(a[1]); switch ((a[2] || "ms").toLowerCase()) { case "years": case "year": case "yrs": case "yr": case "y": return l * o; case "weeks": case "week": case "w": return l * i; case "days": case "day": case "d": return l * s; case "hours": case "hour": case "hrs": case "hr": case "h": return l * r; case "minutes": case "minute": case "mins": case "min": case "m": return l * n; case "seconds": case "second": case "secs": case "sec": case "s": return l * t; case "milliseconds": case "millisecond": case "msecs": case "msec": case "ms": return l; default: return } }(e); if ("number" === u && !1 === isNaN(e)) return l.long ? function (e) { var i = Math.abs(e); if (i >= s) return a(e, i, s, "day"); if (i >= r) return a(e, i, r, "hour"); if (i >= n) return a(e, i, n, "minute"); if (i >= t) return a(e, i, t, "second"); return e + " ms" }(e) : function (e) { var i = Math.abs(e); if (i >= s) return Math.round(e / s) + "d"; if (i >= r) return Math.round(e / r) + "h"; if (i >= n) return Math.round(e / n) + "m"; if (i >= t) return Math.round(e / t) + "s"; return e + "ms" }(e); throw new Error("val is not a non-empty string or a valid number. val=" + JSON.stringify(e)) } }, 7824: e => { var t = 1e3, n = 60 * t, r = 60 * n, s = 24 * r, i = 365.25 * s; function o(e, t, n) { if (!(e < t)) return e < 1.5 * t ? Math.floor(e / t) + " " + n : Math.ceil(e / t) + " " + n + "s" } e.exports = function (e, a) { a = a || {}; var l, u = typeof e; if ("string" === u && e.length > 0) return function (e) { if ((e = String(e)).length > 100) return; var o = /^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e); if (!o) return; var a = parseFloat(o[1]); switch ((o[2] || "ms").toLowerCase()) { case "years": case "year": case "yrs": case "yr": case "y": return a * i; case "days": case "day": case "d": return a * s; case "hours": case "hour": case "hrs": case "hr": case "h": return a * r; case "minutes": case "minute": case "mins": case "min": case "m": return a * n; case "seconds": case "second": case "secs": case "sec": case "s": return a * t; case "milliseconds": case "millisecond": case "msecs": case "msec": case "ms": return a; default: return } }(e); if ("number" === u && !1 === isNaN(e)) return a.long ? o(l = e, s, "day") || o(l, r, "hour") || o(l, n, "minute") || o(l, t, "second") || l + " ms" : function (e) { if (e >= s) return Math.round(e / s) + "d"; if (e >= r) return Math.round(e / r) + "h"; if (e >= n) return Math.round(e / n) + "m"; if (e >= t) return Math.round(e / t) + "s"; return e + "ms" }(e); throw new Error("val is not a non-empty string or a valid number. val=" + JSON.stringify(e)) } }, 1830: (e, t) => { t.encode = function (e) { var t = ""; for (var n in e) e.hasOwnProperty(n) && (t.length && (t += "&"), t += encodeURIComponent(n) + "=" + encodeURIComponent(e[n])); return t }, t.decode = function (e) { for (var t = {}, n = e.split("&"), r = 0, s = n.length; r < s; r++) { var i = n[r].split("="); t[decodeURIComponent(i[0])] = decodeURIComponent(i[1]) } return t } }, 4187: e => { var t = /^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/, n = ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"]; e.exports = function (e) { var r = e, s = e.indexOf("["), i = e.indexOf("]"); -1 != s && -1 != i && (e = e.substring(0, s) + e.substring(s, i).replace(/:/g, ";") + e.substring(i, e.length)); for (var o, a, l = t.exec(e || ""), u = {}, c = 14; c--;)u[n[c]] = l[c] || ""; return -1 != s && -1 != i && (u.source = r, u.host = u.host.substring(1, u.host.length - 1).replace(/;/g, ":"), u.authority = u.authority.replace("[", "").replace("]", "").replace(/;/g, ":"), u.ipv6uri = !0), u.pathNames = function (e, t) { var n = /\/{2,9}/g, r = t.replace(n, "/").split("/"); "/" != t.substr(0, 1) && 0 !== t.length || r.splice(0, 1); "/" == t.substr(t.length - 1, 1) && r.splice(r.length - 1, 1); return r }(0, u.path), u.queryKey = (o = u.query, a = {}, o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, (function (e, t, n) { t && (a[t] = n) })), a), u } }, 6692: e => { var t = e.exports = { v: [{ name: "version", reg: /^(\d*)$/ }], o: [{ name: "origin", reg: /^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/, names: ["username", "sessionId", "sessionVersion", "netType", "ipVer", "address"], format: "%s %s %d %s IP%d %s" }], s: [{ name: "name" }], i: [{ name: "description" }], u: [{ name: "uri" }], e: [{ name: "email" }], p: [{ name: "phone" }], z: [{ name: "timezones" }], r: [{ name: "repeats" }], t: [{ name: "timing", reg: /^(\d*) (\d*)/, names: ["start", "stop"], format: "%d %d" }], c: [{ name: "connection", reg: /^IN IP(\d) (\S*)/, names: ["version", "ip"], format: "IN IP%d %s" }], b: [{ push: "bandwidth", reg: /^(TIAS|AS|CT|RR|RS):(\d*)/, names: ["type", "limit"], format: "%s:%s" }], m: [{ reg: /^(\w*) (\d*) ([\w\/]*)(?: (.*))?/, names: ["type", "port", "protocol", "payloads"], format: "%s %d %s %s" }], a: [{ push: "rtp", reg: /^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/, names: ["payload", "codec", "rate", "encoding"], format: function (e) { return e.encoding ? "rtpmap:%d %s/%s/%s" : e.rate ? "rtpmap:%d %s/%s" : "rtpmap:%d %s" } }, { push: "fmtp", reg: /^fmtp:(\d*) ([\S| ]*)/, names: ["payload", "config"], format: "fmtp:%d %s" }, { name: "control", reg: /^control:(.*)/, format: "control:%s" }, { name: "rtcp", reg: /^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/, names: ["port", "netType", "ipVer", "address"], format: function (e) { return null != e.address ? "rtcp:%d %s IP%d %s" : "rtcp:%d" } }, { push: "rtcpFbTrrInt", reg: /^rtcp-fb:(\*|\d*) trr-int (\d*)/, names: ["payload", "value"], format: "rtcp-fb:%d trr-int %d" }, { push: "rtcpFb", reg: /^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/, names: ["payload", "type", "subtype"], format: function (e) { return null != e.subtype ? "rtcp-fb:%s %s %s" : "rtcp-fb:%s %s" } }, { push: "ext", reg: /^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/, names: ["value", "direction", "uri", "config"], format: function (e) { return "extmap:%d" + (e.direction ? "/%s" : "%v") + " %s" + (e.config ? " %s" : "") } }, { push: "crypto", reg: /^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/, names: ["id", "suite", "config", "sessionConfig"], format: function (e) { return null != e.sessionConfig ? "crypto:%d %s %s %s" : "crypto:%d %s %s" } }, { name: "setup", reg: /^setup:(\w*)/, format: "setup:%s" }, { name: "mid", reg: /^mid:([^\s]*)/, format: "mid:%s" }, { name: "msid", reg: /^msid:(.*)/, format: "msid:%s" }, { name: "ptime", reg: /^ptime:(\d*)/, format: "ptime:%d" }, { name: "maxptime", reg: /^maxptime:(\d*)/, format: "maxptime:%d" }, { name: "direction", reg: /^(sendrecv|recvonly|sendonly|inactive)/ }, { name: "icelite", reg: /^(ice-lite)/ }, { name: "iceUfrag", reg: /^ice-ufrag:(\S*)/, format: "ice-ufrag:%s" }, { name: "icePwd", reg: /^ice-pwd:(\S*)/, format: "ice-pwd:%s" }, { name: "fingerprint", reg: /^fingerprint:(\S*) (\S*)/, names: ["type", "hash"], format: "fingerprint:%s %s" }, { push: "candidates", reg: /^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/, names: ["foundation", "component", "transport", "priority", "ip", "port", "type", "raddr", "rport", "tcptype", "generation", "network-id", "network-cost"], format: function (e) { var t = "candidate:%s %d %s %d %s %d typ %s"; return t += null != e.raddr ? " raddr %s rport %d" : "%v%v", t += null != e.tcptype ? " tcptype %s" : "%v", null != e.generation && (t += " generation %d"), t += null != e["network-id"] ? " network-id %d" : "%v", t += null != e["network-cost"] ? " network-cost %d" : "%v" } }, { name: "endOfCandidates", reg: /^(end-of-candidates)/ }, { name: "remoteCandidates", reg: /^remote-candidates:(.*)/, format: "remote-candidates:%s" }, { name: "iceOptions", reg: /^ice-options:(\S*)/, format: "ice-options:%s" }, { push: "ssrcs", reg: /^ssrc:(\d*) ([\w_-]*)(?::(.*))?/, names: ["id", "attribute", "value"], format: function (e) { var t = "ssrc:%d"; return null != e.attribute && (t += " %s", null != e.value && (t += ":%s")), t } }, { push: "ssrcGroups", reg: /^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/, names: ["semantics", "ssrcs"], format: "ssrc-group:%s %s" }, { name: "msidSemantic", reg: /^msid-semantic:\s?(\w*) (\S*)/, names: ["semantic", "token"], format: "msid-semantic: %s %s" }, { push: "groups", reg: /^group:(\w*) (.*)/, names: ["type", "mids"], format: "group:%s %s" }, { name: "rtcpMux", reg: /^(rtcp-mux)/ }, { name: "rtcpRsize", reg: /^(rtcp-rsize)/ }, { name: "sctpmap", reg: /^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/, names: ["sctpmapNumber", "app", "maxMessageSize"], format: function (e) { return null != e.maxMessageSize ? "sctpmap:%s %s %s" : "sctpmap:%s %s" } }, { name: "xGoogleFlag", reg: /^x-google-flag:([^\s]*)/, format: "x-google-flag:%s" }, { push: "rids", reg: /^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/, names: ["id", "direction", "params"], format: function (e) { return e.params ? "rid:%s %s %s" : "rid:%s %s" } }, { push: "imageattrs", reg: new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"), names: ["pt", "dir1", "attrs1", "dir2", "attrs2"], format: function (e) { return "imageattr:%s %s %s" + (e.dir2 ? " %s %s" : "") } }, { name: "simulcast", reg: new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"), names: ["dir1", "list1", "dir2", "list2"], format: function (e) { return "simulcast:%s %s" + (e.dir2 ? " %s %s" : "") } }, { name: "simulcast_03", reg: /^simulcast:[\s\t]+([\S+\s\t]+)$/, names: ["value"], format: "simulcast: %s" }, { name: "framerate", reg: /^framerate:(\d+(?:$|\.\d+))/, format: "framerate:%s" }, { name: "sourceFilter", reg: /^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/, names: ["filterMode", "netType", "addressTypes", "destAddress", "srcList"], format: "source-filter: %s %s %s %s %s" }, { push: "invalid", names: ["value"] }] }; Object.keys(t).forEach((function (e) { t[e].forEach((function (e) { e.reg || (e.reg = /(.*)/), e.format || (e.format = "%s") })) })) }, 766: (e, t, n) => { var r = n(962), s = n(5776); t.write = s, t.parse = r.parse, t.parseFmtpConfig = r.parseFmtpConfig, t.parseParams = r.parseParams, t.parsePayloads = r.parsePayloads, t.parseRemoteCandidates = r.parseRemoteCandidates, t.parseImageAttributes = r.parseImageAttributes, t.parseSimulcastStreamList = r.parseSimulcastStreamList }, 962: (e, t, n) => { var r = function (e) { return String(Number(e)) === e ? Number(e) : e }, s = function (e, t, n) { var s = e.name && e.names; e.push && !t[e.push] ? t[e.push] = [] : s && !t[e.name] && (t[e.name] = {}); var i = e.push ? {} : s ? t[e.name] : t; !function (e, t, n, s) { if (s && !n) t[s] = r(e[1]); else for (var i = 0; i < n.length; i += 1)null != e[i + 1] && (t[n[i]] = r(e[i + 1])) }(n.match(e.reg), i, e.names, e.name), e.push && t[e.push].push(i) }, i = n(6692), o = RegExp.prototype.test.bind(/^([a-z])=(.*)/); t.parse = function (e) { var t = {}, n = [], r = t; return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function (e) { var t = e[0], o = e.slice(2); "m" === t && (n.push({ rtp: [], fmtp: [] }), r = n[n.length - 1]); for (var a = 0; a < (i[t] || []).length; a += 1) { var l = i[t][a]; if (l.reg.test(o)) return s(l, r, o) } })), t.media = n, t }; var a = function (e, t) { var n = t.split(/=(.+)/, 2); return 2 === n.length ? e[n[0]] = r(n[1]) : 1 === n.length && t.length > 1 && (e[n[0]] = void 0), e }; t.parseParams = function (e) { return e.split(/\;\s?/).reduce(a, {}) }, t.parseFmtpConfig = t.parseParams, t.parsePayloads = function (e) { return e.split(" ").map(Number) }, t.parseRemoteCandidates = function (e) { for (var t = [], n = e.split(" ").map(r), s = 0; s < n.length; s += 3)t.push({ component: n[s], ip: n[s + 1], port: n[s + 2] }); return t }, t.parseImageAttributes = function (e) { return e.split(" ").map((function (e) { return e.substring(1, e.length - 1).split(",").reduce(a, {}) })) }, t.parseSimulcastStreamList = function (e) { return e.split(";").map((function (e) { return e.split(",").map((function (e) { var t, n = !1; return "~" !== e[0] ? t = r(e) : (t = r(e.substring(1, e.length)), n = !0), { scid: t, paused: n } })) })) } }, 5776: (e, t, n) => { var r = n(6692), s = /%[sdv%]/g, i = function (e) { var t = 1, n = arguments, r = n.length; return e.replace(s, (function (e) { if (t >= r) return e; var s = n[t]; switch (t += 1, e) { case "%%": return "%"; case "%s": return String(s); case "%d": return Number(s); case "%v": return "" } })) }, o = function (e, t, n) { var r = [e + "=" + (t.format instanceof Function ? t.format(t.push ? n : n[t.name]) : t.format)]; if (t.names) for (var s = 0; s < t.names.length; s += 1) { var o = t.names[s]; t.name ? r.push(n[t.name][o]) : r.push(n[t.names[s]]) } else r.push(n[t.name]); return i.apply(null, r) }, a = ["v", "o", "s", "i", "u", "e", "p", "c", "b", "t", "r", "z", "a"], l = ["i", "c", "b", "a"]; e.exports = function (e, t) { t = t || {}, null == e.version && (e.version = 0), null == e.name && (e.name = " "), e.media.forEach((function (e) { null == e.payloads && (e.payloads = "") })); var n = t.outerOrder || a, s = t.innerOrder || l, i = []; return n.forEach((function (t) { r[t].forEach((function (n) { n.name in e && null != e[n.name] ? i.push(o(t, n, e)) : n.push in e && null != e[n.push] && e[n.push].forEach((function (e) { i.push(o(t, n, e)) })) })) })), e.media.forEach((function (e) { i.push(o("m", r.m[0], e)), s.forEach((function (t) { r[t].forEach((function (n) { n.name in e && null != e[n.name] ? i.push(o(t, n, e)) : n.push in e && null != e[n.push] && e[n.push].forEach((function (e) { i.push(o(t, n, e)) })) })) })) })), i.join("\r\n") + "\r\n" } }, 6809: (e, t, n) => { var r = n(3678), s = n(9113), i = n(2739), o = n(1227)("socket.io-client"); e.exports = t = l; var a = t.managers = {}; function l(e, t) { "object" == typeof e && (t = e, e = void 0), t = t || {}; var n, s = r(e), l = s.source, u = s.id, c = s.path, h = a[u] && c in a[u].nsps; return t.forceNew || t["force new connection"] || !1 === t.multiplex || h ? (o("ignoring socket cache for %s", l), n = i(l, t)) : (a[u] || (o("new io instance for %s", l), a[u] = i(l, t)), n = a[u]), s.query && !t.query && (t.query = s.query), n.socket(s.path, t) } t.protocol = s.protocol, t.connect = l, t.Manager = n(2739), t.Socket = n(8584) }, 2739: (e, t, n) => { var r = n(5983), s = n(8584), i = n(8767), o = n(9113), a = n(5464), l = n(6077), u = n(1227)("socket.io-client:manager"), c = n(7355), h = n(3010), d = Object.prototype.hasOwnProperty; function f(e, t) { if (!(this instanceof f)) return new f(e, t); e && "object" == typeof e && (t = e, e = void 0), (t = t || {}).path = t.path || "/socket.io", this.nsps = {}, this.subs = [], this.opts = t, this.reconnection(!1 !== t.reconnection), this.reconnectionAttempts(t.reconnectionAttempts || 1 / 0), this.reconnectionDelay(t.reconnectionDelay || 1e3), this.reconnectionDelayMax(t.reconnectionDelayMax || 5e3), this.randomizationFactor(t.randomizationFactor || .5), this.backoff = new h({ min: this.reconnectionDelay(), max: this.reconnectionDelayMax(), jitter: this.randomizationFactor() }), this.timeout(null == t.timeout ? 2e4 : t.timeout), this.readyState = "closed", this.uri = e, this.connecting = [], this.lastPing = null, this.encoding = !1, this.packetBuffer = []; var n = t.parser || o; this.encoder = new n.Encoder, this.decoder = new n.Decoder, this.autoConnect = !1 !== t.autoConnect, this.autoConnect && this.open() } e.exports = f, f.prototype.emitAll = function () { for (var e in this.emit.apply(this, arguments), this.nsps) d.call(this.nsps, e) && this.nsps[e].emit.apply(this.nsps[e], arguments) }, f.prototype.updateSocketIds = function () { for (var e in this.nsps) d.call(this.nsps, e) && (this.nsps[e].id = this.generateId(e)) }, f.prototype.generateId = function (e) { return ("/" === e ? "" : e + "#") + this.engine.id }, i(f.prototype), f.prototype.reconnection = function (e) { return arguments.length ? (this._reconnection = !!e, this) : this._reconnection }, f.prototype.reconnectionAttempts = function (e) { return arguments.length ? (this._reconnectionAttempts = e, this) : this._reconnectionAttempts }, f.prototype.reconnectionDelay = function (e) { return arguments.length ? (this._reconnectionDelay = e, this.backoff && this.backoff.setMin(e), this) : this._reconnectionDelay }, f.prototype.randomizationFactor = function (e) { return arguments.length ? (this._randomizationFactor = e, this.backoff && this.backoff.setJitter(e), this) : this._randomizationFactor }, f.prototype.reconnectionDelayMax = function (e) { return arguments.length ? (this._reconnectionDelayMax = e, this.backoff && this.backoff.setMax(e), this) : this._reconnectionDelayMax }, f.prototype.timeout = function (e) { return arguments.length ? (this._timeout = e, this) : this._timeout }, f.prototype.maybeReconnectOnOpen = function () { !this.reconnecting && this._reconnection && 0 === this.backoff.attempts && this.reconnect() }, f.prototype.open = f.prototype.connect = function (e, t) { if (u("readyState %s", this.readyState), ~this.readyState.indexOf("open")) return this; u("opening %s", this.uri), this.engine = r(this.uri, this.opts); var n = this.engine, s = this; this.readyState = "opening", this.skipReconnect = !1; var i = a(n, "open", (function () { s.onopen(), e && e() })), o = a(n, "error", (function (t) { if (u("connect_error"), s.cleanup(), s.readyState = "closed", s.emitAll("connect_error", t), e) { var n = new Error("Connection error"); n.data = t, e(n) } else s.maybeReconnectOnOpen() })); if (!1 !== this._timeout) { var l = this._timeout; u("connect attempt will timeout after %d", l), 0 === l && i.destroy(); var c = setTimeout((function () { u("connect attempt timed out after %d", l), i.destroy(), n.close(), n.emit("error", "timeout"), s.emitAll("connect_timeout", l) }), l); this.subs.push({ destroy: function () { clearTimeout(c) } }) } return this.subs.push(i), this.subs.push(o), this }, f.prototype.onopen = function () { u("open"), this.cleanup(), this.readyState = "open", this.emit("open"); var e = this.engine; this.subs.push(a(e, "data", l(this, "ondata"))), this.subs.push(a(e, "ping", l(this, "onping"))), this.subs.push(a(e, "pong", l(this, "onpong"))), this.subs.push(a(e, "error", l(this, "onerror"))), this.subs.push(a(e, "close", l(this, "onclose"))), this.subs.push(a(this.decoder, "decoded", l(this, "ondecoded"))) }, f.prototype.onping = function () { this.lastPing = new Date, this.emitAll("ping") }, f.prototype.onpong = function () { this.emitAll("pong", new Date - this.lastPing) }, f.prototype.ondata = function (e) { this.decoder.add(e) }, f.prototype.ondecoded = function (e) { this.emit("packet", e) }, f.prototype.onerror = function (e) { u("error", e), this.emitAll("error", e) }, f.prototype.socket = function (e, t) { var n = this.nsps[e]; if (!n) { n = new s(this, e, t), this.nsps[e] = n; var r = this; n.on("connecting", i), n.on("connect", (function () { n.id = r.generateId(e) })), this.autoConnect && i() } function i() { ~c(r.connecting, n) || r.connecting.push(n) } return n }, f.prototype.destroy = function (e) { var t = c(this.connecting, e); ~t && this.connecting.splice(t, 1), this.connecting.length || this.close() }, f.prototype.packet = function (e) { u("writing packet %j", e); var t = this; e.query && 0 === e.type && (e.nsp += "?" + e.query), t.encoding ? t.packetBuffer.push(e) : (t.encoding = !0, this.encoder.encode(e, (function (n) { for (var r = 0; r < n.length; r++)t.engine.write(n[r], e.options); t.encoding = !1, t.processPacketQueue() }))) }, f.prototype.processPacketQueue = function () { if (this.packetBuffer.length > 0 && !this.encoding) { var e = this.packetBuffer.shift(); this.packet(e) } }, f.prototype.cleanup = function () { u("cleanup"); for (var e = this.subs.length, t = 0; t < e; t++) { this.subs.shift().destroy() } this.packetBuffer = [], this.encoding = !1, this.lastPing = null, this.decoder.destroy() }, f.prototype.close = f.prototype.disconnect = function () { u("disconnect"), this.skipReconnect = !0, this.reconnecting = !1, "opening" === this.readyState && this.cleanup(), this.backoff.reset(), this.readyState = "closed", this.engine && this.engine.close() }, f.prototype.onclose = function (e) { u("onclose"), this.cleanup(), this.backoff.reset(), this.readyState = "closed", this.emit("close", e), this._reconnection && !this.skipReconnect && this.reconnect() }, f.prototype.reconnect = function () { if (this.reconnecting || this.skipReconnect) return this; var e = this; if (this.backoff.attempts >= this._reconnectionAttempts) u("reconnect failed"), this.backoff.reset(), this.emitAll("reconnect_failed"), this.reconnecting = !1; else { var t = this.backoff.duration(); u("will wait %dms before reconnect attempt", t), this.reconnecting = !0; var n = setTimeout((function () { e.skipReconnect || (u("attempting reconnect"), e.emitAll("reconnect_attempt", e.backoff.attempts), e.emitAll("reconnecting", e.backoff.attempts), e.skipReconnect || e.open((function (t) { t ? (u("reconnect attempt error"), e.reconnecting = !1, e.reconnect(), e.emitAll("reconnect_error", t.data)) : (u("reconnect success"), e.onreconnect()) }))) }), t); this.subs.push({ destroy: function () { clearTimeout(n) } }) } }, f.prototype.onreconnect = function () { var e = this.backoff.attempts; this.reconnecting = !1, this.backoff.reset(), this.updateSocketIds(), this.emitAll("reconnect", e) } }, 5464: e => { e.exports = function (e, t, n) { return e.on(t, n), { destroy: function () { e.removeListener(t, n) } } } }, 8584: (e, t, n) => { var r = n(9113), s = n(8767), i = n(4042), o = n(5464), a = n(6077), l = n(1227)("socket.io-client:socket"), u = n(1830), c = n(3466); e.exports = f; var h = { connect: 1, connect_error: 1, connect_timeout: 1, connecting: 1, disconnect: 1, error: 1, reconnect: 1, reconnect_attempt: 1, reconnect_failed: 1, reconnect_error: 1, reconnecting: 1, ping: 1, pong: 1 }, d = s.prototype.emit; function f(e, t, n) { this.io = e, this.nsp = t, this.json = this, this.ids = 0, this.acks = {}, this.receiveBuffer = [], this.sendBuffer = [], this.connected = !1, this.disconnected = !0, this.flags = {}, n && n.query && (this.query = n.query), this.io.autoConnect && this.open() } s(f.prototype), f.prototype.subEvents = function () { if (!this.subs) { var e = this.io; this.subs = [o(e, "open", a(this, "onopen")), o(e, "packet", a(this, "onpacket")), o(e, "close", a(this, "onclose"))] } }, f.prototype.open = f.prototype.connect = function () { return this.connected || (this.subEvents(), this.io.reconnecting || this.io.open(), "open" === this.io.readyState && this.onopen(), this.emit("connecting")), this }, f.prototype.send = function () { var e = i(arguments); return e.unshift("message"), this.emit.apply(this, e), this }, f.prototype.emit = function (e) { if (h.hasOwnProperty(e)) return d.apply(this, arguments), this; var t = i(arguments), n = { type: (void 0 !== this.flags.binary ? this.flags.binary : c(t)) ? r.BINARY_EVENT : r.EVENT, data: t, options: {} }; return n.options.compress = !this.flags || !1 !== this.flags.compress, "function" == typeof t[t.length - 1] && (l("emitting packet with ack id %d", this.ids), this.acks[this.ids] = t.pop(), n.id = this.ids++), this.connected ? this.packet(n) : this.sendBuffer.push(n), this.flags = {}, this }, f.prototype.packet = function (e) { e.nsp = this.nsp, this.io.packet(e) }, f.prototype.onopen = function () { if (l("transport is open - connecting"), "/" !== this.nsp) if (this.query) { var e = "object" == typeof this.query ? u.encode(this.query) : this.query; l("sending connect packet with query %s", e), this.packet({ type: r.CONNECT, query: e }) } else this.packet({ type: r.CONNECT }) }, f.prototype.onclose = function (e) { l("close (%s)", e), this.connected = !1, this.disconnected = !0, delete this.id, this.emit("disconnect", e) }, f.prototype.onpacket = function (e) { var t = e.nsp === this.nsp, n = e.type === r.ERROR && "/" === e.nsp; if (t || n) switch (e.type) { case r.CONNECT: this.onconnect(); break; case r.EVENT: case r.BINARY_EVENT: this.onevent(e); break; case r.ACK: case r.BINARY_ACK: this.onack(e); break; case r.DISCONNECT: this.ondisconnect(); break; case r.ERROR: this.emit("error", e.data) } }, f.prototype.onevent = function (e) { var t = e.data || []; l("emitting event %j", t), null != e.id && (l("attaching ack callback to event"), t.push(this.ack(e.id))), this.connected ? d.apply(this, t) : this.receiveBuffer.push(t) }, f.prototype.ack = function (e) { var t = this, n = !1; return function () { if (!n) { n = !0; var s = i(arguments); l("sending ack %j", s), t.packet({ type: c(s) ? r.BINARY_ACK : r.ACK, id: e, data: s }) } } }, f.prototype.onack = function (e) { var t = this.acks[e.id]; "function" == typeof t ? (l("calling ack %s with %j", e.id, e.data), t.apply(this, e.data), delete this.acks[e.id]) : l("bad ack %s", e.id) }, f.prototype.onconnect = function () { this.connected = !0, this.disconnected = !1, this.emit("connect"), this.emitBuffered() }, f.prototype.emitBuffered = function () { var e; for (e = 0; e < this.receiveBuffer.length; e++)d.apply(this, this.receiveBuffer[e]); for (this.receiveBuffer = [], e = 0; e < this.sendBuffer.length; e++)this.packet(this.sendBuffer[e]); this.sendBuffer = [] }, f.prototype.ondisconnect = function () { l("server disconnect (%s)", this.nsp), this.destroy(), this.onclose("io server disconnect") }, f.prototype.destroy = function () { if (this.subs) { for (var e = 0; e < this.subs.length; e++)this.subs[e].destroy(); this.subs = null } this.io.destroy(this) }, f.prototype.close = f.prototype.disconnect = function () { return this.connected && (l("performing disconnect (%s)", this.nsp), this.packet({ type: r.DISCONNECT })), this.destroy(), this.connected && this.onclose("io client disconnect"), this }, f.prototype.compress = function (e) { return this.flags.compress = e, this }, f.prototype.binary = function (e) { return this.flags.binary = e, this } }, 3678: (e, t, n) => { var r = n(4187), s = n(1227)("socket.io-client:url"); e.exports = function (e, t) { var n = e; t = t || "undefined" != typeof location && location, null == e && (e = t.protocol + "//" + t.host); "string" == typeof e && ("/" === e.charAt(0) && (e = "/" === e.charAt(1) ? t.protocol + e : t.host + e), /^(https?|wss?):\/\//.test(e) || (s("protocol-less url %s", e), e = void 0 !== t ? t.protocol + "//" + e : "https://" + e), s("parse %s", e), n = r(e)); n.port || (/^(http|ws)$/.test(n.protocol) ? n.port = "80" : /^(http|ws)s$/.test(n.protocol) && (n.port = "443")); n.path = n.path || "/"; var i = -1 !== n.host.indexOf(":") ? "[" + n.host + "]" : n.host; return n.id = n.protocol + "://" + i + ":" + n.port, n.href = n.protocol + "://" + i + (t && t.port === n.port ? "" : ":" + n.port), n } }, 2326: (e, t, n) => { var r = n(6327), s = n(6066), i = Object.prototype.toString, o = "function" == typeof Blob || "undefined" != typeof Blob && "[object BlobConstructor]" === i.call(Blob), a = "function" == typeof File || "undefined" != typeof File && "[object FileConstructor]" === i.call(File); function l(e, t) { if (!e) return e; if (s(e)) { var n = { _placeholder: !0, num: t.length }; return t.push(e), n } if (r(e)) { for (var i = new Array(e.length), o = 0; o < e.length; o++)i[o] = l(e[o], t); return i } if ("object" == typeof e && !(e instanceof Date)) { i = {}; for (var a in e) i[a] = l(e[a], t); return i } return e } function u(e, t) { if (!e) return e; if (e && e._placeholder) return t[e.num]; if (r(e)) for (var n = 0; n < e.length; n++)e[n] = u(e[n], t); else if ("object" == typeof e) for (var s in e) e[s] = u(e[s], t); return e } t.deconstructPacket = function (e) { var t = [], n = e.data, r = e; return r.data = l(n, t), r.attachments = t.length, { packet: r, buffers: t } }, t.reconstructPacket = function (e, t) { return e.data = u(e.data, t), e.attachments = void 0, e }, t.removeBlobs = function (e, t) { var n = 0, i = e; !function e(l, u, c) { if (!l) return l; if (o && l instanceof Blob || a && l instanceof File) { n++; var h = new FileReader; h.onload = function () { c ? c[u] = this.result : i = this.result, --n || t(i) }, h.readAsArrayBuffer(l) } else if (r(l)) for (var d = 0; d < l.length; d++)e(l[d], d, l); else if ("object" == typeof l && !s(l)) for (var f in l) e(l[f], f, l) }(i), n || t(i) } }, 9113: (e, t, n) => { var r = n(1227)("socket.io-parser"), s = n(8767), i = n(2326), o = n(6327), a = n(6066); function l() { } t.protocol = 4, t.types = ["CONNECT", "DISCONNECT", "EVENT", "ACK", "ERROR", "BINARY_EVENT", "BINARY_ACK"], t.CONNECT = 0, t.DISCONNECT = 1, t.EVENT = 2, t.ACK = 3, t.ERROR = 4, t.BINARY_EVENT = 5, t.BINARY_ACK = 6, t.Encoder = l, t.Decoder = h; var u = t.ERROR + '"encode error"'; function c(e) { var n = "" + e.type; if (t.BINARY_EVENT !== e.type && t.BINARY_ACK !== e.type || (n += e.attachments + "-"), e.nsp && "/" !== e.nsp && (n += e.nsp + ","), null != e.id && (n += e.id), null != e.data) { var s = function (e) { try { return JSON.stringify(e) } catch (e) { return !1 } }(e.data); if (!1 === s) return u; n += s } return r("encoded %j as %s", e, n), n } function h() { this.reconstructor = null } function d(e) { this.reconPack = e, this.buffers = [] } function f(e) { return { type: t.ERROR, data: "parser error: " + e } } l.prototype.encode = function (e, n) { (r("encoding packet %j", e), t.BINARY_EVENT === e.type || t.BINARY_ACK === e.type) ? function (e, t) { function n(e) { var n = i.deconstructPacket(e), r = c(n.packet), s = n.buffers; s.unshift(r), t(s) } i.removeBlobs(e, n) }(e, n) : n([c(e)]) }, s(h.prototype), h.prototype.add = function (e) { var n; if ("string" == typeof e) n = function (e) { var n = 0, s = { type: Number(e.charAt(0)) }; if (null == t.types[s.type]) return f("unknown packet type " + s.type); if (t.BINARY_EVENT === s.type || t.BINARY_ACK === s.type) { for (var i = n + 1; "-" !== e.charAt(++n) && n != e.length;); var a = e.substring(i, n); if (a != Number(a) || "-" !== e.charAt(n)) throw new Error("Illegal attachments"); s.attachments = Number(a) } if ("/" === e.charAt(n + 1)) { for (i = n + 1; ++n;) { if ("," === (u = e.charAt(n))) break; if (n === e.length) break } s.nsp = e.substring(i, n) } else s.nsp = "/"; var l = e.charAt(n + 1); if ("" !== l && Number(l) == l) { for (i = n + 1; ++n;) { var u; if (null == (u = e.charAt(n)) || Number(u) != u) { --n; break } if (n === e.length) break } s.id = Number(e.substring(i, n + 1)) } if (e.charAt(++n)) { var c = function (e) { try { return JSON.parse(e) } catch (e) { return !1 } }(e.substr(n)); if (!(!1 !== c && (s.type === t.ERROR || o(c)))) return f("invalid payload"); s.data = c } return r("decoded %s as %j", e, s), s }(e), t.BINARY_EVENT === n.type || t.BINARY_ACK === n.type ? (this.reconstructor = new d(n), 0 === this.reconstructor.reconPack.attachments && this.emit("decoded", n)) : this.emit("decoded", n); else { if (!a(e) && !e.base64) throw new Error("Unknown type: " + e); if (!this.reconstructor) throw new Error("got binary data when not reconstructing a packet"); (n = this.reconstructor.takeBinaryData(e)) && (this.reconstructor = null, this.emit("decoded", n)) } }, h.prototype.destroy = function () { this.reconstructor && this.reconstructor.finishedReconstruction() }, d.prototype.takeBinaryData = function (e) { if (this.buffers.push(e), this.buffers.length === this.reconPack.attachments) { var t = i.reconstructPacket(this.reconPack, this.buffers); return this.finishedReconstruction(), t } return null }, d.prototype.finishedReconstruction = function () { this.reconPack = null, this.buffers = [] } }, 6066: e => { e.exports = function (e) { return t && Buffer.isBuffer(e) || n && (e instanceof ArrayBuffer || function (e) { return "function" == typeof ArrayBuffer.isView ? ArrayBuffer.isView(e) : e.buffer instanceof ArrayBuffer }(e)) }; var t = "function" == typeof Buffer && "function" == typeof Buffer.isBuffer, n = "function" == typeof ArrayBuffer }, 6327: e => { var t = {}.toString; e.exports = Array.isArray || function (e) { return "[object Array]" == t.call(e) } }, 4042: e => { e.exports = function (e, t) { for (var n = [], r = (t = t || 0) || 0; r < e.length; r++)n[r - t] = e[r]; return n } }, 2281: e => { var t, n = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""), r = {}, s = 0, i = 0; function o(e) { var t = ""; do { t = n[e % 64] + t, e = Math.floor(e / 64) } while (e > 0); return t } function a() { var e = o(+new Date); return e !== t ? (s = 0, t = e) : e + "." + o(s++) } for (; i < 64; i++)r[n[i]] = i; a.encode = o, a.decode = function (e) { var t = 0; for (i = 0; i < e.length; i++)t = 64 * t + r[e.charAt(i)]; return t }, e.exports = a }, 7020: () => { }, 2403: e => { e.exports = JSON.parse('{"name":"jssip","title":"JsSIP","description":"the Javascript SIP library","version":"3.2.15","homepage":"http://jssip.net","author":"Jos Luis Milln <jmillan@aliax.net> (https://github.com/jmillan)","contributors":["Iaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Sal Ibarra Corretg <saghul@gmail.com> (https://github.com/saghul)"],"main":"lib-es5/JsSIP.js","keywords":["sip","websocket","webrtc","node","browser","library"],"license":"MIT","repository":{"type":"git","url":"https://github.com/versatica/JsSIP.git"},"bugs":{"url":"https://github.com/versatica/JsSIP/issues"},"dependencies":{"debug":"^4.1.0","events":"^3.0.0","sdp-transform":"^2.4.1"},"devDependencies":{"ansi-colors":"^3.1.0","@babel/core":"^7.1.2","@babel/preset-env":"^7.1.0","browserify":"^16.2.3","eslint":"^5.6.1","fancy-log":"^1.3.2","gulp":"^4.0.0","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.0","gulp-header":"^2.0.5","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.0","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4","pegjs":"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},"scripts":{"test":"gulp test","prepublishOnly":"gulp babel"}}') }
}, t = {}; function n(r) { var s = t[r]; if (void 0 !== s) return s.exports; var i = t[r] = { exports: {} }; return e[r](i, i.exports, n), i.exports } n.n = e => { var t = e && e.__esModule ? () => e.default : () => e; return n.d(t, { a: t }), t }, n.d = (e, t) => { for (var r in t) n.o(t, r) && !n.o(e, r) && Object.defineProperty(e, r, { enumerable: !0, get: t[r] }) }, n.o = (e, t) => Object.prototype.hasOwnProperty.call(e, t); var r = {}; (() => { n.d(r, { S: () => D }); const e = { jwt: void 0, user: void 0, cc: void 0, clis: void 0, phone: void 0, cuid: void 0, accountId: void 0, apikey: void 0, platform: void 0, name: void 0, callId: void 0, incomingcall: void 0, sigsockhost: void 0, branding: void 0, isBusy: !1, baseUrl: void 0, playRinger: !1, ringTime: 35e3, callsockPassword: void 0, callsockHost: void 0, hangup: !1, disconnectSipConnection: !1, participantCount: 0, isMuted: !1, ringtone: void 0, recording: !1, isAnswered: !1, disconnectCallsock: !1, retries: 5, retryDelay: 5e3, record: !1, canDeclineCall: !0, disconnectSigsock: !1 }; class t { constructor() { this.events = {} } subscribe(e, t) { return this.events.hasOwnProperty(e) || (this.events[e.toString()] = []), this.events[e.toString()].push(t) } publish(e, t) { return this.events.hasOwnProperty(e) ? this.events[e.toString()].map((n => n(t, e))) : [] } } const s = new class { constructor({ mutations: e, state: n }) { this.mutations = e || {}, this.events = new t; let r = this; this.state = new Proxy(n || {}, { set: function (e, t, n, s) { return n === s[t] || (e[t] = n, r.events.publish(t, n)), !0 }, get: function (e, t) { return e.hasOwnProperty(t) ? e[t] : `the ${t} does not exists` } }) } commit(e, t) { if (!this.mutations[e]) return console.log(`mutation ${e} does not exist`), !1; let n = this.mutations[e](this.state, t); return this.state = Object.assign(this.state, n), !0 } stateLogger(e) { return this.state[e] } }({ mutations: { setAccountDetails: function (e, { accountId: t, apikey: n, platform: r, phone: s, cc: i, cuid: o, name: a }) { return { ...e, accountId: t, apikey: n, platform: r, phone: s, cc: i, cuid: o, name: a } }, setAuthResponse: function (e, { branding: t, jwt: n, user: r, sigsockhost: s, clis: i, templates: o }) { return { ...e, branding: t, jwt: n, user: r, sigsockhost: s, clis: i, templates: o } }, setIsBusy: function (e, t) { return { ...e, isBusy: t } }, setCallId: function (e, t) { return { ...e, callId: t } }, setContext: function (e, t) { return { ...e, context: t } }, setCallsockHost: function (e, t) { return { ...e, callsockHost: t } }, setIncomingCallData: function (e, t) { return { ...e, incomingcall: t } }, playRinger: function (e, t) { return { ...e, playRinger: t } }, setCallsockPassword: function (e, t) { return { ...e, callsockPassword: t } }, hangup: function (e, t) { return { ...e, hangup: t } }, disconnectSip: function (e, t) { return { ...e, disconnectSip: t } }, setIsMuted: function (e, t) { return { state: e, isMuted: t } }, setParticipantCount: function (e, t) { return { ...e, participantCount: t } }, setRingtone: function (e, t) { return { ...e, ringtone: t } }, setIsAnswered: function (e, t) { return { ...e, isAnswered: t } }, disconnectCallsock: function (e, t) { return { ...e, disconnectCallsock: t } }, setRetryDelay: function (e, t) { return { ...e, retryDelay: t } }, setRecord: function (e, t) { return { ...e, record: t } }, setCanDeclineCall: function (e, t) { return { ...e, canDeclineCall: t } }, disconnectSigsock: function (e, t) { return { ...e, disconnectSigsock: t } } }, state: e }); var i = n(6809), o = n.n(i), a = n(5979), l = n.n(a); class u { constructor(e) { if (this.seconds = 0, this.minutes = 0, this.hours = 0, !e || "" === e) throw new Error("Please provide a valid element id"); if (this.timeElement = document.getElementById(e), !this.timeElement) throw new Error("Cannot find a valid dom node with provided element id") } startTimer() { let e = this; this.timer = window.setInterval((function () { e.timeElement.innerText = e.add() }), 1e3) } clearTimer() { try { this.timer && (window.clearInterval(this.timer), this.timer = 0), this.timeElement.innerHTML = "00:00:00" } catch (e) { throw console.error(e), e } } add() { return this.seconds++, 60 === this.seconds && (this.seconds = 0, this.minutes++, 60 === this.minutes && (this.minutes = 0, this.hours++)), `${this.formatTime(this.hours)}:${this.formatTime(this.minutes)}:${this.formatTime(this.seconds)}` } resetTimer() { this.hours = 0, this.minutes = 0, this.seconds = 0, this.clearTimer() } formatTime(e) { return e < 10 ? `0${e}` : e } } class c { constructor() { this.sipSession = void 0, this.ua = void 0, this.sipSocket = void 0 } init() { this.sipSocket = new (l().WebSocketInterface)("wss://" + s.state.callsockHost + ":8089/ws"), s.events.subscribe("disconnectSip", (e => { this.disconnect() })), s.events.subscribe("isMuted", (e => { this.mute(e) })) } initUa() { let e; s.state.cuid.length > 0 ? e = s.state.cuid : s.state.cc.length > 0 && s.state.phone.length > 0 && (e = s.state.cc + s.state.phone); let t = new (l().URI)("sip", e, s.state.callsockHost); t = t.toAor(); let n = { sockets: [this.sipSocket], uri: t, password: s.state.callsockPassword, realm: s.state.callsockHost, register: !0, no_answer_timeout: 30, connection_recovery_min_interval: 3, connection_recovery_max_interval: 45 }; this.ua = new (l().UA)(n), this.ua.start() } setupUaListners(e) { this.ua.on("registered", (() => { e.callVoip().catch((e => { throw s.commit("setIsBusy", !1), e })) })), this.ua.on("unregistered", (() => { })), this.ua.on("registrationFailed", (() => { this.disconnect(), s.commit("hangup", !s.state.hangup) })), this.ua.on("confirmed", (e => { })), this.ua.on("newRTCSession", (t => { "incoming" === t.session.direction && (this.sipSession = t.session, this.setupRTCSession(e), this.sipSession.answer({ mediaConstraints: { audio: !0, video: !1 } })) })) } setupRTCSession(e) { let t; this.sipSession.on("ended", (() => { this.sipSession = void 0 })), this.sipSession.on("progress", (e => { })), this.sipSession.on("accepted", (e => { })), this.sipSession.on("failed", (e => { })), this.sipSession.on("sdp", (e => { })), this.sipSession.on("getusermediafailed", (e => { })), this.sipSession.on("createofferfailed", (e => { })), this.sipSession.on("createanswerfailed", (e => { })), this.sipSession.on("setlocaldescriptionfailed", (e => { })), this.sipSession.on("setremotedescriptionfailed", (e => { })), this.sipSession.on("confirmed", (n => { if (null == t) t = document.getElementById("audioSink"); else try { t.pause() } catch (e) { console.log("try again") } let r = this.sipSession.connection.getRemoteStreams()[0]; t.srcObject = r, s.state.record && e.recordCall(s.state.callId).catch((e => console.error(e))), t.play(), new u("dc__sdk--timer").startTimer() })) } mute(e) { this.sipSession && (e ? this.sipSession.mute({ audio: !0 }) : this.sipSession.unmute({ audio: !0 })) } disconnect() { void 0 !== this.sipSession && (this.sipSession.isEnded() || this.sipSession.terminate()), void 0 !== this.sipSocket && (this.sipSocket.disconnect(), this.sipSocket = void 0), void 0 !== this.ua && (this.ua.stop(), this.ua = void 0) } } class h { constructor() { this.socket = void 0, this.ready = !1, s.events.subscribe("disconnectCallsock", (() => { this.socket.disconnect() })) } init(e, t, n) { return new Promise(((r, s) => { this.socket = o()(`https://${e}:3001`, t), this.socket ? this.initHandlers(n, r, s) : s(new Error("failed to initialise call connection")) })) } initHandlers(e, t, n) { let r = this; this.socket.on("connect", (() => { r.socket.emit("authentication", e); r.socket.once("authenticated", (() => { r.connected = !0, t() })), r.socket.once("unauthorized", (e => { r.connected = !1, r.disconnect(), n(e) })) })), this.socket.on("disconnect", (() => { r.connected = !1 })), this.socket.on("connect_error", (e => { this.socket.disconnect(), console.log("Failed to connect callsock") })), this.socket.on("connect_timeout", (e => { r.connected = !1 })), this.socket.on("reconnect_failed", (e => { r.connected = !1 })), this.socket.on("failure", (e => { if ("call_voip" === e.type) r.voipConnected = !1 })), this.socket.on("callsockError", (e => { console.log("try again") })), this.socket.on("participant-disconnected", (e => { })), this.socket.on("endpoint_ready", (e => { r.callsockPwd = e.secret, s.commit("setCallsockPassword", e.secret), this.sip = new c, this.sip.init(), this.sip.initUa(), this.sip.setupUaListners(this) })), this.socket.on("call_status", (e => { if (e && e.status) { let t = Object.keys(e.status); s.commit("setParticipantCount", t.length) } e.alone && (s.commit("hangup", !s.state.hangup), s.commit("setIsBusy", !1)) })), this.socket.on("connect_timeout", (e => { s.commit("hangup", !s.state.hangup) })), this.socket.on("participant-disconnected", (e => { })) } callVoip(e) { let t; return t = e ? { confCall: e } : null, new Promise(((e, n) => { this.socket.emit("call_voip", t, (t => { t.status ? e(t) : n(t.error) })) })) } disconnect() { this.socket.disconnect() } recordCall(e) { return new Promise(((t, n) => { this.socket.emit("record_call", e, (e => { e.error && n(e.error), t(e) })) })) } } function d() { return new Promise(((e, t) => { let n = new h, r = { reconnectionAttempts: 5, reconnectionDelay: 1500, reconnectionDelayMax: 6e3, timeout: 3e4, autoReconnect: !1, transports: ["websocket"], query: { jwt: s.state.jwt } }, i = { platform: "web", accountId: s.state.accountId, apikey: s.state.apikey, cc: s.state.user.cc, phone: s.state.user.phone, cuid: s.state.cuid, callId: s.state.callId, cli: s.state.cli, initiator: s.state.isInitiator }; n.init(s.state.callsockHost, r, i).then((() => { e(n) })).catch((e => { console.log(e), t(e) })) })) } class f { constructor({ url: e, loop: t }) { if (this.url = e, this.loop = t, this.audioElement = void 0, !e) throw new Error("Please provide a valid url") } play() { this.audioElement = document.createElement("audio"), this.audioElement.src = this.url, this.loop && (this.audioElement.loop = !0), document.body.append(this.audioElement), this.audioElement.play() } stop() { this.audioElement.pause(), this.audioElement.remove() } } const p = function () { let e; class t { constructor(e, t) { this.instance = void 0, this.cancelRinger = void 0, this.ring = new f({ url: e, loop: t }), s.events.subscribe("playRinger", (e => e ? this.play(s.state.ringTime) : this.stop())) } play(e) { this.ring.play(), this.cancelRinger = setTimeout((() => { this.ring.stop() }), e) } stop() { this.ring.stop(), clearTimeout(this.cancelRinger) } } return { getInstance: (n = "https://s3.ap-south-1.amazonaws.com/sdkassets/outgoing-tone.mp3", r = !0) => (e || (e = new t(n, r)), e) } }(); let _; class m { constructor() { this.socket = void 0, this.incomingcall = void 0 } init(e, t, n) { return new Promise(((r, i) => { this.socket = o()(`https://${e}`, t), this.socket ? (this.initHandlers(n, r, i), this.getLatency()) : i(new Error("failed to initialise Signalling connection")), s.events.subscribe("disconnectSigsock", (() => this.disconnect())) })) } getLatency() { setInterval((() => { _ = Date.now(), this.socket.emit("ping") }), 2e3) } initHandlers(e, t, n) { let r = this; this.socket.on("connect", (() => { r.socket.emit("authentication", e, (e => { })); let s = e => { r.socket.removeListener("authenticated", s), r.connected = !1, n(e) }; r.socket.once("authenticated", ((e, n) => { r.socket.removeListener("unauthorized", s), n && n({ status: !0 }), t() })), r.socket.once("unauthorized", s) })), this.socket.on("disconnect", (() => { r.connected = !1 })), this.socket.on("pong", (e => { Math.floor((Date.now() - _) / 1e3) })), this.socket.on("connect_error", (e => { r.connected = !1, n(e) })), this.socket.on("connect_timeout", (e => { r.connected = !1, n(e) })), this.socket.on("reconnect_failed", (e => { r.connected = !1 })) } disconnect() { this.socket.connected && this.socket.disconnect() } makeCall(e) { let t = !1; return new Promise(((n, r) => { let s = setTimeout((() => { if (t) clearTimeout(s); else { r({ code: "ERR_INTERNET_LOST", message: "Internet lost at receiver's end. Please try again later" }) } }), 1e4); this.socket.emit("makecall", e, (e => { if (e) if (t = !0, clearTimeout(s), e.status) n(e.data); else if (e.error) r(e.error); else { r({ code: "ERR_USER_BUSY", message: "User busy on another call" }) } })) })) } answer(e) { return new Promise(((t, n) => { s.commit("setCanDeclineCall", !1); let r = { responseSid: this.incomingcall.from.id + "_" + e, callId: this.incomingcall.call, sid: this.incomingcall.sid }; this.socket.emit("answer", r, (e => { s.commit("setCanDeclineCall", !0), e.status || n(e.error), t() })) })) } decline(e, t) { let n, r = this; return n = t ? { responseSid: t.from.id + "_" + e, callId: t.call, sid: t.sid } : { responseSid: this.incomingcall.from.id + "_" + e, callId: this.incomingcall.call, sid: this.incomingcall.sid }, s.state.participantCount >= 2 && (n.reason = "User Busy", n.reasonCode = 1001), new Promise(((e, t) => { this.socket.emit("decline", n, (n => { n.error && t(n.error), r.incomingcall = void 0, e(n) })) })) } miss(e) { let t = this, n = { responseSid: this.incomingcall.from.id + "_" + e, callId: this.incomingcall.call, sid: this.incomingcall.sid }; return new Promise(((e, r) => { this.socket.emit("miss", n, (n => { n.error && r(n.error), t.incomingcall = void 0, e(n) })) })) } cancel(e) { return new Promise(((t, n) => { this.socket.emit("cancel", e, (e => { e.error && n(e.error), t(e) })) })) } } const g = (e, { logo: t, bgColor: n, color: r }) => { let s = `<div id="dc__sdk">\n      <p id="dc__sdk--header">${e}</p>\n      ${t ? '\n      <div class="dc__sdk--brand"></div>' : ""}\n      <p id="dc__sdk--timer" class="dc__hide">00:00:00</p>\n      <div id="dc__callactions"></div>\n      </div>\n      `, i = `\n  #dc__sdk{\n      width: 134px;\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      flex-direction: column;\n      height: 308px;\n      position: fixed;\n      right: 0;\n      top: 36.38%;\n      bottom: 28.38%;\n      background: ${n};\n      color: ${r}\n      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.04), 0px 4px 8px rgba(0, 0, 0, 0.06);\n      border-radius: 4px 0px 0px 4px;\n      z-index: 999999;\n      font-family: roboto;\n    }\n    .dc__hide {\n      display: none;\n    }\n\n    #dc__sdk--header {\n      margin: 20px 0 11px 0;\n      font-style: normal;\n      font-weight: 600;\n      font-size: 18px;\n      line-height: 24px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      color: ${r};\n    }\n\n    .dc__sdk--brand {\n      width: 88px;\n      height: 66px;\n      background-image: url(${t});\n      mix-blend-mode: difference;\n      background-position: center;\n      background-size: contain;\n      background-repeat: no-repeat;\n    }\n\n    #dc__sdk--timer {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 1px 38px 12px 38px;\n      color: ${r};\n\n    }\n    \n    #dc__callactions {\n      display: inherit;\n      justify-content: inherit;\n      align-items: inherit;\n      flex-direction: inherit;\n    }\n    \n    `, o = document.getElementById("dc-sdk"); if (!o) throw new Error("Container block for calling views is missing."); let a = "callmodal_css"; if (!document.getElementById(a)) { let e = document.getElementsByTagName("head")[0], t = document.createElement("style"); t.setAttribute("id", a), t.innerHTML = i, e.appendChild(t) } o.innerHTML = s }, v = () => { let e = document.getElementById("dc__sdk"); e && e.remove() }, y = "DCOutgoing", C = "DCIncoming", T = "DCEnd", S = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M1.79619 8.10012L1.93876 7.95771C1.94636 7.95012 1.95393 7.94255 1.96199 7.9345C2.66848 7.29757 3.55866 6.80807 4.76361 6.39382C6.84725 5.66603 9.06196 5.39375 11.258 5.59545C12.9029 5.70768 14.5144 6.10987 16.0181 6.78346C16.8443 7.12814 17.5862 7.64706 18.1932 8.3048C18.6466 8.83434 18.922 9.32035 18.8988 10.1108C18.8945 10.3517 18.8405 10.5892 18.7399 10.8083C18.6393 11.0275 18.4945 11.2235 18.3145 11.3841C18.1345 11.5446 17.9233 11.6661 17.6942 11.7411C17.4651 11.816 17.223 11.8427 16.9833 11.8195L14.1415 11.4749C13.718 11.4299 13.3266 11.2293 13.043 10.9121C12.7593 10.5949 12.6036 10.1836 12.606 9.75759L12.6075 9.0709C11.5559 8.94682 9.18117 8.73603 7.25235 9.07006C7.25411 9.30436 7.25646 9.56777 7.25916 9.78235C7.26372 10.2204 7.10207 10.6442 6.80682 10.9684C6.51157 11.2927 6.10462 11.4932 5.66799 11.5297L2.75636 11.8066C2.52292 11.8256 2.28817 11.7961 2.06692 11.7198C1.84566 11.6435 1.64273 11.5222 1.47085 11.3635C1.28972 11.2005 1.14358 11.0024 1.04115 10.7812C0.93872 10.56 0.88212 10.3204 0.874838 10.0765C0.837628 9.13161 1.21483 8.68084 1.79619 8.10012Z" fill="white"/>\n</svg>\n'; function b() { this.sigsock.socket.on("incoming_call", ((e, t) => { var n, r; this.ctSdk.event.push(C, { ct_account_id: this.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: e.call, cuid: s.state.cuid, epoch: Date.now(), context: e.context }), s.state.isBusy ? (t({ status: !0 }), this.sigsock.decline(this.accountId, e).then((() => { let e = { ct_account_id: this.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: s.state.callId, cuid: s.state.cuid, epoch: Date.now(), context: s.state.context, call_status: "declined", reason: "user busy", reason_code: 1001 }; this.ctSdk.event.push(T, e) })).catch((e => { console.error(e) }))) : (this.sigsock.incomingcall = e, s.commit("setCallId", e.call), s.commit("setContext", e.context), s.commit("setCallsockHost", e.host), s.commit("playRinger", !0), g("Incoming Call", s.state.branding), (({ color: e }, t) => { let n = `\n\n    #dc--call_context{\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 4px auto 20px auto;\n      color: ${e = e || "#ffffff"};\n    }\n\n    .dc__inc--decline, .dc__inc--answer {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      position: relative;\n      cursor: pointer;\n      color: ${e}\n    }\n    .dc__inc--decline {\n      background-color: #FF453A\n    }\n\n    .dc__inc--answer  {\n      background-color: #25D366\n    }\n\n\n    .dc__inc--decline>svg {\n      position: absolute;\n      top: 11px;\n      left: 10px;\n    }\n\n    .dc__inc--answer>svg {\n      position: absolute;\n      top: 13px;\n      left: 12px;\n      transform: rotate(372deg);\n    }\n\n    .dc__inc--actiontext {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 4px auto 20px auto;\n      color: ${e};\n    }`, r = `\n  <p id="dc--call_context">${t}</p>\n  <div id="dc__inc--answer--container">\n    <div class="dc__inc--answer">\n        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M11.461 14H11.2594C11.2487 14 11.238 14 11.2266 14C10.2766 13.9513 9.30091 13.6685 8.15566 13.1101C6.16715 12.1524 4.40784 10.7799 2.99673 9.08517C1.9123 7.8433 1.05642 6.41986 0.468609 4.88061C0.12761 4.05279 -0.0305209 3.16137 0.00485979 2.26704C0.0583521 1.572 0.206944 1.03348 0.78204 0.490656C0.955286 0.323237 1.16139 0.193419 1.3874 0.10946C1.61341 0.0255007 1.85447 -0.0108262 2.09524 0.00279012C2.33602 0.0164065 2.57135 0.0796961 2.78641 0.188599C3.00147 0.297502 3.19159 0.449655 3.34477 0.635534L5.11176 2.88769C5.37957 3.21882 5.51477 3.63728 5.49128 4.06216C5.46778 4.48704 5.28721 4.88814 4.98452 5.18785L4.49811 5.67257C5.15442 6.50354 6.68556 8.33097 8.28625 9.45779C8.4506 9.29078 8.63509 9.10275 8.78483 8.94904C9.09117 8.63591 9.50507 8.45028 9.9431 8.42956C10.3811 8.40883 10.8108 8.55455 11.1454 8.83734L13.4011 10.6991C13.5797 10.8506 13.7249 11.0375 13.8275 11.2478C13.9302 11.4581 13.988 11.6873 13.9975 11.9211C14.0104 12.1644 13.9738 12.4079 13.8899 12.6367C13.8061 12.8656 13.6767 13.0752 13.5096 13.2528C12.8681 13.9477 12.2827 14 11.461 14Z" fill="white"/>\n</svg>\n\n    </div>\n    <p class="dc__inc--actiontext">Answer</p>\n  </div>\n  <div>\n  <div id="dc__inc--decline--container">\n    <div class="dc__inc--decline">\n        ${S}\n    </div>\n    <p class="dc__inc--actiontext">Decline</p>\n  </div>\n     `, s = document.getElementById("dc__callactions"); if (!s) throw new Error("Cannot find the required element for call dialog rendering"); let i = "dc--incoming__screen"; if (!document.getElementById(i)) { let e = document.createElement("style"); e.setAttribute("id", i), e.innerHTML = n, document.getElementsByTagName("head")[0].appendChild(e) } s.innerHTML = r })(s.state.branding, e.context), n = () => { this.answer() }, r = () => { this.decline() }, document.getElementById("dc__inc--answer--container").addEventListener("click", n), document.getElementById("dc__inc--decline--container").addEventListener("click", r), this.setupMissTimer(), s.commit("setIsBusy", !0), t({ status: !0 })) })), this.sigsock.socket.on("cancel", ((e, t) => { s.state.callId === e && (s.commit("playRinger", !1), v(), clearTimeout(this.missTimer), t({ status: !0 }), this.isBusy = !1, s.commit("setIsBusy", !1)) })), this.sigsock.socket.on("hold-unhold", (e => { !0 === e.hold ? document.getElementsByClassName("hold__text") && (document.getElementsByClassName("hold__text")[0].classList.remove("dc__hide"), s.commit("setIsMuted", !0)) : !1 === e.hold && (this.hold = !1, document.getElementsByClassName("hold__text")[0].classList.contains("dc__hide") || (document.getElementsByClassName("hold__text")[0].classList.add("dc__hide"), s.commit("setIsMuted", !1))) })) } const { fetch: E } = window; window.fetch = async (...t) => { let [n, r] = t, { headers: s } = r, i = e.retries; return new Promise(((t, o) => { const a = async () => E(n, r).then((async n => { if (n.ok) t(n); else { if (console.log(n), 401 === n.status || 404 === n.status) return void o(n); s.initialRequest ? setTimeout((() => { a() }), e.retryDelay) : i > 0 ? (i -= 1, setTimeout((() => { a() }), e.retryDelay)) : o(n) } })).catch((e => { o(e) })); a() })) }; class A { constructor() { this.baseUrl = "https://ctapi.patchus.in/api/v2" } static setBaseUrl(e) { this.baseUrl = e } async get(e, t) { return t && t.authToken && (t.Authorization = window.localStorage.getItem("act"), delete t.authToken), fetch(this.baseUrl + e, { headers: t }).then((e => e.json())).catch((e => e.json())) } async post(e, t, n) { return n && n.authToken && (n.Authorization = window.localStorage.getItem("act"), delete n.authToken), fetch(this.baseUrl + e, { method: "POST", headers: n, body: JSON.stringify(t) }).then((e => e.json())).catch((e => e.json())) } } let w = new A; const R = ({ color: e, iconTheme: t }) => { let n = `\n    #dc__ong--mute {\n      cursor: pointer;\n    }\n    #dc__ong--unmute {\n      cursor: pointer;\n    }\n\n    #dc__ong--mute>svg, #dc__ong--unmute>svg {\n      display: block;\n      margin: 0 auto;\n      width: 40px;\n      height: 40px;\n    }\n\n    .dc__ong--mutetext {\n      font-family: Proxima Nova;\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      color: ${e = e || "#ffffff"};\n      margin: 4px auto 12px auto\n    }\n\n    .dc__ong--hangup {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      background-color: #FF453A;\n      position: relative;\n      cursor: pointer;\n      margin: 21px auto auto auto;\n    }\n\n    .dc__ong--hangup>svg {\n      position: absolute;\n      top: 11px;\n      left: 10px;\n    }\n\n    .dc__ong--hanguptext {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 4px auto 20px auto;\n      color: ${e};\n    }\n\n    .hold__text {\n      text-align: center;\n      color: ${e}\n    }\n\n    .dc__hide {\n      display: none;\n    }\n  `, r = `\n      <div id="dc__ong">\n      <p class="hold__text dc__hide">The user has put you on hold</p>\n      <div id="dc__ong--unmute" class="dc__hide">\n       ${"light" === t ? '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="15" cy="15" r="14.5" stroke="white"/>\n<path d="M10.664 15.0019C10.664 14.8502 10.6037 14.7046 10.4964 14.5973C10.3891 14.49 10.2435 14.4297 10.0918 14.4297C9.94001 14.4297 9.79445 14.49 9.68714 14.5973C9.57982 14.7046 9.51954 14.8502 9.51954 15.0019C9.51818 15.932 9.7774 16.8439 10.2678 17.6342L11.1071 16.7949C10.8157 16.2422 10.6636 15.6267 10.664 15.0019Z" fill="white"/>\n<path d="M13.9599 19.9802V21.8548H11.3999C11.2481 21.8548 11.1026 21.9151 10.9952 22.0224C10.8879 22.1298 10.8276 22.2753 10.8276 22.4271C10.8276 22.5788 10.8879 22.7244 10.9952 22.8317C11.1026 22.939 11.2481 22.9993 11.3999 22.9993H17.6645C17.8163 22.9993 17.9618 22.939 18.0692 22.8317C18.1765 22.7244 18.2368 22.5788 18.2368 22.4271C18.2368 22.2753 18.1765 22.1298 18.0692 22.0224C17.9618 21.9151 17.8163 21.8548 17.6645 21.8548H15.1043V19.9804C16.3259 19.8388 17.453 19.2536 18.2715 18.3358C19.0901 17.4181 19.5432 16.2317 19.5447 15.0019C19.5447 14.8502 19.4844 14.7046 19.3771 14.5973C19.2698 14.49 19.1242 14.4297 18.9725 14.4297C18.8207 14.4297 18.6752 14.49 18.5678 14.5973C18.4605 14.7046 18.4002 14.8502 18.4002 15.0019C18.4005 15.669 18.228 16.3248 17.8997 16.9054C17.5714 17.4861 17.0984 17.972 16.5267 18.3157C15.955 18.6594 15.3041 18.8493 14.6373 18.8669C13.9705 18.8846 13.3104 18.7293 12.7214 18.4163L11.8847 19.2529C12.5137 19.6468 13.2226 19.8953 13.9599 19.9802V19.9802Z" fill="white"/>\n<path d="M12.9028 14.7977V9.75081C12.9074 9.32176 13.0811 8.91186 13.3861 8.6101C13.6912 8.30835 14.103 8.13909 14.532 8.13909C14.9611 8.13909 15.3729 8.30835 15.6779 8.6101C15.9829 8.91186 16.1566 9.32176 16.1613 9.75081V11.7409L17.3058 10.5964V9.75081C17.2997 9.01916 17.0048 8.31954 16.4853 7.80431C15.9657 7.28909 15.2637 7 14.532 7C13.8003 7 13.0983 7.28909 12.5788 7.80431C12.0593 8.31954 11.7644 9.01916 11.7583 9.75081V14.7977C11.7583 15.1806 11.8381 15.5593 11.9925 15.9096L12.9148 14.9874C12.9071 14.9244 12.9031 14.8611 12.9028 14.7977V14.7977Z" fill="white"/>\n<path d="M14.7247 16.4169L13.6968 17.4448C13.9668 17.5303 14.2484 17.5737 14.5317 17.5736V17.5736C15.267 17.5728 15.972 17.2803 16.4919 16.7604C17.0118 16.2404 17.3043 15.5355 17.3051 14.8002V13.8359L16.1482 14.9928C16.1046 15.3553 15.9406 15.6926 15.6825 15.9508C15.4244 16.209 15.0871 16.3731 14.7247 16.4169V16.4169Z" fill="white"/>\n<path d="M20.0632 9.46094L9 20.5242" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>\n' : '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="15" cy="15" r="14.5" stroke="white"/>\n<path d="M10.664 15.0019C10.664 14.8502 10.6037 14.7046 10.4964 14.5973C10.3891 14.49 10.2435 14.4297 10.0918 14.4297C9.94001 14.4297 9.79445 14.49 9.68714 14.5973C9.57982 14.7046 9.51954 14.8502 9.51954 15.0019C9.51818 15.932 9.7774 16.8439 10.2678 17.6342L11.1071 16.7949C10.8157 16.2422 10.6636 15.6267 10.664 15.0019Z" fill="white"/>\n<path d="M13.9599 19.9802V21.8548H11.3999C11.2481 21.8548 11.1026 21.9151 10.9952 22.0224C10.8879 22.1298 10.8276 22.2753 10.8276 22.4271C10.8276 22.5788 10.8879 22.7244 10.9952 22.8317C11.1026 22.939 11.2481 22.9993 11.3999 22.9993H17.6645C17.8163 22.9993 17.9618 22.939 18.0692 22.8317C18.1765 22.7244 18.2368 22.5788 18.2368 22.4271C18.2368 22.2753 18.1765 22.1298 18.0692 22.0224C17.9618 21.9151 17.8163 21.8548 17.6645 21.8548H15.1043V19.9804C16.3259 19.8388 17.453 19.2536 18.2715 18.3358C19.0901 17.4181 19.5432 16.2317 19.5447 15.0019C19.5447 14.8502 19.4844 14.7046 19.3771 14.5973C19.2698 14.49 19.1242 14.4297 18.9725 14.4297C18.8207 14.4297 18.6752 14.49 18.5678 14.5973C18.4605 14.7046 18.4002 14.8502 18.4002 15.0019C18.4005 15.669 18.228 16.3248 17.8997 16.9054C17.5714 17.4861 17.0984 17.972 16.5267 18.3157C15.955 18.6594 15.3041 18.8493 14.6373 18.8669C13.9705 18.8846 13.3104 18.7293 12.7214 18.4163L11.8847 19.2529C12.5137 19.6468 13.2226 19.8953 13.9599 19.9802V19.9802Z" fill="white"/>\n<path d="M12.9028 14.7977V9.75081C12.9074 9.32176 13.0811 8.91186 13.3861 8.6101C13.6912 8.30835 14.103 8.13909 14.532 8.13909C14.9611 8.13909 15.3729 8.30835 15.6779 8.6101C15.9829 8.91186 16.1566 9.32176 16.1613 9.75081V11.7409L17.3058 10.5964V9.75081C17.2997 9.01916 17.0048 8.31954 16.4853 7.80431C15.9657 7.28909 15.2637 7 14.532 7C13.8003 7 13.0983 7.28909 12.5788 7.80431C12.0593 8.31954 11.7644 9.01916 11.7583 9.75081V14.7977C11.7583 15.1806 11.8381 15.5593 11.9925 15.9096L12.9148 14.9874C12.9071 14.9244 12.9031 14.8611 12.9028 14.7977V14.7977Z" fill="white"/>\n<path d="M14.7247 16.4169L13.6968 17.4448C13.9668 17.5303 14.2484 17.5737 14.5317 17.5736V17.5736C15.267 17.5728 15.972 17.2803 16.4919 16.7604C17.0118 16.2404 17.3043 15.5355 17.3051 14.8002V13.8359L16.1482 14.9928C16.1046 15.3553 15.9406 15.6926 15.6825 15.9508C15.4244 16.209 15.0871 16.3731 14.7247 16.4169V16.4169Z" fill="white"/>\n<path d="M20.0632 9.46094L9 20.5242" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>'}\n        <p class="dc__ong--mutetext">Unmute</p>\n      </div>\n      <div id="dc__ong--mute">\n        ${"light" === t ? '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="15" cy="15" r="14.5" stroke="#121212"/>\n<path d="M11.4077 23H18.1447" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7759 23.0013V19.9531" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7765 7H14.7759C13.4685 7 12.4087 8.05982 12.4087 9.36718V14.7947C12.4087 16.102 13.4685 17.1618 14.7759 17.1618H14.7765C16.0838 17.1618 17.1437 16.102 17.1437 14.7947V9.36718C17.1437 8.05982 16.0838 7 14.7765 7Z" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M19.5512 15.0156C19.5474 16.2808 19.0431 17.4931 18.1484 18.3876C17.2538 19.2822 16.0414 19.7863 14.7762 19.7898H14.7742C13.5091 19.786 12.297 19.2819 11.4024 18.3873C10.5079 17.4928 10.0037 16.2807 10 15.0156" stroke="#121212" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>\n' : '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n<circle cx="15" cy="15" r="14.5" stroke="white"/>\n<path d="M11.4077 23H18.1447" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7759 23.0013V19.9531" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M14.7765 7H14.7759C13.4685 7 12.4087 8.05982 12.4087 9.36718V14.7947C12.4087 16.102 13.4685 17.1618 14.7759 17.1618H14.7765C16.0838 17.1618 17.1437 16.102 17.1437 14.7947V9.36718C17.1437 8.05982 16.0838 7 14.7765 7Z" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n<path d="M19.5512 15.0156C19.5474 16.2808 19.0431 17.4931 18.1484 18.3876C17.2538 19.2822 16.0414 19.7863 14.7762 19.7898H14.7742C13.5091 19.786 12.297 19.2819 11.4024 18.3873C10.5079 17.4928 10.0037 16.2807 10 15.0156" stroke="white" stroke-miterlimit="10" stroke-linecap="round"/>\n</svg>\n'}\n        <p class="dc__ong--mutetext">Mute</p>\n      </div>\n      <div id="dc__ong--hangup--container">\n      <div class="dc__ong--hangup">\n        ${S}\n      </div>\n      <p class="dc__ong--hanguptext">Hang up</p>\n      <audio id="audioSink" class="dc__ong--hide"></audio>\n    </div>\n    </div>\n    `, s = document.getElementById("dc__callactions"); if (!s) throw new Error("Call element is not present. Call modal cannot render."); let i = "ongoing_css"; if (!document.getElementById(i)) { let e = document.getElementsByTagName("head")[0], t = document.createElement("style"); t.setAttribute("id", i), t.innerHTML = n, e.appendChild(t) } s.innerHTML = r }; function I(e) { let t = /^\d+$/g; return t = new RegExp(t), t.test(e) } function k(e) { if (e.indexOf(" ") >= 0) throw new Error("cuid must not contain any space"); if (e.length < 5 || e.length > 50) throw new Error("cuid should be between 5 to 50 characters"); if (t = e, new RegExp(/^(\d{0,}(?:[-,."'*+:@!#$%^&*()_=~<>|}{])\d{0,})*$/).test(t)) throw new Error("cuid cannot have special characters between two numbers"); var t } function x({ accountId: e, apikey: t, cuid: n, cc: r, phone: s, name: i }) { if (!e) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "account id is a required parameter" } } if (!t) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "api key is a required parameter" } } if (!n) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "cuid is a required parameter" } } if (r && !s || !r && s) { throw { code: "ERR_INVALID_INITPARAMETERS", message: "cc and phone if provided, cannot be empty" } } if (n) try { k(n) } catch (e) { throw { code: "ERR_INVALID_INITPARAMETERS", message: e.message } } if (r && s && function (e, t) { if (e = e.trim(), t = t.trim(), e.indexOf(" ") >= 0 || t.indexOf(" ") >= 0) throw { code: "ERR_INVALID_INITPARAMETERS", message: "cc and phone must not have any spaces" }; if (e.length < 1 || e.length > 6) throw { code: "ERR_INVALID_INITPARAMETERS", message: "cc should be between 1 to 6 characters" }; if (t.length < 5 || t.length > 15) throw { code: "ERR_INVALID_INITPARAMETERS", message: "phone should be between 5 to 15 characters" }; if (!I(e) || !I(t)) throw { code: "ERR_INVALID_INITPARAMETERS", message: "cc and phone should be a number without special characters" } }(r, s), i && (i.trim().length < 3 || i.trim().length > 50)) { throw { code: "ERR_INVALID_INITPARAMETERS", message: "name should be between 3 to 50 characters" } } } const O = "1.0.0"; class N { constructor(e) { this.stateLogger = s.stateLogger.bind(s), this.ctSdk = e, s.state.ringtone ? this.ringer = p.getInstance(s.state.ringtone) : this.ringer = p.getInstance(), this.sigsock = void 0, this.loginSuccesful = !1, s.events.subscribe("hangup", this.hangup.bind(this)) } async signin(e) { s.commit("setAccountDetails", e); let t = e.accountId; if (!this.ctSdk.getCleverTapID()) { throw { code: "ERR_MISSING_CT_ID", message: "cannot find clevertap id. Direct call sdk cannot initiate" } } if (!this.ctSdk.getAccountID()) { throw { code: "ERR_MISSING_CT_ACCOUNTID", message: "cannot find clevertap account id. Direct call sdk cannot initiate" } } e.guid = this.ctSdk.getCleverTapID(), e.ctAccountId = this.ctSdk.getAccountID(); let n = this.ctSdk.getRegion(); try { await async function (e, t, n = "eu1") { let r = await w.post(`/accounts/${e}/baseUrl`, { apikey: t, region: n }, { "Content-type": "application/json", initialRequest: !0 }); if (r && r.error) throw 404 === r.error.statusCode ? r.error.statusCode : 401 === r.error.statusCode ? r.error.message : r.error; const { baseUrl: i, retryTime: o } = r; return s.commit("setRetryDelay", 1e3 * o), A.setBaseUrl(i), r }(t, e.apikey, n); let r = await async function ({ accountId: e, apikey: t, guid: n, ctAccountId: r, phone: s, cc: i, cuid: o, name: a }) { let l = await w.post(`/accounts/${e}/contacts/signin`, { cc: i, phone: s, cuid: o, accountId: e, platform: "web", name: a, apikey: t, ctAccountId: r, guid: n }, { "Content-type": "application/json" }); if (l && l.error) { if (l.error.message) throw l.error.message; throw l.error } return l && l.accessToken && window.localStorage.setItem("act", l.accessToken), l }(e), i = await async function ({ accessToken: e, cuid: t, cc: n, phone: r, ...s }) { let i; if (i = t ? await w.get(`/contacts/jwt?cuid=${t}&accountId=${s.accountId}`, { authToken: !0, "Content-type": "application/json" }) : await w.get(`/contacts/jwt?phone=${r}&cc=${n}&accountId=${s.accountId}`, { authToken: !0 }), i && i.error) { if (i.error.message) throw i.error.message; throw i.error } return { branding: s.branding, jwt: i.token, user: i.user, sigsockhost: s.sna, ecta: s.ecta, clis: s.cli, templates: s.templates } }({ ...r, accountId: t }); s.commit("setAuthResponse", i), this.sigsock = await new Promise(((e, t) => { let n = new m, r = { platform: "web", accountId: s.state.accountId, apikey: s.state.apikey, cc: s.state.cc, phone: s.state.phone, cuid: s.state.cuid }, i = { reconnectionAttempts: 5, reconnectionDelay: 1500, reconnectionDelayMax: 6e3, timeout: 3e4, autoReconnect: !0, transports: ["websocket"], query: { jwt: s.state.jwt } }; n.init(s.state.sigsockhost, i, r).then((() => { e(n) })).catch((e => { console.error(e), t(e) })) })), b.call(this), this.loginSuccesful = !0 } catch (t) { if ("Unauthorized Signin. Please recheck contact credentials or logout from the authorized device first and then retry." === t || 404 === t) { let e = {}; if (404 === t) throw e.code = "ERR_INVALID_CREDENTIALS", e.message = "invalid init credentials", e; throw e.code = "ERR_ALREADY_SIGNEDIN", e.message = "Unauthorized Signin. Please recheck contact credentials or logout from the authorized device first and then retry.", e } setTimeout((() => { this.signin(e) }), s.state.retryDelay) } } async call(e, t, n) { try { await navigator.mediaDevices.getUserMedia({ audio: !0 }) } catch (e) { if (!e || "Permission denied" !== e.message && "The request is not allowed by the user agent or the platform in the current context." !== e.message) throw console.error(e), e; { let e = { message: "Unable to get microphone access. Cannot make a call", code: "ERR_MIC_UNAVAILABLE" }; throw e } } return new Promise(((r, i) => { if (s.state.isBusy) { return void i({ code: "ERR_OUTGOING_CALL_IN_PROGRESS", message: "Cannot initiate another call while you're on a call" }) } if (!e || !t) { return void i({ code: "ERR_INVALID_CALL_PARAMETERS", message: "CUID and context are mandatory for calling." }) } if (e === s.state.cuid) { return void i({ code: "ERR_INVALID_CALL_PARAMETERS", message: "caller and receiver cannot be same" }) } this.context = t; let o = {}; try { k(e) } catch (e) { let t = { code: "ERR_INVALID_CALL_PARAMETERS", message: e.message }; return void i(t) } o = { cuid: e, context: t }, n && (n.recording ? (o.recording = n.recording, s.commit("setRecord", !0)) : s.commit("setRecord", !1)), s.commit("setIsBusy", !0), this.sigsock.makeCall(o).then((e => { this.ctSdk.event.push(y, { ct_account_id: this.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: e.call, cuid: s.state.cuid, epoch: Date.now(), context: e.context }), this.sigsock.incomingcall = e, s.commit("setCallId", e.call), s.commit("setCallsockHost", e.host), this.callRejector = i, this.callResolver = r, g("Outgoing call", s.state.branding), (({ color: e }) => { let t = `\n  \n  #dc__og--cancel--container {\n    color: ${(e = e || "#ffffff") || "#ffffff"}\n  }\n\n  #dc__og--cancel {\n      min-width: 40px;\n      min-height: 40px;\n      border-radius: 50%;\n      background-color: #FF453A;\n      position: relative;\n      cursor: pointer;\n    }\n\n    #dc__og--cancel>svg {\n      position: absolute;\n      top: 11px;\n      left: 10px;\n    }\n\n    .dc__og--actiontext {\n      font-style: normal;\n      font-weight: 600;\n      font-size: 14px;\n      line-height: 20px;\n      text-align: center;\n      letter-spacing: -0.01px;\n      margin: 4px auto 20px auto;\n      color: inherit;\n    }`, n = document.getElementById("dc__callactions"); if (!n) throw new Error("Cannot find the required element for call dialog rendering"); let r = "dc--outgoing"; if (!document.getElementById(r)) { let e = document.createElement("style"); e.setAttribute("id", r), e.innerHTML = t, document.getElementsByTagName("head")[0].appendChild(e) } n.innerHTML = '<div id="dc__og--cancel--container">\n        <div id="dc__og--cancel">\n          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path\n              d="M1.79619 8.10012L1.93876 7.95771C1.94636 7.95012 1.95393 7.94255 1.96199 7.9345C2.66848 7.29757 3.55866 6.80807 4.76361 6.39382C6.84725 5.66603 9.06196 5.39375 11.258 5.59545C12.9029 5.70768 14.5144 6.10987 16.0181 6.78346C16.8443 7.12814 17.5862 7.64706 18.1932 8.3048C18.6466 8.83434 18.922 9.32035 18.8988 10.1108C18.8945 10.3517 18.8405 10.5892 18.7399 10.8083C18.6393 11.0275 18.4945 11.2235 18.3145 11.3841C18.1345 11.5446 17.9233 11.6661 17.6942 11.7411C17.4651 11.816 17.223 11.8427 16.9833 11.8195L14.1415 11.4749C13.718 11.4299 13.3266 11.2293 13.043 10.9121C12.7593 10.5949 12.6036 10.1836 12.606 9.75759L12.6075 9.0709C11.5559 8.94682 9.18117 8.73603 7.25235 9.07006C7.25411 9.30436 7.25646 9.56777 7.25916 9.78235C7.26372 10.2204 7.10207 10.6442 6.80682 10.9684C6.51157 11.2927 6.10462 11.4932 5.66799 11.5297L2.75636 11.8066C2.52292 11.8256 2.28817 11.7961 2.06692 11.7198C1.84566 11.6435 1.64273 11.5222 1.47085 11.3635C1.28972 11.2005 1.14358 11.0024 1.04115 10.7812C0.93872 10.56 0.88212 10.3204 0.874838 10.0765C0.837628 9.13161 1.21483 8.68084 1.79619 8.10012Z"\n              fill="white" />\n          </svg>\n        </div>\n        <p class="dc__og--actiontext">Cancel</p>\n      </div>' })(s.state.branding), s.commit("playRinger", !0); try { this.setupCancelCall() } catch (e) { i(e) } this.setupCancelTimer(); let t = this; this.outgoingCallAcceptHandler = (e, n) => { if (s.state.callId === e.callId) { s.commit("setIsAnswered", !0), s.commit("setIsBusy", !0), s.commit("playRinger", !1), t.cancelTimer && clearTimeout(t.cancelTimer); try { g("Ongoing call", s.state.branding), R(s.state.branding), t.renderInCall() } catch (e) { console.error(e), t.callRejector(e) } d().then().catch((e => { throw console.error(e), s.commit("setIsBusy", !1), t.hangup(), e })), n({ status: !0 }), this.removeCallListners() } }, this.outgoingCallDeclineHandler = (e, n) => { s.state.callId === e.callId ? (t.cancelTimer && clearTimeout(t.cancelTimer), s.commit("playRinger", !1), v(), this.removeCallListners(), s.commit("setIsBusy", !1), n({ status: !0 }), 1001 === e.reasonCode ? t.callRejector("The user you are trying to reach is busy on another call") : t.callRejector("declined")) : t.callRejector(e) }, this.outgoingCallMissHandler = (e, n) => { s.state.callId === e.callId && (t.cancelTimer && clearTimeout(t.cancelTimer), s.commit("playRinger", !1), v(), this.removeCallListners(), s.commit("setIsBusy", !1), n({ status: !0 }), t.callRejector("missed")) }, this.sigsock.socket.once("answer", this.outgoingCallAcceptHandler), this.sigsock.socket.once("decline", this.outgoingCallDeclineHandler), this.sigsock.socket.once("miss", this.outgoingCallMissHandler) })).catch((e => { s.commit("setIsBusy", !1), s.commit("setIsAnswered", !1), console.error(e), i(e) })) })) } removeCallListners() { this.sigsock.socket.off("miss", this.outgoingCallMissHandler), this.sigsock.socket.off("decline", this.outgoingCallDeclineHandler), this.sigsock.socket.off("answer", this.outgoingCallAcceptHandler) } setupCancelTimer() { this.cancelTimer = setTimeout((() => { s.state.isAnswered || this.dialCancel() }), 35e3) } setupMissTimer() { this.missTimer = setTimeout((() => { this.miss() }), 3e4) } async answer() { try { await navigator.mediaDevices.getUserMedia({ audio: !0 }) } catch (e) { if (this.sigsock.decline(s.state.accountId), !e || "Permission denied" !== e.message && "The request is not allowed by the user agent or the platform in the current context." !== e.message) console.error(e); else { let e = new Error; e.message = "Unable to get microphone access. Cannot answer the call", e.code = "ERR_MIC_UNAVAILABLE", this.ctSdk.event.push(T, { ct_account_id: this.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: s.state.callId, cuid: s.state.cuid, epoch: Date.now(), context: s.state.context, call_status: "microphone permission not granted", reason_code: 1002 }), console.error(e) } return v(), s.commit("playRinger", !1), s.commit("setIsBusy", !1), void clearTimeout(this.missTimer) } this.isBusy = !0, s.commit("setIsBusy", !0), s.commit("playRinger", !1), this.sigsock.answer(s.state.accountId).then((() => d(this.record))).then((() => { var e; this.clearIncomingModal(), e = "Ongoing call", document.getElementById("dc__sdk--header").innerText = e, R(s.state.branding), this.renderInCall() })).catch((e => { console.error(e), s.commit("setIsBusy", !1), this.hangup() })).finally((() => { clearTimeout(this.missTimer) })) } decline() { s.state.canDeclineCall ? (s.commit("playRinger", !1), this.missTimer && clearTimeout(this.missTimer), v(), this.sigsock.decline(s.state.accountId).then((() => { let e = { ct_account_id: this.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: s.state.callId, cuid: s.state.cuid, epoch: Date.now(), context: s.state.context, call_status: "declined" }; this.ctSdk.event.push(T, e) })).catch((e => { console.error(e) })), s.commit("setIsBusy", !1)) : console.log("cannot decline while answering the call") } miss() { this.ringer.stop(), s.commit("playRinger", !1), this.missTimer && clearTimeout(this.missTimer), this.sigsock.miss(s.state.accountId).then((() => { let e = { ct_account_id: this.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: this.ctSdk.getCleverTapID(), call_id: s.state.callId, cuid: s.state.cuid, epoch: Date.now(), context: s.state.context, call_status: "missed" }; this.ctSdk.event.push(T, e) })).catch((e => { console.error(e) })), v(), this.isBusy = !1, s.commit("setIsBusy", !1) } dialCancel() { this.cancelTimer && clearTimeout(this.cancelTimer), s.commit("playRinger", !1), this.sigsock.cancel(s.state.callId).then((() => { let e = { ct_account_id: this.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: this.ctSdk.getCleverTapID(), cuid: s.state.cuid, epoch: Date.now(), context: s.state.context, call_status: "cancelled" }; this.ctSdk.event.push(T, e) })).catch((e => { console.error(e) })), this.callRejector && (this.callRejector("cancelled"), this.callRejector = void 0), this.sigsock.socket.off("miss", this.outgoingCallMissHandler), this.sigsock.socket.off("decline", this.outgoingCallDeclineHandler), this.sigsock.socket.off("answer", this.outgoingCallAcceptHandler), v(), s.commit("setIsBusy", !1) } hangup() { s.commit("setIsAnswered", !1), s.commit("setCanDeclineCall", !0), s.commit("setIsBusy", !1), s.state.playRinger && s.commit("playRinger", !1), v(), s.commit("disconnectSip", !s.state.disconnectSip), s.commit("disconnectCallsock", !s.state.disconnectCallsock); try { this.callResolver && (this.callResolver("over"), this.callResolver = void 0) } catch (e) { throw console.error(e), e } } mute() { s.commit("setIsMuted", !0), document.getElementById("dc__ong--mute").classList.add("dc__hide"), document.getElementById("dc__ong--unmute").classList.remove("dc__hide") } unmute() { s.commit("setIsMuted", !1), document.getElementById("dc__ong--unmute").classList.add("dc__hide"), document.getElementById("dc__ong--mute").classList.remove("dc__hide") } setupCancelCall() { let e = this, t = document.getElementById("dc__og--cancel--container"); if (!t) throw new Error("Cannot find cancel button in the document."); t.addEventListener("click", (function () { e.dialCancel() })) } clearIncomingModal() { document.getElementById("dc__callactions").innerHTML = null } renderInCall() { let e = this; document.getElementById("dc__sdk--timer").classList.remove("dc__hide"), document.getElementById("dc__ong--mute").addEventListener("click", (function () { e.mute() })), document.getElementById("dc__ong--unmute").addEventListener("click", (function () { e.unmute() })), document.getElementById("dc__ong--hangup--container").addEventListener("click", (function () { let t = { ct_account_id: e.ctSdk.getAccountID(), dc_account_id: s.state.accountId, guid: e.ctSdk.getCleverTapID(), call_id: s.state.callId, cuid: s.state.cuid, epoch: Date.now(), context: s.state.context, call_status: "over" }; e.ctSdk.event.push(T, t), e.hangup() })) } isEnabled() { return this.loginSuccesful } disconnect() { v(), s.commit("disconnectSip", !s.state.disconnectSip), s.commit("disconnectCallsock", !s.state.disconnectCallsock), s.commit("disconnectSigsock", !s.state.disconnectSigsock) } } async function D(e) { if (!document.getElementById("dc-sdk")) { let e = document.createElement("div"); e.setAttribute("id", "dc-sdk"), document.body.appendChild(e) } if (!e.clevertap) { throw { code: "ERR_MISSING_INITPARAMETERS", message: "Clevertap sdk not found. Please ensure that clevertap sdk is initialized and its instance is passed to direct call sdk" } } e.clevertap.setDCSDKVersion && e.clevertap.setDCSDKVersion(O), x(e), e.ringtone && s.commit("setRingtone", e.ringtone); let t = new N(e.clevertap); return await t.signin(e), t } })(); var s = r.S; export { s as init };